import{c as pt,p as Gs,P as mt}from"./phaser-c453c2dd.js";import{P as Pt,O as An,E as Ve,Q as Me,a as et,V as j,A as Jn,L as Ws,M as be,b as ie,R as es,B as bn,c as Tn,d as ts,e as _t,f as js,g as xt,D as Sn,S as zt,h as Xs,i as Ie,C as Ks,j as Ys,k as Qs,T as qs,l as ns,m as Et,n as Zs,o as Ke,p as gt,q as Gt,r as $s,s as Ne,t as _e,u as He,v as In,w as ss,x as is,y as it,z as Js,F as Ce,G as ei,W as rs,H as ti,I as ni,J as je,K as si,N as vt,U as Vt,X as Ct,Y as Wt,Z as Xe,_ as fn,$ as Nt,a0 as fe,a1 as Ue,a2 as ii,a3 as ct,a4 as dn,a5 as wt,a6 as Ht,a7 as Mn,a8 as Pn,a9 as os,aa as as,ab as ls,ac as ri,ad as Ze,ae as cs,af as us,ag as pn,ah as mn,ai as oi,aj as gn,ak as hs,al as se,am as ai,an as li,ao as ci,ap as fs,aq as ds,ar as Zt,as as ui,at as ps,au as hi,av as fi,aw as di,ax as pi,ay as mi,az as gi,aA as yi,aB as xi,aC as vi,aD as wi,aE as Ai,aF as bi,aG as Ti,aH as $t,aI as tt,aJ as Si,aK as Mi,aL as Pi,aM as Ei,aN as Ci,aO as Ri,aP as Li,aQ as ot,aR as at,aS as On,aT as jt,aU as Ii,aV as ms,aW as gs,aX as En,aY as ys,aZ as xs,a_ as Oi,a$ as ki,b0 as vs,b1 as Di}from"./three-d92eb69f.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class At{perspectiveCamera(e={}){return At.Perspective(e)}orthographicCamera(e={}){return At.Orthographic(e)}static Perspective(e={}){const{fov:t=50,aspect:s=window.innerWidth/window.innerHeight,near:i=.1,far:n=2e3,x:r=0,y:a=5,z:o=25}=e,u=new Pt(t,s,i,n);return u.position.set(r,a,o),u}static Orthographic(e={}){const t=window.innerWidth,s=window.innerHeight,{left:i=t/-2,right:n=t/2,top:r=s/2,bottom:a=s/-2,near:o=1,far:u=1e3,x:c=0,y:h=0,z:f=10}=e,l=new An(i,n,r,a,o,u);return l.position.set(c,h,f),l}}const Ot=new Map,Fi=5,Ae=(y,e=!1)=>{if(!Ot.has(y))Ot.set(y,1);else{const t=Ot.get(y);if(typeof t>"u"||t>=Fi)return;Ot.set(y,t+1)}e?console.error(`%c [enable3d] ${y} `,"background: #222; color: #bada55"):console.warn(`%c [enable3d] ${y} `,"background: #222; color: #bada55")};var Cn={},Xt={};Object.defineProperty(Xt,"__esModule",{value:!0});Xt.VERSION=void 0;Xt.VERSION="0.0.5";/**
 * @package      npmjs.com/package/@yandeu/events (events.min.js)
 *
 * @author       Arnout Kazemier (https://github.com/3rd-Eden)
 * @copyright    Copyright (c) 2014 Arnout Kazemier
 * @license      {@link https://github.com/primus/eventemitter3/blob/master/LICENSE|MIT}
 *
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/yandeu/events
 * @license      {@link https://github.com/yandeu/events/blob/master/LICENSE|MIT}
 */var kn=pt&&pt.__spreadArray||function(y,e){for(var t=0,s=e.length,i=y.length;t<s;t++,i++)y[i]=e[t];return y};Object.defineProperty(Cn,"__esModule",{value:!0});var bt=Cn.Events=void 0,Bi=Xt,Vi=function(){function y(e,t,s){s===void 0&&(s=!1),this.fn=e,this.context=t,this.once=s}return y}(),Dn=function(y,e,t,s,i){if(typeof t!="function")throw new TypeError("The listener must be a function");var n=new Vi(t,s||y,i);return y._events.has(e)?y._events.get(e).fn?y._events.set(e,[y._events.get(e),n]):y._events.get(e).push(n):(y._events.set(e,n),y._eventsCount++),y},kt=function(y,e){--y._eventsCount===0?y._events=new Map:y._events.delete(e)},Ni=function(){function y(){this._events=new Map,this._eventsCount=0}return Object.defineProperty(y,"VERSION",{get:function(){return Bi.VERSION},enumerable:!1,configurable:!0}),y.prototype.eventNames=function(){return Array.from(this._events.keys())},y.prototype.listeners=function(e){var t=this._events.get(e);if(!t)return[];if(t.fn)return[t.fn];for(var s=0,i=t.length,n=new Array(i);s<i;s++)n[s]=t[s].fn;return n},y.prototype.listenerCount=function(e){var t=this._events.get(e);return t?t.fn?1:t.length:0},y.prototype.emit=function(e){for(var t,s,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];if(!this._events.has(e))return!1;var r=this._events.get(e),a;if(r.fn)return r.once&&this.removeListener(e,r.fn,void 0,!0),(t=r.fn).call.apply(t,kn([r.context],i)),!0;var o=r.length;for(a=0;a<o;a++)r[a].once&&this.removeListener(e,r[a].fn,void 0,!0),(s=r[a].fn).call.apply(s,kn([r[a].context],i));return!0},y.prototype.on=function(e,t,s){return Dn(this,e,t,s,!1)},y.prototype.once=function(e,t,s){return Dn(this,e,t,s,!0)},y.prototype.removeListener=function(e,t,s,i){if(!this._events.has(e))return this;if(!t)return kt(this,e),this;var n=this._events.get(e);if(n.fn)n.fn===t&&(!i||n.once)&&(!s||n.context===s)&&kt(this,e);else{for(var r=0,a=[],o=n.length;r<o;r++)(n[r].fn!==t||i&&!n[r].once||s&&n[r].context!==s)&&a.push(n[r]);a.length?this._events.set(e,a.length===1?a[0]:a):kt(this,e)}return this},y.prototype.removeAllListeners=function(e){return e?this._events.delete(e)&&kt(this,e):(this._events=new Map,this._eventsCount=0),this},Object.defineProperty(y.prototype,"off",{get:function(){return this.removeListener},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"addListener",{get:function(){return this.on},enumerable:!1,configurable:!0}),y}();bt=Cn.Events=Ni;/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Hi{constructor(e,t){this.physics=e,this.ammo=t,this.ignoreScale=!1,this.isSoftBody=!1,this.offset={x:0,y:0,z:0},this.errors=[],this.checkCollisions=!1,this.impact=[],this.breakable=!1,this.fractureImpulse=1,this.didUpdate=!1,this.skipUpdate=!1,this._emitUpdateEvents=!1,this._needUpdate=!1,this.tmpEuler=new Ve,this.tmpQuaternion=new Me,this.tmpBtVector3=new Ammo.btVector3,this.tmpBtVector3_1=new Ammo.btVector3,this.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),this.eventEmitter=new bt,this.name=t.name}destructor(){this.eventEmitter&&this.eventEmitter.removeAllListeners(),Ammo.destroy(this.tmpBtVector3),Ammo.destroy(this.tmpBtVector3_1),Ammo.destroy(this.tmpBtQuaternion),Ammo.destroy(this.ammo.getCollisionShape()),Ammo.destroy(this.ammo)}setupEventEmitter(){typeof this.eventEmitter>"u"&&(this.eventEmitter=new bt)}get needUpdate(){return this._needUpdate}set needUpdate(e){!e&&this._needUpdate&&(this.didUpdate=!0),this._needUpdate=e}onUpdateEvent(e,t=!1){this.setupEventEmitter(),this._emitUpdateEvents=!0,t?this.eventEmitter.once("update",()=>{e()}):this.eventEmitter.on("update",()=>{e()})}get on(){return{update:e=>this.onUpdateEvent(e),collision:e=>this.onCollision(e)}}get once(){return{update:e=>this.onUpdateEvent(e,!0)}}onCollision(e){this.checkCollisions=!0,this.physics.collisionEvents.on("collision",t=>{const{bodies:s,event:i}=t;s[0].name===this.name?e(s[1],i):s[1].name===this.name&&e(s[0],i)})}transform(){const e=this.physics.worldTransform;this.ammo.getMotionState().getWorldTransform(e)}refresh(){const e=this.physics.worldTransform;this.ammo.getMotionState().setWorldTransform(e)}setRotation(e,t,s){const i=this.tmpEuler.set(e,t,s),n=this.tmpQuaternion.set(0,0,0,1);n.setFromEuler(i),this.tmpBtQuaternion.setValue(0,0,0,1);const r=this.tmpBtQuaternion;r.setValue(n.x,n.y,n.z,n.w),this.physics.worldTransform.setRotation(r)}get rotation(){let e,t,s;const n=this.physics.worldTransform.getRotation();let r=this.tmpQuaternion.set(n.x(),n.y(),n.z(),n.w());r.w>1&&(r=r.normalize());const a=2*Math.acos(r.w),o=Math.sqrt(1-r.w*r.w);return o<.001?(e=r.x,t=r.y,s=r.z):(e=r.x/o,t=r.y/o,s=r.z/o),{x:e*a,y:t*a,z:s*a}}get quaternion(){const t=this.physics.worldTransform.getRotation();return{x:t.x(),y:t.y(),z:t.z(),w:t.w()}}setPosition(e,t,s){this.physics.worldTransform.getOrigin().setValue(e,t,s)}get position(){const e=this.physics.worldTransform;return{x:e.getOrigin().x(),y:e.getOrigin().y(),z:e.getOrigin().z()}}get velocity(){return{x:this.ammo.getLinearVelocity().x(),y:this.ammo.getLinearVelocity().y(),z:this.ammo.getLinearVelocity().z()}}get angularVelocity(){return{x:this.ammo.getAngularVelocity().x(),y:this.ammo.getAngularVelocity().y(),z:this.ammo.getAngularVelocity().z()}}setVelocity(e,t,s){this.tmpBtVector3.setValue(e,t,s),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityX(e){this.tmpBtVector3.setValue(e,this.velocity.y,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityY(e){this.tmpBtVector3.setValue(this.velocity.x,e,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityZ(e){this.tmpBtVector3.setValue(this.velocity.x,this.velocity.y,e),this.ammo.setLinearVelocity(this.tmpBtVector3)}setAngularVelocity(e,t,s){this.tmpBtVector3.setValue(e,t,s),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityX(e){this.tmpBtVector3.setValue(e,this.angularVelocity.y,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityY(e){this.tmpBtVector3.setValue(this.angularVelocity.x,e,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityZ(e){this.tmpBtVector3.setValue(this.angularVelocity.x,this.angularVelocity.y,e),this.ammo.setAngularVelocity(this.tmpBtVector3)}applyForce(e,t,s){this.tmpBtVector3.setValue(e,t,s),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceX(e){this.tmpBtVector3.setValue(e,0,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceY(e){this.tmpBtVector3.setValue(0,e,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceZ(e){this.tmpBtVector3.setValue(0,0,e),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyCentralForce(e,t,s){this.tmpBtVector3.setValue(e,t,s),this.ammo.applyCentralForce(this.tmpBtVector3)}applyCentralImpulse(e,t,s){this.tmpBtVector3.setValue(e,t,s),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyCentralLocalForce(e,t,s){this.tmpBtVector3.setValue(e,t,s),this.ammo.applyCentralLocalForce(this.tmpBtVector3)}applyImpulse(e,t){this.tmpBtVector3.setValue(e.x||0,e.y||0,e.z||0),this.tmpBtVector3_1.setValue(t.x||0,t.y||0,t.z||0),this.ammo.applyImpulse(this.tmpBtVector3,this.tmpBtVector3_1)}applyLocalTorque(e,t,s){this.tmpBtVector3.setValue(e,t,s),this.ammo.applyLocalTorque(this.tmpBtVector3)}applyTorque(e,t,s){this.tmpBtVector3.setValue(e,t,s),this.ammo.applyTorque(this.tmpBtVector3)}applyTorqueImpulse(e,t,s){this.tmpBtVector3.setValue(e,t,s),this.ammo.applyTorqueImpulse(this.tmpBtVector3)}setCollisionFlags(e){this.ammo.setCollisionFlags(e)}getCollisionFlags(){return this.ammo.getCollisionFlags()}setRestitution(e){this.ammo.setRestitution(e)}setBounciness(e){this.setRestitution(e)}setFriction(e){this.ammo.setFriction(e)}setDamping(e,t){this.ammo.setDamping(e,t)}setGravity(e,t,s){this.tmpBtVector3.setValue(e,t,s),this.ammo.setGravity(this.tmpBtVector3)}setLinearFactor(e,t,s){this.tmpBtVector3.setValue(e,t,s),this.ammo.setLinearFactor(this.tmpBtVector3)}setAngularFactor(e,t,s){this.tmpBtVector3.setValue(e,t,s),this.ammo.setAngularFactor(this.tmpBtVector3)}setCcdMotionThreshold(e){this.ammo.setCcdMotionThreshold(e)}setCcdSweptSphereRadius(e){this.ammo.setCcdSweptSphereRadius(e)}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Ui extends et{constructor(){super(),this.isExtendedObject3D=!0,this.isGroup=!1,this.vector3=new j,this.hasBody=!1,this.fragmentDepth=0,this.breakable=!1,this.fractureImpulse=1,this._currentAnimation="",this._animationActions=new Map,this.name=`object-${this.id}`}get world(){return{theta:this.worldTheta,phi:this.worldPhi}}get worldTheta(){return this.getWorldDirection(this.vector3),Math.atan2(this.vector3.x,this.vector3.z)}get worldPhi(){return this.getWorldDirection(this.vector3),Math.acos(this.vector3.y)}set animationMixer(e){this._animationMixer=e}get animationMixer(){return this._animationMixer||(this._animationMixer=new Jn(this)),this._animationMixer}get anims(){return{current:this._currentAnimation,add:(e,t)=>this._animsAdd(e,t),get:e=>this._animsGet(e),play:(e,t=500,s=!0)=>this._animsPlay(e,t,s),mixer:this.animationMixer}}get animation(){return Ae('Please use "anims" instead of "animation"'),this.anims}_animsAdd(e,t){this._animationActions.set(e,this.animationMixer.clipAction(t))}_animsGet(e){const t=this._animationActions.get(e);return t||Ae(`Animation(${e}) not found!`),t}_animsPlay(e,t=500,s=!0){const i=this._animationActions.get(e),n=this._animationActions.get(this._currentAnimation);i&&(i.reset(),n&&(i.crossFadeFrom(n,t/1e3,!0),i.clampWhenFinished=!0),s||i.setLoop(Ws,0),i.play()),this._currentAnimation=e}setAction(e){Ae(`setAction(${e}) is deprecated. Use animation.play(${e}) instead!`)}traverse(e){super.traverse(e)}traverseVisible(e){super.traverseVisible(e)}traverseAncestors(e){super.traverseAncestors(e)}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class ws extends be{constructor(e,t){super(e,t),this.isExtendedMesh=!0,this.isGroup=!1,this.vector3=new j,this.hasBody=!1,this.fragmentDepth=0,this.breakable=!1,this.fractureImpulse=1,this.name=`object-${this.id}`}get world(){return{theta:this.worldTheta,phi:this.worldPhi}}get worldTheta(){return this.getWorldDirection(this.vector3),Math.atan2(this.vector3.x,this.vector3.z)}get worldPhi(){return this.getWorldDirection(this.vector3),Math.acos(this.vector3.y)}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class _i{constructor(e,t){this.factory=e,this.addExisting=t}addPlane(e={},t={}){const s=this.factory.add.plane(e,t);return this.addExisting(s,e),s}addSphere(e={},t={}){const s=this.factory.add.sphere(e,t);return this.addExisting(s,e),s}addBox(e={},t={}){const s=this.factory.add.box(e,t);return this.addExisting(s,e),s}addGround(e,t={}){const s=this.factory.add.ground(e,t),i={...e,mass:0,collisionFlags:1};return this.addExisting(s,i),s}addCapsule(e={},t={}){const s=this.factory.add.capsule(e,t);return this.addExisting(s,e),s}addCylinder(e={},t={}){const s=this.factory.add.cylinder(e,t);return this.addExisting(s,e),s}addCone(e={},t={}){const s=this.factory.add.cone(e,t);return this.addExisting(s,e),s}addTorus(e={},t={}){const s=this.factory.add.torus(e,t);return this.addExisting(s,e),s}addExtrude(e,t={}){const s=this.factory.add.extrude(e,t);return s.translateX(1),this.addExisting(s),s}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class zi{constructor(e,t){this.worldTransform=e,this.physicsWorld=t,this.tmpBtVector3=new Ammo.btVector3}toAmmoV3(e,t=0){return new Ammo.btVector3(typeof(e==null?void 0:e.x)<"u"?e.x:t,typeof(e==null?void 0:e.y)<"u"?e.y:t,typeof(e==null?void 0:e.z)<"u"?e.z:t)}get addConstraints(){return{lock:(e,t,s)=>this.lock(e,t,s),fixed:(e,t,s)=>this.fixed(e,t,s),pointToPoint:(e,t,s,i)=>this.pointToPoint(e,t,s,i),hinge:(e,t,s,i)=>this.hinge(e,t,s,i),slider:(e,t,s={},i)=>this.slider(e,t,s,i),spring:(e,t,s={},i)=>this.spring(e,t,s,i),coneTwist:(e,t,s={frameA:{},frameB:{}},i)=>this.coneTwist(e,t,s,i),dof:(e,t,s,i)=>this.dof(e,t,s,i)}}getTransform(e,t,s={x:0,y:0,z:0},i=!1){s={x:0,y:0,z:0,...s};const n=(a,o)=>{var u=(a.x()-o.x())/2+s.x,c=(a.y()-o.y())/2+s.y,h=(a.z()-o.z())/2+s.z;return new Ammo.btVector3(u,c,h)},r=new Ammo.btTransform;if(r.setIdentity(),i){const a=n(e.getWorldTransform().getOrigin(),t.getWorldTransform().getOrigin()),o=new Ammo.btTransform;o.setIdentity(),o.setOrigin(a);const u=e.getCenterOfMassTransform().inverse().op_mul(t.getWorldTransform());return u.op_mul(o),{transformA:u,transformB:o}}else return r.setOrigin(new Ammo.btVector3(s.x,s.y,s.z)),{transformA:e.getCenterOfMassTransform().inverse().op_mul(t.getWorldTransform()).op_mul(r),transformB:r}}lock(e,t,s=!0){const i={x:0,y:0,z:0};return this.dof(e,t,{angularLowerLimit:i,angularUpperLimit:i},s)}fixed(e,t,s=!0){const i=this.getTransform(e.ammo,t.ammo);i.transformA.setRotation(e.ammo.getWorldTransform().getRotation()),i.transformB.setRotation(t.ammo.getWorldTransform().getRotation());const n=new Ammo.btFixedConstraint(e.ammo,t.ammo,i.transformA,i.transformB);return this.physicsWorld.addConstraint(n,s),n}pointToPoint(e,t,s={},i=!0){const{pivotA:n,pivotB:r}=s,a=new Ammo.btVector3((n==null?void 0:n.x)||0,(n==null?void 0:n.y)||0,(n==null?void 0:n.z)||0),o=new Ammo.btVector3((r==null?void 0:r.x)||0,(r==null?void 0:r.y)||0,(r==null?void 0:r.z)||0),u=new Ammo.btPoint2PointConstraint(e.ammo,t.ammo,a,o);return this.physicsWorld.addConstraint(u,i),u}hinge(e,t,s={},i=!0){const{pivotA:n,pivotB:r,axisA:a,axisB:o}=s,u=new Ammo.btVector3((n==null?void 0:n.x)||0,(n==null?void 0:n.y)||0,(n==null?void 0:n.z)||0),c=new Ammo.btVector3((r==null?void 0:r.x)||0,(r==null?void 0:r.y)||0,(r==null?void 0:r.z)||0),h=new Ammo.btVector3((a==null?void 0:a.x)||0,(a==null?void 0:a.y)||0,(a==null?void 0:a.z)||0),f=new Ammo.btVector3((o==null?void 0:o.x)||0,(o==null?void 0:o.y)||0,(o==null?void 0:o.z)||0),l=new Ammo.btHingeConstraint(e.ammo,t.ammo,u,c,h,f,!0);return this.physicsWorld.addConstraint(l,i),l}slider(e,t,s={},i=!0){const n=this.getTransform(e.ammo,t.ammo),{frameA:r={},frameB:a={},linearLowerLimit:o=0,linearUpperLimit:u=0,angularLowerLimit:c=0,angularUpperLimit:h=0}=s,f=n.transformA.getRotation();f.setEulerZYX(r.x||0,r.y||0,r.z||0),n.transformA.setRotation(f);const l=n.transformB.getRotation();l.setEulerZYX(a.x||0,a.y||0,a.z||0),n.transformB.setRotation(l);const d=new Ammo.btSliderConstraint(e.ammo,t.ammo,n.transformA,n.transformB,!0);return d.setLowerLinLimit(o),d.setUpperLinLimit(u),d.setLowerAngLimit(c),d.setUpperAngLimit(h),this.physicsWorld.addConstraint(d,i),d}spring(e,t,s={},i=!0){const{stiffness:n=50,damping:r=.01,angularLock:a=!1,linearLowerLimit:o={},linearUpperLimit:u={},angularLowerLimit:c={},angularUpperLimit:h={},offset:f={},center:l=!1,enableSpring:d=!0}=s,p={x:0,y:0,z:0,...f},m=this.getTransform(e.ammo,t.ammo,p,l),x=new Ammo.btGeneric6DofSpringConstraint(e.ammo,t.ammo,m.transformA,m.transformB,!0);this.tmpBtVector3.setValue(o.x||0,o.y||0,o.z||0),x.setLinearLowerLimit(this.tmpBtVector3),this.tmpBtVector3.setValue(u.x||0,u.y||0,u.z||0),x.setLinearUpperLimit(this.tmpBtVector3),a?(this.tmpBtVector3.setValue(0,0,0),x.setAngularLowerLimit(this.tmpBtVector3),x.setAngularUpperLimit(this.tmpBtVector3)):(console.log(c,h),x.setAngularLowerLimit(this.toAmmoV3(c,-Math.PI)),x.setAngularUpperLimit(this.toAmmoV3(h,Math.PI)));for(let b=0;b<3;b++)x.enableSpring(b,d),x.setStiffness(b,n),x.setDamping(b,r);return this.physicsWorld.addConstraint(x,i),x}coneTwist(e,t,s,i=!0){const{frameA:n,frameB:r}=s,a=new Ammo.btTransform;a.setIdentity(),a.getOrigin().setValue((n==null?void 0:n.x)||0,(n==null?void 0:n.y)||0,(n==null?void 0:n.z)||0);const o=new Ammo.btTransform;o.setIdentity(),o.getOrigin().setValue((r==null?void 0:r.x)||0,(r==null?void 0:r.y)||0,(r==null?void 0:r.z)||0),this.getTransform(e.ammo,t.ammo);const u=new Ammo.btConeTwistConstraint(t.ammo,e.ammo,a,o);return u.setAngularOnly(!0),this.physicsWorld.addConstraint(u,i),u}dof(e,t,s={},i=!0){const{offset:n,center:r=!1}=s,a={x:0,y:0,z:0,...n},o=this.getTransform(e.ammo,t.ammo,a,r),u=new Ammo.btGeneric6DofConstraint(e.ammo,t.ammo,o.transformA,o.transformB,!0),{linearLowerLimit:c,linearUpperLimit:h,angularLowerLimit:f,angularUpperLimit:l}=s,d=this.toAmmoV3(c),p=this.toAmmoV3(h),m=this.toAmmoV3(f,-Math.PI),x=this.toAmmoV3(l,Math.PI);return u.setLinearLowerLimit(d),u.setLinearUpperLimit(p),u.setAngularLowerLimit(m),u.setAngularUpperLimit(x),Ammo.destroy(d),Ammo.destroy(p),Ammo.destroy(m),Ammo.destroy(x),this.physicsWorld.addConstraint(u,i),u}}/**
 * @author       Kevin Lee (https://github.com/InfiniteLee)
 * @copyright    Copyright (c) 2020 Kevin Lee; Project Url: https://github.com/InfiniteLee/three-to-ammo
 * @license      {@link https://github.com/InfiniteLee/three-to-ammo/blob/master/LICENSE|MPL-2.0}
 */const Rt={BOX:"box",CYLINDER:"cylinder",SPHERE:"sphere",CAPSULE:"capsule",CONE:"cone",HULL:"hull",HACD:"hacd",VHACD:"vhacd",MESH:"mesh",HEIGHTFIELD:"heightfield"},Lt={ALL:"all",MANUAL:"manual"},Gi=function(){const y=new j,e=new j,t=new ie;return function(s,i,n,r={}){if(r.type=Rt.HULL,Kt(r),r.fit===Lt.MANUAL)return console.warn("cannot use fit: manual with type: hull"),null;const a=Rn(s,i),o=new Ammo.btVector3,u=new Ammo.btConvexHullShape;u.setMargin(r.margin),e.addVectors(a.max,a.min).multiplyScalar(.5);let c=0;for(let d=0;d<s.length;d++)c+=s[d].length/3;const h=r.hullMaxVertices||1e5;c>h&&console.warn(`too many vertices for hull shape; sampling ~${h} from ~${c} vertices`);const f=Math.min(1,h/c);for(let d=0;d<s.length;d++){const p=s[d];t.fromArray(i[d]);for(let m=0;m<p.length;m+=3){const x=d===s.length-1&&m===p.length-3;(Math.random()<=f||x)&&(y.set(p[m],p[m+1],p[m+2]).applyMatrix4(t).sub(e),o.setValue(y.x,y.y,y.z),u.addPoint(o,x))}}let l=u;if(u.getNumVertices()>=100){const d=new Ammo.btShapeHull(u);d.buildHull(r.margin),Ammo.destroy(u),l=new Ammo.btConvexHullShape(Ammo.getPointer(d.getVertexPointer()),d.numVertices()),Ammo.destroy(d)}return Ammo.destroy(o),Yt(l,r,Qt(n,r)),l}}(),Wi=function(){const y=new j,e=new j,t=new ie;return function(s,i,n,r,a={}){if(a.type=Rt.HACD,Kt(a),a.fit===Lt.MANUAL)return console.warn("cannot use fit: manual with type: hacd"),[];if(!Ammo.hasOwnProperty("HACD"))return console.warn("HACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];const o=Rn(s,i);Qt(r,a);let u=0,c=0;e.addVectors(o.max,o.min).multiplyScalar(.5);for(let b=0;b<s.length;b++)u+=s[b].length/3,n&&n[b]?c+=n[b].length/3:c+=s[b].length/9;const h=new Ammo.HACD;a.hasOwnProperty("compacityWeight")&&h.SetCompacityWeight(a.compacityWeight),a.hasOwnProperty("volumeWeight")&&h.SetVolumeWeight(a.volumeWeight),a.hasOwnProperty("nClusters")&&h.SetNClusters(a.nClusters),a.hasOwnProperty("nVerticesPerCH")&&h.SetNVerticesPerCH(a.nVerticesPerCH),a.hasOwnProperty("concavity")&&h.SetConcavity(a.concavity);const f=Ammo._malloc(u*3*8),l=Ammo._malloc(c*3*4);h.SetPoints(f),h.SetTriangles(l),h.SetNPoints(u),h.SetNTriangles(c);let d=f/8,p=l/4;for(let b=0;b<s.length;b++){const v=s[b];t.fromArray(i[b]);for(let T=0;T<v.length;T+=3)y.set(v[T+0],v[T+1],v[T+2]).applyMatrix4(t).sub(e),Ammo.HEAPF64[d+0]=y.x,Ammo.HEAPF64[d+1]=y.y,Ammo.HEAPF64[d+2]=y.z,d+=3;if(n[b]){const T=n[b];for(let g=0;g<T.length;g++)Ammo.HEAP32[p]=T[g],p++}else for(let T=0;T<v.length/3;T++)Ammo.HEAP32[p]=T,p++}h.Compute(),Ammo._free(f),Ammo._free(l);const m=h.GetNClusters(),x=[];for(let b=0;b<m;b++){const v=new Ammo.btConvexHullShape;v.setMargin(a.margin);const T=h.GetNPointsCH(b),g=h.GetNTrianglesCH(b),w=Ammo._malloc(T*3*8),S=Ammo._malloc(g*3*4);h.GetCH(b,w,S);const A=w/8;for(let P=0;P<T;P++){const M=new Ammo.btVector3,L=Ammo.HEAPF64[A+P*3+0],C=Ammo.HEAPF64[A+P*3+1],k=Ammo.HEAPF64[A+P*3+2];M.setValue(L,C,k),v.addPoint(M,P===T-1),Ammo.destroy(M)}Yt(),x.push(v)}return x}}(),ji=function(){const y=new j,e=new j,t=new ie;return function(s,i,n,r,a={}){if(a.type=Rt.VHACD,Kt(a),a.fit===Lt.MANUAL)return console.warn("cannot use fit: manual with type: vhacd"),[];if(!Ammo.hasOwnProperty("VHACD"))return console.warn("VHACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];const o=Rn(s,i);Qt(r,a);let u=0,c=0;e.addVectors(o.max,o.min).multiplyScalar(.5);for(let T=0;T<s.length;T++)u+=s[T].length/3,n&&n[T]?c+=n[T].length/3:c+=s[T].length/9;const h=new Ammo.VHACD,f=new Ammo.Parameters;a.hasOwnProperty("resolution")&&f.set_m_resolution(a.resolution),a.hasOwnProperty("depth")&&f.set_m_depth(a.depth),a.hasOwnProperty("concavity")&&f.set_m_concavity(a.concavity),a.hasOwnProperty("planeDownsampling")&&f.set_m_planeDownsampling(a.planeDownsampling),a.hasOwnProperty("convexhullDownsampling")&&f.set_m_convexhullDownsampling(a.convexhullDownsampling),a.hasOwnProperty("alpha")&&f.set_m_alpha(a.alpha),a.hasOwnProperty("beta")&&f.set_m_beta(a.beta),a.hasOwnProperty("gamma")&&f.set_m_gamma(a.gamma),a.hasOwnProperty("pca")&&f.set_m_pca(a.pca),a.hasOwnProperty("mode")&&f.set_m_mode(a.mode),a.hasOwnProperty("maxNumVerticesPerCH")&&f.set_m_maxNumVerticesPerCH(a.maxNumVerticesPerCH),a.hasOwnProperty("minVolumePerCH")&&f.set_m_minVolumePerCH(a.minVolumePerCH),a.hasOwnProperty("convexhullApproximation")&&f.set_m_convexhullApproximation(a.convexhullApproximation),a.hasOwnProperty("oclAcceleration")&&f.set_m_oclAcceleration(a.oclAcceleration);const l=Ammo._malloc(u*3*8+3),d=Ammo._malloc(c*3*4);let p=l/8,m=d/4;for(let T=0;T<s.length;T++){const g=s[T];t.fromArray(i[T]);for(let w=0;w<g.length;w+=3)y.set(g[w+0],g[w+1],g[w+2]).applyMatrix4(t).sub(e),Ammo.HEAPF64[p+0]=y.x,Ammo.HEAPF64[p+1]=y.y,Ammo.HEAPF64[p+2]=y.z,p+=3;if(n[T]){const w=n[T];for(let S=0;S<w.length;S++)Ammo.HEAP32[m]=w[S],m++}else for(let w=0;w<g.length/3;w++)Ammo.HEAP32[m]=w,m++}h.Compute(l,3,u,d,3,c,f),Ammo._free(l),Ammo._free(d);const x=h.GetNConvexHulls(),b=[],v=new Ammo.ConvexHull;for(let T=0;T<x;T++){h.GetConvexHull(T,v);const g=v.get_m_nPoints();v.get_m_points();const w=new Ammo.btConvexHullShape;w.setMargin(a.margin);for(let S=0;S<g;S++){const A=new Ammo.btVector3,P=v.get_m_points(S*3+0),M=v.get_m_points(S*3+1),L=v.get_m_points(S*3+2);A.setValue(P,M,L),w.addPoint(A,S===g-1),Ammo.destroy(A)}Yt(),b.push(w)}return Ammo.destroy(v),Ammo.destroy(h),b}}(),Jt=function(){const y=new j,e=new j,t=new j,s=new ie;return function(i,n,r,a,o={}){if(o.type=Rt.MESH,Kt(o),o.fit===Lt.MANUAL)return console.warn("cannot use fit: manual with type: mesh"),null;const u=Qt(a,o),c=new Ammo.btVector3,h=new Ammo.btVector3,f=new Ammo.btVector3,l=new Ammo.btTriangleMesh(!0,!1);for(let m=0;m<i.length;m++){const x=i[m],b=r[m]?r[m]:null;if(s.fromArray(n[m]),b)for(let v=0;v<b.length;v+=3){const T=b[v]*3,g=b[v+1]*3,w=b[v+2]*3;y.set(x[T],x[T+1],x[T+2]).applyMatrix4(s),e.set(x[g],x[g+1],x[g+2]).applyMatrix4(s),t.set(x[w],x[w+1],x[w+2]).applyMatrix4(s),c.setValue(y.x,y.y,y.z),h.setValue(e.x,e.y,e.z),f.setValue(t.x,t.y,t.z),l.addTriangle(c,h,f,!1)}else for(let v=0;v<x.length;v+=9)y.set(x[v+0],x[v+1],x[v+2]).applyMatrix4(s),e.set(x[v+3],x[v+4],x[v+5]).applyMatrix4(s),t.set(x[v+6],x[v+7],x[v+8]).applyMatrix4(s),c.setValue(y.x,y.y,y.z),h.setValue(e.x,e.y,e.z),f.setValue(t.x,t.y,t.z),l.addTriangle(c,h,f,!1)}const d=new Ammo.btVector3(u.x,u.y,u.z);l.setScaling(d),Ammo.destroy(d);let p;return o.concave?p=new Ammo.btBvhTriangleMeshShape(l,!0,!0):p=new Ammo.btConvexTriangleMeshShape(l,!0),p.resources=[l],Ammo.destroy(c),Ammo.destroy(h),Ammo.destroy(f),Yt(),p}}();function Kt(y){y.type=y.type||Rt.HULL,y.margin=y.hasOwnProperty("margin")?y.margin:.01}const Yt=function(y,e,t){},Xi=function(){const y=new ie;return function(e,t,s){parseInt(es)>=123?y.copy(e.matrixWorld).invert():y.getInverse(e.matrixWorld),new j().setFromMatrixScale(e.matrixWorld),e.traverse(n=>{const r=new ie;n.isMesh&&(t.includeInvisible||n.el&&n.el.object3D.visible||n.visible)&&(n===e?r.identity():(n.updateWorldMatrix(!0),r.multiplyMatrices(y,n.matrixWorld)),s(n.geometry.isBufferGeometry?n.geometry.attributes.position.array:n.geometry.vertices,r.elements,n.geometry.index?n.geometry.index.array:null))})}}(),Qt=function(){const y=new ie;return function(e,t={}){const s=new j(1,1,1);return t.fit===Lt.ALL&&(y.fromArray(e),s.setFromMatrixScale(y)),s}}();(function(){const y=new j;return function(e,t,s){let i=0,{x:n,y:r,z:a}=s.getCenter(y);return As(e,t,o=>{const u=n-o.x,c=r-o.y,h=a-o.z;i=Math.max(i,u*u+c*c+h*h)}),Math.sqrt(i)}})();const Rn=function(y,e){const t=new bn;let s=1/0,i=1/0,n=1/0,r=-1/0,a=-1/0,o=-1/0;return t.min.set(0,0,0),t.max.set(0,0,0),As(y,e,u=>{u.x<s&&(s=u.x),u.y<i&&(i=u.y),u.z<n&&(n=u.z),u.x>r&&(r=u.x),u.y>a&&(a=u.y),u.z>o&&(o=u.z)}),t.min.set(s,i,n),t.max.set(r,a,o),t},As=function(){const y=new j,e=new ie;return function(t,s,i){for(let n=0;n<t.length;n++){e.fromArray(s[n]);for(let r=0;r<t[n].length;r+=3)y.set(t[n][r],t[n][r+1],t[n][r+2]).applyMatrix4(e),i(y)}}}();/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */const Ki=(y,e)=>{const{radius:t=1,tube:s=.4,tubularSegments:i=8}=y,n=Math.PI,r=i,a=Math.sqrt(2*s*s-2*s*s*Math.cos(2*n/r)),o=new Ammo.btVector3(s,n/r+.5*a,s),u=new Ammo.btCylinderShape(o);u.setMargin(.05);const c=new Ammo.btCompoundShape,h=new Ammo.btVector3(0,0,1),f=new Ammo.btVector3(0,t,0),l=new Ammo.btQuaternion(e.x,e.y,e.z,e.w);for(let d=0;d<r;d++){const p=d*2*n/r,m=f.rotate(h,p),x=new Ammo.btTransform;l.setRotation(h,p+Math.PI/2),x.setIdentity(),x.setOrigin(m),x.setRotation(l),c.addChildShape(x,u)}return c};class bs{constructor(){this._defaultMaterial=new Tn({color:13421772})}get(){return this._defaultMaterial}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Ts{constructor(e){this.scene=e,this.isHeadless=e==="headless",this.defaultMaterial=new bs}get make(){return{plane:(e={},t={})=>this.makePlane(e,t),box:(e={},t={})=>this.makeBox(e,t),sphere:(e={},t={})=>this.makeSphere(e,t),capsule:(e={},t={})=>this.makeCapsule(e,t),cylinder:(e={},t={})=>this.makeCylinder(e,t),cone:(e={},t={})=>this.makeCone(e,t),torus:(e={},t={})=>this.makeTorus(e,t),extrude:(e,t={})=>this.makeExtrude(e,t)}}get add(){return{mesh:e=>this.addMesh(e),existing:e=>this.addExisting(e),plane:(e={},t={})=>this.addPlane(e,t),box:(e={},t={})=>this.addBox(e,t),ground:(e,t={})=>this.addGround(e,t),sphere:(e={},t={})=>this.addSphere(e,t),capsule:(e={},t={})=>this.addCapsule(e,t),cylinder:(e={},t={})=>this.addCylinder(e,t),cone:(e={},t={})=>this.addCone(e,t),torus:(e={},t={})=>this.addTorus(e,t),extrude:(e,t={})=>this.addExtrude(e,t),material:(e={})=>this.addMaterial(e)}}addExisting(...e){this.scene!=="headless"&&this.scene.add(...e)}addMesh(e){if(Array.isArray(e))for(let t=0;t<e.length;t++)this.addExisting(e[t]);else this.addExisting(e);return this}createMesh(e,t,s){const{x:i=0,y:n=0,z:r=0}=s;let a;switch(!Array.isArray(t)&&t.type){case"LineBasicMaterial":a=new _t(e,t);break;case"PointsMaterial":a=new ts(e,t);break;default:a=new ws(e,t);break}return a.position.set(i,n,r),a.castShadow=a.receiveShadow=!0,a}makeExtrude(e,t){const{x:s,y:i,z:n,name:r,shape:a,autoCenter:o=!0,breakable:u=!1,...c}=e,{depth:h=1,bevelEnabled:f=!1}=c,l=new js(a,{depth:h,bevelEnabled:f,...c}),d=this.addMaterial(t),p=this.createMesh(l,d,{x:s,y:i,z:n});return o&&p.geometry.center(),p.name=r||`body_id_${p.id}`,p.shape="extrude",p}addExtrude(e,t={}){const s=this.makeExtrude(e,t);return this.addExisting(s),s}makePlane(e,t){const{x:s,y:i,z:n,name:r,breakable:a=!1,...o}=e,u=new xt(o.width||1,o.height||1,o.widthSegments||1,o.heightSegments||1),c=this.addMaterial(t);c.side=Sn;const h=this.createMesh(u,c,{x:s,y:i,z:n});return h.name=r||`body_id_${h.id}`,h.shape="plane",h}addPlane(e,t){const s=this.makePlane(e,t);return this.addExisting(s),s}makeSphere(e,t){const{x:s,y:i,z:n,name:r,breakable:a=!1,...o}=e,u=new zt(o.radius||1,o.widthSegments||16,o.heightSegments||12,o.phiStart||void 0,o.phiLength||void 0,o.thetaStart||void 0,o.thetaLength||void 0),c=this.addMaterial(t),h=this.createMesh(u,c,{x:s,y:i,z:n});return h.name=r||`body_id_${h.id}`,h.shape="sphere",h}addSphere(e={},t={}){const s=this.makeSphere(e,t);return this.addExisting(s),s}makeBox(e,t){const{x:s,y:i,z:n,name:r,breakable:a=!1,...o}=e,u=new Xs(o.width||1,o.height||1,o.depth||1,o.widthSegments||void 0,o.heightSegments||void 0,o.depthSegments||void 0),c=this.addMaterial(t),h=this.createMesh(u,c,{x:s,y:i,z:n});return h.name=r||`body_id_${h.id}`,h.shape="box",h}addBox(e={},t={}){const s=this.makeBox(e,t);return this.addExisting(s),s}addGround(e,t={}){const s=this.makeBox(e,t);return s.rotateX(Ie.degToRad(90)),this.addExisting(s),s}makeCapsule(e={},t={}){const{x:s,y:i,z:n,name:r,breakable:a=!1,...o}=e,u=new Ks(o.radius||.5,o.length||1,o.capSegments||4,o.radialSegments||16),c=this.addMaterial(t),h=this.createMesh(u,c,{x:s,y:i,z:n});return h.name=r||`body_id_${h.id}`,h.shape="capsule",h}addCapsule(e={},t={}){const s=this.makeCapsule(e,t);return this.addExisting(s),s}makeCylinder(e={},t={}){const{x:s,y:i,z:n,name:r,breakable:a=!1,...o}=e,u=new Ys(o.radiusTop||1,o.radiusBottom||1,o.height||1,o.radiusSegments||void 0,o.heightSegments||void 0,o.openEnded||void 0,o.thetaStart||void 0,o.thetaLength||void 0),c=this.addMaterial(t),h=this.createMesh(u,c,{x:s,y:i,z:n});return h.name=r||`body_id_${h.id}`,h.shape="cylinder",h}addCylinder(e={},t={}){const s=this.makeCylinder(e,t);return this.addExisting(s),s}makeCone(e={},t={}){const{x:s,y:i,z:n,name:r,breakable:a=!1,...o}=e,u=new Qs(o.radius||1,o.height||1,o.radiusSegments||8,o.heightSegments||1,o.openEnded||!1,o.thetaStart||0,o.thetaLength||2*Math.PI),c=this.addMaterial(t),h=this.createMesh(u,c,{x:s,y:i,z:n});return h.name=r||`body_id_${h.id}`,h.shape="cone",h}addCone(e={},t={}){const s=this.makeCone(e,t);return this.addExisting(s),s}makeTorus(e={},t={}){const{x:s,y:i,z:n,name:r,breakable:a=!1,...o}=e,u=new qs(o.radius||void 0,o.tube||void 0,o.radialSegments||void 0,o.tubularSegments||void 0,o.arc||void 0),c=this.addMaterial(t),h=this.createMesh(u,c,{x:s,y:i,z:n});return h.name=r||`body_id_${h.id}`,h.shape="torus",h}addTorus(e={},t={}){const s=this.makeTorus(e,t);return this.addExisting(s),s}addMaterial(e={}){const t=Object.keys(e)[0];let s;if(this.scene==="headless")return this.defaultMaterial.get();switch(t){case"basic":s=new Ne(e.basic);break;case"normal":s=new $s(e.normal);break;case"standard":s=new Gt(e.standard);break;case"lambert":s=new Tn(e.lambert);break;case"phong":s=new gt(e.phong);break;case"physical":typeof e.physical<"u"?s=new Ke(e.physical):(Ae("You need to pass parameters to the physical material. (Fallback to default material)"),s=this.defaultMaterial.get());break;case"toon":s=new Zs(e.toon);break;case"line":s=new Et(e.line);break;case"points":s=new ns(e.points);break;case"custom":s=e.custom||this.defaultMaterial.get();break;default:s=this.defaultMaterial.get();break}return s}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Yi extends bt{addCollider(e,t,s){!e.body||!t.body||(e.body.checkCollisions=!0,t.body.checkCollisions=!0,this.on("collision",i=>{var a,o;const{bodies:n,event:r}=i;(a=n[0])!=null&&a.name&&((o=n[1])!=null&&o.name)&&(e!=null&&e.name)&&(t!=null&&t.name)&&(n[0].name===e.name&&n[1].name===t.name||n[1].name===e.name&&n[0].name===t.name)&&s(r)}))}}/**
 * @author       Kevin Lee (https://github.com/InfiniteLee)
 * @copyright    Copyright (c) 2019 Kevin Lee; Project Url: https://github.com/InfiniteLee/ammo-debug-drawer
 * @license      {@link https://github.com/InfiniteLee/ammo-debug-drawer/blob/master/LICENSE|MPL-2.0}
 */const Fn={NoDebug:0,DrawWireframe:1,DrawAabb:2,DrawFeaturesText:4,DrawContactPoints:8,NoDeactivation:16,NoHelpText:32,DrawText:64,ProfileTimings:128,EnableSatComparison:256,DisableBulletLCP:512,EnableCCD:1024,DrawConstraints:2048,DrawConstraintLimits:4096,FastWireframe:8192,DrawNormals:16384,DrawOnTop:32768,MAX_DEBUG_DRAW_MODE:4294967295};class Qi{constructor(e,t,s={}){this.scene=e,this.world=t,this.options=s,this.debugDrawMode=s.debugDrawMode||Fn.DrawWireframe;const i=this.debugDrawMode&Fn.DrawOnTop||!1,n=s.maxBufferSize||1e6;this.geometry=new _e;const r=new Float32Array(n*3),a=new Float32Array(n*3);this.geometry.setAttribute("position",new He(r,3).setUsage(In)),this.geometry.setAttribute("color",new He(a,3).setUsage(In)),this.index=0;const o=new Et({vertexColors:!0,depthTest:!i});this.mesh=new ss(this.geometry,o),i&&(this.mesh.renderOrder=999),this.mesh.frustumCulled=!1,this.enabled=!1,this.debugDrawer=new Ammo.DebugDrawer,this.debugDrawer.drawLine=this.drawLine.bind(this),this.debugDrawer.drawContactPoint=this.drawContactPoint.bind(this),this.debugDrawer.reportErrorWarning=this.reportErrorWarning.bind(this),this.debugDrawer.draw3dText=this.draw3dText.bind(this),this.debugDrawer.setDebugMode=this.setDebugMode.bind(this),this.debugDrawer.getDebugMode=this.getDebugMode.bind(this),this.world.setDebugDrawer(this.debugDrawer)}enable(){this.enabled=!0,this.scene.add(this.mesh)}disable(){this.enabled=!1,this.scene.remove(this.mesh)}update(){this.enabled&&(this.index!=0&&(this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0),this.index=0,this.world.debugDrawWorld(),this.geometry.setDrawRange(0,this.index))}drawLine(e,t,s){const i=Ammo.HEAPF32,n=i[(s+0)/4],r=i[(s+4)/4],a=i[(s+8)/4],o=i[(e+0)/4],u=i[(e+4)/4],c=i[(e+8)/4];this.geometry.attributes.position.setXYZ(this.index,o,u,c),this.geometry.attributes.color.setXYZ(this.index++,n,r,a);const h=i[(t+0)/4],f=i[(t+4)/4],l=i[(t+8)/4];this.geometry.attributes.position.setXYZ(this.index,h,f,l),this.geometry.attributes.color.setXYZ(this.index++,n,r,a)}drawContactPoint(e,t,s,i,n){const r=Ammo.HEAPF32,a=r[(n+0)/4],o=r[(n+4)/4],u=r[(n+8)/4],c=r[(e+0)/4],h=r[(e+4)/4],f=r[(e+8)/4];this.geometry.attributes.position.setXYZ(this.index,c,h,f),this.geometry.attributes.color.setXYZ(this.index++,a,o,u);const l=r[(t+0)/4]*s,d=r[(t+4)/4]*s,p=r[(t+8)/4]*s;this.geometry.attributes.position.setXYZ(this.index,c+l,h+d,f+p),this.geometry.attributes.color.setXYZ(this.index++,a,o,u)}reportErrorWarning(e){Ammo.hasOwnProperty("Pointer_stringify")?console.warn(Ammo.Pointer_stringify(e)):this.warnedOnce||(this.warnedOnce=!0,console.warn("Cannot print warningString, please rebuild Ammo.js using 'debug' flag"))}draw3dText(e,t){console.warn("TODO: draw3dText")}setDebugMode(e){this.debugDrawMode=e}getDebugMode(){return this.debugDrawMode}}const Bt=0,qi=1,Zi=new j,Bn=new is,en=new it,Vn=new j,Dt=new Js;class $i{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new Nn,this.unassigned=new Nn,this.vertices=[]}setFromPoints(e){if(e.length>=4){this.makeEmpty();for(let t=0,s=e.length;t<s;t++)this.vertices.push(new Ji(e[t]));this.compute()}return this}setFromObject(e){const t=[];return e.updateMatrixWorld(!0),e.traverse(function(s){const i=s.geometry;if(i!==void 0){const n=i.attributes.position;if(n!==void 0)for(let r=0,a=n.count;r<a;r++){const o=new j;o.fromBufferAttribute(n,r).applyMatrix4(s.matrixWorld),t.push(o)}}}),this.setFromPoints(t)}containsPoint(e){const t=this.faces;for(let s=0,i=t.length;s<i;s++)if(t[s].distanceToPoint(e)>this.tolerance)return!1;return!0}intersectRay(e,t){const s=this.faces;let i=-1/0,n=1/0;for(let r=0,a=s.length;r<a;r++){const o=s[r],u=o.distanceToPoint(e.origin),c=o.normal.dot(e.direction);if(u>0&&c>=0)return null;const h=c!==0?-u/c:0;if(!(h<=0)&&(c>0?n=Math.min(h,n):i=Math.max(h,i),i>n))return null}return i!==-1/0?e.at(i,t):e.at(n,t),t}intersectsRay(e){return this.intersectRay(e,Zi)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(e,t){return e.face=t,t.outside===null?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this}removeVertexFromFace(e,t){return e===t.outside&&(e.next!==null&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this}removeAllVerticesFromFace(e){if(e.outside!==null){const t=e.outside;let s=e.outside;for(;s.next!==null&&s.next.face===e;)s=s.next;return this.assigned.removeSubList(t,s),t.prev=s.next=null,e.outside=null,t}}deleteFaceVertices(e,t){const s=this.removeAllVerticesFromFace(e);if(s!==void 0)if(t===void 0)this.unassigned.appendChain(s);else{let i=s;do{const n=i.next;t.distanceToPoint(i.point)>this.tolerance?this.addVertexToFace(i,t):this.unassigned.append(i),i=n}while(i!==null)}return this}resolveUnassignedPoints(e){if(this.unassigned.isEmpty()===!1){let t=this.unassigned.first();do{const s=t.next;let i=this.tolerance,n=null;for(let r=0;r<e.length;r++){const a=e[r];if(a.mark===Bt){const o=a.distanceToPoint(t.point);if(o>i&&(i=o,n=a),i>1e3*this.tolerance)break}}n!==null&&this.addVertexToFace(t,n),t=s}while(t!==null)}return this}computeExtremes(){const e=new j,t=new j,s=[],i=[];for(let n=0;n<3;n++)s[n]=i[n]=this.vertices[0];e.copy(this.vertices[0].point),t.copy(this.vertices[0].point);for(let n=0,r=this.vertices.length;n<r;n++){const a=this.vertices[n],o=a.point;for(let u=0;u<3;u++)o.getComponent(u)<e.getComponent(u)&&(e.setComponent(u,o.getComponent(u)),s[u]=a);for(let u=0;u<3;u++)o.getComponent(u)>t.getComponent(u)&&(t.setComponent(u,o.getComponent(u)),i[u]=a)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e.x),Math.abs(t.x))+Math.max(Math.abs(e.y),Math.abs(t.y))+Math.max(Math.abs(e.z),Math.abs(t.z))),{min:s,max:i}}computeInitialHull(){const e=this.vertices,t=this.computeExtremes(),s=t.min,i=t.max;let n=0,r=0;for(let f=0;f<3;f++){const l=i[f].point.getComponent(f)-s[f].point.getComponent(f);l>n&&(n=l,r=f)}const a=s[r],o=i[r];let u,c;n=0,Bn.set(a.point,o.point);for(let f=0,l=this.vertices.length;f<l;f++){const d=e[f];if(d!==a&&d!==o){Bn.closestPointToPoint(d.point,!0,Vn);const p=Vn.distanceToSquared(d.point);p>n&&(n=p,u=d)}}n=-1,en.setFromCoplanarPoints(a.point,o.point,u.point);for(let f=0,l=this.vertices.length;f<l;f++){const d=e[f];if(d!==a&&d!==o&&d!==u){const p=Math.abs(en.distanceToPoint(d.point));p>n&&(n=p,c=d)}}const h=[];if(en.distanceToPoint(c.point)<0){h.push(De.create(a,o,u),De.create(c,o,a),De.create(c,u,o),De.create(c,a,u));for(let f=0;f<3;f++){const l=(f+1)%3;h[f+1].getEdge(2).setTwin(h[0].getEdge(l)),h[f+1].getEdge(1).setTwin(h[l+1].getEdge(0))}}else{h.push(De.create(a,u,o),De.create(c,a,o),De.create(c,o,u),De.create(c,u,a));for(let f=0;f<3;f++){const l=(f+1)%3;h[f+1].getEdge(2).setTwin(h[0].getEdge((3-f)%3)),h[f+1].getEdge(0).setTwin(h[l+1].getEdge(1))}}for(let f=0;f<4;f++)this.faces.push(h[f]);for(let f=0,l=e.length;f<l;f++){const d=e[f];if(d!==a&&d!==o&&d!==u&&d!==c){n=this.tolerance;let p=null;for(let m=0;m<4;m++){const x=this.faces[m].distanceToPoint(d.point);x>n&&(n=x,p=this.faces[m])}p!==null&&this.addVertexToFace(d,p)}}return this}reindexFaces(){const e=[];for(let t=0;t<this.faces.length;t++){const s=this.faces[t];s.mark===Bt&&e.push(s)}return this.faces=e,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let e,t=0;const s=this.assigned.first().face;let i=s.outside;do{const n=s.distanceToPoint(i.point);n>t&&(t=n,e=i),i=i.next}while(i!==null&&i.face===s);return e}}computeHorizon(e,t,s,i){this.deleteFaceVertices(s),s.mark=qi;let n;t===null?n=t=s.getEdge(0):n=t.next;do{const r=n.twin,a=r.face;a.mark===Bt&&(a.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,r,a,i):i.push(n)),n=n.next}while(n!==t);return this}addAdjoiningFace(e,t){const s=De.create(e,t.tail(),t.head());return this.faces.push(s),s.getEdge(-1).setTwin(t.twin),s.getEdge(0)}addNewFaces(e,t){this.newFaces=[];let s=null,i=null;for(let n=0;n<t.length;n++){const r=t[n],a=this.addAdjoiningFace(e,r);s===null?s=a:a.next.setTwin(i),this.newFaces.push(a.face),i=a}return s.next.setTwin(i),this}addVertexToHull(e){const t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let e;for(this.computeInitialHull();(e=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}class De{constructor(){this.normal=new j,this.midpoint=new j,this.area=0,this.constant=0,this.outside=null,this.mark=Bt,this.edge=null}static create(e,t,s){const i=new De,n=new tn(e,i),r=new tn(t,i),a=new tn(s,i);return n.next=a.prev=r,r.next=n.prev=a,a.next=r.prev=n,i.edge=n,i.compute()}getEdge(e){let t=this.edge;for(;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t}compute(){const e=this.edge.tail(),t=this.edge.head(),s=this.edge.next.head();return Dt.set(e.point,t.point,s.point),Dt.getNormal(this.normal),Dt.getMidpoint(this.midpoint),this.area=Dt.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(e){return this.normal.dot(e)-this.constant}}class tn{constructor(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const e=this.head(),t=this.tail();return t!==null?t.point.distanceTo(e.point):-1}lengthSquared(){const e=this.head(),t=this.tail();return t!==null?t.point.distanceToSquared(e.point):-1}setTwin(e){return this.twin=e,e.twin=this,this}}class Ji{constructor(e){this.point=e,this.prev=null,this.next=null,this.face=null}}class Nn{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(e,t){return t.prev=e.prev,t.next=e,t.prev===null?this.head=t:t.prev.next=t,e.prev=t,this}insertAfter(e,t){return t.prev=e,t.next=e.next,t.next===null?this.tail=t:t.next.prev=t,e.next=t,this}append(e){return this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this}appendChain(e){for(this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail;e.next!==null;)e=e.next;return this.tail=e,this}remove(e){return e.prev===null?this.head=e.next:e.prev.next=e.next,e.next===null?this.tail=e.prev:e.next.prev=e.prev,this}removeSubList(e,t){return e.prev===null?this.head=t.next:e.prev.next=t.next,t.next===null?this.tail=e.prev:t.next.prev=e.prev,this}isEmpty(){return this.head===null}}class er extends _e{constructor(e=[]){super();const t=[],s=[],n=new $i().setFromPoints(e).faces;for(let r=0;r<n.length;r++){const a=n[r];let o=a.edge;do{const u=o.head().point;t.push(u.x,u.y,u.z),s.push(a.normal.x,a.normal.y,a.normal.z),o=o.next}while(o!==a.edge)}this.setAttribute("position",new Ce(t,3)),this.setAttribute("normal",new Ce(s,3))}}const Hn=y=>{const e=window.THREE&&window.THREE.ConvexGeometry?window.THREE.ConvexGeometry:er;return new e(y)},ze=function(y,e){this.minSizeForBreak=y||1.4,this.smallDelta=e||1e-4,this.tempLine1=new is,this.tempPlane1=new it,this.tempPlane2=new it,this.tempPlane_Cut=new it,this.tempCM1=new j,this.tempCM2=new j,this.tempVector3=new j,this.tempVector3_2=new j,this.tempVector3_3=new j,this.tempVector3_P0=new j,this.tempVector3_P1=new j,this.tempVector3_P2=new j,this.tempVector3_N0=new j,this.tempVector3_N1=new j,this.tempVector3_AB=new j,this.tempVector3_CB=new j,this.tempResultObjects={object1:null,object2:null},this.segments=[];for(var t=30*30,s=0;s<t;s++)this.segments[s]=!1};ze.prototype={constructor:ze,prepareBreakableObject:function(y,e,t,s,i){y.geometry.isBufferGeometry||console.error("THREE.ConvexObjectBreaker.prepareBreakableObject(): Parameter object must have a BufferGeometry."),y.userData.ammoPhysicsData={};var n=y.userData.ammoPhysicsData;n.mass=e,n.velocity=t.clone(),n.angularVelocity=s.clone(),n.breakable=i},subdivideByImpact:function(y,e,t,s,i){var n=[],r=this.tempPlane1,a=this.tempPlane2;this.tempVector3.addVectors(e,t),r.setFromCoplanarPoints(e,y.position,this.tempVector3);var o=i+s,u=this;function c(h,f,l,d){if(Math.random()<d*.05||d>o){n.push(h);return}var p=Math.PI;d===0?(a.normal.copy(r.normal),a.constant=r.constant):d<=s?(p=(l-f)*(.2+.6*Math.random())+f,u.tempVector3_2.copy(y.position).sub(e).applyAxisAngle(t,p).add(e),a.setFromCoplanarPoints(e,u.tempVector3,u.tempVector3_2)):(p=(.5*(d&1)+.2*(2-Math.random()))*Math.PI,u.tempVector3_2.copy(e).sub(h.position).applyAxisAngle(t,p).add(h.position),u.tempVector3_3.copy(t).add(h.position),a.setFromCoplanarPoints(h.position,u.tempVector3_3,u.tempVector3_2)),u.cutByPlane(h,a,u.tempResultObjects);var m=u.tempResultObjects.object1,x=u.tempResultObjects.object2;m&&c(m,f,p,d+1),x&&c(x,p,l,d+1)}return c(y,0,2*Math.PI,0),n},cutByPlane:function(y,e,t){var s=y.geometry,i=s.attributes.position.array,n=s.attributes.normal.array,r=i.length/3,a=r/3,o=s.getIndex();o&&(o=o.array,a=o.length/3);function u(Q,q){var G=Q*3+q;return o?o[G]:G}for(var c=[],h=[],f=this.smallDelta,l=r*r,d=0;d<l;d++)this.segments[d]=!1;for(var p=this.tempVector3_P0,m=this.tempVector3_P1,x=this.tempVector3_N0,b=this.tempVector3_N1,d=0;d<a-1;d++){var v=u(d,0),T=u(d,1),g=u(d,2);x.set(n[v],n[v]+1,n[v]+2);for(var w=d+1;w<a;w++){var S=u(w,0),A=u(w,1),P=u(w,2);b.set(n[S],n[S]+1,n[S]+2);var M=1-x.dot(b)<f;M&&(v===S||v===A||v===P?T===S||T===A||T===P?(this.segments[v*r+T]=!0,this.segments[T*r+v]=!0):(this.segments[g*r+v]=!0,this.segments[v*r+g]=!0):(T===S||T===A||T===P)&&(this.segments[g*r+T]=!0,this.segments[T*r+g]=!0))}}var L=this.tempPlane_Cut;y.updateMatrix(),ze.transformPlaneToLocalSpace(e,y.matrix,L);for(var d=0;d<a;d++)for(var C=u(d,0),k=u(d,1),V=u(d,2),z=0;z<3;z++){var W=z===0?C:z===1?k:V,_=z===0?k:z===1?V:C,U=this.segments[W*r+_];if(!U){this.segments[W*r+_]=!0,this.segments[_*r+W]=!0,p.set(i[3*W],i[3*W+1],i[3*W+2]),m.set(i[3*_],i[3*_+1],i[3*_+2]);var J=0,re=L.distanceToPoint(p);re>f?(J=2,h.push(p.clone())):re<-f?(J=1,c.push(p.clone())):(J=3,c.push(p.clone()),h.push(p.clone()));var te=0,re=L.distanceToPoint(m);if(re>f?(te=2,h.push(m.clone())):re<-f?(te=1,c.push(m.clone())):(te=3,c.push(m.clone()),h.push(m.clone())),J===1&&te===2||J===2&&te===1){this.tempLine1.start.copy(p),this.tempLine1.end.copy(m);var oe=new j;if(oe=L.intersectLine(this.tempLine1,oe),oe===void 0)return console.error("Internal error: segment does not intersect plane."),t.segmentedObject1=null,t.segmentedObject2=null,0;c.push(oe),h.push(oe.clone())}}}var ue=y.userData.ammoPhysicsData.mass*.5;this.tempCM1.set(0,0,0);var B=0,O=c.length;if(O>0){for(var d=0;d<O;d++)this.tempCM1.add(c[d]);this.tempCM1.divideScalar(O);for(var d=0;d<O;d++){var E=c[d];E.sub(this.tempCM1),B=Math.max(B,E.x,E.y,E.z)}this.tempCM1.add(y.position)}this.tempCM2.set(0,0,0);var R=0,H=h.length;if(H>0){for(var d=0;d<H;d++)this.tempCM2.add(h[d]);this.tempCM2.divideScalar(H);for(var d=0;d<H;d++){var E=h[d];E.sub(this.tempCM2),R=Math.max(R,E.x,E.y,E.z)}this.tempCM2.add(y.position)}var X=null,N=null,K=0;if(O>4)try{X=new be(Hn(c),y.material),X.position.copy(this.tempCM1),X.quaternion.copy(y.quaternion),X.userData=y.userData,this.prepareBreakableObject(X,ue,y.userData.ammoPhysicsData.velocity,y.userData.ammoPhysicsData.angularVelocity,2*B>this.minSizeForBreak),K++}catch(Q){Ae("Error in ConvexObjectBreaker.ts",!0),Ae(Q,!0)}if(H>4)try{N=new be(Hn(h),y.material),N.position.copy(this.tempCM2),N.quaternion.copy(y.quaternion),N.userData=y.userData,this.prepareBreakableObject(N,ue,y.userData.ammoPhysicsData.velocity,y.userData.ammoPhysicsData.angularVelocity,2*R>this.minSizeForBreak),K++}catch(Q){Ae("Error in ConvexObjectBreaker.ts",!0),Ae(Q,!0)}return t.object1=X,t.object2=N,K}};ze.transformFreeVector=function(y,e){var t=y.x,s=y.y,i=y.z,n=e.elements;return y.x=n[0]*t+n[4]*s+n[8]*i,y.y=n[1]*t+n[5]*s+n[9]*i,y.z=n[2]*t+n[6]*s+n[10]*i,y};ze.transformFreeVectorInverse=function(y,e){var t=y.x,s=y.y,i=y.z,n=e.elements;return y.x=n[0]*t+n[1]*s+n[2]*i,y.y=n[4]*t+n[5]*s+n[6]*i,y.z=n[8]*t+n[9]*s+n[10]*i,y};ze.transformTiedVectorInverse=function(y,e){var t=y.x,s=y.y,i=y.z,n=e.elements;return y.x=n[0]*t+n[1]*s+n[2]*i-n[12],y.y=n[4]*t+n[5]*s+n[6]*i-n[13],y.z=n[8]*t+n[9]*s+n[10]*i-n[14],y};ze.transformPlaneToLocalSpace=function(){var y=new j;return function(t,s,i){i.normal.copy(t.normal),i.constant=t.constant;var n=ze.transformTiedVectorInverse(t.coplanarPoint(y),s);ze.transformFreeVectorInverse(i.normal,s),i.constant=-n.dot(i.normal)}}();const tr=(()=>{try{if(typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function"){const y=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(y instanceof WebAssembly.Module)return new WebAssembly.Instance(y)instanceof WebAssembly.Instance}}catch(y){y instanceof Error&&console.error(y.message)}return!1})(),Un=(y,e)=>{var t=document.createElement("script");t.onload=()=>{e()},t.onerror=()=>{throw new Error(`failed to load ${y}`)},t.async=!0,t.src=y,document.head.appendChild(t)},nr=(y,e)=>{tr?Un(`${y}/ammo.wasm.js`,()=>e()):Un(`${y}/ammo.js`,()=>e())};function Ss(y,e){e.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(s=>{Object.defineProperty(y.prototype,s,Object.getOwnPropertyDescriptor(t.prototype,s)||Object.create(null))})})}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class sr{constructor(e){this.physics=e}getHitPointWorld(){const e=this._btRayCallback.get_m_hitPointWorld();return{x:e.x(),y:e.y(),z:e.z()}}getHitNormalWorld(){const e=this._btRayCallback.get_m_hitNormalWorld();return{x:e.x(),y:e.y(),z:e.z()}}getCollisionObject(){return Ammo.castObject(this._btRayCallback.get_m_collisionObject(),Ammo.btRigidBody).threeObject}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class ir{constructor(e){this.physics=e}getHitPointsWorld(){const e=this._btRayCallback.get_m_hitPointWorld(),t=[];for(let s=e.size()-1;s>=0;s--){const i=e.at(s);t.push({x:i.x(),y:i.y(),z:i.z()})}return t}getHitPointWorld(){return Ae("Use getHitPointsWorld() instead of getHitPointWorld() for the AllHitsRayCaster!"),this.getHitPointsWorld()}getHitNormalsWorld(){const e=this._btRayCallback.get_m_hitNormalWorld(),t=[];for(let s=e.size()-1;s>=0;s--){const i=e.at(s);t.push({x:i.x(),y:i.y(),z:i.z()})}return t}getCollisionObjects(){const e=[],t=this._btRayCallback.get_m_collisionObjects();for(let s=t.size()-1;s>=0;s--){const i=Ammo.castObject(t.at(s),Ammo.btRigidBody);e.push(i.threeObject)}return e}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Ms{constructor(e){this.physics=e}setRayFromWorld(e=0,t=0,s=0){this._btRayFrom.setValue(e,t,s)}setRayToWorld(e=0,t=0,s=0){this._btRayTo.setValue(e,t,s)}hasHit(){return this._btRayCallback.hasHit()}rayTest(){typeof this._btRayCallback<"u"&&Ammo.destroy(this._btRayCallback),this._btRayCallback=this.type==="closest"?new Ammo.ClosestRayResultCallback(this._btRayFrom,this._btRayTo):new Ammo.AllHitsRayResultCallback(this._btRayFrom,this._btRayTo),this.physics.physicsWorld.rayTest(this._btRayFrom,this._btRayTo,this._btRayCallback)}destroy(){typeof this._btRayFrom<"u"&&Ammo.destroy(this._btRayFrom),typeof this._btRayTo<"u"&&Ammo.destroy(this._btRayTo),typeof this._btRayCallback<"u"&&Ammo.destroy(this._btRayCallback)}}class Ps{constructor(e){this.physics=e,this.type="closest",this._btRayFrom=new Ammo.btVector3(0,0,0),this._btRayTo=new Ammo.btVector3(0,0,0)}}class Es{constructor(e){this.physics=e,this.type="allHits",this._btRayFrom=new Ammo.btVector3(0,0,0),this._btRayTo=new Ammo.btVector3(0,0,0)}}Ss(Ps,[Ms,sr]);Ss(Es,[Ms,ir]);/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class rr extends bt{constructor(e,t={}){super(),this.scene=e,this.config=t,this.rigidBodies=[],this.earlierDetectedCollisions=[],this.complexShapes=["plane","hull","hacd","vhacd","convexMesh","concaveMesh"],this.gravity=t.gravity||{x:0,y:-9.81,z:0},this.isHeadless=e==="headless",this.tmpEuler=new Ve,this.tmpQuaternion=new Me,this.tmpVector3=new j,this.tmpVector3a=new j,this.tmpMatrix4=new ie,this.tmpMatrix4a=new ie,this.tmpBtVector3=new Ammo.btVector3,this.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),this.emptyV3=new j,this.impactPoint=new j,this.impactNormal=new j,e!=="headless"&&(this.defaultMaterial=new bs),this.start()}get tmpTrans(){return console.warn("Use worldTransform instead of tmpTrans."),this.worldTransform}set tmpTrans(e){console.warn("Use worldTransform instead of tmpTrans."),this.worldTransform=e}destroy(e){var n;const t=Object.keys(e).includes("body")?e.body:e;if(typeof(t==null?void 0:t.ammo)>"u")return;let s=t.ammo.threeObject;const i=s.name;if(i&&s&&(n=s==null?void 0:s.body)!=null&&n.ammo){s.body.isSoftBody?this.physicsWorld.removeSoftBody(s.body.ammo):this.physicsWorld.removeRigidBody(s.body.ammo),s.body.destructor(),s.body=void 0,s.hasBody=!1,delete t.ammo.threeObject;for(let r=0;r<this.rigidBodies.length;r++)this.rigidBodies[r].name===i&&(this.rigidBodies.splice(r,1),r--)}this.scene==="headless"&&s&&(s=null)}setup(){if(this.worldTransform=new Ammo.btTransform,typeof this.config.setupPhysicsWorld=="function"?this.physicsWorld=this.config.setupPhysicsWorld():this.physicsWorld=this.setupPhysicsWorld(),this.scene!=="headless"){this.convexBreaker=new ze,this.objectsToRemove=[],this.numObjectsToRemove=0;for(let e=0;e<500;e++)this.objectsToRemove[e]=null}this.collisionEvents=new Yi,this.factory=new Ts(this.scene),this.shapes=new _i(this.factory,(e,t)=>this.addExisting(e,t)),this.constraints=new zi(this.worldTransform,this.physicsWorld),this.scene!=="headless"&&(this.debugDrawer=new Qi(this.scene,this.physicsWorld,{}))}updateDebugger(){this.scene!=="headless"&&this.debugDrawer&&this.debugDrawer.enabled&&this.debugDrawer.update()}setupPhysicsWorld(){const e=this.gravity,{softBodies:t=!1}=this.config;let s;if(!t){const i=new Ammo.btDefaultCollisionConfiguration,n=new Ammo.btCollisionDispatcher(i),r=new Ammo.btDbvtBroadphase,a=new Ammo.btSequentialImpulseConstraintSolver;s=new Ammo.btDiscreteDynamicsWorld(n,r,a,i)}if(t){const i=new Ammo.btSoftBodyRigidBodyCollisionConfiguration,n=new Ammo.btCollisionDispatcher(i),r=new Ammo.btDbvtBroadphase,a=new Ammo.btSequentialImpulseConstraintSolver,o=new Ammo.btDefaultSoftBodySolver;s=new Ammo.btSoftRigidDynamicsWorld(n,r,a,i,o)}return s.setGravity(new Ammo.btVector3(e.x,e.y,e.z)),s}createDebrisFromBreakableObject(e,t){this.scene!=="headless"&&(e.material=t.material,e.shape="hull",e.fragmentDepth=t.fragmentDepth+1,e.name=`${t.name}__DEBRIS_${e.id}`,this.scene.add(e),this.addExisting(e,{autoCenter:!0}),e.body.fractureImpulse=t.body.fractureImpulse,e.body.breakable=!1,setTimeout(()=>{e.body.breakable=!0},2500))}removeDebris(e){this.scene!=="headless"&&(this.scene.remove(e),this.destroy(e))}update(e){this.updatePhysics(e),this.detectCollisions()}updatePhysics(e){const t=e/1e3;this.physicsWorld.stepSimulation(t,this.config.maxSubSteps||4,this.config.fixedTimeStep||1/60);for(let s=0;s<this.rigidBodies.length;s++){const i=this.rigidBodies[s];i.body.impact=[];const r=i.body.ammo.getMotionState();if(r){if(r.getWorldTransform(this.worldTransform),i.body.didUpdate&&(i.body._emitUpdateEvents&&i.body.eventEmitter.emit("update"),i.body.didUpdate=!1),i.body.ammo.isKinematicObject()&&i.body.needUpdate)i.getWorldQuaternion(this.tmpQuaternion),i.getWorldPosition(this.tmpVector3),this.tmpBtVector3.setValue(this.tmpVector3.x,this.tmpVector3.y,this.tmpVector3.z),this.tmpBtQuaternion.setValue(this.tmpQuaternion.x,this.tmpQuaternion.y,this.tmpQuaternion.z,this.tmpQuaternion.w),this.worldTransform.setOrigin(this.tmpBtVector3),this.worldTransform.setRotation(this.tmpBtQuaternion),r.setWorldTransform(this.worldTransform),i.body.needUpdate=!1;else if(!i.body.skipUpdate){if(!i.body.ammo.isStaticObject()){const a=this.worldTransform.getOrigin(),o=this.worldTransform.getRotation(),u=i.body.offset;if(i.body.ignoreScale)this.tmpVector3a.set(i.scale.x,i.scale.y,i.scale.z);else{const c=i.body.ammo.getCollisionShape().getLocalScaling();this.tmpVector3a.set(c.x(),c.y(),c.z())}this.tmpVector3.set(a.x()+u.x,a.y()+u.y,a.z()+u.z),this.tmpQuaternion.set(o.x(),o.y(),o.z(),o.w()),this.tmpMatrix4.compose(this.tmpVector3,this.tmpQuaternion,this.tmpVector3a),i.parent?parseInt(es)>=123?this.tmpMatrix4a.copy(i.parent.matrixWorld).invert():this.tmpMatrix4a.getInverse(i.parent.matrixWorld):this.tmpMatrix4a.identity(),this.tmpMatrix4a.multiply(this.tmpMatrix4),this.tmpMatrix4a.decompose(i.position,i.quaternion,i.scale)}}}}}detectCollisions(){var i,n;const e=[];this.impactPoint.set(0,0,0),this.impactNormal.set(0,0,0);const t=this.physicsWorld.getDispatcher(),s=t.getNumManifolds();for(let r=0;r<s;r++){const a=t.getManifoldByIndexInternal(r),o=a.getNumContacts(),u=Ammo.castObject(a.getBody0(),Ammo.btRigidBody),c=Ammo.castObject(a.getBody1(),Ammo.btRigidBody),h=u.threeObject,f=c.threeObject;if(!h||!f||u.name===""&&c.name==="")continue;const l=(i=h.body)==null?void 0:i.checkCollisions,d=(n=f.body)==null?void 0:n.checkCollisions,p=h.body.breakable,m=f.body.breakable,x=h.body.fractureImpulse,b=f.body.fractureImpulse,v=l||d,T=p||m;if(typeof h.fragmentDepth>"u"&&(h.fragmentDepth=0),typeof f.fragmentDepth>"u"&&(f.fragmentDepth=0),!v&&!T)continue;let g=!1,w=0,S="start";for(let P=0;P<o;P++){const M=a.getContactPoint(P);if(M.getDistance()<=0){g=!0;const C=M.getAppliedImpulse(),k=M.get_m_positionWorldOnB(),V=M.get_m_normalWorldOnB();if(l||d){const z=[h.uuid,f.uuid].sort(),W=`${z[0]}__${z[1]}`;if(this.earlierDetectedCollisions.find(_=>_.combinedName===W)&&(S="collision"),!e.find(_=>_.combinedName===W)){e.push({combinedName:W,collision:!0});const _={x:k.x(),y:k.y(),z:k.z()},U={x:V.x(),y:V.y(),z:V.z()};h.body.impact.push({impulse:C,point:_,normal:U,name:f.name}),f.body.impact.push({impulse:C,point:_,normal:U,name:h.name}),this.collisionEvents.emit("collision",{bodies:[h,f],event:S})}}C>=w&&(w=C,(p||m)&&(this.impactPoint.set(k.x(),k.y(),k.z()),this.impactNormal.set(V.x(),V.y(),V.z())));break}}if(!g||!T)continue;const A=2;if(this.emptyV3.set(0,0,0),h.userData.ammoPhysicsData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:p,physicsBody:u},f.userData.ammoPhysicsData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:m,physicsBody:c},p&&w>x&&h.fragmentDepth<A){const P=this.convexBreaker.subdivideByImpact(h,this.impactPoint,this.impactNormal,1,2),M=P.length;for(let L=0;L<M;L++){const C=u.getLinearVelocity(),k=u.getAngularVelocity(),V=P[L];V.userData.ammoPhysicsData.velocity.set(C.x(),C.y(),C.z()),V.userData.ammoPhysicsData.angularVelocity.set(k.x(),k.y(),k.z()),this.createDebrisFromBreakableObject(V,h)}this.objectsToRemove[this.numObjectsToRemove++]=h}if(m&&w>b&&f.fragmentDepth<A){const P=this.convexBreaker.subdivideByImpact(f,this.impactPoint,this.impactNormal,1,2),M=P.length;for(let L=0;L<M;L++){const C=c.getLinearVelocity(),k=c.getAngularVelocity(),V=P[L];V.userData.ammoPhysicsData.velocity.set(C.x(),C.y(),C.z()),V.userData.ammoPhysicsData.angularVelocity.set(k.x(),k.y(),k.z()),this.createDebrisFromBreakableObject(V,f)}this.objectsToRemove[this.numObjectsToRemove++]=f}}for(let r=0;r<this.numObjectsToRemove;r++)this.removeDebris(this.objectsToRemove[r]);this.numObjectsToRemove=0,this.earlierDetectedCollisions.forEach(r=>{const{combinedName:a}=r;if(!e.find(o=>o.combinedName===a)){const o=a.split("__"),u=this.rigidBodies.find(f=>f.uuid===o[0]),c=this.rigidBodies.find(f=>f.uuid===o[1]),h="end";u&&c&&this.collisionEvents.emit("collision",{bodies:[u,c],event:h})}}),this.earlierDetectedCollisions=[...e]}setGravity(e=0,t=-9.8,s=0){this.tmpBtVector3.setValue(e,t,s),this.physicsWorld.setGravity(this.tmpBtVector3)}get debug(){return this.isHeadless?null:{enable:()=>{this.debugDrawer.enable()},mode:(e=1)=>{this.debugDrawer.setDebugMode(e)},disable:()=>{this.debugDrawer.disable()}}}start(){if(typeof Ammo>"u"){Ae("Are you sure you included ammo.js?");return}typeof Ammo=="function"?Ammo().then(()=>{this.setup()}):this.setup()}get add(){return{collider:(e,t,s)=>this.collisionEvents.addCollider(e,t,s),constraints:this.constraints.addConstraints,existing:(e,t)=>this.addExisting(e,t),plane:(e={},t={})=>this.shapes.addPlane(e,t),sphere:(e={},t={})=>this.shapes.addSphere(e,t),ground:(e={},t={})=>this.shapes.addGround(e,t),box:(e={},t={})=>this.shapes.addBox(e,t),capsule:(e={},t={})=>this.shapes.addCapsule(e,t),cylinder:(e={},t={})=>this.shapes.addCylinder(e,t),cone:(e={},t={})=>this.shapes.addCone(e,t),torus:(e={},t={})=>this.shapes.addTorus(e,t),extrude:(e,t={})=>this.shapes.addExtrude(e,t),raycaster:(e="closest")=>e==="closest"?new Ps(this):new Es(this)}}prepareThreeObjectForCollisionShape(e,t={}){var o,u;const{autoCenter:s=!1}=t,i={width:1,height:1,depth:1,radius:1,radiusTop:1,radiusBottom:1,tube:.4,tubularSegments:6};let n="unknown";const r=((o=e.geometry)==null?void 0:o.type)||"unknown";/box/i.test(r)?n="box":/cone/i.test(r)?n="cone":/cylinder/i.test(r)?n="cylinder":/extrude/i.test(r)?n="extrude":/plane/i.test(r)?n="plane":/sphere/i.test(r)?n="sphere":/torus/i.test(r)&&(n="torus");let a={...i,...(u=e==null?void 0:e.geometry)==null?void 0:u.parameters};if(t.shape?(a={...i,...t},n=t.shape):e.shape&&(n=e.shape),Object.keys(a).forEach(c=>{typeof a[c]>"u"&&i[c]&&(a[c]=i[c])}),s){if(e.isMesh&&e.geometry)e.geometry.center();else if(e.isGroup){const c=new bn,h=new j;c.setFromObject(e).getCenter(h),e.traverse(f=>{f.isMesh&&f.geometry.translate(-h.x,-h.y,-h.z)})}}return n==="cylinder"&&(a.radius=t.radius||a.radiusTop),n==="extrude"&&(n="hacd"),(n==="mesh"||n==="convex")&&(n="convexMesh"),n==="concave"&&(n="concaveMesh"),n==="unknown"&&(Ae(`Shape for ${e==null?void 0:e.name} not recognized! Will fallback to box.`),n="box"),{shape:n,params:a,object:e}}createCollisionShape(e,t,s){const i=s!=null&&s.quaternion?s==null?void 0:s.quaternion:new Me(0,0,0,1),{axis:n="y"}=t,r=new Ammo.btVector3,a=s==null?void 0:s.geometry;s&&(a!=null&&a.isGeometry)&&(s.geometry=new _e().fromGeometry(a));const o=d=>{const p=new ie().elements,m=[],x=[],b=[];return Xi(d,{},(v,T,g)=>{m.push(v),x.push(T),b.push(g)}),{vertices:m,matrices:x,indexes:b,matrixWorld:p}};let u={};this.complexShapes.indexOf(e)!==-1&&(u=o(s));let c;switch(e){case"box":r.setValue(t.width/2,t.height/2,t.depth/2),c=new Ammo.btBoxShape(r);break;case"sphere":c=new Ammo.btSphereShape(t.radius);break;case"cylinder":switch(n){case"y":r.setValue(t.radius,t.height/2,t.radius),c=new Ammo.btCylinderShape(r);break;case"x":r.setValue(t.height/2,t.radius,t.radius),c=new Ammo.btCylinderShapeX(r);break;case"z":r.setValue(t.radius,t.radius,t.height/2),c=new Ammo.btCylinderShapeZ(r);break}break;case"cone":switch(n){case"y":c=new Ammo.btConeShape(t.radius,t.height);break;case"x":c=new Ammo.btConeShapeX(t.radius,t.height);break;case"z":c=new Ammo.btConeShapeZ(t.radius,t.height);break}break;case"capsule":switch(n){case"y":c=new Ammo.btCapsuleShape(t.radius,t.height);break;case"x":c=new Ammo.btCapsuleShapeX(t.radius,t.height);break;case"z":c=new Ammo.btCapsuleShapeZ(t.radius,t.height);break}break;case"torus":c=Ki(t,i);break;case"plane":c=Jt(u.vertices,u.matrices,u.indexes,u.matrixWorld,{...t,concave:!1});break;case"hull":c=Gi(u.vertices,u.matrices,u.matrixWorld,t);break;case"hacd":c=Wi(u.vertices,u.matrices,u.indexes,u.matrixWorld,t);break;case"vhacd":c=ji(u.vertices,u.matrices,u.indexes,u.matrixWorld,t);break;case"convexMesh":c=Jt(u.vertices,u.matrices,u.indexes,u.matrixWorld,{...t,concave:!1});break;case"concaveMesh":c=Jt(u.vertices,u.matrices,u.indexes,u.matrixWorld,{...t,concave:!0});break}Ammo.destroy(r);const{x:h,y:f,z:l}=t;return(h||f||l)&&(c._compoundOffset={x:h||0,y:f||0,z:l||0}),Array.isArray(c)&&(c=this.mergeCollisionShapesToCompoundShape(c)),c}mergeCollisionShapesToCompoundShape(e){const t=new Ammo.btCompoundShape;return e.forEach(s=>{const{_childOffset:i,_compoundOffset:n}=s;if(i){const{pos:r,quat:a,scale:o,margin:u}=i,c=this.applyPosQuatScaleMargin(s,r,a,o,u);t.addChildShape(c,s)}else if(n){const r=new Ammo.btTransform;r.setIdentity(),r.setOrigin(new Ammo.btVector3(n.x,n.y,n.z)),t.addChildShape(r,s)}else{const r=new Ammo.btTransform;r.setIdentity(),t.addChildShape(r,s)}}),t}addExisting(e,t={}){const{hasBody:s}=e;if(s){Ae(`Object "${e.name}" already has a physical body!`);return}const i=new j,n=new Me,r=new j;e.getWorldPosition(i),e.getWorldQuaternion(n),e.getWorldScale(r);const a=(t.collisionFlags||0).toString(2).slice(-1)==="1",o=(t.collisionFlags||0).toString(2).slice(-2,-1)==="1",{shape:u="unknown",compound:c=[],mass:h=a||o?0:1,collisionFlags:f=0,collisionGroup:l=1,collisionMask:d=-1,offset:p=void 0,breakable:m=!1,addChildren:x=!0,margin:b=.01,ignoreScale:v=!1,fractureImpulse:T=1}=t;if(v&&r.set(1,1,1),c.length>=1){const P=c.map(k=>this.createCollisionShape(k.shape,k)),M=this.mergeCollisionShapesToCompoundShape(P),L=this.applyPosQuatScaleMargin(M,i,n,r,b),C=this.collisionShapeToRigidBody(M,L,h,o);this.addRigidBodyToWorld(e,C,f,l,d,p),e.body.breakable=m,e.body.fractureImpulse=T,e.body.ignoreScale=v;return}const g=[];if(u!=="unknown"||e.isMesh){const P=this.prepareThreeObjectForCollisionShape(e,t),M=this.createCollisionShape(P.shape,P.params,P.object);g.push(M)}if(u==="unknown"&&x&&e.children.length>=1&&e.children.forEach(P=>{if(P.isMesh){const M=this.prepareThreeObjectForCollisionShape(P),L=this.createCollisionShape(M.shape,M.params,M.object);L._childOffset={pos:P.position.clone(),quat:P.quaternion.clone(),scale:P.scale.clone(),margin:b},g.push(L)}}),g.length===0){const P=this.prepareThreeObjectForCollisionShape(e,t),M=this.createCollisionShape(P.shape,P.params,P.object);g.push(M)}const w=g.length===1?g[0]:this.mergeCollisionShapesToCompoundShape(g),S=this.applyPosQuatScaleMargin(w,i,n,r,b),A=this.collisionShapeToRigidBody(w,S,h,o);this.addRigidBodyToWorld(e,A,f,l,d,p),e.body.breakable=m,e.body.fractureImpulse=T,e.body.ignoreScale=v}addRigidBodyToWorld(e,t,s,i,n,r){this.rigidBodies.push(e),this.physicsWorld.addRigidBody(t,i,n);const a=Object.values(t)[0];e.name||(e.name=`object-${e.id}`),t.name=e.name,e.body=new Hi(this,t),e.hasBody=!0,e.ptr=a,t.threeObject=e,r&&(e.body.offset={x:0,y:0,z:0,...r}),e.body.setCollisionFlags(s)}applyPosQuatScaleMargin(e,t=new j,s=new Me,i=new j,n=.01){e.setMargin(n);const r=new Ammo.btQuaternion(0,0,0,1);r.setValue(s.x,s.y,s.z,s.w);const a=new Ammo.btTransform;a.setIdentity(),a.getOrigin().setValue(t.x,t.y,t.z),a.setRotation(r),Ammo.destroy(r);const o=new Ammo.btVector3(i.x,i.y,i.z);return e.setLocalScaling(o),Ammo.destroy(o),a}collisionShapeToRigidBody(e,t,s,i){const n=new Ammo.btDefaultMotionState(t),r=new Ammo.btVector3(0,0,0);s>0&&e.calculateLocalInertia(s,r);const a=new Ammo.btRigidBodyConstructionInfo(s,n,e,r),o=new Ammo.btRigidBody(a);return(s>0||i)&&o.setActivationState(4),o}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class or{constructor(e={}){this.threeGraphicsConfig=e;const{alpha:t=!1,anisotropy:s=1,camera:i=At.Perspective({z:25,y:5}),antialias:n=!1,usePhysics:r=!0,renderer:a}=e;this.textureAnisotropy=s,this.camera=i,this.scene=new ei,this.renderer=a||new rs({antialias:n,alpha:t}),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=ti,this.cache=ni,this.cache.enabled=!0,r&&(typeof Ammo<"u"?this.physics=new rr(this.scene,e):Ae("Are you sure you included ammo.js?"))}}const ar="0.25.4",lr=`Powered by enable3d v${ar}`;console.log(`%c %c %c %c %c ${lr} %c https://enable3d.io/`,"background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none");/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var _n=function(y){return URL.createObjectURL(new Blob([y],{type:"text/javascript"}))};try{URL.revokeObjectURL(_n(""))}catch{_n=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var Oe=Uint8Array,Je=Uint16Array,yn=Uint32Array,Cs=new Oe([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Rs=new Oe([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),cr=new Oe([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ls=function(y,e){for(var t=new Je(31),s=0;s<31;++s)t[s]=e+=1<<y[s-1];for(var i=new yn(t[30]),s=1;s<30;++s)for(var n=t[s];n<t[s+1];++n)i[n]=n-t[s]<<5|s;return[t,i]},Is=Ls(Cs,2),Os=Is[0],ur=Is[1];Os[28]=258,ur[258]=28;var hr=Ls(Rs,0),fr=hr[0],xn=new Je(32768);for(var de=0;de<32768;++de){var Qe=(de&43690)>>>1|(de&21845)<<1;Qe=(Qe&52428)>>>2|(Qe&13107)<<2,Qe=(Qe&61680)>>>4|(Qe&3855)<<4,xn[de]=((Qe&65280)>>>8|(Qe&255)<<8)>>>1}var yt=function(y,e,t){for(var s=y.length,i=0,n=new Je(e);i<s;++i)++n[y[i]-1];var r=new Je(e);for(i=0;i<e;++i)r[i]=r[i-1]+n[i-1]<<1;var a;if(t){a=new Je(1<<e);var o=15-e;for(i=0;i<s;++i)if(y[i])for(var u=i<<4|y[i],c=e-y[i],h=r[y[i]-1]++<<c,f=h|(1<<c)-1;h<=f;++h)a[xn[h]>>>o]=u}else for(a=new Je(s),i=0;i<s;++i)y[i]&&(a[i]=xn[r[y[i]-1]++]>>>15-y[i]);return a},It=new Oe(288);for(var de=0;de<144;++de)It[de]=8;for(var de=144;de<256;++de)It[de]=9;for(var de=256;de<280;++de)It[de]=7;for(var de=280;de<288;++de)It[de]=8;var ks=new Oe(32);for(var de=0;de<32;++de)ks[de]=5;var dr=yt(It,9,1),pr=yt(ks,5,1),nn=function(y){for(var e=y[0],t=1;t<y.length;++t)y[t]>e&&(e=y[t]);return e},ke=function(y,e,t){var s=e/8|0;return(y[s]|y[s+1]<<8)>>(e&7)&t},sn=function(y,e){var t=e/8|0;return(y[t]|y[t+1]<<8|y[t+2]<<16)>>(e&7)},mr=function(y){return(y/8|0)+(y&7&&1)},gr=function(y,e,t){(e==null||e<0)&&(e=0),(t==null||t>y.length)&&(t=y.length);var s=new(y instanceof Je?Je:y instanceof yn?yn:Oe)(t-e);return s.set(y.subarray(e,t)),s},yr=function(y,e,t){var s=y.length;if(!s||t&&!t.l&&s<5)return e||new Oe(0);var i=!e||t,n=!t||t.i;t||(t={}),e||(e=new Oe(s*3));var r=function(E){var R=e.length;if(E>R){var H=new Oe(Math.max(R*2,E));H.set(e),e=H}},a=t.f||0,o=t.p||0,u=t.b||0,c=t.l,h=t.d,f=t.m,l=t.n,d=s*8;do{if(!c){t.f=a=ke(y,o,1);var p=ke(y,o+1,3);if(o+=3,p)if(p==1)c=dr,h=pr,f=9,l=5;else if(p==2){var v=ke(y,o,31)+257,T=ke(y,o+10,15)+4,g=v+ke(y,o+5,31)+1;o+=14;for(var w=new Oe(g),S=new Oe(19),A=0;A<T;++A)S[cr[A]]=ke(y,o+A*3,7);o+=T*3;for(var P=nn(S),M=(1<<P)-1,L=yt(S,P,1),A=0;A<g;){var C=L[ke(y,o,M)];o+=C&15;var m=C>>>4;if(m<16)w[A++]=m;else{var k=0,V=0;for(m==16?(V=3+ke(y,o,3),o+=2,k=w[A-1]):m==17?(V=3+ke(y,o,7),o+=3):m==18&&(V=11+ke(y,o,127),o+=7);V--;)w[A++]=k}}var z=w.subarray(0,v),W=w.subarray(v);f=nn(z),l=nn(W),c=yt(z,f,1),h=yt(W,l,1)}else throw"invalid block type";else{var m=mr(o)+4,x=y[m-4]|y[m-3]<<8,b=m+x;if(b>s){if(n)throw"unexpected EOF";break}i&&r(u+x),e.set(y.subarray(m,b),u),t.b=u+=x,t.p=o=b*8;continue}if(o>d){if(n)throw"unexpected EOF";break}}i&&r(u+131072);for(var _=(1<<f)-1,U=(1<<l)-1,J=o;;J=o){var k=c[sn(y,o)&_],te=k>>>4;if(o+=k&15,o>d){if(n)throw"unexpected EOF";break}if(!k)throw"invalid length/literal";if(te<256)e[u++]=te;else if(te==256){J=o,c=null;break}else{var re=te-254;if(te>264){var A=te-257,oe=Cs[A];re=ke(y,o,(1<<oe)-1)+Os[A],o+=oe}var ue=h[sn(y,o)&U],B=ue>>>4;if(!ue)throw"invalid distance";o+=ue&15;var W=fr[B];if(B>3){var oe=Rs[B];W+=sn(y,o)&(1<<oe)-1,o+=oe}if(o>d){if(n)throw"unexpected EOF";break}i&&r(u+131072);for(var O=u+re;u<O;u+=4)e[u]=e[u-W],e[u+1]=e[u+1-W],e[u+2]=e[u+2-W],e[u+3]=e[u+3-W];u=O}}t.l=c,t.p=J,t.b=u,c&&(a=1,t.m=f,t.d=h,t.n=l)}while(!a);return u==e.length?e:gr(e,0,u)},xr=new Oe(0),vr=function(y){if((y[0]&15)!=8||y[0]>>>4>7||(y[0]<<8|y[1])%31)throw"invalid zlib data";if(y[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function wr(y,e){return yr((vr(y),y.subarray(2,-4)),e)}var Ar=typeof TextDecoder<"u"&&new TextDecoder,br=0;try{Ar.decode(xr,{stream:!0}),br=1}catch{}function Ds(y,e,t){const s=t.length-y-1;if(e>=t[s])return s-1;if(e<=t[y])return y;let i=y,n=s,r=Math.floor((i+n)/2);for(;e<t[r]||e>=t[r+1];)e<t[r]?n=r:i=r,r=Math.floor((i+n)/2);return r}function Tr(y,e,t,s){const i=[],n=[],r=[];i[0]=1;for(let a=1;a<=t;++a){n[a]=e-s[y+1-a],r[a]=s[y+a]-e;let o=0;for(let u=0;u<a;++u){const c=r[u+1],h=n[a-u],f=i[u]/(c+h);i[u]=o+c*f,o=h*f}i[a]=o}return i}function Sr(y,e,t,s){const i=Ds(y,s,e),n=Tr(i,s,y,e),r=new je(0,0,0,0);for(let a=0;a<=y;++a){const o=t[i-y+a],u=n[a],c=o.w*u;r.x+=o.x*c,r.y+=o.y*c,r.z+=o.z*c,r.w+=o.w*u}return r}function Mr(y,e,t,s,i){const n=[];for(let h=0;h<=t;++h)n[h]=0;const r=[];for(let h=0;h<=s;++h)r[h]=n.slice(0);const a=[];for(let h=0;h<=t;++h)a[h]=n.slice(0);a[0][0]=1;const o=n.slice(0),u=n.slice(0);for(let h=1;h<=t;++h){o[h]=e-i[y+1-h],u[h]=i[y+h]-e;let f=0;for(let l=0;l<h;++l){const d=u[l+1],p=o[h-l];a[h][l]=d+p;const m=a[l][h-1]/a[h][l];a[l][h]=f+d*m,f=p*m}a[h][h]=f}for(let h=0;h<=t;++h)r[0][h]=a[h][t];for(let h=0;h<=t;++h){let f=0,l=1;const d=[];for(let p=0;p<=t;++p)d[p]=n.slice(0);d[0][0]=1;for(let p=1;p<=s;++p){let m=0;const x=h-p,b=t-p;h>=p&&(d[l][0]=d[f][0]/a[b+1][x],m=d[l][0]*a[x][b]);const v=x>=-1?1:-x,T=h-1<=b?p-1:t-h;for(let w=v;w<=T;++w)d[l][w]=(d[f][w]-d[f][w-1])/a[b+1][x+w],m+=d[l][w]*a[x+w][b];h<=b&&(d[l][p]=-d[f][p-1]/a[b+1][h],m+=d[l][p]*a[h][b]),r[p][h]=m;const g=f;f=l,l=g}}let c=t;for(let h=1;h<=s;++h){for(let f=0;f<=t;++f)r[h][f]*=c;c*=t-h}return r}function Pr(y,e,t,s,i){const n=i<y?i:y,r=[],a=Ds(y,s,e),o=Mr(a,s,y,n,e),u=[];for(let c=0;c<t.length;++c){const h=t[c].clone(),f=h.w;h.x*=f,h.y*=f,h.z*=f,u[c]=h}for(let c=0;c<=n;++c){const h=u[a-y].clone().multiplyScalar(o[c][0]);for(let f=1;f<=y;++f)h.add(u[a-y+f].clone().multiplyScalar(o[c][f]));r[c]=h}for(let c=n+1;c<=i+1;++c)r[c]=new je(0,0,0);return r}function Er(y,e){let t=1;for(let i=2;i<=y;++i)t*=i;let s=1;for(let i=2;i<=e;++i)s*=i;for(let i=2;i<=y-e;++i)s*=i;return t/s}function Cr(y){const e=y.length,t=[],s=[];for(let n=0;n<e;++n){const r=y[n];t[n]=new j(r.x,r.y,r.z),s[n]=r.w}const i=[];for(let n=0;n<e;++n){const r=t[n].clone();for(let a=1;a<=n;++a)r.sub(i[n-a].clone().multiplyScalar(Er(n,a)*s[a]));i[n]=r.divideScalar(s[0])}return i}function Rr(y,e,t,s,i){const n=Pr(y,e,t,s,i);return Cr(n)}class Lr extends si{constructor(e,t,s,i,n){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=n||this.knots.length-1;for(let r=0;r<s.length;++r){const a=s[r];this.controlPoints[r]=new je(a.x,a.y,a.z,a.w)}}getPoint(e,t=new j){const s=t,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),n=Sr(this.degree,this.knots,this.controlPoints,i);return n.w!==1&&n.divideScalar(n.w),s.set(n.x,n.y,n.z)}getTangent(e,t=new j){const s=t,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),n=Rr(this.degree,this.knots,this.controlPoints,i,1);return s.copy(n[1]).normalize(),s}}let le,ye,Se;class Ir extends vt{constructor(e){super(e)}load(e,t,s,i){const n=this,r=n.path===""?Vt.extractUrlBase(e):n.path,a=new Ct(this.manager);a.setPath(n.path),a.setResponseType("arraybuffer"),a.setRequestHeader(n.requestHeader),a.setWithCredentials(n.withCredentials),a.load(e,function(o){try{t(n.parse(o,r))}catch(u){i?i(u):console.error(u),n.manager.itemError(e)}},s,i)}parse(e,t){if(Vr(e))le=new Br().parse(e);else{const i=Ns(e);if(!Nr(i))throw new Error("THREE.FBXLoader: Unknown format.");if(Gn(i)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Gn(i));le=new Fr().parse(i)}const s=new Wt(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new Or(s,this.manager).parse(le)}}class Or{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){ye=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),s=this.parseMaterials(t),i=this.parseDeformers(),n=new kr().parse(i);return this.parseScene(i,n,s),Se}parseConnections(){const e=new Map;return"Connections"in le&&le.Connections.connections.forEach(function(s){const i=s[0],n=s[1],r=s[2];e.has(i)||e.set(i,{parents:[],children:[]});const a={ID:n,relationship:r};e.get(i).parents.push(a),e.has(n)||e.set(n,{parents:[],children:[]});const o={ID:i,relationship:r};e.get(n).children.push(o)}),e}parseImages(){const e={},t={};if("Video"in le.Objects){const s=le.Objects.Video;for(const i in s){const n=s[i],r=parseInt(i);if(e[r]=n.RelativeFilename||n.Filename,"Content"in n){const a=n.Content instanceof ArrayBuffer&&n.Content.byteLength>0,o=typeof n.Content=="string"&&n.Content!=="";if(a||o){const u=this.parseImage(s[i]);t[n.RelativeFilename||n.Filename]=u}}}}for(const s in e){const i=e[s];t[i]!==void 0?e[s]=t[i]:e[s]=e[s].split("\\").pop()}return e}parseImage(e){const t=e.Content,s=e.RelativeFilename||e.Filename,i=s.slice(s.lastIndexOf(".")+1).toLowerCase();let n;switch(i){case"bmp":n="image/bmp";break;case"jpg":case"jpeg":n="image/jpeg";break;case"png":n="image/png";break;case"tif":n="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",s),n="image/tga";break;default:console.warn('FBXLoader: Image type "'+i+'" is not supported.');return}if(typeof t=="string")return"data:"+n+";base64,"+t;{const r=new Uint8Array(t);return window.URL.createObjectURL(new Blob([r],{type:n}))}}parseTextures(e){const t=new Map;if("Texture"in le.Objects){const s=le.Objects.Texture;for(const i in s){const n=this.parseTexture(s[i],e);t.set(parseInt(i),n)}}return t}parseTexture(e,t){const s=this.loadTexture(e,t);s.ID=e.id,s.name=e.attrName;const i=e.WrapModeU,n=e.WrapModeV,r=i!==void 0?i.value:0,a=n!==void 0?n.value:0;if(s.wrapS=r===0?Xe:fn,s.wrapT=a===0?Xe:fn,"Scaling"in e){const o=e.Scaling.value;s.repeat.x=o[0],s.repeat.y=o[1]}if("Translation"in e){const o=e.Translation.value;s.offset.x=o[0],s.offset.y=o[1]}return s}loadTexture(e,t){let s;const i=this.textureLoader.path,n=ye.get(e.id).children;n!==void 0&&n.length>0&&t[n[0].ID]!==void 0&&(s=t[n[0].ID],(s.indexOf("blob:")===0||s.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let r;const a=e.FileName.slice(-3).toLowerCase();if(a==="tga"){const o=this.manager.getHandler(".tga");o===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),r=new Nt):(o.setPath(this.textureLoader.path),r=o.load(s))}else a==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),r=new Nt):r=this.textureLoader.load(s);return this.textureLoader.setPath(i),r}parseMaterials(e){const t=new Map;if("Material"in le.Objects){const s=le.Objects.Material;for(const i in s){const n=this.parseMaterial(s[i],e);n!==null&&t.set(parseInt(i),n)}}return t}parseMaterial(e,t){const s=e.id,i=e.attrName;let n=e.ShadingModel;if(typeof n=="object"&&(n=n.value),!ye.has(s))return null;const r=this.parseParameters(e,t,s);let a;switch(n.toLowerCase()){case"phong":a=new gt;break;case"lambert":a=new Tn;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',n),a=new gt;break}return a.setValues(r),a.name=i,a}parseParameters(e,t,s){const i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=new fe().fromArray(e.Diffuse.value).convertSRGBToLinear():e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(i.color=new fe().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=new fe().fromArray(e.Emissive.value).convertSRGBToLinear():e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(i.emissive=new fe().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=new fe().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(i.specular=new fe().fromArray(e.SpecularColor.value).convertSRGBToLinear());const n=this;return ye.get(s).children.forEach(function(r){const a=r.relationship;switch(a){case"Bump":i.bumpMap=n.getTexture(t,r.ID);break;case"Maya|TEX_ao_map":i.aoMap=n.getTexture(t,r.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=n.getTexture(t,r.ID),i.map!==void 0&&(i.map.colorSpace=Ue);break;case"DisplacementColor":i.displacementMap=n.getTexture(t,r.ID);break;case"EmissiveColor":i.emissiveMap=n.getTexture(t,r.ID),i.emissiveMap!==void 0&&(i.emissiveMap.colorSpace=Ue);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=n.getTexture(t,r.ID);break;case"ReflectionColor":i.envMap=n.getTexture(t,r.ID),i.envMap!==void 0&&(i.envMap.mapping=ii,i.envMap.colorSpace=Ue);break;case"SpecularColor":i.specularMap=n.getTexture(t,r.ID),i.specularMap!==void 0&&(i.specularMap.colorSpace=Ue);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=n.getTexture(t,r.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),i}getTexture(e,t){return"LayeredTexture"in le.Objects&&t in le.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=ye.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in le.Objects){const s=le.Objects.Deformer;for(const i in s){const n=s[i],r=ye.get(parseInt(i));if(n.attrType==="Skin"){const a=this.parseSkeleton(r,s);a.ID=i,r.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=r.parents[0].ID,e[i]=a}else if(n.attrType==="BlendShape"){const a={id:i};a.rawTargets=this.parseMorphTargets(r,s),a.id=i,r.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=a}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const s=[];return e.children.forEach(function(i){const n=t[i.ID];if(n.attrType!=="Cluster")return;const r={ID:i.ID,indices:[],weights:[],transformLink:new ie().fromArray(n.TransformLink.a)};"Indexes"in n&&(r.indices=n.Indexes.a,r.weights=n.Weights.a),s.push(r)}),{rawBones:s,bones:[]}}parseMorphTargets(e,t){const s=[];for(let i=0;i<e.children.length;i++){const n=e.children[i],r=t[n.ID],a={name:r.attrName,initialWeight:r.DeformPercent,id:r.id,fullWeights:r.FullWeights.a};if(r.attrType!=="BlendShapeChannel")return;a.geoID=ye.get(parseInt(n.ID)).children.filter(function(o){return o.relationship===void 0})[0].ID,s.push(a)}return s}parseScene(e,t,s){Se=new ct;const i=this.parseModels(e.skeletons,t,s),n=le.Objects.Model,r=this;i.forEach(function(o){const u=n[o.ID];r.setLookAtProperties(o,u),ye.get(o.ID).parents.forEach(function(h){const f=i.get(h.ID);f!==void 0&&f.add(o)}),o.parent===null&&Se.add(o)}),this.bindSkeleton(e.skeletons,t,i),this.createAmbientLight(),Se.traverse(function(o){if(o.userData.transformData){o.parent&&(o.userData.transformData.parentMatrix=o.parent.matrix,o.userData.transformData.parentMatrixWorld=o.parent.matrixWorld);const u=Bs(o.userData.transformData);o.applyMatrix4(u),o.updateWorldMatrix()}});const a=new Dr().parse();Se.children.length===1&&Se.children[0].isGroup&&(Se.children[0].animations=a,Se=Se.children[0]),Se.animations=a}parseModels(e,t,s){const i=new Map,n=le.Objects.Model;for(const r in n){const a=parseInt(r),o=n[r],u=ye.get(a);let c=this.buildSkeleton(u,e,a,o.attrName);if(!c){switch(o.attrType){case"Camera":c=this.createCamera(u);break;case"Light":c=this.createLight(u);break;case"Mesh":c=this.createMesh(u,t,s);break;case"NurbsCurve":c=this.createCurve(u,t);break;case"LimbNode":case"Root":c=new dn;break;case"Null":default:c=new ct;break}c.name=o.attrName?wt.sanitizeNodeName(o.attrName):"",c.ID=a}this.getTransformData(c,o),i.set(a,c)}return i}buildSkeleton(e,t,s,i){let n=null;return e.parents.forEach(function(r){for(const a in t){const o=t[a];o.rawBones.forEach(function(u,c){if(u.ID===r.ID){const h=n;n=new dn,n.matrixWorld.copy(u.transformLink),n.name=i?wt.sanitizeNodeName(i):"",n.ID=s,o.bones[c]=n,h!==null&&n.add(h)}})}}),n}createCamera(e){let t,s;if(e.children.forEach(function(i){const n=le.Objects.NodeAttribute[i.ID];n!==void 0&&(s=n)}),s===void 0)t=new et;else{let i=0;s.CameraProjectionType!==void 0&&s.CameraProjectionType.value===1&&(i=1);let n=1;s.NearPlane!==void 0&&(n=s.NearPlane.value/1e3);let r=1e3;s.FarPlane!==void 0&&(r=s.FarPlane.value/1e3);let a=window.innerWidth,o=window.innerHeight;s.AspectWidth!==void 0&&s.AspectHeight!==void 0&&(a=s.AspectWidth.value,o=s.AspectHeight.value);const u=a/o;let c=45;s.FieldOfView!==void 0&&(c=s.FieldOfView.value);const h=s.FocalLength?s.FocalLength.value:null;switch(i){case 0:t=new Pt(c,u,n,r),h!==null&&t.setFocalLength(h);break;case 1:t=new An(-a/2,a/2,o/2,-o/2,n,r);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),t=new et;break}}return t}createLight(e){let t,s;if(e.children.forEach(function(i){const n=le.Objects.NodeAttribute[i.ID];n!==void 0&&(s=n)}),s===void 0)t=new et;else{let i;s.LightType===void 0?i=0:i=s.LightType.value;let n=16777215;s.Color!==void 0&&(n=new fe().fromArray(s.Color.value).convertSRGBToLinear());let r=s.Intensity===void 0?1:s.Intensity.value/100;s.CastLightOnObject!==void 0&&s.CastLightOnObject.value===0&&(r=0);let a=0;s.FarAttenuationEnd!==void 0&&(s.EnableFarAttenuation!==void 0&&s.EnableFarAttenuation.value===0?a=0:a=s.FarAttenuationEnd.value);const o=1;switch(i){case 0:t=new Ht(n,r,a,o);break;case 1:t=new Pn(n,r);break;case 2:let u=Math.PI/3;s.InnerAngle!==void 0&&(u=Ie.degToRad(s.InnerAngle.value));let c=0;s.OuterAngle!==void 0&&(c=Ie.degToRad(s.OuterAngle.value),c=Math.max(c,1)),t=new Mn(n,r,a,u,c,o);break;default:console.warn("THREE.FBXLoader: Unknown light type "+s.LightType.value+", defaulting to a PointLight."),t=new Ht(n,r);break}s.CastShadows!==void 0&&s.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,s){let i,n=null,r=null;const a=[];return e.children.forEach(function(o){t.has(o.ID)&&(n=t.get(o.ID)),s.has(o.ID)&&a.push(s.get(o.ID))}),a.length>1?r=a:a.length>0?r=a[0]:(r=new gt({name:vt.DEFAULT_MATERIAL_NAME,color:13421772}),a.push(r)),"color"in n.attributes&&a.forEach(function(o){o.vertexColors=!0}),n.FBX_Deformer?(i=new os(n,r),i.normalizeSkinWeights()):i=new be(n,r),i}createCurve(e,t){const s=e.children.reduce(function(n,r){return t.has(r.ID)&&(n=t.get(r.ID)),n},null),i=new Et({name:vt.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new _t(s,i)}getTransformData(e,t){const s={};"InheritType"in t&&(s.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?s.eulerOrder=Vs(t.RotationOrder.value):s.eulerOrder="ZYX","Lcl_Translation"in t&&(s.translation=t.Lcl_Translation.value),"PreRotation"in t&&(s.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(s.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(s.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(s.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(s.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(s.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(s.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(s.rotationPivot=t.RotationPivot.value),e.userData.transformData=s}setLookAtProperties(e,t){"LookAtProperty"in t&&ye.get(e.ID).children.forEach(function(i){if(i.relationship==="LookAtProperty"){const n=le.Objects.Model[i.ID];if("Lcl_Translation"in n){const r=n.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(r),Se.add(e.target)):e.lookAt(new j().fromArray(r))}}})}bindSkeleton(e,t,s){const i=this.parsePoseNodes();for(const n in e){const r=e[n];ye.get(parseInt(r.ID)).parents.forEach(function(o){if(t.has(o.ID)){const u=o.ID;ye.get(u).parents.forEach(function(h){s.has(h.ID)&&s.get(h.ID).bind(new as(r.bones),i[h.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in le.Objects){const t=le.Objects.Pose;for(const s in t)if(t[s].attrType==="BindPose"&&t[s].NbPoseNodes>0){const i=t[s].PoseNode;Array.isArray(i)?i.forEach(function(n){e[n.Node]=new ie().fromArray(n.Matrix.a)}):e[i.Node]=new ie().fromArray(i.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in le&&"AmbientColor"in le.GlobalSettings){const e=le.GlobalSettings.AmbientColor.value,t=e[0],s=e[1],i=e[2];if(t!==0||s!==0||i!==0){const n=new fe(t,s,i).convertSRGBToLinear();Se.add(new ls(n,1))}}}}class kr{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in le.Objects){const s=le.Objects.Geometry;for(const i in s){const n=ye.get(parseInt(i)),r=this.parseGeometry(n,s[i],e);t.set(parseInt(i),r)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,s){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,s);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,s){const i=s.skeletons,n=[],r=e.parents.map(function(h){return le.Objects.Model[h.ID]});if(r.length===0)return;const a=e.children.reduce(function(h,f){return i[f.ID]!==void 0&&(h=i[f.ID]),h},null);e.children.forEach(function(h){s.morphTargets[h.ID]!==void 0&&n.push(s.morphTargets[h.ID])});const o=r[0],u={};"RotationOrder"in o&&(u.eulerOrder=Vs(o.RotationOrder.value)),"InheritType"in o&&(u.inheritType=parseInt(o.InheritType.value)),"GeometricTranslation"in o&&(u.translation=o.GeometricTranslation.value),"GeometricRotation"in o&&(u.rotation=o.GeometricRotation.value),"GeometricScaling"in o&&(u.scale=o.GeometricScaling.value);const c=Bs(u);return this.genGeometry(t,a,n,c)}genGeometry(e,t,s,i){const n=new _e;e.attrName&&(n.name=e.attrName);const r=this.parseGeoNode(e,t),a=this.genBuffers(r),o=new Ce(a.vertex,3);if(o.applyMatrix4(i),n.setAttribute("position",o),a.colors.length>0&&n.setAttribute("color",new Ce(a.colors,3)),t&&(n.setAttribute("skinIndex",new ri(a.weightsIndices,4)),n.setAttribute("skinWeight",new Ce(a.vertexWeights,4)),n.FBX_Deformer=t),a.normal.length>0){const u=new Ze().getNormalMatrix(i),c=new Ce(a.normal,3);c.applyNormalMatrix(u),n.setAttribute("normal",c)}if(a.uvs.forEach(function(u,c){const h=c===0?"uv":`uv${c}`;n.setAttribute(h,new Ce(a.uvs[c],2))}),r.material&&r.material.mappingType!=="AllSame"){let u=a.materialIndex[0],c=0;if(a.materialIndex.forEach(function(h,f){h!==u&&(n.addGroup(c,f-c,u),u=h,c=f)}),n.groups.length>0){const h=n.groups[n.groups.length-1],f=h.start+h.count;f!==a.materialIndex.length&&n.addGroup(f,a.materialIndex.length-f,u)}n.groups.length===0&&n.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(n,e,s,i),n}parseGeoNode(e,t){const s={};if(s.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],s.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(s.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(s.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(s.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){s.uv=[];let i=0;for(;e.LayerElementUV[i];)e.LayerElementUV[i].UV&&s.uv.push(this.parseUVs(e.LayerElementUV[i])),i++}return s.weightTable={},t!==null&&(s.skeleton=t,t.rawBones.forEach(function(i,n){i.indices.forEach(function(r,a){s.weightTable[r]===void 0&&(s.weightTable[r]=[]),s.weightTable[r].push({id:n,weight:i.weights[a]})})})),s}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let s=0,i=0,n=!1,r=[],a=[],o=[],u=[],c=[],h=[];const f=this;return e.vertexIndices.forEach(function(l,d){let p,m=!1;l<0&&(l=l^-1,m=!0);let x=[],b=[];if(r.push(l*3,l*3+1,l*3+2),e.color){const v=Ft(d,s,l,e.color);o.push(v[0],v[1],v[2])}if(e.skeleton){if(e.weightTable[l]!==void 0&&e.weightTable[l].forEach(function(v){b.push(v.weight),x.push(v.id)}),b.length>4){n||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),n=!0);const v=[0,0,0,0],T=[0,0,0,0];b.forEach(function(g,w){let S=g,A=x[w];T.forEach(function(P,M,L){if(S>P){L[M]=S,S=P;const C=v[M];v[M]=A,A=C}})}),x=v,b=T}for(;b.length<4;)b.push(0),x.push(0);for(let v=0;v<4;++v)c.push(b[v]),h.push(x[v])}if(e.normal){const v=Ft(d,s,l,e.normal);a.push(v[0],v[1],v[2])}e.material&&e.material.mappingType!=="AllSame"&&(p=Ft(d,s,l,e.material)[0],p<0&&(f.negativeMaterialIndices=!0,p=0)),e.uv&&e.uv.forEach(function(v,T){const g=Ft(d,s,l,v);u[T]===void 0&&(u[T]=[]),u[T].push(g[0]),u[T].push(g[1])}),i++,m&&(i>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),f.genFace(t,e,r,p,a,o,u,c,h,i),s++,i=0,r=[],a=[],o=[],u=[],c=[],h=[])}),t}genFace(e,t,s,i,n,r,a,o,u,c){for(let h=2;h<c;h++)e.vertex.push(t.vertexPositions[s[0]]),e.vertex.push(t.vertexPositions[s[1]]),e.vertex.push(t.vertexPositions[s[2]]),e.vertex.push(t.vertexPositions[s[(h-1)*3]]),e.vertex.push(t.vertexPositions[s[(h-1)*3+1]]),e.vertex.push(t.vertexPositions[s[(h-1)*3+2]]),e.vertex.push(t.vertexPositions[s[h*3]]),e.vertex.push(t.vertexPositions[s[h*3+1]]),e.vertex.push(t.vertexPositions[s[h*3+2]]),t.skeleton&&(e.vertexWeights.push(o[0]),e.vertexWeights.push(o[1]),e.vertexWeights.push(o[2]),e.vertexWeights.push(o[3]),e.vertexWeights.push(o[(h-1)*4]),e.vertexWeights.push(o[(h-1)*4+1]),e.vertexWeights.push(o[(h-1)*4+2]),e.vertexWeights.push(o[(h-1)*4+3]),e.vertexWeights.push(o[h*4]),e.vertexWeights.push(o[h*4+1]),e.vertexWeights.push(o[h*4+2]),e.vertexWeights.push(o[h*4+3]),e.weightsIndices.push(u[0]),e.weightsIndices.push(u[1]),e.weightsIndices.push(u[2]),e.weightsIndices.push(u[3]),e.weightsIndices.push(u[(h-1)*4]),e.weightsIndices.push(u[(h-1)*4+1]),e.weightsIndices.push(u[(h-1)*4+2]),e.weightsIndices.push(u[(h-1)*4+3]),e.weightsIndices.push(u[h*4]),e.weightsIndices.push(u[h*4+1]),e.weightsIndices.push(u[h*4+2]),e.weightsIndices.push(u[h*4+3])),t.color&&(e.colors.push(r[0]),e.colors.push(r[1]),e.colors.push(r[2]),e.colors.push(r[(h-1)*3]),e.colors.push(r[(h-1)*3+1]),e.colors.push(r[(h-1)*3+2]),e.colors.push(r[h*3]),e.colors.push(r[h*3+1]),e.colors.push(r[h*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(n[0]),e.normal.push(n[1]),e.normal.push(n[2]),e.normal.push(n[(h-1)*3]),e.normal.push(n[(h-1)*3+1]),e.normal.push(n[(h-1)*3+2]),e.normal.push(n[h*3]),e.normal.push(n[h*3+1]),e.normal.push(n[h*3+2])),t.uv&&t.uv.forEach(function(f,l){e.uvs[l]===void 0&&(e.uvs[l]=[]),e.uvs[l].push(a[l][0]),e.uvs[l].push(a[l][1]),e.uvs[l].push(a[l][(h-1)*2]),e.uvs[l].push(a[l][(h-1)*2+1]),e.uvs[l].push(a[l][h*2]),e.uvs[l].push(a[l][h*2+1])})}addMorphTargets(e,t,s,i){if(s.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const n=this;s.forEach(function(r){r.rawTargets.forEach(function(a){const o=le.Objects.Geometry[a.geoID];o!==void 0&&n.genMorphGeometry(e,t,o,i,a.name)})})}genMorphGeometry(e,t,s,i,n){const r=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],a=s.Vertices!==void 0?s.Vertices.a:[],o=s.Indexes!==void 0?s.Indexes.a:[],u=e.attributes.position.count*3,c=new Float32Array(u);for(let d=0;d<o.length;d++){const p=o[d]*3;c[p]=a[d*3],c[p+1]=a[d*3+1],c[p+2]=a[d*3+2]}const h={vertexIndices:r,vertexPositions:c},f=this.genBuffers(h),l=new Ce(f.vertex,3);l.name=n||s.attrName,l.applyMatrix4(i),e.morphAttributes.position.push(l)}parseNormals(e){const t=e.MappingInformationType,s=e.ReferenceInformationType,i=e.Normals.a;let n=[];return s==="IndexToDirect"&&("NormalIndex"in e?n=e.NormalIndex.a:"NormalsIndex"in e&&(n=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:n,mappingType:t,referenceType:s}}parseUVs(e){const t=e.MappingInformationType,s=e.ReferenceInformationType,i=e.UV.a;let n=[];return s==="IndexToDirect"&&(n=e.UVIndex.a),{dataSize:2,buffer:i,indices:n,mappingType:t,referenceType:s}}parseVertexColors(e){const t=e.MappingInformationType,s=e.ReferenceInformationType,i=e.Colors.a;let n=[];s==="IndexToDirect"&&(n=e.ColorIndex.a);for(let r=0,a=new fe;r<i.length;r+=4)a.fromArray(i,r).convertSRGBToLinear().toArray(i,r);return{dataSize:4,buffer:i,indices:n,mappingType:t,referenceType:s}}parseMaterialIndices(e){const t=e.MappingInformationType,s=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:s};const i=e.Materials.a,n=[];for(let r=0;r<i.length;++r)n.push(r);return{dataSize:1,buffer:i,indices:n,mappingType:t,referenceType:s}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new _e;const s=t-1,i=e.KnotVector.a,n=[],r=e.Points.a;for(let h=0,f=r.length;h<f;h+=4)n.push(new je().fromArray(r,h));let a,o;if(e.Form==="Closed")n.push(n[0]);else if(e.Form==="Periodic"){a=s,o=i.length-1-a;for(let h=0;h<s;++h)n.push(n[h])}const c=new Lr(s,i,n,a,o).getPoints(n.length*12);return new _e().setFromPoints(c)}}class Dr{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const s in t){const i=t[s],n=this.addClip(i);e.push(n)}return e}parseClips(){if(le.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=le.Objects.AnimationCurveNode,t=new Map;for(const s in e){const i=e[s];if(i.attrName.match(/S|R|T|DeformPercent/)!==null){const n={id:i.id,attr:i.attrName,curves:{}};t.set(n.id,n)}}return t}parseAnimationCurves(e){const t=le.Objects.AnimationCurve;for(const s in t){const i={id:t[s].id,times:t[s].KeyTime.a.map(Hr),values:t[s].KeyValueFloat.a},n=ye.get(i.id);if(n!==void 0){const r=n.parents[0].ID,a=n.parents[0].relationship;a.match(/X/)?e.get(r).curves.x=i:a.match(/Y/)?e.get(r).curves.y=i:a.match(/Z/)?e.get(r).curves.z=i:a.match(/DeformPercent/)&&e.has(r)&&(e.get(r).curves.morph=i)}}}parseAnimationLayers(e){const t=le.Objects.AnimationLayer,s=new Map;for(const i in t){const n=[],r=ye.get(parseInt(i));r!==void 0&&(r.children.forEach(function(o,u){if(e.has(o.ID)){const c=e.get(o.ID);if(c.curves.x!==void 0||c.curves.y!==void 0||c.curves.z!==void 0){if(n[u]===void 0){const h=ye.get(o.ID).parents.filter(function(f){return f.relationship!==void 0})[0].ID;if(h!==void 0){const f=le.Objects.Model[h.toString()];if(f===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",o);return}const l={modelName:f.attrName?wt.sanitizeNodeName(f.attrName):"",ID:f.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Se.traverse(function(d){d.ID===f.id&&(l.transform=d.matrix,d.userData.transformData&&(l.eulerOrder=d.userData.transformData.eulerOrder))}),l.transform||(l.transform=new ie),"PreRotation"in f&&(l.preRotation=f.PreRotation.value),"PostRotation"in f&&(l.postRotation=f.PostRotation.value),n[u]=l}}n[u]&&(n[u][c.attr]=c)}else if(c.curves.morph!==void 0){if(n[u]===void 0){const h=ye.get(o.ID).parents.filter(function(x){return x.relationship!==void 0})[0].ID,f=ye.get(h).parents[0].ID,l=ye.get(f).parents[0].ID,d=ye.get(l).parents[0].ID,p=le.Objects.Model[d],m={modelName:p.attrName?wt.sanitizeNodeName(p.attrName):"",morphName:le.Objects.Deformer[h].attrName};n[u]=m}n[u][c.attr]=c}}}),s.set(parseInt(i),n))}return s}parseAnimStacks(e){const t=le.Objects.AnimationStack,s={};for(const i in t){const n=ye.get(parseInt(i)).children;n.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const r=e.get(n[0].ID);s[i]={name:t[i].attrName,layer:r}}return s}addClip(e){let t=[];const s=this;return e.layer.forEach(function(i){t=t.concat(s.generateTracks(i))}),new cs(e.name,-1,t)}generateTracks(e){const t=[];let s=new j,i=new Me,n=new j;if(e.transform&&e.transform.decompose(s,i,n),s=s.toArray(),i=new Ve().setFromQuaternion(i,e.eulerOrder).toArray(),n=n.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const r=this.generateVectorTrack(e.modelName,e.T.curves,s,"position");r!==void 0&&t.push(r)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const r=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);r!==void 0&&t.push(r)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const r=this.generateVectorTrack(e.modelName,e.S.curves,n,"scale");r!==void 0&&t.push(r)}if(e.DeformPercent!==void 0){const r=this.generateMorphTrack(e);r!==void 0&&t.push(r)}return t}generateVectorTrack(e,t,s,i){const n=this.getTimesForAllAxes(t),r=this.getKeyframeTrackValues(n,t,s);return new us(e+"."+i,n,r)}generateRotationTrack(e,t,s,i,n,r){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(Ie.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(Ie.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(Ie.degToRad));const a=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(a,t,s);i!==void 0&&(i=i.map(Ie.degToRad),i.push(r),i=new Ve().fromArray(i),i=new Me().setFromEuler(i)),n!==void 0&&(n=n.map(Ie.degToRad),n.push(r),n=new Ve().fromArray(n),n=new Me().setFromEuler(n).invert());const u=new Me,c=new Ve,h=[];for(let f=0;f<o.length;f+=3)c.set(o[f],o[f+1],o[f+2],r),u.setFromEuler(c),i!==void 0&&u.premultiply(i),n!==void 0&&u.multiply(n),u.toArray(h,f/3*4);return new pn(e+".quaternion",a,h)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,s=t.values.map(function(n){return n/100}),i=Se.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new mn(e.modelName+".morphTargetInfluences["+i+"]",t.times,s)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(s,i){return s-i}),t.length>1){let s=1,i=t[0];for(let n=1;n<t.length;n++){const r=t[n];r!==i&&(t[s]=r,i=r,s++)}t=t.slice(0,s)}return t}getKeyframeTrackValues(e,t,s){const i=s,n=[];let r=-1,a=-1,o=-1;return e.forEach(function(u){if(t.x&&(r=t.x.times.indexOf(u)),t.y&&(a=t.y.times.indexOf(u)),t.z&&(o=t.z.times.indexOf(u)),r!==-1){const c=t.x.values[r];n.push(c),i[0]=c}else n.push(i[0]);if(a!==-1){const c=t.y.values[a];n.push(c),i[1]=c}else n.push(i[1]);if(o!==-1){const c=t.z.values[o];n.push(c),i[2]=c}else n.push(i[2])}),n}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const s=e.values[t-1],i=e.values[t]-s,n=Math.abs(i);if(n>=180){const r=n/180,a=i/r;let o=s+a;const u=e.times[t-1],h=(e.times[t]-u)/r;let f=u+h;const l=[],d=[];for(;f<e.times[t];)l.push(f),f+=h,d.push(o),o+=a;e.times=Wn(e.times,t,l),e.values=Wn(e.values,t,d)}}}}class Fr{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Fs,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,s=e.split(/[\r\n]+/);return s.forEach(function(i,n){const r=i.match(/^[\s\t]*;/),a=i.match(/^[\s\t]*$/);if(r||a)return;const o=i.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),u=i.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),c=i.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(i,o):u?t.parseNodeProperty(i,u,s[++n]):c?t.popStack():i.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(i)}),this.allNodes}parseNodeBegin(e,t){const s=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map(function(o){return o.trim().replace(/^"/,"").replace(/"$/,"")}),n={name:s},r=this.parseNodeAttr(i),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(s,n):s in a?(s==="PoseNode"?a.PoseNode.push(n):a[s].id!==void 0&&(a[s]={},a[s][a[s].id]=a[s]),r.id!==""&&(a[s][r.id]=n)):typeof r.id=="number"?(a[s]={},a[s][r.id]=n):s!=="Properties70"&&(s==="PoseNode"?a[s]=[n]:a[s]=n),typeof r.id=="number"&&(n.id=r.id),r.name!==""&&(n.attrName=r.name),r.type!==""&&(n.attrType=r.type),this.pushStack(n)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let s="",i="";return e.length>1&&(s=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:s,type:i}}parseNodeProperty(e,t,s){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),n=t[2].replace(/^"/,"").replace(/"$/,"").trim();i==="Content"&&n===","&&(n=s.replace(/"/g,"").replace(/,$/,"").trim());const r=this.getCurrentNode();if(r.name==="Properties70"){this.parseNodeSpecialProperty(e,i,n);return}if(i==="C"){const o=n.split(",").slice(1),u=parseInt(o[0]),c=parseInt(o[1]);let h=n.split(",").slice(3);h=h.map(function(f){return f.trim().replace(/^"/,"")}),i="connections",n=[u,c],_r(n,h),r[i]===void 0&&(r[i]=[])}i==="Node"&&(r.id=n),i in r&&Array.isArray(r[i])?r[i].push(n):i!=="a"?r[i]=n:r.a=n,this.setCurrentProp(r,i),i==="a"&&n.slice(-1)!==","&&(r.a=on(n))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=on(t.a))}parseNodeSpecialProperty(e,t,s){const i=s.split('",').map(function(c){return c.trim().replace(/^\"/,"").replace(/\s/,"_")}),n=i[0],r=i[1],a=i[2],o=i[3];let u=i[4];switch(r){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":u=parseFloat(u);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":u=on(u);break}this.getPrevNode()[n]={type:r,type2:a,flag:o,value:u},this.setCurrentProp(this.getPrevNode(),n)}}class Br{parse(e){const t=new zn(e);t.skip(23);const s=t.getUint32();if(s<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+s);const i=new Fs;for(;!this.endOfContent(t);){const n=this.parseNode(t,s);n!==null&&i.add(n.name,n)}return i}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const s={},i=t>=7500?e.getUint64():e.getUint32(),n=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const r=e.getUint8(),a=e.getString(r);if(i===0)return null;const o=[];for(let f=0;f<n;f++)o.push(this.parseProperty(e));const u=o.length>0?o[0]:"",c=o.length>1?o[1]:"",h=o.length>2?o[2]:"";for(s.singleProperty=n===1&&e.getOffset()===i;i>e.getOffset();){const f=this.parseNode(e,t);f!==null&&this.parseSubNode(a,s,f)}return s.propertyList=o,typeof u=="number"&&(s.id=u),c!==""&&(s.attrName=c),h!==""&&(s.attrType=h),a!==""&&(s.name=a),s}parseSubNode(e,t,s){if(s.singleProperty===!0){const i=s.propertyList[0];Array.isArray(i)?(t[s.name]=s,s.a=i):t[s.name]=i}else if(e==="Connections"&&s.name==="C"){const i=[];s.propertyList.forEach(function(n,r){r!==0&&i.push(n)}),t.connections===void 0&&(t.connections=[]),t.connections.push(i)}else if(s.name==="Properties70")Object.keys(s).forEach(function(n){t[n]=s[n]});else if(e==="Properties70"&&s.name==="P"){let i=s.propertyList[0],n=s.propertyList[1];const r=s.propertyList[2],a=s.propertyList[3];let o;i.indexOf("Lcl ")===0&&(i=i.replace("Lcl ","Lcl_")),n.indexOf("Lcl ")===0&&(n=n.replace("Lcl ","Lcl_")),n==="Color"||n==="ColorRGB"||n==="Vector"||n==="Vector3D"||n.indexOf("Lcl_")===0?o=[s.propertyList[4],s.propertyList[5],s.propertyList[6]]:o=s.propertyList[4],t[i]={type:n,type2:r,flag:a,value:o}}else t[s.name]===void 0?typeof s.id=="number"?(t[s.name]={},t[s.name][s.id]=s):t[s.name]=s:s.name==="PoseNode"?(Array.isArray(t[s.name])||(t[s.name]=[t[s.name]]),t[s.name].push(s)):t[s.name][s.id]===void 0&&(t[s.name][s.id]=s)}parseProperty(e){const t=e.getString(1);let s;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return s=e.getUint32(),e.getArrayBuffer(s);case"S":return s=e.getUint32(),e.getString(s);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=e.getUint32(),n=e.getUint32(),r=e.getUint32();if(n===0)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}const a=wr(new Uint8Array(e.getArrayBuffer(r))),o=new zn(a.buffer);switch(t){case"b":case"c":return o.getBooleanArray(i);case"d":return o.getFloat64Array(i);case"f":return o.getFloat32Array(i);case"i":return o.getInt32Array(i);case"l":return o.getInt64Array(i)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class zn{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let s=0;s<e;s++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let s=0;s<e;s++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let s=0;s<e;s++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let s=0;s<e;s++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let s=0;s<e;s++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let s=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const i=s.indexOf(0);return i>=0&&(s=new Uint8Array(this.dv.buffer,t,i)),this._textDecoder.decode(s)}}class Fs{add(e,t){this[e]=t}}function Vr(y){const e="Kaydara FBX Binary  \0";return y.byteLength>=e.length&&e===Ns(y,0,e.length)}function Nr(y){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function s(i){const n=y[i-1];return y=y.slice(t+i),t++,n}for(let i=0;i<e.length;++i)if(s(1)===e[i])return!1;return!0}function Gn(y){const e=/FBXVersion: (\d+)/,t=y.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Hr(y){return y/46186158e3}const Ur=[];function Ft(y,e,t,s){let i;switch(s.mappingType){case"ByPolygonVertex":i=y;break;case"ByPolygon":i=e;break;case"ByVertice":i=t;break;case"AllSame":i=s.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+s.mappingType)}s.referenceType==="IndexToDirect"&&(i=s.indices[i]);const n=i*s.dataSize,r=n+s.dataSize;return zr(Ur,s.buffer,n,r)}const rn=new Ve,lt=new j;function Bs(y){const e=new ie,t=new ie,s=new ie,i=new ie,n=new ie,r=new ie,a=new ie,o=new ie,u=new ie,c=new ie,h=new ie,f=new ie,l=y.inheritType?y.inheritType:0;if(y.translation&&e.setPosition(lt.fromArray(y.translation)),y.preRotation){const M=y.preRotation.map(Ie.degToRad);M.push(y.eulerOrder||Ve.DEFAULT_ORDER),t.makeRotationFromEuler(rn.fromArray(M))}if(y.rotation){const M=y.rotation.map(Ie.degToRad);M.push(y.eulerOrder||Ve.DEFAULT_ORDER),s.makeRotationFromEuler(rn.fromArray(M))}if(y.postRotation){const M=y.postRotation.map(Ie.degToRad);M.push(y.eulerOrder||Ve.DEFAULT_ORDER),i.makeRotationFromEuler(rn.fromArray(M)),i.invert()}y.scale&&n.scale(lt.fromArray(y.scale)),y.scalingOffset&&a.setPosition(lt.fromArray(y.scalingOffset)),y.scalingPivot&&r.setPosition(lt.fromArray(y.scalingPivot)),y.rotationOffset&&o.setPosition(lt.fromArray(y.rotationOffset)),y.rotationPivot&&u.setPosition(lt.fromArray(y.rotationPivot)),y.parentMatrixWorld&&(h.copy(y.parentMatrix),c.copy(y.parentMatrixWorld));const d=t.clone().multiply(s).multiply(i),p=new ie;p.extractRotation(c);const m=new ie;m.copyPosition(c);const x=m.clone().invert().multiply(c),b=p.clone().invert().multiply(x),v=n,T=new ie;if(l===0)T.copy(p).multiply(d).multiply(b).multiply(v);else if(l===1)T.copy(p).multiply(b).multiply(d).multiply(v);else{const L=new ie().scale(new j().setFromMatrixScale(h)).clone().invert(),C=b.clone().multiply(L);T.copy(p).multiply(d).multiply(C).multiply(v)}const g=u.clone().invert(),w=r.clone().invert();let S=e.clone().multiply(o).multiply(u).multiply(t).multiply(s).multiply(i).multiply(g).multiply(a).multiply(r).multiply(n).multiply(w);const A=new ie().copyPosition(S),P=c.clone().multiply(A);return f.copyPosition(P),S=f.clone().multiply(T),S.premultiply(c.invert()),S}function Vs(y){y=y||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return y===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[y]}function on(y){return y.split(",").map(function(t){return parseFloat(t)})}function Ns(y,e,t){return e===void 0&&(e=0),t===void 0&&(t=y.byteLength),new TextDecoder().decode(new Uint8Array(y,e,t))}function _r(y,e){for(let t=0,s=y.length,i=e.length;t<i;t++,s++)y[s]=e[t]}function zr(y,e,t,s){for(let i=t,n=0;i<s;i++,n++)y[n]=e[i];return y}function Wn(y,e,t){return y.slice(0,e).concat(t).concat(y.slice(e))}function jn(y,e){if(e===oi)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),y;if(e===gn||e===hs){let t=y.getIndex();if(t===null){const r=[],a=y.getAttribute("position");if(a!==void 0){for(let o=0;o<a.count;o++)r.push(o);y.setIndex(r),t=y.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),y}const s=t.count-2,i=[];if(e===gn)for(let r=1;r<=s;r++)i.push(t.getX(0)),i.push(t.getX(r)),i.push(t.getX(r+1));else for(let r=0;r<s;r++)r%2===0?(i.push(t.getX(r)),i.push(t.getX(r+1)),i.push(t.getX(r+2))):(i.push(t.getX(r+2)),i.push(t.getX(r+1)),i.push(t.getX(r)));i.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const n=y.clone();return n.setIndex(i),n.clearGroups(),n}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),y}class Hs extends vt{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Kr(t)}),this.register(function(t){return new to(t)}),this.register(function(t){return new no(t)}),this.register(function(t){return new so(t)}),this.register(function(t){return new Qr(t)}),this.register(function(t){return new qr(t)}),this.register(function(t){return new Zr(t)}),this.register(function(t){return new $r(t)}),this.register(function(t){return new Xr(t)}),this.register(function(t){return new Jr(t)}),this.register(function(t){return new Yr(t)}),this.register(function(t){return new eo(t)}),this.register(function(t){return new Wr(t)}),this.register(function(t){return new io(t)}),this.register(function(t){return new ro(t)})}load(e,t,s,i){const n=this;let r;this.resourcePath!==""?r=this.resourcePath:this.path!==""?r=this.path:r=Vt.extractUrlBase(e),this.manager.itemStart(e);const a=function(u){i?i(u):console.error(u),n.manager.itemError(e),n.manager.itemEnd(e)},o=new Ct(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(u){try{n.parse(u,r,function(c){t(c),n.manager.itemEnd(e)},a)}catch(c){a(c)}},s,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,i){let n;const r={},a={},o=new TextDecoder;if(typeof e=="string")n=JSON.parse(e);else if(e instanceof ArrayBuffer)if(o.decode(new Uint8Array(e,0,4))===Us){try{r[ce.KHR_BINARY_GLTF]=new oo(e)}catch(h){i&&i(h);return}n=JSON.parse(r[ce.KHR_BINARY_GLTF].content)}else n=JSON.parse(o.decode(e));else n=e;if(n.asset===void 0||n.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const u=new wo(n,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const h=this.pluginCallbacks[c](u);a[h.name]=h,r[h.name]=!0}if(n.extensionsUsed)for(let c=0;c<n.extensionsUsed.length;++c){const h=n.extensionsUsed[c],f=n.extensionsRequired||[];switch(h){case ce.KHR_MATERIALS_UNLIT:r[h]=new jr;break;case ce.KHR_DRACO_MESH_COMPRESSION:r[h]=new ao(n,this.dracoLoader);break;case ce.KHR_TEXTURE_TRANSFORM:r[h]=new lo;break;case ce.KHR_MESH_QUANTIZATION:r[h]=new co;break;default:f.indexOf(h)>=0&&a[h]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}u.setExtensions(r),u.setPlugins(a),u.parse(s,i)}parseAsync(e,t){const s=this;return new Promise(function(i,n){s.parse(e,t,i,n)})}}function Gr(){let y={};return{get:function(e){return y[e]},add:function(e,t){y[e]=t},remove:function(e){delete y[e]},removeAll:function(){y={}}}}const ce={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Wr{constructor(e){this.parser=e,this.name=ce.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,i=t.length;s<i;s++){const n=t[s];n.extensions&&n.extensions[this.name]&&n.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let i=t.cache.get(s);if(i)return i;const n=t.json,o=((n.extensions&&n.extensions[this.name]||{}).lights||[])[e];let u;const c=new fe(16777215);o.color!==void 0&&c.fromArray(o.color);const h=o.range!==void 0?o.range:0;switch(o.type){case"directional":u=new Pn(c),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new Ht(c),u.distance=h;break;case"spot":u=new Mn(c),u.distance=h,o.spot=o.spot||{},o.spot.innerConeAngle=o.spot.innerConeAngle!==void 0?o.spot.innerConeAngle:0,o.spot.outerConeAngle=o.spot.outerConeAngle!==void 0?o.spot.outerConeAngle:Math.PI/4,u.angle=o.spot.outerConeAngle,u.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return u.position.set(0,0,0),u.decay=2,$e(u,o),o.intensity!==void 0&&(u.intensity=o.intensity),u.name=t.createUniqueName(o.name||"light_"+e),i=Promise.resolve(u),t.cache.add(s,i),i}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,s=this.parser,n=s.json.nodes[e],a=(n.extensions&&n.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(o){return s._getNodeRef(t.cache,a,o)})}}class jr{constructor(){this.name=ce.KHR_MATERIALS_UNLIT}getMaterialType(){return Ne}extendParams(e,t,s){const i=[];e.color=new fe(1,1,1),e.opacity=1;const n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){const r=n.baseColorFactor;e.color.fromArray(r),e.opacity=r[3]}n.baseColorTexture!==void 0&&i.push(s.assignTexture(e,"map",n.baseColorTexture,Ue))}return Promise.all(i)}}class Xr{constructor(e){this.parser=e,this.name=ce.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name].emissiveStrength;return n!==void 0&&(t.emissiveIntensity=n),Promise.resolve()}}class Kr{constructor(e){this.parser=e,this.name=ce.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Ke}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],r=i.extensions[this.name];if(r.clearcoatFactor!==void 0&&(t.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&n.push(s.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&n.push(s.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(n.push(s.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const a=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new se(a,a)}return Promise.all(n)}}class Yr{constructor(e){this.parser=e,this.name=ce.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Ke}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],r=i.extensions[this.name];return r.iridescenceFactor!==void 0&&(t.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&n.push(s.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(t.iridescenceIOR=r.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&n.push(s.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(n)}}class Qr{constructor(e){this.parser=e,this.name=ce.KHR_MATERIALS_SHEEN}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Ke}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[];t.sheenColor=new fe(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=i.extensions[this.name];return r.sheenColorFactor!==void 0&&t.sheenColor.fromArray(r.sheenColorFactor),r.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&n.push(s.assignTexture(t,"sheenColorMap",r.sheenColorTexture,Ue)),r.sheenRoughnessTexture!==void 0&&n.push(s.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(n)}}class qr{constructor(e){this.parser=e,this.name=ce.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Ke}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],r=i.extensions[this.name];return r.transmissionFactor!==void 0&&(t.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&n.push(s.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(n)}}class Zr{constructor(e){this.parser=e,this.name=ce.KHR_MATERIALS_VOLUME}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Ke}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],r=i.extensions[this.name];t.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&n.push(s.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||1/0;const a=r.attenuationColor||[1,1,1];return t.attenuationColor=new fe(a[0],a[1],a[2]),Promise.all(n)}}class $r{constructor(e){this.parser=e,this.name=ce.KHR_MATERIALS_IOR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Ke}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name];return t.ior=n.ior!==void 0?n.ior:1.5,Promise.resolve()}}class Jr{constructor(e){this.parser=e,this.name=ce.KHR_MATERIALS_SPECULAR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Ke}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],r=i.extensions[this.name];t.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&n.push(s.assignTexture(t,"specularIntensityMap",r.specularTexture));const a=r.specularColorFactor||[1,1,1];return t.specularColor=new fe(a[0],a[1],a[2]),r.specularColorTexture!==void 0&&n.push(s.assignTexture(t,"specularColorMap",r.specularColorTexture,Ue)),Promise.all(n)}}class eo{constructor(e){this.parser=e,this.name=ce.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Ke}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],r=i.extensions[this.name];return r.anisotropyStrength!==void 0&&(t.anisotropy=r.anisotropyStrength),r.anisotropyRotation!==void 0&&(t.anisotropyRotation=r.anisotropyRotation),r.anisotropyTexture!==void 0&&n.push(s.assignTexture(t,"anisotropyMap",r.anisotropyTexture)),Promise.all(n)}}class to{constructor(e){this.parser=e,this.name=ce.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,i=s.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const n=i.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,n.source,r)}}class no{constructor(e){this.parser=e,this.name=ce.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,i=s.json,n=i.textures[e];if(!n.extensions||!n.extensions[t])return null;const r=n.extensions[t],a=i.images[r.source];let o=s.textureLoader;if(a.uri){const u=s.options.manager.getHandler(a.uri);u!==null&&(o=u)}return this.detectSupport().then(function(u){if(u)return s.loadTextureImage(e,r.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class so{constructor(e){this.parser=e,this.name=ce.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,i=s.json,n=i.textures[e];if(!n.extensions||!n.extensions[t])return null;const r=n.extensions[t],a=i.images[r.source];let o=s.textureLoader;if(a.uri){const u=s.options.manager.getHandler(a.uri);u!==null&&(o=u)}return this.detectSupport().then(function(u){if(u)return s.loadTextureImage(e,r.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class io{constructor(e){this.name=ce.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const i=s.extensions[this.name],n=this.parser.getDependency("buffer",i.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return n.then(function(a){const o=i.byteOffset||0,u=i.byteLength||0,c=i.count,h=i.byteStride,f=new Uint8Array(a,o,u);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(c,h,f,i.mode,i.filter).then(function(l){return l.buffer}):r.ready.then(function(){const l=new ArrayBuffer(c*h);return r.decodeGltfBuffer(new Uint8Array(l),c,h,f,i.mode,i.filter),l})})}else return null}}class ro{constructor(e){this.name=ce.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,s=t.nodes[e];if(!s.extensions||!s.extensions[this.name]||s.mesh===void 0)return null;const i=t.meshes[s.mesh];for(const u of i.primitives)if(u.mode!==Le.TRIANGLES&&u.mode!==Le.TRIANGLE_STRIP&&u.mode!==Le.TRIANGLE_FAN&&u.mode!==void 0)return null;const r=s.extensions[this.name].attributes,a=[],o={};for(const u in r)a.push(this.parser.getDependency("accessor",r[u]).then(c=>(o[u]=c,o[u])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(u=>{const c=u.pop(),h=c.isGroup?c.children:[c],f=u[0].count,l=[];for(const d of h){const p=new ie,m=new j,x=new Me,b=new j(1,1,1),v=new ai(d.geometry,d.material,f);for(let T=0;T<f;T++)o.TRANSLATION&&m.fromBufferAttribute(o.TRANSLATION,T),o.ROTATION&&x.fromBufferAttribute(o.ROTATION,T),o.SCALE&&b.fromBufferAttribute(o.SCALE,T),v.setMatrixAt(T,p.compose(m,x,b));for(const T in o)T!=="TRANSLATION"&&T!=="ROTATION"&&T!=="SCALE"&&d.geometry.setAttribute(T,o[T]);et.prototype.copy.call(v,d),this.parser.assignFinalMaterial(v),l.push(v)}return c.isGroup?(c.clear(),c.add(...l),c):l[0]}))}}const Us="glTF",dt=12,Xn={JSON:1313821514,BIN:5130562};class oo{constructor(e){this.name=ce.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,dt),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Us)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-dt,n=new DataView(e,dt);let r=0;for(;r<i;){const a=n.getUint32(r,!0);r+=4;const o=n.getUint32(r,!0);if(r+=4,o===Xn.JSON){const u=new Uint8Array(e,dt+r,a);this.content=s.decode(u)}else if(o===Xn.BIN){const u=dt+r;this.body=e.slice(u,u+a)}r+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ao{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ce.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,i=this.dracoLoader,n=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,a={},o={},u={};for(const c in r){const h=vn[c]||c.toLowerCase();a[h]=r[c]}for(const c in e.attributes){const h=vn[c]||c.toLowerCase();if(r[c]!==void 0){const f=s.accessors[e.attributes[c]],l=ut[f.componentType];u[h]=l.name,o[h]=f.normalized===!0}}return t.getDependency("bufferView",n).then(function(c){return new Promise(function(h){i.decodeDracoFile(c,function(f){for(const l in f.attributes){const d=f.attributes[l],p=o[l];p!==void 0&&(d.normalized=p)}h(f)},a,u)})})}}class lo{constructor(){this.name=ce.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class co{constructor(){this.name=ce.KHR_MESH_QUANTIZATION}}class _s extends wi{constructor(e,t,s,i){super(e,t,s,i)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,i=this.valueSize,n=e*i*3+i;for(let r=0;r!==i;r++)t[r]=s[n+r];return t}interpolate_(e,t,s,i){const n=this.resultBuffer,r=this.sampleValues,a=this.valueSize,o=a*2,u=a*3,c=i-t,h=(s-t)/c,f=h*h,l=f*h,d=e*u,p=d-u,m=-2*l+3*f,x=l-f,b=1-m,v=x-f+h;for(let T=0;T!==a;T++){const g=r[p+T+a],w=r[p+T+o]*c,S=r[d+T+a],A=r[d+T]*c;n[T]=b*g+v*w+m*S+x*A}return n}}const uo=new Me;class ho extends _s{interpolate_(e,t,s,i){const n=super.interpolate_(e,t,s,i);return uo.fromArray(n).normalize().toArray(n),n}}const Le={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},ut={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Kn={9728:hi,9729:fs,9984:fi,9985:di,9986:pi,9987:ds},Yn={33071:fn,33648:mi,10497:Xe},an={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},vn={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},qe={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},fo={CUBICSPLINE:void 0,LINEAR:ps,STEP:gi},ln={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function po(y){return y.DefaultMaterial===void 0&&(y.DefaultMaterial=new Gt({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:yi})),y.DefaultMaterial}function nt(y,e,t){for(const s in t.extensions)y[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=t.extensions[s])}function $e(y,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(y.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function mo(y,e,t){let s=!1,i=!1,n=!1;for(let u=0,c=e.length;u<c;u++){const h=e[u];if(h.POSITION!==void 0&&(s=!0),h.NORMAL!==void 0&&(i=!0),h.COLOR_0!==void 0&&(n=!0),s&&i&&n)break}if(!s&&!i&&!n)return Promise.resolve(y);const r=[],a=[],o=[];for(let u=0,c=e.length;u<c;u++){const h=e[u];if(s){const f=h.POSITION!==void 0?t.getDependency("accessor",h.POSITION):y.attributes.position;r.push(f)}if(i){const f=h.NORMAL!==void 0?t.getDependency("accessor",h.NORMAL):y.attributes.normal;a.push(f)}if(n){const f=h.COLOR_0!==void 0?t.getDependency("accessor",h.COLOR_0):y.attributes.color;o.push(f)}}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(o)]).then(function(u){const c=u[0],h=u[1],f=u[2];return s&&(y.morphAttributes.position=c),i&&(y.morphAttributes.normal=h),n&&(y.morphAttributes.color=f),y.morphTargetsRelative=!0,y})}function go(y,e){if(y.updateMorphTargets(),e.weights!==void 0)for(let t=0,s=e.weights.length;t<s;t++)y.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(y.morphTargetInfluences.length===t.length){y.morphTargetDictionary={};for(let s=0,i=t.length;s<i;s++)y.morphTargetDictionary[t[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function yo(y){let e;const t=y.extensions&&y.extensions[ce.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+cn(t.attributes):e=y.indices+":"+cn(y.attributes)+":"+y.mode,y.targets!==void 0)for(let s=0,i=y.targets.length;s<i;s++)e+=":"+cn(y.targets[s]);return e}function cn(y){let e="";const t=Object.keys(y).sort();for(let s=0,i=t.length;s<i;s++)e+=t[s]+":"+y[t[s]]+";";return e}function wn(y){switch(y){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function xo(y){return y.search(/\.jpe?g($|\?)/i)>0||y.search(/^data\:image\/jpeg/)===0?"image/jpeg":y.search(/\.webp($|\?)/i)>0||y.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const vo=new ie;class wo{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Gr,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,i=!1,n=-1;typeof navigator<"u"&&(s=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,i=navigator.userAgent.indexOf("Firefox")>-1,n=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||s||i&&n<98?this.textureLoader=new Wt(this.options.manager):this.textureLoader=new li(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Ct(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,i=this.json,n=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(r){const a={scene:r[0][i.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:i.asset,parser:s,userData:{}};nt(n,a,i),$e(a,i),Promise.all(s._invokeAll(function(o){return o.afterRoot&&o.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let i=0,n=t.length;i<n;i++){const r=t[i].joints;for(let a=0,o=r.length;a<o;a++)e[r[a]].isBone=!0}for(let i=0,n=e.length;i<n;i++){const r=e[i];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(s[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const i=s.clone(),n=(r,a)=>{const o=this.associations.get(r);o!=null&&this.associations.set(a,o);for(const[u,c]of r.children.entries())n(c,a.children[u])};return n(s,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const i=e(t[s]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let i=0;i<t.length;i++){const n=e(t[i]);n&&s.push(n)}return s}getDependency(e,t){const s=e+":"+t;let i=this.cache.get(s);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(n){return n.loadNode&&n.loadNode(t)});break;case"mesh":i=this._invokeOne(function(n){return n.loadMesh&&n.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(n){return n.loadBufferView&&n.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(n){return n.loadMaterial&&n.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(n){return n.loadTexture&&n.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(n){return n.loadAnimation&&n.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e);break}this.cache.add(s,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(n,r){return s.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[ce.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(n,r){s.load(Vt.resolveURL(t.uri,i.path),n,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(s){const i=t.byteLength||0,n=t.byteOffset||0;return s.slice(n,n+i)})}loadAccessor(e){const t=this,s=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0){const r=an[i.type],a=ut[i.componentType],o=i.normalized===!0,u=new a(i.count*r);return Promise.resolve(new He(u,r,o))}const n=[];return i.bufferView!==void 0?n.push(this.getDependency("bufferView",i.bufferView)):n.push(null),i.sparse!==void 0&&(n.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(n).then(function(r){const a=r[0],o=an[i.type],u=ut[i.componentType],c=u.BYTES_PER_ELEMENT,h=c*o,f=i.byteOffset||0,l=i.bufferView!==void 0?s.bufferViews[i.bufferView].byteStride:void 0,d=i.normalized===!0;let p,m;if(l&&l!==h){const x=Math.floor(f/l),b="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+x+":"+i.count;let v=t.cache.get(b);v||(p=new u(a,x*l,i.count*l/c),v=new ci(p,l/c),t.cache.add(b,v)),m=new xi(v,o,f%l/c,d)}else a===null?p=new u(i.count*o):p=new u(a,f,i.count*o),m=new He(p,o,d);if(i.sparse!==void 0){const x=an.SCALAR,b=ut[i.sparse.indices.componentType],v=i.sparse.indices.byteOffset||0,T=i.sparse.values.byteOffset||0,g=new b(r[1],v,i.sparse.count*x),w=new u(r[2],T,i.sparse.count*o);a!==null&&(m=new He(m.array.slice(),m.itemSize,m.normalized));for(let S=0,A=g.length;S<A;S++){const P=g[S];if(m.setX(P,w[S*o]),o>=2&&m.setY(P,w[S*o+1]),o>=3&&m.setZ(P,w[S*o+2]),o>=4&&m.setW(P,w[S*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return m})}loadTexture(e){const t=this.json,s=this.options,n=t.textures[e].source,r=t.images[n];let a=this.textureLoader;if(r.uri){const o=s.manager.getHandler(r.uri);o!==null&&(a=o)}return this.loadTextureImage(e,n,a)}loadTextureImage(e,t,s){const i=this,n=this.json,r=n.textures[e],a=n.images[t],o=(a.uri||a.bufferView)+":"+r.sampler;if(this.textureCache[o])return this.textureCache[o];const u=this.loadImageSource(t,s).then(function(c){c.flipY=!1,c.name=r.name||a.name||"",c.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(c.name=a.uri);const f=(n.samplers||{})[r.sampler]||{};return c.magFilter=Kn[f.magFilter]||fs,c.minFilter=Kn[f.minFilter]||ds,c.wrapS=Yn[f.wrapS]||Xe,c.wrapT=Yn[f.wrapT]||Xe,i.associations.set(c,{textures:e}),c}).catch(function(){return null});return this.textureCache[o]=u,u}loadImageSource(e,t){const s=this,i=this.json,n=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(h=>h.clone());const r=i.images[e],a=self.URL||self.webkitURL;let o=r.uri||"",u=!1;if(r.bufferView!==void 0)o=s.getDependency("bufferView",r.bufferView).then(function(h){u=!0;const f=new Blob([h],{type:r.mimeType});return o=a.createObjectURL(f),o});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const c=Promise.resolve(o).then(function(h){return new Promise(function(f,l){let d=f;t.isImageBitmapLoader===!0&&(d=function(p){const m=new Nt(p);m.needsUpdate=!0,f(m)}),t.load(Vt.resolveURL(h,n.path),d,void 0,l)})}).then(function(h){return u===!0&&a.revokeObjectURL(o),h.userData.mimeType=r.mimeType||xo(r.uri),h}).catch(function(h){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),h});return this.sourceCache[e]=c,c}assignTexture(e,t,s,i){const n=this;return this.getDependency("texture",s.index).then(function(r){if(!r)return null;if(s.texCoord!==void 0&&s.texCoord>0&&(r=r.clone(),r.channel=s.texCoord),n.extensions[ce.KHR_TEXTURE_TRANSFORM]){const a=s.extensions!==void 0?s.extensions[ce.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const o=n.associations.get(r);r=n.extensions[ce.KHR_TEXTURE_TRANSFORM].extendTexture(r,a),n.associations.set(r,o)}}return i!==void 0&&(r.colorSpace=i),e[t]=r,r})}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const i=t.attributes.tangent===void 0,n=t.attributes.color!==void 0,r=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+s.uuid;let o=this.cache.get(a);o||(o=new ns,Zt.prototype.copy.call(o,s),o.color.copy(s.color),o.map=s.map,o.sizeAttenuation=!1,this.cache.add(a,o)),s=o}else if(e.isLine){const a="LineBasicMaterial:"+s.uuid;let o=this.cache.get(a);o||(o=new Et,Zt.prototype.copy.call(o,s),o.color.copy(s.color),o.map=s.map,this.cache.add(a,o)),s=o}if(i||n||r){let a="ClonedMaterial:"+s.uuid+":";i&&(a+="derivative-tangents:"),n&&(a+="vertex-colors:"),r&&(a+="flat-shading:");let o=this.cache.get(a);o||(o=s.clone(),n&&(o.vertexColors=!0),r&&(o.flatShading=!0),i&&(o.normalScale&&(o.normalScale.y*=-1),o.clearcoatNormalScale&&(o.clearcoatNormalScale.y*=-1)),this.cache.add(a,o),this.associations.set(o,this.associations.get(s))),s=o}e.material=s}getMaterialType(){return Gt}loadMaterial(e){const t=this,s=this.json,i=this.extensions,n=s.materials[e];let r;const a={},o=n.extensions||{},u=[];if(o[ce.KHR_MATERIALS_UNLIT]){const h=i[ce.KHR_MATERIALS_UNLIT];r=h.getMaterialType(),u.push(h.extendParams(a,n,t))}else{const h=n.pbrMetallicRoughness||{};if(a.color=new fe(1,1,1),a.opacity=1,Array.isArray(h.baseColorFactor)){const f=h.baseColorFactor;a.color.fromArray(f),a.opacity=f[3]}h.baseColorTexture!==void 0&&u.push(t.assignTexture(a,"map",h.baseColorTexture,Ue)),a.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,a.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&(u.push(t.assignTexture(a,"metalnessMap",h.metallicRoughnessTexture)),u.push(t.assignTexture(a,"roughnessMap",h.metallicRoughnessTexture))),r=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),u.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,a)})))}n.doubleSided===!0&&(a.side=Sn);const c=n.alphaMode||ln.OPAQUE;if(c===ln.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,c===ln.MASK&&(a.alphaTest=n.alphaCutoff!==void 0?n.alphaCutoff:.5)),n.normalTexture!==void 0&&r!==Ne&&(u.push(t.assignTexture(a,"normalMap",n.normalTexture)),a.normalScale=new se(1,1),n.normalTexture.scale!==void 0)){const h=n.normalTexture.scale;a.normalScale.set(h,h)}return n.occlusionTexture!==void 0&&r!==Ne&&(u.push(t.assignTexture(a,"aoMap",n.occlusionTexture)),n.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=n.occlusionTexture.strength)),n.emissiveFactor!==void 0&&r!==Ne&&(a.emissive=new fe().fromArray(n.emissiveFactor)),n.emissiveTexture!==void 0&&r!==Ne&&u.push(t.assignTexture(a,"emissiveMap",n.emissiveTexture,Ue)),Promise.all(u).then(function(){const h=new r(a);return n.name&&(h.name=n.name),$e(h,n),t.associations.set(h,{materials:e}),n.extensions&&nt(i,h,n),h})}createUniqueName(e){const t=wt.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,s=this.extensions,i=this.primitiveCache;function n(a){return s[ce.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(o){return Qn(o,a,t)})}const r=[];for(let a=0,o=e.length;a<o;a++){const u=e[a],c=yo(u),h=i[c];if(h)r.push(h.promise);else{let f;u.extensions&&u.extensions[ce.KHR_DRACO_MESH_COMPRESSION]?f=n(u):f=Qn(new _e,u,t),i[c]={primitive:u,promise:f},r.push(f)}}return Promise.all(r)}loadMesh(e){const t=this,s=this.json,i=this.extensions,n=s.meshes[e],r=n.primitives,a=[];for(let o=0,u=r.length;o<u;o++){const c=r[o].material===void 0?po(this.cache):this.getDependency("material",r[o].material);a.push(c)}return a.push(t.loadGeometries(r)),Promise.all(a).then(function(o){const u=o.slice(0,o.length-1),c=o[o.length-1],h=[];for(let l=0,d=c.length;l<d;l++){const p=c[l],m=r[l];let x;const b=u[l];if(m.mode===Le.TRIANGLES||m.mode===Le.TRIANGLE_STRIP||m.mode===Le.TRIANGLE_FAN||m.mode===void 0)x=n.isSkinnedMesh===!0?new os(p,b):new be(p,b),x.isSkinnedMesh===!0&&x.normalizeSkinWeights(),m.mode===Le.TRIANGLE_STRIP?x.geometry=jn(x.geometry,hs):m.mode===Le.TRIANGLE_FAN&&(x.geometry=jn(x.geometry,gn));else if(m.mode===Le.LINES)x=new ss(p,b);else if(m.mode===Le.LINE_STRIP)x=new _t(p,b);else if(m.mode===Le.LINE_LOOP)x=new ui(p,b);else if(m.mode===Le.POINTS)x=new ts(p,b);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);Object.keys(x.geometry.morphAttributes).length>0&&go(x,n),x.name=t.createUniqueName(n.name||"mesh_"+e),$e(x,n),m.extensions&&nt(i,x,m),t.assignFinalMaterial(x),h.push(x)}for(let l=0,d=h.length;l<d;l++)t.associations.set(h[l],{meshes:e,primitives:l});if(h.length===1)return n.extensions&&nt(i,h[0],n),h[0];const f=new ct;n.extensions&&nt(i,f,n),t.associations.set(f,{meshes:e});for(let l=0,d=h.length;l<d;l++)f.add(h[l]);return f})}loadCamera(e){let t;const s=this.json.cameras[e],i=s[s.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return s.type==="perspective"?t=new Pt(Ie.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):s.type==="orthographic"&&(t=new An(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),$e(t,s),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],s=[];for(let i=0,n=t.joints.length;i<n;i++)s.push(this._loadNodeShallow(t.joints[i]));return t.inverseBindMatrices!==void 0?s.push(this.getDependency("accessor",t.inverseBindMatrices)):s.push(null),Promise.all(s).then(function(i){const n=i.pop(),r=i,a=[],o=[];for(let u=0,c=r.length;u<c;u++){const h=r[u];if(h){a.push(h);const f=new ie;n!==null&&f.fromArray(n.array,u*16),o.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[u])}return new as(a,o)})}loadAnimation(e){const t=this.json,s=this,i=t.animations[e],n=i.name?i.name:"animation_"+e,r=[],a=[],o=[],u=[],c=[];for(let h=0,f=i.channels.length;h<f;h++){const l=i.channels[h],d=i.samplers[l.sampler],p=l.target,m=p.node,x=i.parameters!==void 0?i.parameters[d.input]:d.input,b=i.parameters!==void 0?i.parameters[d.output]:d.output;p.node!==void 0&&(r.push(this.getDependency("node",m)),a.push(this.getDependency("accessor",x)),o.push(this.getDependency("accessor",b)),u.push(d),c.push(p))}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(o),Promise.all(u),Promise.all(c)]).then(function(h){const f=h[0],l=h[1],d=h[2],p=h[3],m=h[4],x=[];for(let b=0,v=f.length;b<v;b++){const T=f[b],g=l[b],w=d[b],S=p[b],A=m[b];if(T===void 0)continue;T.updateMatrix&&(T.updateMatrix(),T.matrixAutoUpdate=!0);const P=s._createAnimationTracks(T,g,w,S,A);if(P)for(let M=0;M<P.length;M++)x.push(P[M])}return new cs(n,void 0,x)})}createNodeMesh(e){const t=this.json,s=this,i=t.nodes[e];return i.mesh===void 0?null:s.getDependency("mesh",i.mesh).then(function(n){const r=s._getNodeRef(s.meshCache,i.mesh,n);return i.weights!==void 0&&r.traverse(function(a){if(a.isMesh)for(let o=0,u=i.weights.length;o<u;o++)a.morphTargetInfluences[o]=i.weights[o]}),r})}loadNode(e){const t=this.json,s=this,i=t.nodes[e],n=s._loadNodeShallow(e),r=[],a=i.children||[];for(let u=0,c=a.length;u<c;u++)r.push(s.getDependency("node",a[u]));const o=i.skin===void 0?Promise.resolve(null):s.getDependency("skin",i.skin);return Promise.all([n,Promise.all(r),o]).then(function(u){const c=u[0],h=u[1],f=u[2];f!==null&&c.traverse(function(l){l.isSkinnedMesh&&l.bind(f,vo)});for(let l=0,d=h.length;l<d;l++)c.add(h[l]);return c})}_loadNodeShallow(e){const t=this.json,s=this.extensions,i=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const n=t.nodes[e],r=n.name?i.createUniqueName(n.name):"",a=[],o=i._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(e)});return o&&a.push(o),n.camera!==void 0&&a.push(i.getDependency("camera",n.camera).then(function(u){return i._getNodeRef(i.cameraCache,n.camera,u)})),i._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(e)}).forEach(function(u){a.push(u)}),this.nodeCache[e]=Promise.all(a).then(function(u){let c;if(n.isBone===!0?c=new dn:u.length>1?c=new ct:u.length===1?c=u[0]:c=new et,c!==u[0])for(let h=0,f=u.length;h<f;h++)c.add(u[h]);if(n.name&&(c.userData.name=n.name,c.name=r),$e(c,n),n.extensions&&nt(s,c,n),n.matrix!==void 0){const h=new ie;h.fromArray(n.matrix),c.applyMatrix4(h)}else n.translation!==void 0&&c.position.fromArray(n.translation),n.rotation!==void 0&&c.quaternion.fromArray(n.rotation),n.scale!==void 0&&c.scale.fromArray(n.scale);return i.associations.has(c)||i.associations.set(c,{}),i.associations.get(c).nodes=e,c}),this.nodeCache[e]}loadScene(e){const t=this.extensions,s=this.json.scenes[e],i=this,n=new ct;s.name&&(n.name=i.createUniqueName(s.name)),$e(n,s),s.extensions&&nt(t,n,s);const r=s.nodes||[],a=[];for(let o=0,u=r.length;o<u;o++)a.push(i.getDependency("node",r[o]));return Promise.all(a).then(function(o){for(let c=0,h=o.length;c<h;c++)n.add(o[c]);const u=c=>{const h=new Map;for(const[f,l]of i.associations)(f instanceof Zt||f instanceof Nt)&&h.set(f,l);return c.traverse(f=>{const l=i.associations.get(f);l!=null&&h.set(f,l)}),h};return i.associations=u(n),n})}_createAnimationTracks(e,t,s,i,n){const r=[],a=e.name?e.name:e.uuid,o=[];qe[n.path]===qe.weights?e.traverse(function(f){f.morphTargetInfluences&&o.push(f.name?f.name:f.uuid)}):o.push(a);let u;switch(qe[n.path]){case qe.weights:u=mn;break;case qe.rotation:u=pn;break;case qe.position:case qe.scale:default:switch(s.itemSize){case 1:u=mn;break;case 2:case 3:u=us;break}break}const c=i.interpolation!==void 0?fo[i.interpolation]:ps,h=this._getArrayFromAccessor(s);for(let f=0,l=o.length;f<l;f++){const d=new u(o[f]+"."+qe[n.path],t.array,h,c);c==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(d),r.push(d)}return r}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const s=wn(t.constructor),i=new Float32Array(t.length);for(let n=0,r=t.length;n<r;n++)i[n]=t[n]*s;t=i}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(s){const i=this instanceof pn?ho:_s;return new i(this.times,this.values,this.getValueSize()/3,s)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Ao(y,e,t){const s=e.attributes,i=new bn;if(s.POSITION!==void 0){const a=t.json.accessors[s.POSITION],o=a.min,u=a.max;if(o!==void 0&&u!==void 0){if(i.set(new j(o[0],o[1],o[2]),new j(u[0],u[1],u[2])),a.normalized){const c=wn(ut[a.componentType]);i.min.multiplyScalar(c),i.max.multiplyScalar(c)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const n=e.targets;if(n!==void 0){const a=new j,o=new j;for(let u=0,c=n.length;u<c;u++){const h=n[u];if(h.POSITION!==void 0){const f=t.json.accessors[h.POSITION],l=f.min,d=f.max;if(l!==void 0&&d!==void 0){if(o.setX(Math.max(Math.abs(l[0]),Math.abs(d[0]))),o.setY(Math.max(Math.abs(l[1]),Math.abs(d[1]))),o.setZ(Math.max(Math.abs(l[2]),Math.abs(d[2]))),f.normalized){const p=wn(ut[f.componentType]);o.multiplyScalar(p)}a.max(o)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(a)}y.boundingBox=i;const r=new vi;i.getCenter(r.center),r.radius=i.min.distanceTo(i.max)/2,y.boundingSphere=r}function Qn(y,e,t){const s=e.attributes,i=[];function n(r,a){return t.getDependency("accessor",r).then(function(o){y.setAttribute(a,o)})}for(const r in s){const a=vn[r]||r.toLowerCase();a in y.attributes||i.push(n(s[r],a))}if(e.indices!==void 0&&!y.index){const r=t.getDependency("accessor",e.indices).then(function(a){y.setIndex(a)});i.push(r)}return $e(y,e),Ao(y,e,t),Promise.all(i).then(function(){return e.targets!==void 0?mo(y,e.targets,t):y})}const bo=Ue;class Tt extends vt{constructor(e){super(e),this.defaultDPI=90,this.defaultUnit="px"}load(e,t,s,i){const n=this,r=new Ct(n.manager);r.setPath(n.path),r.setRequestHeader(n.requestHeader),r.setWithCredentials(n.withCredentials),r.load(e,function(a){try{t(n.parse(a))}catch(o){i?i(o):console.error(o),n.manager.itemError(e)}},s,i)}parse(e){const t=this;function s(B,O){if(B.nodeType!==1)return;const E=T(B);let R=!1,H=null;switch(B.nodeName){case"svg":O=d(B,O);break;case"style":n(B);break;case"g":O=d(B,O);break;case"path":O=d(B,O),B.hasAttribute("d")&&(H=i(B));break;case"rect":O=d(B,O),H=o(B);break;case"polygon":O=d(B,O),H=u(B);break;case"polyline":O=d(B,O),H=c(B);break;case"circle":O=d(B,O),H=h(B);break;case"ellipse":O=d(B,O),H=f(B);break;case"line":O=d(B,O),H=l(B);break;case"defs":R=!0;break;case"use":O=d(B,O);const K=(B.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),Q=B.viewportElement.getElementById(K);Q?s(Q,O):console.warn("SVGLoader: 'use node' references non-existent node id: "+K);break}H&&(O.fill!==void 0&&O.fill!=="none"&&H.color.setStyle(O.fill,bo),w(H,re),C.push(H),H.userData={node:B,style:O});const X=B.childNodes;for(let N=0;N<X.length;N++){const K=X[N];R&&K.nodeName!=="style"&&K.nodeName!=="defs"||s(K,O)}E&&(V.pop(),V.length>0?re.copy(V[V.length-1]):re.identity())}function i(B){const O=new tt,E=new se,R=new se,H=new se;let X=!0,N=!1;const K=B.getAttribute("d");if(K===""||K==="none")return null;const Q=K.match(/[a-df-z][^a-df-z]*/ig);for(let q=0,G=Q.length;q<G;q++){const Y=Q[q],Z=Y.charAt(0),ee=Y.slice(1).trim();X===!0&&(N=!0,X=!1);let F;switch(Z){case"M":F=m(ee);for(let I=0,$=F.length;I<$;I+=2)E.x=F[I+0],E.y=F[I+1],R.x=E.x,R.y=E.y,I===0?O.moveTo(E.x,E.y):O.lineTo(E.x,E.y),I===0&&H.copy(E);break;case"H":F=m(ee);for(let I=0,$=F.length;I<$;I++)E.x=F[I],R.x=E.x,R.y=E.y,O.lineTo(E.x,E.y),I===0&&N===!0&&H.copy(E);break;case"V":F=m(ee);for(let I=0,$=F.length;I<$;I++)E.y=F[I],R.x=E.x,R.y=E.y,O.lineTo(E.x,E.y),I===0&&N===!0&&H.copy(E);break;case"L":F=m(ee);for(let I=0,$=F.length;I<$;I+=2)E.x=F[I+0],E.y=F[I+1],R.x=E.x,R.y=E.y,O.lineTo(E.x,E.y),I===0&&N===!0&&H.copy(E);break;case"C":F=m(ee);for(let I=0,$=F.length;I<$;I+=6)O.bezierCurveTo(F[I+0],F[I+1],F[I+2],F[I+3],F[I+4],F[I+5]),R.x=F[I+2],R.y=F[I+3],E.x=F[I+4],E.y=F[I+5],I===0&&N===!0&&H.copy(E);break;case"S":F=m(ee);for(let I=0,$=F.length;I<$;I+=4)O.bezierCurveTo(p(E.x,R.x),p(E.y,R.y),F[I+0],F[I+1],F[I+2],F[I+3]),R.x=F[I+0],R.y=F[I+1],E.x=F[I+2],E.y=F[I+3],I===0&&N===!0&&H.copy(E);break;case"Q":F=m(ee);for(let I=0,$=F.length;I<$;I+=4)O.quadraticCurveTo(F[I+0],F[I+1],F[I+2],F[I+3]),R.x=F[I+0],R.y=F[I+1],E.x=F[I+2],E.y=F[I+3],I===0&&N===!0&&H.copy(E);break;case"T":F=m(ee);for(let I=0,$=F.length;I<$;I+=2){const ae=p(E.x,R.x),ve=p(E.y,R.y);O.quadraticCurveTo(ae,ve,F[I+0],F[I+1]),R.x=ae,R.y=ve,E.x=F[I+0],E.y=F[I+1],I===0&&N===!0&&H.copy(E)}break;case"A":F=m(ee,[3,4],7);for(let I=0,$=F.length;I<$;I+=7){if(F[I+5]==E.x&&F[I+6]==E.y)continue;const ae=E.clone();E.x=F[I+5],E.y=F[I+6],R.x=E.x,R.y=E.y,r(O,F[I],F[I+1],F[I+2],F[I+3],F[I+4],ae,E),I===0&&N===!0&&H.copy(E)}break;case"m":F=m(ee);for(let I=0,$=F.length;I<$;I+=2)E.x+=F[I+0],E.y+=F[I+1],R.x=E.x,R.y=E.y,I===0?O.moveTo(E.x,E.y):O.lineTo(E.x,E.y),I===0&&H.copy(E);break;case"h":F=m(ee);for(let I=0,$=F.length;I<$;I++)E.x+=F[I],R.x=E.x,R.y=E.y,O.lineTo(E.x,E.y),I===0&&N===!0&&H.copy(E);break;case"v":F=m(ee);for(let I=0,$=F.length;I<$;I++)E.y+=F[I],R.x=E.x,R.y=E.y,O.lineTo(E.x,E.y),I===0&&N===!0&&H.copy(E);break;case"l":F=m(ee);for(let I=0,$=F.length;I<$;I+=2)E.x+=F[I+0],E.y+=F[I+1],R.x=E.x,R.y=E.y,O.lineTo(E.x,E.y),I===0&&N===!0&&H.copy(E);break;case"c":F=m(ee);for(let I=0,$=F.length;I<$;I+=6)O.bezierCurveTo(E.x+F[I+0],E.y+F[I+1],E.x+F[I+2],E.y+F[I+3],E.x+F[I+4],E.y+F[I+5]),R.x=E.x+F[I+2],R.y=E.y+F[I+3],E.x+=F[I+4],E.y+=F[I+5],I===0&&N===!0&&H.copy(E);break;case"s":F=m(ee);for(let I=0,$=F.length;I<$;I+=4)O.bezierCurveTo(p(E.x,R.x),p(E.y,R.y),E.x+F[I+0],E.y+F[I+1],E.x+F[I+2],E.y+F[I+3]),R.x=E.x+F[I+0],R.y=E.y+F[I+1],E.x+=F[I+2],E.y+=F[I+3],I===0&&N===!0&&H.copy(E);break;case"q":F=m(ee);for(let I=0,$=F.length;I<$;I+=4)O.quadraticCurveTo(E.x+F[I+0],E.y+F[I+1],E.x+F[I+2],E.y+F[I+3]),R.x=E.x+F[I+0],R.y=E.y+F[I+1],E.x+=F[I+2],E.y+=F[I+3],I===0&&N===!0&&H.copy(E);break;case"t":F=m(ee);for(let I=0,$=F.length;I<$;I+=2){const ae=p(E.x,R.x),ve=p(E.y,R.y);O.quadraticCurveTo(ae,ve,E.x+F[I+0],E.y+F[I+1]),R.x=ae,R.y=ve,E.x=E.x+F[I+0],E.y=E.y+F[I+1],I===0&&N===!0&&H.copy(E)}break;case"a":F=m(ee,[3,4],7);for(let I=0,$=F.length;I<$;I+=7){if(F[I+5]==0&&F[I+6]==0)continue;const ae=E.clone();E.x+=F[I+5],E.y+=F[I+6],R.x=E.x,R.y=E.y,r(O,F[I],F[I+1],F[I+2],F[I+3],F[I+4],ae,E),I===0&&N===!0&&H.copy(E)}break;case"Z":case"z":O.currentPath.autoClose=!0,O.currentPath.curves.length>0&&(E.copy(H),O.currentPath.currentPoint.copy(E),X=!0);break;default:console.warn(Y)}N=!1}return O}function n(B){if(!(!B.sheet||!B.sheet.cssRules||!B.sheet.cssRules.length))for(let O=0;O<B.sheet.cssRules.length;O++){const E=B.sheet.cssRules[O];if(E.type!==1)continue;const R=E.selectorText.split(/,/gm).filter(Boolean).map(H=>H.trim());for(let H=0;H<R.length;H++){const X=Object.fromEntries(Object.entries(E.style).filter(([,N])=>N!==""));k[R[H]]=Object.assign(k[R[H]]||{},X)}}}function r(B,O,E,R,H,X,N,K){if(O==0||E==0){B.lineTo(K.x,K.y);return}R=R*Math.PI/180,O=Math.abs(O),E=Math.abs(E);const Q=(N.x-K.x)/2,q=(N.y-K.y)/2,G=Math.cos(R)*Q+Math.sin(R)*q,Y=-Math.sin(R)*Q+Math.cos(R)*q;let Z=O*O,ee=E*E;const F=G*G,I=Y*Y,$=F/Z+I/ee;if($>1){const he=Math.sqrt($);O=he*O,E=he*E,Z=O*O,ee=E*E}const ae=Z*I+ee*F,ve=(Z*ee-ae)/ae;let we=Math.sqrt(Math.max(0,ve));H===X&&(we=-we);const me=we*O*Y/E,Ee=-we*E*G/O,Re=Math.cos(R)*me-Math.sin(R)*Ee+(N.x+K.x)/2,Ye=Math.sin(R)*me+Math.cos(R)*Ee+(N.y+K.y)/2,D=a(1,0,(G-me)/O,(Y-Ee)/E),ne=a((G-me)/O,(Y-Ee)/E,(-G-me)/O,(-Y-Ee)/E)%(Math.PI*2);B.currentPath.absellipse(Re,Ye,O,E,D,D+ne,X===0,R)}function a(B,O,E,R){const H=B*E+O*R,X=Math.sqrt(B*B+O*O)*Math.sqrt(E*E+R*R);let N=Math.acos(Math.max(-1,Math.min(1,H/X)));return B*R-O*E<0&&(N=-N),N}function o(B){const O=v(B.getAttribute("x")||0),E=v(B.getAttribute("y")||0),R=v(B.getAttribute("rx")||B.getAttribute("ry")||0),H=v(B.getAttribute("ry")||B.getAttribute("rx")||0),X=v(B.getAttribute("width")),N=v(B.getAttribute("height")),K=1-.551915024494,Q=new tt;return Q.moveTo(O+R,E),Q.lineTo(O+X-R,E),(R!==0||H!==0)&&Q.bezierCurveTo(O+X-R*K,E,O+X,E+H*K,O+X,E+H),Q.lineTo(O+X,E+N-H),(R!==0||H!==0)&&Q.bezierCurveTo(O+X,E+N-H*K,O+X-R*K,E+N,O+X-R,E+N),Q.lineTo(O+R,E+N),(R!==0||H!==0)&&Q.bezierCurveTo(O+R*K,E+N,O,E+N-H*K,O,E+N-H),Q.lineTo(O,E+H),(R!==0||H!==0)&&Q.bezierCurveTo(O,E+H*K,O+R*K,E,O+R,E),Q}function u(B){function O(X,N,K){const Q=v(N),q=v(K);H===0?R.moveTo(Q,q):R.lineTo(Q,q),H++}const E=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,R=new tt;let H=0;return B.getAttribute("points").replace(E,O),R.currentPath.autoClose=!0,R}function c(B){function O(X,N,K){const Q=v(N),q=v(K);H===0?R.moveTo(Q,q):R.lineTo(Q,q),H++}const E=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,R=new tt;let H=0;return B.getAttribute("points").replace(E,O),R.currentPath.autoClose=!1,R}function h(B){const O=v(B.getAttribute("cx")||0),E=v(B.getAttribute("cy")||0),R=v(B.getAttribute("r")||0),H=new $t;H.absarc(O,E,R,0,Math.PI*2);const X=new tt;return X.subPaths.push(H),X}function f(B){const O=v(B.getAttribute("cx")||0),E=v(B.getAttribute("cy")||0),R=v(B.getAttribute("rx")||0),H=v(B.getAttribute("ry")||0),X=new $t;X.absellipse(O,E,R,H,0,Math.PI*2);const N=new tt;return N.subPaths.push(X),N}function l(B){const O=v(B.getAttribute("x1")||0),E=v(B.getAttribute("y1")||0),R=v(B.getAttribute("x2")||0),H=v(B.getAttribute("y2")||0),X=new tt;return X.moveTo(O,E),X.lineTo(R,H),X.currentPath.autoClose=!1,X}function d(B,O){O=Object.assign({},O);let E={};if(B.hasAttribute("class")){const N=B.getAttribute("class").split(/\s/).filter(Boolean).map(K=>K.trim());for(let K=0;K<N.length;K++)E=Object.assign(E,k["."+N[K]])}B.hasAttribute("id")&&(E=Object.assign(E,k["#"+B.getAttribute("id")]));function R(N,K,Q){Q===void 0&&(Q=function(G){return G.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),G}),B.hasAttribute(N)&&(O[K]=Q(B.getAttribute(N))),E[N]&&(O[K]=Q(E[N])),B.style&&B.style[N]!==""&&(O[K]=Q(B.style[N]))}function H(N){return Math.max(0,Math.min(1,v(N)))}function X(N){return Math.max(0,v(N))}return R("fill","fill"),R("fill-opacity","fillOpacity",H),R("fill-rule","fillRule"),R("opacity","opacity",H),R("stroke","stroke"),R("stroke-opacity","strokeOpacity",H),R("stroke-width","strokeWidth",X),R("stroke-linejoin","strokeLineJoin"),R("stroke-linecap","strokeLineCap"),R("stroke-miterlimit","strokeMiterLimit",X),R("visibility","visibility"),O}function p(B,O){return B-(O-B)}function m(B,O,E){if(typeof B!="string")throw new TypeError("Invalid input: "+typeof B);const R={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},H=0,X=1,N=2,K=3;let Q=H,q=!0,G="",Y="";const Z=[];function ee(ae,ve,we){const me=new SyntaxError('Unexpected character "'+ae+'" at index '+ve+".");throw me.partial=we,me}function F(){G!==""&&(Y===""?Z.push(Number(G)):Z.push(Number(G)*Math.pow(10,Number(Y)))),G="",Y=""}let I;const $=B.length;for(let ae=0;ae<$;ae++){if(I=B[ae],Array.isArray(O)&&O.includes(Z.length%E)&&R.FLAGS.test(I)){Q=X,G=I,F();continue}if(Q===H){if(R.WHITESPACE.test(I))continue;if(R.DIGIT.test(I)||R.SIGN.test(I)){Q=X,G=I;continue}if(R.POINT.test(I)){Q=N,G=I;continue}R.COMMA.test(I)&&(q&&ee(I,ae,Z),q=!0)}if(Q===X){if(R.DIGIT.test(I)){G+=I;continue}if(R.POINT.test(I)){G+=I,Q=N;continue}if(R.EXP.test(I)){Q=K;continue}R.SIGN.test(I)&&G.length===1&&R.SIGN.test(G[0])&&ee(I,ae,Z)}if(Q===N){if(R.DIGIT.test(I)){G+=I;continue}if(R.EXP.test(I)){Q=K;continue}R.POINT.test(I)&&G[G.length-1]==="."&&ee(I,ae,Z)}if(Q===K){if(R.DIGIT.test(I)){Y+=I;continue}if(R.SIGN.test(I)){if(Y===""){Y+=I;continue}Y.length===1&&R.SIGN.test(Y)&&ee(I,ae,Z)}}R.WHITESPACE.test(I)?(F(),Q=H,q=!1):R.COMMA.test(I)?(F(),Q=H,q=!0):R.SIGN.test(I)?(F(),Q=X,G=I):R.POINT.test(I)?(F(),Q=N,G=I):ee(I,ae,Z)}return F(),Z}const x=["mm","cm","in","pt","pc","px"],b={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:72/6,pc:1,px:-1},px:{px:1}};function v(B){let O="px";if(typeof B=="string"||B instanceof String)for(let R=0,H=x.length;R<H;R++){const X=x[R];if(B.endsWith(X)){O=X,B=B.substring(0,B.length-X.length);break}}let E;return O==="px"&&t.defaultUnit!=="px"?E=b.in[t.defaultUnit]/t.defaultDPI:(E=b[O][t.defaultUnit],E<0&&(E=b[O].in*t.defaultDPI)),E*parseFloat(B)}function T(B){if(!(B.hasAttribute("transform")||B.nodeName==="use"&&(B.hasAttribute("x")||B.hasAttribute("y"))))return null;const O=g(B);return V.length>0&&O.premultiply(V[V.length-1]),re.copy(O),V.push(O),O}function g(B){const O=new Ze,E=z;if(B.nodeName==="use"&&(B.hasAttribute("x")||B.hasAttribute("y"))){const R=v(B.getAttribute("x")),H=v(B.getAttribute("y"));O.translate(R,H)}if(B.hasAttribute("transform")){const R=B.getAttribute("transform").split(")");for(let H=R.length-1;H>=0;H--){const X=R[H].trim();if(X==="")continue;const N=X.indexOf("("),K=X.length;if(N>0&&N<K){const Q=X.slice(0,N),q=m(X.slice(N+1));switch(E.identity(),Q){case"translate":if(q.length>=1){const G=q[0];let Y=0;q.length>=2&&(Y=q[1]),E.translate(G,Y)}break;case"rotate":if(q.length>=1){let G=0,Y=0,Z=0;G=q[0]*Math.PI/180,q.length>=3&&(Y=q[1],Z=q[2]),W.makeTranslation(-Y,-Z),_.makeRotation(G),U.multiplyMatrices(_,W),W.makeTranslation(Y,Z),E.multiplyMatrices(W,U)}break;case"scale":if(q.length>=1){const G=q[0];let Y=G;q.length>=2&&(Y=q[1]),E.scale(G,Y)}break;case"skewX":q.length===1&&E.set(1,Math.tan(q[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":q.length===1&&E.set(1,0,0,Math.tan(q[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":q.length===6&&E.set(q[0],q[2],q[4],q[1],q[3],q[5],0,0,1);break}}O.premultiply(E)}}return O}function w(B,O){function E(N){te.set(N.x,N.y,1).applyMatrix3(O),N.set(te.x,te.y)}function R(N){const K=N.xRadius,Q=N.yRadius,q=Math.cos(N.aRotation),G=Math.sin(N.aRotation),Y=new j(K*q,K*G,0),Z=new j(-Q*G,Q*q,0),ee=Y.applyMatrix3(O),F=Z.applyMatrix3(O),I=z.set(ee.x,F.x,0,ee.y,F.y,0,0,0,1),$=W.copy(I).invert(),we=_.copy($).transpose().multiply($).elements,me=L(we[0],we[1],we[4]),Ee=Math.sqrt(me.rt1),Re=Math.sqrt(me.rt2);if(N.xRadius=1/Ee,N.yRadius=1/Re,N.aRotation=Math.atan2(me.sn,me.cs),!((N.aEndAngle-N.aStartAngle)%(2*Math.PI)<Number.EPSILON)){const D=W.set(Ee,0,0,0,Re,0,0,0,1),ne=_.set(me.cs,me.sn,0,-me.sn,me.cs,0,0,0,1),he=D.multiply(ne).multiply(I),xe=Te=>{const{x:rt,y:Fe}=new j(Math.cos(Te),Math.sin(Te),0).applyMatrix3(he);return Math.atan2(Fe,rt)};N.aStartAngle=xe(N.aStartAngle),N.aEndAngle=xe(N.aEndAngle),S(O)&&(N.aClockwise=!N.aClockwise)}}function H(N){const K=P(O),Q=M(O);N.xRadius*=K,N.yRadius*=Q;const q=K>Number.EPSILON?Math.atan2(O.elements[1],O.elements[0]):Math.atan2(-O.elements[3],O.elements[4]);N.aRotation+=q,S(O)&&(N.aStartAngle*=-1,N.aEndAngle*=-1,N.aClockwise=!N.aClockwise)}const X=B.subPaths;for(let N=0,K=X.length;N<K;N++){const q=X[N].curves;for(let G=0;G<q.length;G++){const Y=q[G];Y.isLineCurve?(E(Y.v1),E(Y.v2)):Y.isCubicBezierCurve?(E(Y.v0),E(Y.v1),E(Y.v2),E(Y.v3)):Y.isQuadraticBezierCurve?(E(Y.v0),E(Y.v1),E(Y.v2)):Y.isEllipseCurve&&(J.set(Y.aX,Y.aY),E(J),Y.aX=J.x,Y.aY=J.y,A(O)?R(Y):H(Y))}}}function S(B){const O=B.elements;return O[0]*O[4]-O[1]*O[3]<0}function A(B){const O=B.elements,E=O[0]*O[3]+O[1]*O[4];if(E===0)return!1;const R=P(B),H=M(B);return Math.abs(E/(R*H))>Number.EPSILON}function P(B){const O=B.elements;return Math.sqrt(O[0]*O[0]+O[1]*O[1])}function M(B){const O=B.elements;return Math.sqrt(O[3]*O[3]+O[4]*O[4])}function L(B,O,E){let R,H,X,N,K;const Q=B+E,q=B-E,G=Math.sqrt(q*q+4*O*O);return Q>0?(R=.5*(Q+G),K=1/R,H=B*K*E-O*K*O):Q<0?H=.5*(Q-G):(R=.5*G,H=-.5*G),q>0?X=q+G:X=q-G,Math.abs(X)>2*Math.abs(O)?(K=-2*O/X,N=1/Math.sqrt(1+K*K),X=K*N):Math.abs(O)===0?(X=1,N=0):(K=-.5*X/O,X=1/Math.sqrt(1+K*K),N=K*X),q>0&&(K=X,X=-N,N=K),{rt1:R,rt2:H,cs:X,sn:N}}const C=[],k={},V=[],z=new Ze,W=new Ze,_=new Ze,U=new Ze,J=new se,te=new j,re=new Ze,oe=new DOMParser().parseFromString(e,"image/svg+xml");return s(oe.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:C,xml:oe.documentElement}}static createShapes(e){const s={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},i={loc:s.ORIGIN,t:0};function n(p,m,x,b){const v=p.x,T=m.x,g=x.x,w=b.x,S=p.y,A=m.y,P=x.y,M=b.y,L=(w-g)*(S-P)-(M-P)*(v-g),C=(T-v)*(S-P)-(A-S)*(v-g),k=(M-P)*(T-v)-(w-g)*(A-S),V=L/k,z=C/k;if(k===0&&L!==0||V<=0||V>=1||z<0||z>1)return null;if(L===0&&k===0){for(let W=0;W<2;W++)if(r(W===0?x:b,p,m),i.loc==s.ORIGIN){const _=W===0?x:b;return{x:_.x,y:_.y,t:i.t}}else if(i.loc==s.BETWEEN){const _=+(v+i.t*(T-v)).toPrecision(10),U=+(S+i.t*(A-S)).toPrecision(10);return{x:_,y:U,t:i.t}}return null}else{for(let U=0;U<2;U++)if(r(U===0?x:b,p,m),i.loc==s.ORIGIN){const J=U===0?x:b;return{x:J.x,y:J.y,t:i.t}}const W=+(v+V*(T-v)).toPrecision(10),_=+(S+V*(A-S)).toPrecision(10);return{x:W,y:_,t:V}}}function r(p,m,x){const b=x.x-m.x,v=x.y-m.y,T=p.x-m.x,g=p.y-m.y,w=b*g-T*v;if(p.x===m.x&&p.y===m.y){i.loc=s.ORIGIN,i.t=0;return}if(p.x===x.x&&p.y===x.y){i.loc=s.DESTINATION,i.t=1;return}if(w<-Number.EPSILON){i.loc=s.LEFT;return}if(w>Number.EPSILON){i.loc=s.RIGHT;return}if(b*T<0||v*g<0){i.loc=s.BEHIND;return}if(Math.sqrt(b*b+v*v)<Math.sqrt(T*T+g*g)){i.loc=s.BEYOND;return}let S;b!==0?S=T/b:S=g/v,i.loc=s.BETWEEN,i.t=S}function a(p,m){const x=[],b=[];for(let v=1;v<p.length;v++){const T=p[v-1],g=p[v];for(let w=1;w<m.length;w++){const S=m[w-1],A=m[w],P=n(T,g,S,A);P!==null&&x.find(M=>M.t<=P.t+Number.EPSILON&&M.t>=P.t-Number.EPSILON)===void 0&&(x.push(P),b.push(new se(P.x,P.y)))}}return b}function o(p,m,x){const b=new se;m.getCenter(b);const v=[];return x.forEach(T=>{T.boundingBox.containsPoint(b)&&a(p,T.points).forEach(w=>{v.push({identifier:T.identifier,isCW:T.isCW,point:w})})}),v.sort((T,g)=>T.point.x-g.point.x),v}function u(p,m,x,b,v){(v==null||v==="")&&(v="nonzero");const T=new se;p.boundingBox.getCenter(T);const g=[new se(x,T.y),new se(b,T.y)],w=o(g,p.boundingBox,m);w.sort((C,k)=>C.point.x-k.point.x);const S=[],A=[];w.forEach(C=>{C.identifier===p.identifier?S.push(C):A.push(C)});const P=S[0].point.x,M=[];let L=0;for(;L<A.length&&A[L].point.x<P;)M.length>0&&M[M.length-1]===A[L].identifier?M.pop():M.push(A[L].identifier),L++;if(M.push(p.identifier),v==="evenodd"){const C=M.length%2===0,k=M[M.length-2];return{identifier:p.identifier,isHole:C,for:k}}else if(v==="nonzero"){let C=!0,k=null,V=null;for(let z=0;z<M.length;z++){const W=M[z];C?(V=m[W].isCW,C=!1,k=W):V!==m[W].isCW&&(V=m[W].isCW,C=!0)}return{identifier:p.identifier,isHole:C,for:k}}else console.warn('fill-rule: "'+v+'" is currently not implemented.')}let c=999999999,h=-999999999,f=e.subPaths.map(p=>{const m=p.getPoints();let x=-999999999,b=999999999,v=-999999999,T=999999999;for(let g=0;g<m.length;g++){const w=m[g];w.y>x&&(x=w.y),w.y<b&&(b=w.y),w.x>v&&(v=w.x),w.x<T&&(T=w.x)}return h<=v&&(h=v+1),c>=T&&(c=T-1),{curves:p.curves,points:m,isCW:Ai.isClockWise(m),identifier:-1,boundingBox:new bi(new se(T,b),new se(v,x))}});f=f.filter(p=>p.points.length>1);for(let p=0;p<f.length;p++)f[p].identifier=p;const l=f.map(p=>u(p,f,c,h,e.userData?e.userData.style.fillRule:void 0)),d=[];return f.forEach(p=>{if(!l[p.identifier].isHole){const x=new Ti;x.curves=p.curves,l.filter(v=>v.isHole&&v.for===p.identifier).forEach(v=>{const T=f[v.identifier],g=new $t;g.curves=T.curves,x.holes.push(g)}),d.push(x)}}),d}static getStrokeStyle(e,t,s,i,n){return e=e!==void 0?e:1,t=t!==void 0?t:"#000",s=s!==void 0?s:"miter",i=i!==void 0?i:"butt",n=n!==void 0?n:4,{strokeColor:t,strokeWidth:e,strokeLineJoin:s,strokeLineCap:i,strokeMiterLimit:n}}static pointsToStroke(e,t,s,i){const n=[],r=[],a=[];if(Tt.pointsToStrokeWithBuffers(e,t,s,i,n,r,a)===0)return null;const o=new _e;return o.setAttribute("position",new Ce(n,3)),o.setAttribute("normal",new Ce(r,3)),o.setAttribute("uv",new Ce(a,2)),o}static pointsToStrokeWithBuffers(e,t,s,i,n,r,a,o){const u=new se,c=new se,h=new se,f=new se,l=new se,d=new se,p=new se,m=new se,x=new se,b=new se,v=new se,T=new se,g=new se,w=new se,S=new se,A=new se,P=new se;s=s!==void 0?s:12,i=i!==void 0?i:.001,o=o!==void 0?o:0,e=q(e);const M=e.length;if(M<2)return 0;const L=e[0].equals(e[M-1]);let C,k=e[0],V;const z=t.strokeWidth/2,W=1/(M-1);let _=0,U,J,te,re,oe=!1,ue=0,B=o*3,O=o*2;E(e[0],e[1],u).multiplyScalar(z),m.copy(e[0]).sub(u),x.copy(e[0]).add(u),b.copy(m),v.copy(x);for(let G=1;G<M;G++){C=e[G],G===M-1?L?V=e[1]:V=void 0:V=e[G+1];const Y=u;if(E(k,C,Y),h.copy(Y).multiplyScalar(z),T.copy(C).sub(h),g.copy(C).add(h),U=_+W,J=!1,V!==void 0){E(C,V,c),h.copy(c).multiplyScalar(z),w.copy(C).sub(h),S.copy(C).add(h),te=!0,h.subVectors(V,k),Y.dot(h)<0&&(te=!1),G===1&&(oe=te),h.subVectors(V,C),h.normalize();const Z=Math.abs(Y.dot(h));if(Z>Number.EPSILON){const ee=z/Z;h.multiplyScalar(-ee),f.subVectors(C,k),l.copy(f).setLength(ee).add(h),A.copy(l).negate();const F=l.length(),I=f.length();f.divideScalar(I),d.subVectors(V,C);const $=d.length();switch(d.divideScalar($),f.dot(A)<I&&d.dot(A)<$&&(J=!0),P.copy(l).add(C),A.add(C),re=!1,J?te?(S.copy(A),g.copy(A)):(w.copy(A),T.copy(A)):X(),t.strokeLineJoin){case"bevel":N(te,J,U);break;case"round":K(te,J),te?H(C,T,w,U,0):H(C,S,g,U,1);break;case"miter":case"miter-clip":default:const ae=z*t.strokeMiterLimit/F;if(ae<1)if(t.strokeLineJoin!=="miter-clip"){N(te,J,U);break}else K(te,J),te?(d.subVectors(P,T).multiplyScalar(ae).add(T),p.subVectors(P,w).multiplyScalar(ae).add(w),R(T,U,0),R(d,U,0),R(C,U,.5),R(C,U,.5),R(d,U,0),R(p,U,0),R(C,U,.5),R(p,U,0),R(w,U,0)):(d.subVectors(P,g).multiplyScalar(ae).add(g),p.subVectors(P,S).multiplyScalar(ae).add(S),R(g,U,1),R(d,U,1),R(C,U,.5),R(C,U,.5),R(d,U,1),R(p,U,1),R(C,U,.5),R(p,U,1),R(S,U,1));else J?(te?(R(x,_,1),R(m,_,0),R(P,U,0),R(x,_,1),R(P,U,0),R(A,U,1)):(R(x,_,1),R(m,_,0),R(P,U,1),R(m,_,0),R(A,U,0),R(P,U,1)),te?w.copy(P):S.copy(P)):te?(R(T,U,0),R(P,U,0),R(C,U,.5),R(C,U,.5),R(P,U,0),R(w,U,0)):(R(g,U,1),R(P,U,1),R(C,U,.5),R(C,U,.5),R(P,U,1),R(S,U,1)),re=!0;break}}else X()}else X();!L&&G===M-1&&Q(e[0],b,v,te,!0,_),_=U,k=C,m.copy(w),x.copy(S)}if(!L)Q(C,T,g,te,!1,U);else if(J&&n){let G=P,Y=A;oe!==te&&(G=A,Y=P),te?(re||oe)&&(Y.toArray(n,0*3),Y.toArray(n,3*3),re&&G.toArray(n,1*3)):(re||!oe)&&(Y.toArray(n,1*3),Y.toArray(n,3*3),re&&G.toArray(n,0*3))}return ue;function E(G,Y,Z){return Z.subVectors(Y,G),Z.set(-Z.y,Z.x).normalize()}function R(G,Y,Z){n&&(n[B]=G.x,n[B+1]=G.y,n[B+2]=0,r&&(r[B]=0,r[B+1]=0,r[B+2]=1),B+=3,a&&(a[O]=Y,a[O+1]=Z,O+=2)),ue+=3}function H(G,Y,Z,ee,F){u.copy(Y).sub(G).normalize(),c.copy(Z).sub(G).normalize();let I=Math.PI;const $=u.dot(c);Math.abs($)<1&&(I=Math.abs(Math.acos($))),I/=s,h.copy(Y);for(let ae=0,ve=s-1;ae<ve;ae++)f.copy(h).rotateAround(G,I),R(h,ee,F),R(f,ee,F),R(G,ee,.5),h.copy(f);R(f,ee,F),R(Z,ee,F),R(G,ee,.5)}function X(){R(x,_,1),R(m,_,0),R(T,U,0),R(x,_,1),R(T,U,1),R(g,U,0)}function N(G,Y,Z){Y?G?(R(x,_,1),R(m,_,0),R(T,U,0),R(x,_,1),R(T,U,0),R(A,U,1),R(T,Z,0),R(w,Z,0),R(A,Z,.5)):(R(x,_,1),R(m,_,0),R(g,U,1),R(m,_,0),R(A,U,0),R(g,U,1),R(g,Z,1),R(S,Z,0),R(A,Z,.5)):G?(R(T,Z,0),R(w,Z,0),R(C,Z,.5)):(R(g,Z,1),R(S,Z,0),R(C,Z,.5))}function K(G,Y){Y&&(G?(R(x,_,1),R(m,_,0),R(T,U,0),R(x,_,1),R(T,U,0),R(A,U,1),R(T,_,0),R(C,U,.5),R(A,U,1),R(C,U,.5),R(w,_,0),R(A,U,1)):(R(x,_,1),R(m,_,0),R(g,U,1),R(m,_,0),R(A,U,0),R(g,U,1),R(g,_,1),R(A,U,0),R(C,U,.5),R(C,U,.5),R(A,U,0),R(S,_,1)))}function Q(G,Y,Z,ee,F,I){switch(t.strokeLineCap){case"round":F?H(G,Z,Y,I,.5):H(G,Y,Z,I,.5);break;case"square":if(F)u.subVectors(Y,G),c.set(u.y,-u.x),h.addVectors(u,c).add(G),f.subVectors(c,u).add(G),ee?(h.toArray(n,1*3),f.toArray(n,0*3),f.toArray(n,3*3)):(h.toArray(n,1*3),h.toArray(n,3*3),f.toArray(n,0*3));else{u.subVectors(Z,G),c.set(u.y,-u.x),h.addVectors(u,c).add(G),f.subVectors(c,u).add(G);const $=n.length;ee?(h.toArray(n,$-1*3),f.toArray(n,$-2*3),f.toArray(n,$-4*3)):(h.toArray(n,$-2*3),f.toArray(n,$-1*3),f.toArray(n,$-4*3))}break}}function q(G){let Y=!1;for(let ee=1,F=G.length-1;ee<F;ee++)if(G[ee].distanceTo(G[ee+1])<i){Y=!0;break}if(!Y)return G;const Z=[];Z.push(G[0]);for(let ee=1,F=G.length-1;ee<F;ee++)G[ee].distanceTo(G[ee+1])>=i&&Z.push(G[ee]);return Z.push(G[G.length-1]),Z}}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class To{constructor(e,t){this.cache=e,this.textureAnisotropy=t}get fileLoader(){return this._fileLoader||(this._fileLoader=new Ct),this._fileLoader}get imageLoader(){return this._imgLoader||(this._imgLoader=new Si),this._imgLoader}get svgLoader(){return this._svgLoader||(this._svgLoader=new Tt),this._svgLoader}get textureLoader(){return this._textureLoader||(this._textureLoader=new Wt),this._textureLoader}get objectLoader(){return this._objectLoader||(this._objectLoader=new Mi),this._objectLoader}get gltfLoader(){return this._gltfLoader||(this._gltfLoader=new Hs),this._gltfLoader}get fbxLoader(){return this._fbxLoader||(this._fbxLoader=new Ir),this._fbxLoader}async preload(e,t){return this.cache.add(e,t),new Promise(s=>{const i=/\.fbx$|\.glb$|\.gltf$/.test(t);/\.jpe?g$|\.png$/.test(t)?this.textureLoader.load(t,r=>s(r)):(i?this.fileLoader.setResponseType("arraybuffer"):this.fileLoader.setResponseType("undefined"),this.fileLoader.load(t,r=>s(r)))})}async textureAtlas(e,t,s="JSONHash"){let i=JSON.parse(await this.file(t));if(i.textures){const a=i.textures[0].frames;let o={frames:{}};a.forEach(u=>{o={...o,frames:{...o.frames,[u.filename]:{frame:u.frame,rotated:u.rotated,sourceSize:u.sourceSize,spriteSourceSize:u.spriteSourceSize,trimmed:u.trimmed}}}}),i=o}return{texture:await this.texture(e),json:i}}file(e){const t=this.cache.get(e);return e=t||e,new Promise(s=>{this.fileLoader.load(e,i=>s(i))})}svg(e){const t=this.cache.get(e);return e=t||e,new Promise(s=>{this.svgLoader.load(e,i=>s(i))})}texture(e){if(!/^data:image\/[\S]+;base64,/gm.test(e)){const s=this.cache.get(e);e=s||e}return new Promise(s=>{this.textureLoader.load(e,i=>{i.anisotropy=this.textureAnisotropy,i.needsUpdate=!0,s(i)})})}object(e){const t=this.cache.get(e);return e=t||e,new Promise(s=>{this.objectLoader.load(e,i=>{s(i)})})}gltf(e){const t=this.cache.get(e);return e=t||e,new Promise(s=>{this.gltfLoader.load(e,i=>{s(i)})})}fbx(e){const t=this.cache.get(e);return e=t||e,new Promise(s=>{this.fbxLoader.load(e,i=>{s(i)})})}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class So extends et{constructor(e,t,s,i){super(),this.scene=e,this.light=t,this.size=s,this.color=i,this.geo=new zt(s||.2,16,8),this.mat=new Ne({color:i||t.color}),this.mesh=new be(this.geo,this.mat),this.add(this.mesh),t.add(this)}dispose(){this.mesh.geometry.dispose(),Array.isArray(this.mesh.material)?this.mesh.material.forEach(e=>e.dispose()):this.mesh.material.dispose(),this.remove(this.mesh)}update(){}}class Mo{constructor(e){this.scene=e}get helper(){return{directionalLightHelper:(e,t,s)=>{const i=new Pi(e,t,s);return this.scene.add(i),i},spotLightHelper:(e,t)=>{const s=new Ei(e,t);return this.scene.add(s),s},pointLightHelper:(e,t,s)=>new So(this.scene,e,t,s)}}directionalLight(e={}){const{color:t=16777215,intensity:s=1}=e,i=new Pn(t,s);return i.castShadow=!0,this.scene.add(i),i}hemisphereLight(e={}){const{skyColor:t=16777215,groundColor:s=16777215,intensity:i=1}=e,n=new Ci(t,s,i);return this.scene.add(n),n}ambientLight(e={}){const{color:t=16777215,intensity:s=1}=e,i=new ls(t,s);return this.scene.add(i),i}pointLight(e={}){const{color:t=16777215,intensity:s=1,distance:i=0,decay:n=1}=e,r=new Ht(t,s,i,n);return r.castShadow=!0,this.scene.add(r),r}spotLight(e={}){const{color:t=16777215,intensity:s=1,distance:i=0,angle:n=Math.PI/8,penumbra:r=0,decay:a=1}=e,o=new Mn(t,s,i,n,r,a);return o.castShadow=!0,this.scene.add(o),o}rectAreaLight(e={}){const{color:t=16777215,intensity:s=1,width:i=10,height:n=10}=e,r=new Ri(t,s,i,n);return this.scene.add(r),r}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2022 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Po{constructor(e){this.scene=e}add(e,t={}){const s=this.make(e,t);return s?this.scene.add(s):console.warn("Could not make heightmap"),s}make(e,t={}){const{image:s}=e,{width:i,height:n}=s,{colorScale:r,heightScale:a=100,colorSpace:o=""}=t,u=document.createElement("canvas");u.width=i,u.height=n;const c=u.getContext("2d");if(!c)return;c.drawImage(e.image,0,0);const h=c.getImageData(0,0,i,n),f=new xt(10,10,i-1,n-1);let l={color:13421772,side:Sn};r&&(l={...l,vertexColors:!0});const d=new gt(l),p=new ws(f,d);p.receiveShadow=p.castShadow=!0,p.shape="concave";const m=f.attributes.position.array;for(let x=0;x<m.length;x++){const b=h.data[x*4]/a;m[x*3+2]=b}if(r){const x=f.attributes.position.count;f.setAttribute("color",new He(new Float32Array(x*3),3));const b=new fe,v=f.attributes.position,T=f.attributes.color;let g,w;for(let S=0;S<x;S++)g=v.getZ(S),w=r(g).hsl(),b.setHSL(w[0]/360,w[1],w[2],o),T.setXYZ(S,b.r,b.g,b.b)}return p.rotateX(-Math.PI/2),p.updateMatrix(),f.computeVertexNormals(),p.name="heightmap",p}}const qn={type:"change"},un={type:"start"},Zn={type:"end"};class Eo extends Li{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new j,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:ot.ROTATE,MIDDLE:ot.DOLLY,RIGHT:ot.PAN},this.touches={ONE:at.ROTATE,TWO:at.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(D){D.addEventListener("keydown",$),this._domElementKeyEvents=D},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",$),this._domElementKeyEvents=null},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(qn),s.update(),n=i.NONE},this.update=function(){const D=new j,ne=new Me().setFromUnitVectors(e.up,new j(0,1,0)),he=ne.clone().invert(),xe=new j,Te=new Me,rt=new j,Fe=2*Math.PI;return function(){const Ln=s.object.position;D.copy(Ln).sub(s.target),D.applyQuaternion(ne),a.setFromVector3(D),s.autoRotate&&n===i.NONE&&P(S()),s.enableDamping?(a.theta+=o.theta*s.dampingFactor,a.phi+=o.phi*s.dampingFactor):(a.theta+=o.theta,a.phi+=o.phi);let Ge=s.minAzimuthAngle,We=s.maxAzimuthAngle;return isFinite(Ge)&&isFinite(We)&&(Ge<-Math.PI?Ge+=Fe:Ge>Math.PI&&(Ge-=Fe),We<-Math.PI?We+=Fe:We>Math.PI&&(We-=Fe),Ge<=We?a.theta=Math.max(Ge,Math.min(We,a.theta)):a.theta=a.theta>(Ge+We)/2?Math.max(Ge,a.theta):Math.min(We,a.theta)),a.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=u,a.radius=Math.max(s.minDistance,Math.min(s.maxDistance,a.radius)),s.enableDamping===!0?s.target.addScaledVector(c,s.dampingFactor):s.target.add(c),D.setFromSpherical(a),D.applyQuaternion(he),Ln.copy(s.target).add(D),s.object.lookAt(s.target),s.enableDamping===!0?(o.theta*=1-s.dampingFactor,o.phi*=1-s.dampingFactor,c.multiplyScalar(1-s.dampingFactor)):(o.set(0,0,0),c.set(0,0,0)),u=1,h||xe.distanceToSquared(s.object.position)>r||8*(1-Te.dot(s.object.quaternion))>r||rt.distanceToSquared(s.target)>0?(s.dispatchEvent(qn),xe.copy(s.object.position),Te.copy(s.object.quaternion),rt.copy(s.target),h=!1,!0):!1}}(),this.dispose=function(){s.domElement.removeEventListener("contextmenu",we),s.domElement.removeEventListener("pointerdown",G),s.domElement.removeEventListener("pointercancel",Z),s.domElement.removeEventListener("wheel",I),s.domElement.removeEventListener("pointermove",Y),s.domElement.removeEventListener("pointerup",Z),s._domElementKeyEvents!==null&&(s._domElementKeyEvents.removeEventListener("keydown",$),s._domElementKeyEvents=null)};const s=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let n=i.NONE;const r=1e-6,a=new On,o=new On;let u=1;const c=new j;let h=!1;const f=new se,l=new se,d=new se,p=new se,m=new se,x=new se,b=new se,v=new se,T=new se,g=[],w={};function S(){return 2*Math.PI/60/60*s.autoRotateSpeed}function A(){return Math.pow(.95,s.zoomSpeed)}function P(D){o.theta-=D}function M(D){o.phi-=D}const L=function(){const D=new j;return function(he,xe){D.setFromMatrixColumn(xe,0),D.multiplyScalar(-he),c.add(D)}}(),C=function(){const D=new j;return function(he,xe){s.screenSpacePanning===!0?D.setFromMatrixColumn(xe,1):(D.setFromMatrixColumn(xe,0),D.crossVectors(s.object.up,D)),D.multiplyScalar(he),c.add(D)}}(),k=function(){const D=new j;return function(he,xe){const Te=s.domElement;if(s.object.isPerspectiveCamera){const rt=s.object.position;D.copy(rt).sub(s.target);let Fe=D.length();Fe*=Math.tan(s.object.fov/2*Math.PI/180),L(2*he*Fe/Te.clientHeight,s.object.matrix),C(2*xe*Fe/Te.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(L(he*(s.object.right-s.object.left)/s.object.zoom/Te.clientWidth,s.object.matrix),C(xe*(s.object.top-s.object.bottom)/s.object.zoom/Te.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function V(D){s.object.isPerspectiveCamera?u/=D:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*D)),s.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function z(D){s.object.isPerspectiveCamera?u*=D:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/D)),s.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function W(D){f.set(D.clientX,D.clientY)}function _(D){b.set(D.clientX,D.clientY)}function U(D){p.set(D.clientX,D.clientY)}function J(D){l.set(D.clientX,D.clientY),d.subVectors(l,f).multiplyScalar(s.rotateSpeed);const ne=s.domElement;P(2*Math.PI*d.x/ne.clientHeight),M(2*Math.PI*d.y/ne.clientHeight),f.copy(l),s.update()}function te(D){v.set(D.clientX,D.clientY),T.subVectors(v,b),T.y>0?V(A()):T.y<0&&z(A()),b.copy(v),s.update()}function re(D){m.set(D.clientX,D.clientY),x.subVectors(m,p).multiplyScalar(s.panSpeed),k(x.x,x.y),p.copy(m),s.update()}function oe(D){D.deltaY<0?z(A()):D.deltaY>0&&V(A()),s.update()}function ue(D){let ne=!1;switch(D.code){case s.keys.UP:D.ctrlKey||D.metaKey||D.shiftKey?M(2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):k(0,s.keyPanSpeed),ne=!0;break;case s.keys.BOTTOM:D.ctrlKey||D.metaKey||D.shiftKey?M(-2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):k(0,-s.keyPanSpeed),ne=!0;break;case s.keys.LEFT:D.ctrlKey||D.metaKey||D.shiftKey?P(2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):k(s.keyPanSpeed,0),ne=!0;break;case s.keys.RIGHT:D.ctrlKey||D.metaKey||D.shiftKey?P(-2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):k(-s.keyPanSpeed,0),ne=!0;break}ne&&(D.preventDefault(),s.update())}function B(){if(g.length===1)f.set(g[0].pageX,g[0].pageY);else{const D=.5*(g[0].pageX+g[1].pageX),ne=.5*(g[0].pageY+g[1].pageY);f.set(D,ne)}}function O(){if(g.length===1)p.set(g[0].pageX,g[0].pageY);else{const D=.5*(g[0].pageX+g[1].pageX),ne=.5*(g[0].pageY+g[1].pageY);p.set(D,ne)}}function E(){const D=g[0].pageX-g[1].pageX,ne=g[0].pageY-g[1].pageY,he=Math.sqrt(D*D+ne*ne);b.set(0,he)}function R(){s.enableZoom&&E(),s.enablePan&&O()}function H(){s.enableZoom&&E(),s.enableRotate&&B()}function X(D){if(g.length==1)l.set(D.pageX,D.pageY);else{const he=Ye(D),xe=.5*(D.pageX+he.x),Te=.5*(D.pageY+he.y);l.set(xe,Te)}d.subVectors(l,f).multiplyScalar(s.rotateSpeed);const ne=s.domElement;P(2*Math.PI*d.x/ne.clientHeight),M(2*Math.PI*d.y/ne.clientHeight),f.copy(l)}function N(D){if(g.length===1)m.set(D.pageX,D.pageY);else{const ne=Ye(D),he=.5*(D.pageX+ne.x),xe=.5*(D.pageY+ne.y);m.set(he,xe)}x.subVectors(m,p).multiplyScalar(s.panSpeed),k(x.x,x.y),p.copy(m)}function K(D){const ne=Ye(D),he=D.pageX-ne.x,xe=D.pageY-ne.y,Te=Math.sqrt(he*he+xe*xe);v.set(0,Te),T.set(0,Math.pow(v.y/b.y,s.zoomSpeed)),V(T.y),b.copy(v)}function Q(D){s.enableZoom&&K(D),s.enablePan&&N(D)}function q(D){s.enableZoom&&K(D),s.enableRotate&&X(D)}function G(D){s.enabled!==!1&&(g.length===0&&(s.domElement.setPointerCapture(D.pointerId),s.domElement.addEventListener("pointermove",Y),s.domElement.addEventListener("pointerup",Z)),me(D),D.pointerType==="touch"?ae(D):ee(D))}function Y(D){s.enabled!==!1&&(D.pointerType==="touch"?ve(D):F(D))}function Z(D){Ee(D),g.length===0&&(s.domElement.releasePointerCapture(D.pointerId),s.domElement.removeEventListener("pointermove",Y),s.domElement.removeEventListener("pointerup",Z)),s.dispatchEvent(Zn),n=i.NONE}function ee(D){let ne;switch(D.button){case 0:ne=s.mouseButtons.LEFT;break;case 1:ne=s.mouseButtons.MIDDLE;break;case 2:ne=s.mouseButtons.RIGHT;break;default:ne=-1}switch(ne){case ot.DOLLY:if(s.enableZoom===!1)return;_(D),n=i.DOLLY;break;case ot.ROTATE:if(D.ctrlKey||D.metaKey||D.shiftKey){if(s.enablePan===!1)return;U(D),n=i.PAN}else{if(s.enableRotate===!1)return;W(D),n=i.ROTATE}break;case ot.PAN:if(D.ctrlKey||D.metaKey||D.shiftKey){if(s.enableRotate===!1)return;W(D),n=i.ROTATE}else{if(s.enablePan===!1)return;U(D),n=i.PAN}break;default:n=i.NONE}n!==i.NONE&&s.dispatchEvent(un)}function F(D){switch(n){case i.ROTATE:if(s.enableRotate===!1)return;J(D);break;case i.DOLLY:if(s.enableZoom===!1)return;te(D);break;case i.PAN:if(s.enablePan===!1)return;re(D);break}}function I(D){s.enabled===!1||s.enableZoom===!1||n!==i.NONE||(D.preventDefault(),s.dispatchEvent(un),oe(D),s.dispatchEvent(Zn))}function $(D){s.enabled===!1||s.enablePan===!1||ue(D)}function ae(D){switch(Re(D),g.length){case 1:switch(s.touches.ONE){case at.ROTATE:if(s.enableRotate===!1)return;B(),n=i.TOUCH_ROTATE;break;case at.PAN:if(s.enablePan===!1)return;O(),n=i.TOUCH_PAN;break;default:n=i.NONE}break;case 2:switch(s.touches.TWO){case at.DOLLY_PAN:if(s.enableZoom===!1&&s.enablePan===!1)return;R(),n=i.TOUCH_DOLLY_PAN;break;case at.DOLLY_ROTATE:if(s.enableZoom===!1&&s.enableRotate===!1)return;H(),n=i.TOUCH_DOLLY_ROTATE;break;default:n=i.NONE}break;default:n=i.NONE}n!==i.NONE&&s.dispatchEvent(un)}function ve(D){switch(Re(D),n){case i.TOUCH_ROTATE:if(s.enableRotate===!1)return;X(D),s.update();break;case i.TOUCH_PAN:if(s.enablePan===!1)return;N(D),s.update();break;case i.TOUCH_DOLLY_PAN:if(s.enableZoom===!1&&s.enablePan===!1)return;Q(D),s.update();break;case i.TOUCH_DOLLY_ROTATE:if(s.enableZoom===!1&&s.enableRotate===!1)return;q(D),s.update();break;default:n=i.NONE}}function we(D){s.enabled!==!1&&D.preventDefault()}function me(D){g.push(D)}function Ee(D){delete w[D.pointerId];for(let ne=0;ne<g.length;ne++)if(g[ne].pointerId==D.pointerId){g.splice(ne,1);return}}function Re(D){let ne=w[D.pointerId];ne===void 0&&(ne=new se,w[D.pointerId]=ne),ne.set(D.pageX,D.pageY)}function Ye(D){const ne=D.pointerId===g[0].pointerId?g[1]:g[0];return w[ne.pointerId]}s.domElement.addEventListener("contextmenu",we),s.domElement.addEventListener("pointerdown",G),s.domElement.addEventListener("pointercancel",Z),s.domElement.addEventListener("wheel",I,{passive:!1}),this.update()}}class Co{constructor(e,t,s,i,n,r,a){this.scene=e,this.renderer=t,this.camera=s,this.lights=i,this.physics=n,this.load=r,this.factories=a}async warpSpeed(...e){let t={};const s=e.filter(o=>/^-\w+/.test(o)),i=s.length>0;if((e.length===0||i)&&(e=["light","camera","lookAtCenter","ground","grid","orbitControls","fog","sky"]),i&&s.map(u=>u.substr(1)).forEach(u=>{const c=e.indexOf(u);e.splice(c,1)}),e.includes("sky")){const o=["varying vec3 vWorldPosition;","","void main() {","","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","","}"].join(`
`),u=["uniform vec3 topColor;","uniform vec3 bottomColor;","uniform float offset;","uniform float exponent;","","varying vec3 vWorldPosition;","","void main() {","","float h = normalize( vWorldPosition + offset ).y;","gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h , 0.0), exponent ), 0.0 ) ), 1.0 );","","}"].join(`
`),c={topColor:{value:new fe(30719)},bottomColor:{value:new fe(15595007)},offset:{value:33},exponent:{value:.6}};var n=new zt(500,32,15),r=new jt({uniforms:c,vertexShader:o,fragmentShader:u,side:Ii}),a=new be(n,r);this.scene.add(a)}if(e.includes("camera")&&(this.camera.position.set(0,6,12),t={camera:this.camera,...t}),e.includes("light")){const u=this.lights.hemisphereLight({skyColor:16777215,groundColor:0,intensity:1}),c=this.lights.ambientLight({color:16777215,intensity:1}),h=this.lights.directionalLight({color:16777215,intensity:1});h.position.set(100,200,50);const f=20;h.shadow.camera.top=f,h.shadow.camera.bottom=-f,h.shadow.camera.left=-f,h.shadow.camera.right=f,h.shadow.mapSize.set(1024,1024),t={lights:{ambientLight:c,directionalLight:h,hemisphereLight:u},...t}}if(e.includes("lookAtCenter")&&this.camera.lookAt(this.scene.position),e.includes("ground")){const o=e.includes("grid"),u="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOnAAADusBZ+q87AAAAJtJREFUeJzt0EENwDAAxLDbNP6UOxh+NEYQ5dl2drFv286598GrA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAu37AD8eaBH5JQdVbAAAAAElFTkSuQmCC",c=await this.load.texture(u);c.wrapS=c.wrapT=Xe,c.repeat.set(21,21);const h={name:"ground",width:21,height:21,depth:1,y:-.5},f={phong:{map:o?c:null,color:16777215}};let l;window.__loadPhysics?(l=this.physics.add.ground(h,f),l.body.setRestitution(1)):l=this.factories.add.ground(h,f),l.receiveShadow=!0,t={ground:l,...t}}return e.includes("orbitControls")&&(t={orbitControls:new Eo(this.camera,document.getElementById("enable3d-phaser-canvas")||this.renderer.domElement),...t}),t}}class Ro{constructor(){this._mixers=[]}animationMixer(e){const t=new Jn(e);return this.mixers.add(t),t}get mixers(){return{create:e=>this.animationMixer(e),add:e=>this._mixers.push(e),get:()=>this._mixers,update:e=>{var t;return(t=this._mixers)==null?void 0:t.forEach(s=>s.update(e/1e3))}}}}class St extends be{constructor(e,t={}){super(e),this.isReflector=!0,this.type="Reflector",this.camera=new Pt;const s=this,i=t.color!==void 0?new fe(t.color):new fe(8355711),n=t.textureWidth||512,r=t.textureHeight||512,a=t.clipBias||0,o=t.shader||St.ReflectorShader,u=t.multisample!==void 0?t.multisample:4,c=new it,h=new j,f=new j,l=new j,d=new ie,p=new j(0,0,-1),m=new je,x=new j,b=new j,v=new je,T=new ie,g=this.camera,w=new ms(n,r,{samples:u,type:gs}),S=new jt({name:o.name!==void 0?o.name:"unspecified",uniforms:En.clone(o.uniforms),fragmentShader:o.fragmentShader,vertexShader:o.vertexShader});S.uniforms.tDiffuse.value=w.texture,S.uniforms.color.value=i,S.uniforms.textureMatrix.value=T,this.material=S,this.onBeforeRender=function(A,P,M){if(f.setFromMatrixPosition(s.matrixWorld),l.setFromMatrixPosition(M.matrixWorld),d.extractRotation(s.matrixWorld),h.set(0,0,1),h.applyMatrix4(d),x.subVectors(f,l),x.dot(h)>0)return;x.reflect(h).negate(),x.add(f),d.extractRotation(M.matrixWorld),p.set(0,0,-1),p.applyMatrix4(d),p.add(l),b.subVectors(f,p),b.reflect(h).negate(),b.add(f),g.position.copy(x),g.up.set(0,1,0),g.up.applyMatrix4(d),g.up.reflect(h),g.lookAt(b),g.far=M.far,g.updateMatrixWorld(),g.projectionMatrix.copy(M.projectionMatrix),T.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),T.multiply(g.projectionMatrix),T.multiply(g.matrixWorldInverse),T.multiply(s.matrixWorld),c.setFromNormalAndCoplanarPoint(h,f),c.applyMatrix4(g.matrixWorldInverse),m.set(c.normal.x,c.normal.y,c.normal.z,c.constant);const L=g.projectionMatrix;v.x=(Math.sign(m.x)+L.elements[8])/L.elements[0],v.y=(Math.sign(m.y)+L.elements[9])/L.elements[5],v.z=-1,v.w=(1+L.elements[10])/L.elements[14],m.multiplyScalar(2/m.dot(v)),L.elements[2]=m.x,L.elements[6]=m.y,L.elements[10]=m.z+1-a,L.elements[14]=m.w,s.visible=!1;const C=A.getRenderTarget(),k=A.xr.enabled,V=A.shadowMap.autoUpdate,z=A.outputColorSpace,W=A.toneMapping;A.xr.enabled=!1,A.shadowMap.autoUpdate=!1,A.outputColorSpace=ys,A.toneMapping=xs,A.setRenderTarget(w),A.state.buffers.depth.setMask(!0),A.autoClear===!1&&A.clear(),A.render(P,g),A.xr.enabled=k,A.shadowMap.autoUpdate=V,A.outputColorSpace=z,A.toneMapping=W,A.setRenderTarget(C);const _=M.viewport;_!==void 0&&A.state.viewport(_),s.visible=!0},this.getRenderTarget=function(){return w},this.dispose=function(){w.dispose(),s.material.dispose()}}}St.ReflectorShader={name:"ReflectorShader",uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		#include <common>
		#include <logdepthbuf_pars_vertex>

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			#include <logdepthbuf_vertex>

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		varying vec4 vUv;

		#include <logdepthbuf_pars_fragment>

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			#include <logdepthbuf_fragment>

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>

		}`};class Mt extends be{constructor(e,t={}){super(e),this.isRefractor=!0,this.type="Refractor",this.camera=new Pt;const s=this,i=t.color!==void 0?new fe(t.color):new fe(8355711),n=t.textureWidth||512,r=t.textureHeight||512,a=t.clipBias||0,o=t.shader||Mt.RefractorShader,u=t.multisample!==void 0?t.multisample:4,c=this.camera;c.matrixAutoUpdate=!1,c.userData.refractor=!0;const h=new it,f=new ie,l=new ms(n,r,{samples:u,type:gs});this.material=new jt({uniforms:En.clone(o.uniforms),vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,transparent:!0}),this.material.uniforms.color.value=i,this.material.uniforms.tDiffuse.value=l.texture,this.material.uniforms.textureMatrix.value=f;const d=function(){const v=new j,T=new j,g=new ie,w=new j,S=new j;return function(P){return v.setFromMatrixPosition(s.matrixWorld),T.setFromMatrixPosition(P.matrixWorld),w.subVectors(v,T),g.extractRotation(s.matrixWorld),S.set(0,0,1),S.applyMatrix4(g),w.dot(S)<0}}(),p=function(){const v=new j,T=new j,g=new Me,w=new j;return function(){s.matrixWorld.decompose(T,g,w),v.set(0,0,1).applyQuaternion(g).normalize(),v.negate(),h.setFromNormalAndCoplanarPoint(v,T)}}(),m=function(){const v=new it,T=new je,g=new je;return function(S){c.matrixWorld.copy(S.matrixWorld),c.matrixWorldInverse.copy(c.matrixWorld).invert(),c.projectionMatrix.copy(S.projectionMatrix),c.far=S.far,v.copy(h),v.applyMatrix4(c.matrixWorldInverse),T.set(v.normal.x,v.normal.y,v.normal.z,v.constant);const A=c.projectionMatrix;g.x=(Math.sign(T.x)+A.elements[8])/A.elements[0],g.y=(Math.sign(T.y)+A.elements[9])/A.elements[5],g.z=-1,g.w=(1+A.elements[10])/A.elements[14],T.multiplyScalar(2/T.dot(g)),A.elements[2]=T.x,A.elements[6]=T.y,A.elements[10]=T.z+1-a,A.elements[14]=T.w}}();function x(v){f.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),f.multiply(v.projectionMatrix),f.multiply(v.matrixWorldInverse),f.multiply(s.matrixWorld)}function b(v,T,g){s.visible=!1;const w=v.getRenderTarget(),S=v.xr.enabled,A=v.shadowMap.autoUpdate,P=v.outputColorSpace,M=v.toneMapping;v.xr.enabled=!1,v.shadowMap.autoUpdate=!1,v.outputColorSpace=ys,v.toneMapping=xs,v.setRenderTarget(l),v.autoClear===!1&&v.clear(),v.render(T,c),v.xr.enabled=S,v.shadowMap.autoUpdate=A,v.outputColorSpace=P,v.toneMapping=M,v.setRenderTarget(w);const L=g.viewport;L!==void 0&&v.state.viewport(L),s.visible=!0}this.onBeforeRender=function(v,T,g){g.userData.refractor!==!0&&d(g)&&(p(),x(g),m(g),b(v,T,g))},this.getRenderTarget=function(){return l},this.dispose=function(){l.dispose(),s.material.dispose()}}}Mt.RefractorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`

		uniform mat4 textureMatrix;

		varying vec4 vUv;

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform vec3 color;
		uniform sampler2D tDiffuse;

		varying vec4 vUv;

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>

		}`};class qt extends be{constructor(e,t={}){super(e),this.isWater=!0,this.type="Water";const s=this,i=t.color!==void 0?new fe(t.color):new fe(16777215),n=t.textureWidth||512,r=t.textureHeight||512,a=t.clipBias||0,o=t.flowDirection||new se(1,0),u=t.flowSpeed||.03,c=t.reflectivity||.02,h=t.scale||1,f=t.shader||qt.WaterShader,l=new Wt,d=t.flowMap||void 0,p=t.normalMap0||l.load("textures/water/Water_1_M_Normal.jpg"),m=t.normalMap1||l.load("textures/water/Water_2_M_Normal.jpg"),x=.15,b=x*.5,v=new ie,T=new ki;if(St===void 0){console.error("THREE.Water: Required component Reflector not found.");return}if(Mt===void 0){console.error("THREE.Water: Required component Refractor not found.");return}const g=new St(e,{textureWidth:n,textureHeight:r,clipBias:a}),w=new Mt(e,{textureWidth:n,textureHeight:r,clipBias:a});g.matrixAutoUpdate=!1,w.matrixAutoUpdate=!1,this.material=new jt({uniforms:En.merge([Oi.fog,f.uniforms]),vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,transparent:!0,fog:!0}),d!==void 0?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:d}):this.material.uniforms.flowDirection={type:"v2",value:o},p.wrapS=p.wrapT=Xe,m.wrapS=m.wrapT=Xe,this.material.uniforms.tReflectionMap.value=g.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=w.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=p,this.material.uniforms.tNormalMap1.value=m,this.material.uniforms.color.value=i,this.material.uniforms.reflectivity.value=c,this.material.uniforms.textureMatrix.value=v,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=b,this.material.uniforms.config.value.z=b,this.material.uniforms.config.value.w=h;function S(P){v.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),v.multiply(P.projectionMatrix),v.multiply(P.matrixWorldInverse),v.multiply(s.matrixWorld)}function A(){const P=T.getDelta(),M=s.material.uniforms.config;M.value.x+=u*P,M.value.y=M.value.x+b,M.value.x>=x?(M.value.x=0,M.value.y=b):M.value.y>=x&&(M.value.y=M.value.y-x)}this.onBeforeRender=function(P,M,L){S(L),A(),s.visible=!1,g.matrixWorld.copy(s.matrixWorld),w.matrixWorld.copy(s.matrixWorld),g.onBeforeRender(P,M,L),w.onBeforeRender(P,M,L),s.visible=!0}}}qt.WaterShader={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new je}},vertexShader:`

		#include <common>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>

		uniform mat4 textureMatrix;

		varying vec4 vCoord;
		varying vec2 vUv;
		varying vec3 vToEye;

		void main() {

			vUv = uv;
			vCoord = textureMatrix * vec4( position, 1.0 );

			vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
			vToEye = cameraPosition - worldPosition.xyz;

			vec4 mvPosition =  viewMatrix * worldPosition; // used in fog_vertex
			gl_Position = projectionMatrix * mvPosition;

			#include <logdepthbuf_vertex>
			#include <fog_vertex>

		}`,fragmentShader:`

		#include <common>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>

		uniform sampler2D tReflectionMap;
		uniform sampler2D tRefractionMap;
		uniform sampler2D tNormalMap0;
		uniform sampler2D tNormalMap1;

		#ifdef USE_FLOWMAP
			uniform sampler2D tFlowMap;
		#else
			uniform vec2 flowDirection;
		#endif

		uniform vec3 color;
		uniform float reflectivity;
		uniform vec4 config;

		varying vec4 vCoord;
		varying vec2 vUv;
		varying vec3 vToEye;

		void main() {

			#include <logdepthbuf_fragment>

			float flowMapOffset0 = config.x;
			float flowMapOffset1 = config.y;
			float halfCycle = config.z;
			float scale = config.w;

			vec3 toEye = normalize( vToEye );

			// determine flow direction
			vec2 flow;
			#ifdef USE_FLOWMAP
				flow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;
			#else
				flow = flowDirection;
			#endif
			flow.x *= - 1.0;

			// sample normal maps (distort uvs with flowdata)
			vec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );
			vec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );

			// linear interpolate to get the final normal color
			float flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;
			vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );

			// calculate normal vector
			vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );

			// calculate the fresnel term to blend reflection and refraction maps
			float theta = max( dot( toEye, normal ), 0.0 );
			float reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );

			// calculate final uv coords
			vec3 coord = vCoord.xyz / vCoord.w;
			vec2 uv = coord.xy + coord.z * normal.xz * 0.05;

			vec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );
			vec4 refractColor = texture2D( tRefractionMap, uv );

			// multiply water color with the mix of both textures
			gl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>

		}`};const Lo=(y,e,t={})=>{const{width:s=20,height:i=20,x:n=0,y:r=0,z:a=0,color:o="#ffffff",scale:u=4,flowX:c=1,flowY:h=1,normalMap0:f=void 0,normalMap1:l=void 0}=t,d=new xt(s,i),p=new Gt({color:30654,transparent:!0,opacity:.8}),m=new be(d,p);m.position.set(n,r,a),m.rotation.x=Math.PI*-.5,y.add(m);const x=new xt(s,i),b=new qt(x,{color:o,scale:u,flowDirection:new se(c,h),textureWidth:1024,textureHeight:1024,normalMap0:f,normalMap1:l,encoding:e.outputEncoding});return b.position.set(n,r+.1,a),b.rotation.x=Math.PI*-.5,y.add(b),{ground:m,water:b}};class Io{constructor(e,t,s){this.scene=e,this.renderer=t,this.factories=s}water(e={}){Lo(this.scene,this.renderer,e)}textureCube(e){e.length!==6&&Ae("You need to pass 6 urls to textureCube()");const t=new Oo;return e.forEach((s,i)=>{s.wrapS=s.wrapT=Xe;const n=this.factories.add.material({phong:{map:s}});t.materials[i]=n}),t}}class Oo{constructor(){this.materials=new Array(6)}get texture(){return{left:this.getTexture(0),right:this.getTexture(1),up:this.getTexture(2),down:this.getTexture(3),front:this.getTexture(4),back:this.getTexture(5)}}getTexture(e){return this.materials[e].map}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class ko{constructor(e,t){this.camera=e,this.renderer=t,this.tmpVector2=new se}fromSVGtoShape(e){if(e){const t=new Tt,s=[];return t.parse(e).paths.forEach(i=>{Tt.createShapes(i).forEach(n=>{s.push(n)})}),s}return[]}from3dto2d(e){const t=new j(e.x,e.y,e.z),s=this.renderer.domElement;this.camera.updateMatrixWorld(),t.project(this.camera);const i=Math.round((t.x+1)*(s.width/2)),n=Math.round((-t.y+1)*(s.height/2));return new se(i,n)}from2dto3d(e,t,s){var a;if(!this.tmpPlane){const o=new xt(1e4,1e4),u=new Ne({transparent:!0,opacity:.25});this.tmpPlane=new be(o,u),this.tmpPlane.name="_tmp_raycast_plane"}this.tmpRaycaster||(this.tmpRaycaster=new vs),this.tmpVector3||(this.tmpVector3=new j);let i;this.tmpPlane.setRotationFromEuler(this.camera.rotation);const n=this.camera.position;this.tmpPlane.position.set(n.x,n.y,n.z),this.camera.getWorldDirection(this.tmpVector3),this.tmpPlane.position.add(this.tmpVector3.clone().multiplyScalar(s)),this.tmpPlane.updateMatrix(),this.tmpPlane.updateMatrixWorld(!0),this.tmpVector2.set(e,t),this.tmpRaycaster.setFromCamera(this.tmpVector2,this.camera);const r=this.tmpRaycaster.intersectObjects([this.tmpPlane]);return((a=r[0])==null?void 0:a.object.name)==="_tmp_raycast_plane"&&(i=r[0].point),i}}class ht{static createButton(e){const t=document.createElement("button");function s(){let o=null;async function u(h){h.addEventListener("end",c),await e.xr.setSession(h),t.textContent="EXIT VR",o=h}function c(){o.removeEventListener("end",c),t.textContent="ENTER VR",o=null}t.style.display="",t.style.cursor="pointer",t.style.left="calc(50% - 50px)",t.style.width="100px",t.textContent="ENTER VR",t.onmouseenter=function(){t.style.opacity="1.0"},t.onmouseleave=function(){t.style.opacity="0.5"},t.onclick=function(){if(o===null){const h={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]};navigator.xr.requestSession("immersive-vr",h).then(u)}else o.end()}}function i(){t.style.display="",t.style.cursor="auto",t.style.left="calc(50% - 75px)",t.style.width="150px",t.onmouseenter=null,t.onmouseleave=null,t.onclick=null}function n(){i(),t.textContent="VR NOT SUPPORTED"}function r(o){i(),console.warn("Exception when trying to call xr.isSessionSupported",o),t.textContent="VR NOT ALLOWED"}function a(o){o.style.position="absolute",o.style.bottom="20px",o.style.padding="12px 6px",o.style.border="1px solid #fff",o.style.borderRadius="4px",o.style.background="rgba(0,0,0,0.1)",o.style.color="#fff",o.style.font="normal 13px sans-serif",o.style.textAlign="center",o.style.opacity="0.5",o.style.outline="none",o.style.zIndex="999"}if("xr"in navigator)return t.id="VRButton",t.style.display="none",a(t),navigator.xr.isSessionSupported("immersive-vr").then(function(o){o?s():n(),o&&ht.xrSessionIsGranted&&t.click()}).catch(r),t;{const o=document.createElement("a");return window.isSecureContext===!1?(o.href=document.location.href.replace(/^http:/,"https:"),o.innerHTML="WEBXR NEEDS HTTPS"):(o.href="https://immersiveweb.dev/",o.innerHTML="WEBXR NOT AVAILABLE"),o.style.left="calc(50% - 90px)",o.style.width="180px",o.style.textDecoration="none",a(o),o}}static registerSessionGrantedListener(){if("xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",()=>{ht.xrSessionIsGranted=!0})}}}ht.xrSessionIsGranted=!1;ht.registerSessionGrantedListener();const ge={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function zs(y){const e=await fetch(y);if(e.ok)return e.json();throw new Error(e.statusText)}async function Do(y){if(!y)throw new Error("No basePath supplied");return await zs(`${y}/profilesList.json`)}async function Fo(y,e,t=null,s=!0){if(!y)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const i=await Do(e);let n;if(y.profiles.some(o=>{const u=i[o];return u&&(n={profileId:o,profilePath:`${e}/${u.path}`,deprecated:!!u.deprecated}),!!n}),!n){if(!t)throw new Error("No matching profile name found");const o=i[t];if(!o)throw new Error(`No matching profile name found and default profile "${t}" missing.`);n={profileId:t,profilePath:`${e}/${o.path}`,deprecated:!!o.deprecated}}const r=await zs(n.profilePath);let a;if(s){let o;if(y.handedness==="any"?o=r.layouts[Object.keys(r.layouts)[0]]:o=r.layouts[y.handedness],!o)throw new Error(`No matching handedness, ${y.handedness}, in profile ${n.profileId}`);o.assetPath&&(a=n.profilePath.replace("profile.json",o.assetPath))}return{profile:r,assetPath:a}}const Bo={xAxis:0,yAxis:0,button:0,state:ge.ComponentState.DEFAULT};function Vo(y=0,e=0){let t=y,s=e;if(Math.sqrt(y*y+e*e)>1){const r=Math.atan2(e,y);t=Math.cos(r),s=Math.sin(r)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:s*.5+.5}}class No{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===ge.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(Bo)}updateFromComponent({xAxis:e,yAxis:t,button:s,state:i}){const{normalizedXAxis:n,normalizedYAxis:r}=Vo(e,t);switch(this.componentProperty){case ge.ComponentProperty.X_AXIS:this.value=this.states.includes(i)?n:.5;break;case ge.ComponentProperty.Y_AXIS:this.value=this.states.includes(i)?r:.5;break;case ge.ComponentProperty.BUTTON:this.value=this.states.includes(i)?s:0;break;case ge.ComponentProperty.STATE:this.valueNodeProperty===ge.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(i):this.value=this.states.includes(i)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class Ho{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(s=>{const i=new No(t.visualResponses[s]);this.visualResponses[s]=i}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:ge.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=ge.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=ge.ComponentState.PRESSED:(t.touched||this.values.button>ge.ButtonTouchThreshold)&&(this.values.state=ge.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===ge.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>ge.AxisTouchThreshold&&(this.values.state=ge.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===ge.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>ge.AxisTouchThreshold&&(this.values.state=ge.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}}class Uo{constructor(e,t,s){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=s,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(i=>{const n=this.layoutDescription.components[i];this.components[i]=new Ho(i,n)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}const _o="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",zo="generic-trigger";class Go extends et{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(t=>{t.isMesh&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(s=>{const{valueNode:i,minNode:n,maxNode:r,value:a,valueNodeProperty:o}=s;i&&(o===ge.VisualResponseProperty.VISIBILITY?i.visible=a:o===ge.VisualResponseProperty.TRANSFORM&&(i.quaternion.slerpQuaternions(n.quaternion,r.quaternion,a),i.position.lerpVectors(n.position,r.position,a)))})}))}}function Wo(y,e){Object.values(y.components).forEach(t=>{const{type:s,touchPointNodeName:i,visualResponses:n}=t;if(s===ge.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(i),t.touchPointNode){const r=new zt(.001),a=new Ne({color:255}),o=new be(r,a);t.touchPointNode.add(o)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(n).forEach(r=>{const{valueNodeName:a,minNodeName:o,maxNodeName:u,valueNodeProperty:c}=r;if(c===ge.VisualResponseProperty.TRANSFORM){if(r.minNode=e.getObjectByName(o),r.maxNode=e.getObjectByName(u),!r.minNode){console.warn(`Could not find ${o} in the model`);return}if(!r.maxNode){console.warn(`Could not find ${u} in the model`);return}}r.valueNode=e.getObjectByName(a),r.valueNode||console.warn(`Could not find ${a} in the model`)})})}function $n(y,e){Wo(y.motionController,e),y.envMap&&e.traverse(t=>{t.isMesh&&(t.material.envMap=y.envMap,t.material.needsUpdate=!0)}),y.add(e)}class jo{constructor(e=null){this.gltfLoader=e,this.path=_o,this._assetCache={},this.gltfLoader||(this.gltfLoader=new Hs)}createControllerModel(e){const t=new Go;let s=null;return e.addEventListener("connected",i=>{const n=i.data;n.targetRayMode!=="tracked-pointer"||!n.gamepad||Fo(n,this.path,zo).then(({profile:r,assetPath:a})=>{t.motionController=new Uo(n,r,a);const o=this._assetCache[t.motionController.assetUrl];if(o)s=o.scene.clone(),$n(t,s);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,u=>{this._assetCache[t.motionController.assetUrl]=u,s=u.scene.clone(),$n(t,s)},null,()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)})}}).catch(r=>{console.warn(r)})}),e.addEventListener("disconnected",()=>{t.motionController=null,t.remove(s),s=null}),t}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Xo{constructor(e,t){this._renderer=e,this._scene=t,this.controllerModelFactory=new jo;const s=new Ui;s.name="dot",this.cameraGroup=new ct,this.cameraGroup.add(s),t.add(this.cameraGroup),e.xr.enabled=!0;const i=ht.createButton(e);i.style.cssText+="background: rgba(0, 0, 0, 0.8); ",document.body.appendChild(i),this._renderer.xr.getCamera().add(this.cameraGroup)}get isPresenting(){var e,t;return!!((t=(e=this._renderer)==null?void 0:e.xr)!=null&&t.isPresenting)}getController(e){const t=this._renderer.xr.getController(e);return this.cameraGroup.add(t),t}getControllerGrip(e){const t=this._renderer.xr.getControllerGrip(e),s=this.controllerModelFactory.createControllerModel(t);return t.add(s),this.cameraGroup.add(t),t}getControllerRay(e){const{targetRayMode:t}=e;if(t==="tracked-pointer"){const s=new _e;s.setAttribute("position",new Ce([0,0,0,0,0,-1],3)),s.setAttribute("color",new Ce([1,0,0,1,1,1],3));const i=new Et({vertexColors:!0});return new _t(s,i)}if(t==="gaze"){const s=new Di(.02,.04,32).translate(0,0,-1),i=new Ne({color:"red",opacity:.5,transparent:!0});return new be(s,i)}}get camera(){return this.WebXRCamera}get WebXRCamera(){var e;return{group:this.cameraGroup,position:(e=this._renderer.xr.getCamera())==null?void 0:e.position,rotation:this.isPresenting?this._renderer.xr.getCamera().rotation:void 0,getWorldDirection:t=>this.isPresenting?this._renderer.xr.getCamera().getWorldDirection(t):void 0}}}const Ko=(y=20,e)=>{if(!window.__loadPhysics){console.log("There is not much fun without physics enabled!");return}for(let t=0;t<y;t++){const s=["standard","basic","normal","phong","line","points"],i=(r,a)=>Math.floor(Math.random()*(a-r+1)+r),n=r=>r[Math.floor(Math.random()*r.length)];Math.random()>.5?e.add.box({x:i(-10,10),y:i(10,20),z:i(-10,10),width:i(1,2)/10,height:i(1,2)/10,depth:i(1,2)/10,mass:1},{[n(s)]:{color:Math.floor(Math.random()*16777215)}}).body.setRestitution(Math.floor(Math.random()*10)/20):e.add.sphere({x:i(-10,10),y:i(10,20),z:i(-10,10),radius:i(1,2)/10,mass:1},{[n(s)]:{color:Math.floor(Math.random()*16777215)}}).body.setRestitution(Math.floor(Math.random()*10)/20)}};class hn{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y,this.array[this.top++]=e.z}}class Yo{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y}}class Be{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}clone(){const e=new Be;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(t=>t.clone()),e}invert(){for(let t=0;t<this.polygons.length;t++)this.polygons[t].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let t=new Array,s=new Array;for(let i=0;i<e.length;i++)this.plane.splitPolygon(e[i],t,s,t,s);return this.front&&(t=this.front.clipPolygons(t)),this.back?s=this.back.clipPolygons(s):s=[],t.concat(s)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());const t=[],s=[];for(let i=0;i<e.length;i++)this.plane.splitPolygon(e[i],this.polygons,this.polygons,t,s);t.length&&(this.front||(this.front=new Be),this.front.build(t)),s.length&&(this.back||(this.back=new Be),this.back.build(s))}}class Pe{constructor(e=0,t=0,s=0){this.x=e,this.y=t,this.z=s}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new Pe(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}times(e){return this.x*=e,this.y*=e,this.z*=e,this}dividedBy(e){return this.x/=e,this.y/=e,this.z/=e,this}lerp(e,t){return this.add(new Pe().copy(e).sub(this).times(t))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(e){const t=this.clone(),s=t.x,i=t.y,n=t.z,r=e.x,a=e.y,o=e.z;return this.x=i*o-n*a,this.y=n*r-s*o,this.z=s*a-i*r,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}toVector3(){return new j(this.x,this.y,this.z)}}class st{constructor(e,t){this.normal=e,this.w=t,this.normal=e,this.w=t}clone(){return new st(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(e,t,s,i,n){let c=0;const h=[];for(let f=0;f<e.vertices.length;f++){const l=this.normal.dot(e.vertices[f].pos)-this.w,d=l<-st.EPSILON?2:l>st.EPSILON?1:0;c|=d,h.push(d)}switch(c){case 0:(this.normal.dot(e.plane.normal)>0?t:s).push(e);break;case 1:i.push(e);break;case 2:n.push(e);break;case 3:{const f=[],l=[];for(let d=0;d<e.vertices.length;d++){const p=(d+1)%e.vertices.length,m=h[d],x=h[p],b=e.vertices[d],v=e.vertices[p];if(m!=2&&f.push(b),m!=1&&l.push(m!=2?b.clone():b),(m|x)==3){const T=(this.w-this.normal.dot(b.pos))/this.normal.dot(new Pe().copy(v.pos).sub(b.pos)),g=b.interpolate(v,T);f.push(g),l.push(g.clone())}}f.length>=3&&i.push(new ft(f,e.shared)),l.length>=3&&n.push(new ft(l,e.shared));break}}}static fromPoints(e,t,s){const i=new Pe().copy(t).sub(e).cross(new Pe().copy(s).sub(e)).normalize();return new st(i.clone(),i.dot(e))}}st.EPSILON=1e-5;class ft{constructor(e,t){this.vertices=e,this.shared=t,this.plane=st.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){return new ft(this.vertices.map(e=>e.clone()),this.shared)}flip(){this.vertices.reverse().map(e=>e.flip()),this.plane.flip()}}class Ut{constructor(e,t,s,i){this.pos=new Pe().copy(e),this.normal=new Pe().copy(t),this.uv=new Pe().copy(s),this.uv.z=0,i&&(this.color=new Pe().copy(i))}clone(){return new Ut(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(e,t){return new Ut(this.pos.clone().lerp(e.pos,t),this.normal.clone().lerp(e.normal,t),this.uv.clone().lerp(e.uv,t),this.color&&e.color&&this.color.clone().lerp(e.color,t))}}class pe{constructor(){this.polygons=[]}static fromPolygons(e){const t=new pe;return t.polygons=e,t}static fromGeometry(e,t){let s=[];const i=e.attributes.position,n=e.attributes.normal,r=e.attributes.uv,a=e.attributes.color,o=e.groups;let u;if(e.index)u=e.index.array;else{u=new Uint16Array(i.array.length/i.itemSize|0);for(let h=0;h<u.length;h++)u[h]=h}const c=u.length/3|0;s=new Array(c);for(let h=0,f=0,l=u.length;h<l;h+=3,f++){const d=new Array(3);for(let p=0;p<3;p++){const m=u[h+p],x=m*3,b=m*2,v=i.array[x],T=i.array[x+1],g=i.array[x+2],w=n.array[x],S=n.array[x+1],A=n.array[x+2],P=r==null?void 0:r.array[b],M=r==null?void 0:r.array[b+1];d[p]=new Ut(new Pe(v,T,g),new Pe(w,S,A),new Pe(P,M,0),a&&new Pe(a.array[x],a.array[x+1],a.array[x+2]))}if(t===void 0&&o&&o.length>0)for(const p of o)h>=p.start&&h<p.start+p.count&&(s[f]=new ft(d,p.materialIndex));else s[f]=new ft(d,t)}return pe.fromPolygons(s.filter(h=>!Number.isNaN(h.plane.normal.x)))}static toGeometry(e,t){let s=0;const i=e.polygons;for(const l of i)s+=l.vertices.length-2;const n=new _e,r=new hn(s*3*3),a=new hn(s*3*3),o=new Yo(s*2*3);let u;const c=[],h=[];for(const l of i){const d=l.vertices,p=d.length;l.shared!==void 0&&(c[l.shared]||(c[l.shared]=[])),p&&d[0].color!==void 0&&(u||(u=new hn(s*3*3)));for(let m=3;m<=p;m++)(l.shared===void 0?h:c[l.shared]).push(r.top/3,r.top/3+1,r.top/3+2),r.write(d[0].pos),r.write(d[m-2].pos),r.write(d[m-1].pos),a.write(d[0].normal),a.write(d[m-2].normal),a.write(d[m-1].normal),o&&(o.write(d[0].uv),o.write(d[m-2].uv),o.write(d[m-1].uv)),u&&(u.write(d[0].color),u.write(d[m-2].color),u.write(d[m-1].color))}n.setAttribute("position",new He(r.array,3)),n.setAttribute("normal",new He(a.array,3)),o&&n.setAttribute("uv",new He(o.array,2)),u&&n.setAttribute("color",new He(u.array,3));for(let l=0;l<c.length;l++)c[l]===void 0&&(c[l]=[]);if(c.length){let l=[],d=0;for(let p=0;p<c.length;p++)n.addGroup(d,c[p].length,p),d+=c[p].length,l=l.concat(c[p]);n.addGroup(d,h.length,c.length),l=l.concat(h),n.setIndex(l)}const f=new ie().copy(t).invert();return n.applyMatrix4(f),n.computeBoundingSphere(),n.computeBoundingBox(),n}static fromMesh(e,t){const s=pe.fromGeometry(e.geometry,t),i=new j,n=new Ze;n.getNormalMatrix(e.matrix);for(let r=0;r<s.polygons.length;r++){const a=s.polygons[r];for(let o=0;o<a.vertices.length;o++){const u=a.vertices[o];u.pos.copy(i.copy(u.pos.toVector3()).applyMatrix4(e.matrix)),u.normal.copy(i.copy(u.normal.toVector3()).applyMatrix3(n))}}return s}static toMesh(e,t,s){const i=pe.toGeometry(e,t),n=new be(i,s);return n.matrix.copy(t),n.matrix.decompose(n.position,n.quaternion,n.scale),n.rotation.setFromQuaternion(n.quaternion),n.updateMatrixWorld(),n.castShadow=n.receiveShadow=!0,n}static union(e,t){const s=pe.fromMesh(e),i=pe.fromMesh(t);return pe.toMesh(s.union(i),e.matrix,e.material)}static subtract(e,t){const s=pe.fromMesh(e),i=pe.fromMesh(t);return pe.toMesh(s.subtract(i),e.matrix,e.material)}static intersect(e,t){const s=pe.fromMesh(e),i=pe.fromMesh(t);return pe.toMesh(s.intersect(i),e.matrix,e.material)}clone(){const e=new pe;return e.polygons=this.polygons.map(t=>t.clone()).filter(t=>Number.isFinite(t.plane.w)),e}toPolygons(){return this.polygons}union(e){const t=new Be(this.clone().polygons),s=new Be(e.clone().polygons);return t.clipTo(s),s.clipTo(t),s.invert(),s.clipTo(t),s.invert(),t.build(s.allPolygons()),pe.fromPolygons(t.allPolygons())}subtract(e){const t=new Be(this.clone().polygons),s=new Be(e.clone().polygons);return t.invert(),t.clipTo(s),s.clipTo(t),s.invert(),s.clipTo(t),s.invert(),t.build(s.allPolygons()),t.invert(),pe.fromPolygons(t.allPolygons())}intersect(e){const t=new Be(this.clone().polygons),s=new Be(e.clone().polygons);return t.invert(),s.clipTo(t),s.invert(),t.clipTo(s),s.clipTo(t),t.build(s.allPolygons()),t.invert(),pe.fromPolygons(t.allPolygons())}inverse(){const e=this.clone();for(const t of e.polygons)t.flip();return e}toMesh(e,t){return pe.toMesh(this,e,t)}toGeometry(e){return pe.toGeometry(this,e)}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2022 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Qo{static union(e,t){return this.doCSG(e,t,"union")}static subtract(e,t){return this.doCSG(e,t,"subtract")}static intersect(e,t){return this.doCSG(e,t,"intersect")}static doCSG(e,t,s){if(e.updateMatrix(),t.updateMatrix(),s==="union")return pe.union(e,t);if(s==="subtract")return pe.subtract(e,t);if(s==="intersect")return pe.intersect(e,t)}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class qo extends or{constructor(e,t={}){var u;const s=document.getElementById("enable3d-three-canvas");let i={};s&&(i={canvas:s}),t.renderer=new rs({...i,antialias:t.antialias||!1}),super(t),(u=e.sys.game.canvas.parentElement)==null||u.insertBefore(t.renderer.domElement,e.sys.game.canvas),e.sys.game.canvas.style.position="relative";const n=()=>{var d,p;if(!t.renderer)return;const{width:c,height:h,marginLeft:f,marginTop:l}=e.sys.game.canvas.style;t.renderer.domElement.id="enable3d-three-canvas",(d=this.camera)!=null&&d.aspect&&(this.camera.aspect=e.sys.game.scale.baseSize.width/e.sys.game.scale.baseSize.height),(p=this.camera)==null||p.updateProjectionMatrix(),t.renderer.setSize(e.sys.game.scale.baseSize.width,e.sys.game.scale.baseSize.height),t.renderer.domElement.style.width=c,t.renderer.domElement.style.height=h,t.renderer.domElement.style.marginLeft=f,t.renderer.domElement.style.marginTop=l};n(),e.scale.on("resize",()=>{n()});const r=document.createElement("style");r.innerText=`
      #enable3d-phaser-canvas:focus,
      #enable3d-three-canvas:focus {
        outline: none;
      }

      #enable3d-three-canvas {
        position: absolute;
      }
    `,document.head.appendChild(r);const{enableXR:a=!1}=t;if(this.isXrEnabled=a,this.scene3D=e,a&&(this.webXR=new Xo(this.renderer,this.scene)),this.isXrEnabled){let c=0;this.renderer.setAnimationLoop(h=>{if(this.renderer.xr.isPresenting){const f=h-c;c=h,e.updateLoopXR(h,f),this.renderer.state.reset(),this.preRender(),this.composer?this.composer.render():this.renderer.render(this.scene,this.camera),this.postRender()}})}const o=e.add.extern();o.render=c=>{this.renderer.xr.isPresenting||(this.preRender(),this.composer?this.composer.render():this.renderer.render(this.scene,this.camera),this.postRender())},e.events.on("postupdate",(c,h)=>{var f,l,d;(f=this.animationMixers)==null||f.update(h),(l=this.physics)==null||l.update(h),(d=this.physics)==null||d.updateDebugger()}),this.load=new To(this.cache,this.textureAnisotropy),this.lights=new Mo(this.scene),this.transform=new ko(this.camera,this.renderer),this.csg=Qo,this.heightMap=new Po(this.scene),this.factories=new Ts(this.scene),this.misc=new Io(this.scene,this.renderer,this.factories),this.cameras=new At,this.ws=new Co(this.scene,this.renderer,this.camera,this.lights,this.physics,this.load,this.factories),this.mixers=new Ro,e.events.once("shutdown",()=>{e.clearThirdDimension(),e.events.removeListener("update")})}preRender(){}postRender(){}destroy(e){var t;(t=this.physics)==null||t.destroy(e.body),this.scene.remove(e),e=null}async warpSpeed(...e){return await this.ws.warpSpeed(...e)}haveSomeFun(e=20){Ko(e,this.physics)}get animationMixers(){var e;return(e=this.mixers)==null?void 0:e.mixers}get make(){return this.factories.make}get add(){return this.factories.add}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Zo extends Gs.Scene{constructor(e){super(e)}async warpSpeed(...e){return await this.third.warpSpeed(...e)}haveSomeFun(e=20){this.third.haveSomeFun(e)}requestThirdDimension(){Ae("You do not need requestThirdDimension() anymore. Place accessThirdDimension() inside init() instead!")}clearThirdDimension(){for(const e in this.third)delete this.third[e];delete this.third}accessThirdDimension(e={}){this.clearThirdDimension(),this.third=new qo(this,e),this.cameras.main.transparent=!0,this.cameras.main.setBackgroundColor("rgba(0,0,0,0)"),this.third.scene.background=new fe("white")}updateLoopXR(e,t){this.preUpdateXR(e,t),this.updateXR(e,t),this.postUpdateXR(e,t)}preUpdateXR(e,t){}updateXR(e,t){}postUpdateXR(e,t){this.third.isXrEnabled&&(this.time.update(e,t),this.third.physics.update(t),this.third.physics.updateDebugger(),this.third.animationMixers.update(t))}}window.__loadPhysics=!1;window.__ammoPath="";const $o=y=>(window.setTimeout(()=>{window.__loadPhysics?nr(window.__ammoPath,()=>{Ammo().then(()=>{y()})}):y()},50),{withPhysics(e){window.__loadPhysics=!0,window.__ammoPath=e}});/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */const Jo=()=>{try{const y=document.createElement("canvas");return!!(window.WebGL2RenderingContext&&y.getContext("webgl2"))}catch{return!1}},ea=(y={})=>{const{antialias:e=!0,parent:t=void 0,canvasId:s="enable3d-phaser-canvas"}=y,i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");i.id=s;const n=t?document.getElementById(t):document.body;n?n.appendChild(i):Ae(`Parent "${t}" not found!`);const r={antialias:e},a=r.alpha!==void 0?r.alpha:!0,o=r.depth!==void 0?r.depth:!0,u=r.stencil!==void 0?r.stencil:!0,c=r.antialias!==void 0?r.antialias:!1,h=r.premultipliedAlpha!==void 0?r.premultipliedAlpha:!0,f=r.preserveDrawingBuffer!==void 0?r.preserveDrawingBuffer:!1,l=r.powerPreference!==void 0?r.powerPreference:"default",d=r.failIfMajorPerformanceCaveat!==void 0?r.failIfMajorPerformanceCaveat:!1,m={...{alpha:a,depth:o,stencil:u,antialias:c,premultipliedAlpha:h,preserveDrawingBuffer:f,powerPreference:l,failIfMajorPerformanceCaveat:d,xrCompatible:!0}},x=Jo()?"webgl2":"webgl",b=i.getContext(x,m);return{canvas:i,context:b}};/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */document.createElement("canvas");new vs;new se;new se;new se;var ta={exports:{}};/*!
 * matter-js 0.20.0 by @liabru
 * http://brm.io/matter-js/
 * License MIT
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) Liam Brummitt and contributors.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */(function(y,e){(function(s,i){y.exports=i()})(pt,function(){return function(t){var s={};function i(n){if(s[n])return s[n].exports;var r=s[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=s,i.d=function(n,r,a){i.o(n,r)||Object.defineProperty(n,r,{enumerable:!0,get:a})},i.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},i.t=function(n,r){if(r&1&&(n=i(n)),r&8||r&4&&typeof n=="object"&&n&&n.__esModule)return n;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:n}),r&2&&typeof n!="string")for(var o in n)i.d(a,o,(function(u){return n[u]}).bind(null,o));return a},i.n=function(n){var r=n&&n.__esModule?function(){return n.default}:function(){return n};return i.d(r,"a",r),r},i.o=function(n,r){return Object.prototype.hasOwnProperty.call(n,r)},i.p="",i(i.s=20)}([function(t,s){var i={};t.exports=i,function(){i._baseDelta=1e3/60,i._nextId=0,i._seed=0,i._nowStartTime=+new Date,i._warnedOnce={},i._decomp=null,i.extend=function(r,a){var o,u;typeof a=="boolean"?(o=2,u=a):(o=1,u=!0);for(var c=o;c<arguments.length;c++){var h=arguments[c];if(h)for(var f in h)u&&h[f]&&h[f].constructor===Object&&(!r[f]||r[f].constructor===Object)?(r[f]=r[f]||{},i.extend(r[f],u,h[f])):r[f]=h[f]}return r},i.clone=function(r,a){return i.extend({},a,r)},i.keys=function(r){if(Object.keys)return Object.keys(r);var a=[];for(var o in r)a.push(o);return a},i.values=function(r){var a=[];if(Object.keys){for(var o=Object.keys(r),u=0;u<o.length;u++)a.push(r[o[u]]);return a}for(var c in r)a.push(r[c]);return a},i.get=function(r,a,o,u){a=a.split(".").slice(o,u);for(var c=0;c<a.length;c+=1)r=r[a[c]];return r},i.set=function(r,a,o,u,c){var h=a.split(".").slice(u,c);return i.get(r,a,0,-1)[h[h.length-1]]=o,o},i.shuffle=function(r){for(var a=r.length-1;a>0;a--){var o=Math.floor(i.random()*(a+1)),u=r[a];r[a]=r[o],r[o]=u}return r},i.choose=function(r){return r[Math.floor(i.random()*r.length)]},i.isElement=function(r){return typeof HTMLElement<"u"?r instanceof HTMLElement:!!(r&&r.nodeType&&r.nodeName)},i.isArray=function(r){return Object.prototype.toString.call(r)==="[object Array]"},i.isFunction=function(r){return typeof r=="function"},i.isPlainObject=function(r){return typeof r=="object"&&r.constructor===Object},i.isString=function(r){return toString.call(r)==="[object String]"},i.clamp=function(r,a,o){return r<a?a:r>o?o:r},i.sign=function(r){return r<0?-1:1},i.now=function(){if(typeof window<"u"&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-i._nowStartTime},i.random=function(r,a){return r=typeof r<"u"?r:0,a=typeof a<"u"?a:1,r+n()*(a-r)};var n=function(){return i._seed=(i._seed*9301+49297)%233280,i._seed/233280};i.colorToNumber=function(r){return r=r.replace("#",""),r.length==3&&(r=r.charAt(0)+r.charAt(0)+r.charAt(1)+r.charAt(1)+r.charAt(2)+r.charAt(2)),parseInt(r,16)},i.logLevel=1,i.log=function(){console&&i.logLevel>0&&i.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},i.info=function(){console&&i.logLevel>0&&i.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},i.warn=function(){console&&i.logLevel>0&&i.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},i.warnOnce=function(){var r=Array.prototype.slice.call(arguments).join(" ");i._warnedOnce[r]||(i.warn(r),i._warnedOnce[r]=!0)},i.deprecated=function(r,a,o){r[a]=i.chain(function(){i.warnOnce(" deprecated ",o)},r[a])},i.nextId=function(){return i._nextId++},i.indexOf=function(r,a){if(r.indexOf)return r.indexOf(a);for(var o=0;o<r.length;o++)if(r[o]===a)return o;return-1},i.map=function(r,a){if(r.map)return r.map(a);for(var o=[],u=0;u<r.length;u+=1)o.push(a(r[u]));return o},i.topologicalSort=function(r){var a=[],o=[],u=[];for(var c in r)!o[c]&&!u[c]&&i._topologicalSort(c,o,u,r,a);return a},i._topologicalSort=function(r,a,o,u,c){var h=u[r]||[];o[r]=!0;for(var f=0;f<h.length;f+=1){var l=h[f];o[l]||a[l]||i._topologicalSort(l,a,o,u,c)}o[r]=!1,a[r]=!0,c.push(r)},i.chain=function(){for(var r=[],a=0;a<arguments.length;a+=1){var o=arguments[a];o._chained?r.push.apply(r,o._chained):r.push(o)}var u=function(){for(var c,h=new Array(arguments.length),f=0,l=arguments.length;f<l;f++)h[f]=arguments[f];for(f=0;f<r.length;f+=1){var d=r[f].apply(c,h);typeof d<"u"&&(c=d)}return c};return u._chained=r,u},i.chainPathBefore=function(r,a,o){return i.set(r,a,i.chain(o,i.get(r,a)))},i.chainPathAfter=function(r,a,o){return i.set(r,a,i.chain(i.get(r,a),o))},i.setDecomp=function(r){i._decomp=r},i.getDecomp=function(){var r=i._decomp;try{!r&&typeof window<"u"&&(r=window.decomp),!r&&typeof pt<"u"&&(r=pt.decomp)}catch{r=null}return r}}()},function(t,s){var i={};t.exports=i,function(){i.create=function(n){var r={min:{x:0,y:0},max:{x:0,y:0}};return n&&i.update(r,n),r},i.update=function(n,r,a){n.min.x=1/0,n.max.x=-1/0,n.min.y=1/0,n.max.y=-1/0;for(var o=0;o<r.length;o++){var u=r[o];u.x>n.max.x&&(n.max.x=u.x),u.x<n.min.x&&(n.min.x=u.x),u.y>n.max.y&&(n.max.y=u.y),u.y<n.min.y&&(n.min.y=u.y)}a&&(a.x>0?n.max.x+=a.x:n.min.x+=a.x,a.y>0?n.max.y+=a.y:n.min.y+=a.y)},i.contains=function(n,r){return r.x>=n.min.x&&r.x<=n.max.x&&r.y>=n.min.y&&r.y<=n.max.y},i.overlaps=function(n,r){return n.min.x<=r.max.x&&n.max.x>=r.min.x&&n.max.y>=r.min.y&&n.min.y<=r.max.y},i.translate=function(n,r){n.min.x+=r.x,n.max.x+=r.x,n.min.y+=r.y,n.max.y+=r.y},i.shift=function(n,r){var a=n.max.x-n.min.x,o=n.max.y-n.min.y;n.min.x=r.x,n.max.x=r.x+a,n.min.y=r.y,n.max.y=r.y+o}}()},function(t,s){var i={};t.exports=i,function(){i.create=function(n,r){return{x:n||0,y:r||0}},i.clone=function(n){return{x:n.x,y:n.y}},i.magnitude=function(n){return Math.sqrt(n.x*n.x+n.y*n.y)},i.magnitudeSquared=function(n){return n.x*n.x+n.y*n.y},i.rotate=function(n,r,a){var o=Math.cos(r),u=Math.sin(r);a||(a={});var c=n.x*o-n.y*u;return a.y=n.x*u+n.y*o,a.x=c,a},i.rotateAbout=function(n,r,a,o){var u=Math.cos(r),c=Math.sin(r);o||(o={});var h=a.x+((n.x-a.x)*u-(n.y-a.y)*c);return o.y=a.y+((n.x-a.x)*c+(n.y-a.y)*u),o.x=h,o},i.normalise=function(n){var r=i.magnitude(n);return r===0?{x:0,y:0}:{x:n.x/r,y:n.y/r}},i.dot=function(n,r){return n.x*r.x+n.y*r.y},i.cross=function(n,r){return n.x*r.y-n.y*r.x},i.cross3=function(n,r,a){return(r.x-n.x)*(a.y-n.y)-(r.y-n.y)*(a.x-n.x)},i.add=function(n,r,a){return a||(a={}),a.x=n.x+r.x,a.y=n.y+r.y,a},i.sub=function(n,r,a){return a||(a={}),a.x=n.x-r.x,a.y=n.y-r.y,a},i.mult=function(n,r){return{x:n.x*r,y:n.y*r}},i.div=function(n,r){return{x:n.x/r,y:n.y/r}},i.perp=function(n,r){return r=r===!0?-1:1,{x:r*-n.y,y:r*n.x}},i.neg=function(n){return{x:-n.x,y:-n.y}},i.angle=function(n,r){return Math.atan2(r.y-n.y,r.x-n.x)},i._temp=[i.create(),i.create(),i.create(),i.create(),i.create(),i.create()]}()},function(t,s,i){var n={};t.exports=n;var r=i(2),a=i(0);(function(){n.create=function(o,u){for(var c=[],h=0;h<o.length;h++){var f=o[h],l={x:f.x,y:f.y,index:h,body:u,isInternal:!1};c.push(l)}return c},n.fromPath=function(o,u){var c=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/ig,h=[];return o.replace(c,function(f,l,d){h.push({x:parseFloat(l),y:parseFloat(d)})}),n.create(h,u)},n.centre=function(o){for(var u=n.area(o,!0),c={x:0,y:0},h,f,l,d=0;d<o.length;d++)l=(d+1)%o.length,h=r.cross(o[d],o[l]),f=r.mult(r.add(o[d],o[l]),h),c=r.add(c,f);return r.div(c,6*u)},n.mean=function(o){for(var u={x:0,y:0},c=0;c<o.length;c++)u.x+=o[c].x,u.y+=o[c].y;return r.div(u,o.length)},n.area=function(o,u){for(var c=0,h=o.length-1,f=0;f<o.length;f++)c+=(o[h].x-o[f].x)*(o[h].y+o[f].y),h=f;return u?c/2:Math.abs(c)/2},n.inertia=function(o,u){for(var c=0,h=0,f=o,l,d,p=0;p<f.length;p++)d=(p+1)%f.length,l=Math.abs(r.cross(f[d],f[p])),c+=l*(r.dot(f[d],f[d])+r.dot(f[d],f[p])+r.dot(f[p],f[p])),h+=l;return u/6*(c/h)},n.translate=function(o,u,c){c=typeof c<"u"?c:1;var h=o.length,f=u.x*c,l=u.y*c,d;for(d=0;d<h;d++)o[d].x+=f,o[d].y+=l;return o},n.rotate=function(o,u,c){if(u!==0){var h=Math.cos(u),f=Math.sin(u),l=c.x,d=c.y,p=o.length,m,x,b,v;for(v=0;v<p;v++)m=o[v],x=m.x-l,b=m.y-d,m.x=l+(x*h-b*f),m.y=d+(x*f+b*h);return o}},n.contains=function(o,u){for(var c=u.x,h=u.y,f=o.length,l=o[f-1],d,p=0;p<f;p++){if(d=o[p],(c-l.x)*(d.y-l.y)+(h-l.y)*(l.x-d.x)>0)return!1;l=d}return!0},n.scale=function(o,u,c,h){if(u===1&&c===1)return o;h=h||n.centre(o);for(var f,l,d=0;d<o.length;d++)f=o[d],l=r.sub(f,h),o[d].x=h.x+l.x*u,o[d].y=h.y+l.y*c;return o},n.chamfer=function(o,u,c,h,f){typeof u=="number"?u=[u]:u=u||[8],c=typeof c<"u"?c:-1,h=h||2,f=f||14;for(var l=[],d=0;d<o.length;d++){var p=o[d-1>=0?d-1:o.length-1],m=o[d],x=o[(d+1)%o.length],b=u[d<u.length?d:u.length-1];if(b===0){l.push(m);continue}var v=r.normalise({x:m.y-p.y,y:p.x-m.x}),T=r.normalise({x:x.y-m.y,y:m.x-x.x}),g=Math.sqrt(2*Math.pow(b,2)),w=r.mult(a.clone(v),b),S=r.normalise(r.mult(r.add(v,T),.5)),A=r.sub(m,r.mult(S,g)),P=c;c===-1&&(P=Math.pow(b,.32)*1.75),P=a.clamp(P,h,f),P%2===1&&(P+=1);for(var M=Math.acos(r.dot(v,T)),L=M/P,C=0;C<P;C++)l.push(r.add(r.rotate(w,L*C),A))}return l},n.clockwiseSort=function(o){var u=n.mean(o);return o.sort(function(c,h){return r.angle(u,c)-r.angle(u,h)}),o},n.isConvex=function(o){var u=0,c=o.length,h,f,l,d;if(c<3)return null;for(h=0;h<c;h++)if(f=(h+1)%c,l=(h+2)%c,d=(o[f].x-o[h].x)*(o[l].y-o[f].y),d-=(o[f].y-o[h].y)*(o[l].x-o[f].x),d<0?u|=1:d>0&&(u|=2),u===3)return!1;return u!==0?!0:null},n.hull=function(o){var u=[],c=[],h,f;for(o=o.slice(0),o.sort(function(l,d){var p=l.x-d.x;return p!==0?p:l.y-d.y}),f=0;f<o.length;f+=1){for(h=o[f];c.length>=2&&r.cross3(c[c.length-2],c[c.length-1],h)<=0;)c.pop();c.push(h)}for(f=o.length-1;f>=0;f-=1){for(h=o[f];u.length>=2&&r.cross3(u[u.length-2],u[u.length-1],h)<=0;)u.pop();u.push(h)}return u.pop(),c.pop(),u.concat(c)}})()},function(t,s,i){var n={};t.exports=n;var r=i(3),a=i(2),o=i(7),u=i(0),c=i(1),h=i(11);(function(){n._timeCorrection=!0,n._inertiaScale=4,n._nextCollidingGroupId=1,n._nextNonCollidingGroupId=-1,n._nextCategory=1,n._baseDelta=1e3/60,n.create=function(l){var d={id:u.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:r.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,deltaTime:16.666666666666668,_original:null},p=u.extend(d,l);return f(p,l),p},n.nextGroup=function(l){return l?n._nextNonCollidingGroupId--:n._nextCollidingGroupId++},n.nextCategory=function(){return n._nextCategory=n._nextCategory<<1,n._nextCategory};var f=function(l,d){d=d||{},n.set(l,{bounds:l.bounds||c.create(l.vertices),positionPrev:l.positionPrev||a.clone(l.position),anglePrev:l.anglePrev||l.angle,vertices:l.vertices,parts:l.parts||[l],isStatic:l.isStatic,isSleeping:l.isSleeping,parent:l.parent||l}),r.rotate(l.vertices,l.angle,l.position),h.rotate(l.axes,l.angle),c.update(l.bounds,l.vertices,l.velocity),n.set(l,{axes:d.axes||l.axes,area:d.area||l.area,mass:d.mass||l.mass,inertia:d.inertia||l.inertia});var p=l.isStatic?"#14151f":u.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),m=l.isStatic?"#555":"#ccc",x=l.isStatic&&l.render.fillStyle===null?1:0;l.render.fillStyle=l.render.fillStyle||p,l.render.strokeStyle=l.render.strokeStyle||m,l.render.lineWidth=l.render.lineWidth||x,l.render.sprite.xOffset+=-(l.bounds.min.x-l.position.x)/(l.bounds.max.x-l.bounds.min.x),l.render.sprite.yOffset+=-(l.bounds.min.y-l.position.y)/(l.bounds.max.y-l.bounds.min.y)};n.set=function(l,d,p){var m;typeof d=="string"&&(m=d,d={},d[m]=p);for(m in d)if(Object.prototype.hasOwnProperty.call(d,m))switch(p=d[m],m){case"isStatic":n.setStatic(l,p);break;case"isSleeping":o.set(l,p);break;case"mass":n.setMass(l,p);break;case"density":n.setDensity(l,p);break;case"inertia":n.setInertia(l,p);break;case"vertices":n.setVertices(l,p);break;case"position":n.setPosition(l,p);break;case"angle":n.setAngle(l,p);break;case"velocity":n.setVelocity(l,p);break;case"angularVelocity":n.setAngularVelocity(l,p);break;case"speed":n.setSpeed(l,p);break;case"angularSpeed":n.setAngularSpeed(l,p);break;case"parts":n.setParts(l,p);break;case"centre":n.setCentre(l,p);break;default:l[m]=p}},n.setStatic=function(l,d){for(var p=0;p<l.parts.length;p++){var m=l.parts[p];d?(m.isStatic||(m._original={restitution:m.restitution,friction:m.friction,mass:m.mass,inertia:m.inertia,density:m.density,inverseMass:m.inverseMass,inverseInertia:m.inverseInertia}),m.restitution=0,m.friction=1,m.mass=m.inertia=m.density=1/0,m.inverseMass=m.inverseInertia=0,m.positionPrev.x=m.position.x,m.positionPrev.y=m.position.y,m.anglePrev=m.angle,m.angularVelocity=0,m.speed=0,m.angularSpeed=0,m.motion=0):m._original&&(m.restitution=m._original.restitution,m.friction=m._original.friction,m.mass=m._original.mass,m.inertia=m._original.inertia,m.density=m._original.density,m.inverseMass=m._original.inverseMass,m.inverseInertia=m._original.inverseInertia,m._original=null),m.isStatic=d}},n.setMass=function(l,d){var p=l.inertia/(l.mass/6);l.inertia=p*(d/6),l.inverseInertia=1/l.inertia,l.mass=d,l.inverseMass=1/l.mass,l.density=l.mass/l.area},n.setDensity=function(l,d){n.setMass(l,d*l.area),l.density=d},n.setInertia=function(l,d){l.inertia=d,l.inverseInertia=1/l.inertia},n.setVertices=function(l,d){d[0].body===l?l.vertices=d:l.vertices=r.create(d,l),l.axes=h.fromVertices(l.vertices),l.area=r.area(l.vertices),n.setMass(l,l.density*l.area);var p=r.centre(l.vertices);r.translate(l.vertices,p,-1),n.setInertia(l,n._inertiaScale*r.inertia(l.vertices,l.mass)),r.translate(l.vertices,l.position),c.update(l.bounds,l.vertices,l.velocity)},n.setParts=function(l,d,p){var m;for(d=d.slice(0),l.parts.length=0,l.parts.push(l),l.parent=l,m=0;m<d.length;m++){var x=d[m];x!==l&&(x.parent=l,l.parts.push(x))}if(l.parts.length!==1){if(p=typeof p<"u"?p:!0,p){var b=[];for(m=0;m<d.length;m++)b=b.concat(d[m].vertices);r.clockwiseSort(b);var v=r.hull(b),T=r.centre(v);n.setVertices(l,v),r.translate(l.vertices,T)}var g=n._totalProperties(l);l.area=g.area,l.parent=l,l.position.x=g.centre.x,l.position.y=g.centre.y,l.positionPrev.x=g.centre.x,l.positionPrev.y=g.centre.y,n.setMass(l,g.mass),n.setInertia(l,g.inertia),n.setPosition(l,g.centre)}},n.setCentre=function(l,d,p){p?(l.positionPrev.x+=d.x,l.positionPrev.y+=d.y,l.position.x+=d.x,l.position.y+=d.y):(l.positionPrev.x=d.x-(l.position.x-l.positionPrev.x),l.positionPrev.y=d.y-(l.position.y-l.positionPrev.y),l.position.x=d.x,l.position.y=d.y)},n.setPosition=function(l,d,p){var m=a.sub(d,l.position);p?(l.positionPrev.x=l.position.x,l.positionPrev.y=l.position.y,l.velocity.x=m.x,l.velocity.y=m.y,l.speed=a.magnitude(m)):(l.positionPrev.x+=m.x,l.positionPrev.y+=m.y);for(var x=0;x<l.parts.length;x++){var b=l.parts[x];b.position.x+=m.x,b.position.y+=m.y,r.translate(b.vertices,m),c.update(b.bounds,b.vertices,l.velocity)}},n.setAngle=function(l,d,p){var m=d-l.angle;p?(l.anglePrev=l.angle,l.angularVelocity=m,l.angularSpeed=Math.abs(m)):l.anglePrev+=m;for(var x=0;x<l.parts.length;x++){var b=l.parts[x];b.angle+=m,r.rotate(b.vertices,m,l.position),h.rotate(b.axes,m),c.update(b.bounds,b.vertices,l.velocity),x>0&&a.rotateAbout(b.position,m,l.position,b.position)}},n.setVelocity=function(l,d){var p=l.deltaTime/n._baseDelta;l.positionPrev.x=l.position.x-d.x*p,l.positionPrev.y=l.position.y-d.y*p,l.velocity.x=(l.position.x-l.positionPrev.x)/p,l.velocity.y=(l.position.y-l.positionPrev.y)/p,l.speed=a.magnitude(l.velocity)},n.getVelocity=function(l){var d=n._baseDelta/l.deltaTime;return{x:(l.position.x-l.positionPrev.x)*d,y:(l.position.y-l.positionPrev.y)*d}},n.getSpeed=function(l){return a.magnitude(n.getVelocity(l))},n.setSpeed=function(l,d){n.setVelocity(l,a.mult(a.normalise(n.getVelocity(l)),d))},n.setAngularVelocity=function(l,d){var p=l.deltaTime/n._baseDelta;l.anglePrev=l.angle-d*p,l.angularVelocity=(l.angle-l.anglePrev)/p,l.angularSpeed=Math.abs(l.angularVelocity)},n.getAngularVelocity=function(l){return(l.angle-l.anglePrev)*n._baseDelta/l.deltaTime},n.getAngularSpeed=function(l){return Math.abs(n.getAngularVelocity(l))},n.setAngularSpeed=function(l,d){n.setAngularVelocity(l,u.sign(n.getAngularVelocity(l))*d)},n.translate=function(l,d,p){n.setPosition(l,a.add(l.position,d),p)},n.rotate=function(l,d,p,m){if(!p)n.setAngle(l,l.angle+d,m);else{var x=Math.cos(d),b=Math.sin(d),v=l.position.x-p.x,T=l.position.y-p.y;n.setPosition(l,{x:p.x+(v*x-T*b),y:p.y+(v*b+T*x)},m),n.setAngle(l,l.angle+d,m)}},n.scale=function(l,d,p,m){var x=0,b=0;m=m||l.position;for(var v=0;v<l.parts.length;v++){var T=l.parts[v];r.scale(T.vertices,d,p,m),T.axes=h.fromVertices(T.vertices),T.area=r.area(T.vertices),n.setMass(T,l.density*T.area),r.translate(T.vertices,{x:-T.position.x,y:-T.position.y}),n.setInertia(T,n._inertiaScale*r.inertia(T.vertices,T.mass)),r.translate(T.vertices,{x:T.position.x,y:T.position.y}),v>0&&(x+=T.area,b+=T.inertia),T.position.x=m.x+(T.position.x-m.x)*d,T.position.y=m.y+(T.position.y-m.y)*p,c.update(T.bounds,T.vertices,l.velocity)}l.parts.length>1&&(l.area=x,l.isStatic||(n.setMass(l,l.density*x),n.setInertia(l,b))),l.circleRadius&&(d===p?l.circleRadius*=d:l.circleRadius=null)},n.update=function(l,d){d=(typeof d<"u"?d:1e3/60)*l.timeScale;var p=d*d,m=n._timeCorrection?d/(l.deltaTime||d):1,x=1-l.frictionAir*(d/u._baseDelta),b=(l.position.x-l.positionPrev.x)*m,v=(l.position.y-l.positionPrev.y)*m;l.velocity.x=b*x+l.force.x/l.mass*p,l.velocity.y=v*x+l.force.y/l.mass*p,l.positionPrev.x=l.position.x,l.positionPrev.y=l.position.y,l.position.x+=l.velocity.x,l.position.y+=l.velocity.y,l.deltaTime=d,l.angularVelocity=(l.angle-l.anglePrev)*x*m+l.torque/l.inertia*p,l.anglePrev=l.angle,l.angle+=l.angularVelocity;for(var T=0;T<l.parts.length;T++){var g=l.parts[T];r.translate(g.vertices,l.velocity),T>0&&(g.position.x+=l.velocity.x,g.position.y+=l.velocity.y),l.angularVelocity!==0&&(r.rotate(g.vertices,l.angularVelocity,l.position),h.rotate(g.axes,l.angularVelocity),T>0&&a.rotateAbout(g.position,l.angularVelocity,l.position,g.position)),c.update(g.bounds,g.vertices,l.velocity)}},n.updateVelocities=function(l){var d=n._baseDelta/l.deltaTime,p=l.velocity;p.x=(l.position.x-l.positionPrev.x)*d,p.y=(l.position.y-l.positionPrev.y)*d,l.speed=Math.sqrt(p.x*p.x+p.y*p.y),l.angularVelocity=(l.angle-l.anglePrev)*d,l.angularSpeed=Math.abs(l.angularVelocity)},n.applyForce=function(l,d,p){var m={x:d.x-l.position.x,y:d.y-l.position.y};l.force.x+=p.x,l.force.y+=p.y,l.torque+=m.x*p.y-m.y*p.x},n._totalProperties=function(l){for(var d={mass:0,area:0,inertia:0,centre:{x:0,y:0}},p=l.parts.length===1?0:1;p<l.parts.length;p++){var m=l.parts[p],x=m.mass!==1/0?m.mass:1;d.mass+=x,d.area+=m.area,d.inertia+=m.inertia,d.centre=a.add(d.centre,a.mult(m.position,x))}return d.centre=a.div(d.centre,d.mass),d}})()},function(t,s,i){var n={};t.exports=n;var r=i(0);(function(){n.on=function(a,o,u){for(var c=o.split(" "),h,f=0;f<c.length;f++)h=c[f],a.events=a.events||{},a.events[h]=a.events[h]||[],a.events[h].push(u);return u},n.off=function(a,o,u){if(!o){a.events={};return}typeof o=="function"&&(u=o,o=r.keys(a.events).join(" "));for(var c=o.split(" "),h=0;h<c.length;h++){var f=a.events[c[h]],l=[];if(u&&f)for(var d=0;d<f.length;d++)f[d]!==u&&l.push(f[d]);a.events[c[h]]=l}},n.trigger=function(a,o,u){var c,h,f,l,d=a.events;if(d&&r.keys(d).length>0){u||(u={}),c=o.split(" ");for(var p=0;p<c.length;p++)if(h=c[p],f=d[h],f){l=r.clone(u,!1),l.name=h,l.source=a;for(var m=0;m<f.length;m++)f[m].apply(a,[l])}}}})()},function(t,s,i){var n={};t.exports=n;var r=i(5),a=i(0),o=i(1),u=i(4);(function(){n.create=function(c){return a.extend({id:a.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},c)},n.setModified=function(c,h,f,l){if(c.isModified=h,h&&c.cache&&(c.cache.allBodies=null,c.cache.allConstraints=null,c.cache.allComposites=null),f&&c.parent&&n.setModified(c.parent,h,f,l),l)for(var d=0;d<c.composites.length;d++){var p=c.composites[d];n.setModified(p,h,f,l)}},n.add=function(c,h){var f=[].concat(h);r.trigger(c,"beforeAdd",{object:h});for(var l=0;l<f.length;l++){var d=f[l];switch(d.type){case"body":if(d.parent!==d){a.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}n.addBody(c,d);break;case"constraint":n.addConstraint(c,d);break;case"composite":n.addComposite(c,d);break;case"mouseConstraint":n.addConstraint(c,d.constraint);break}}return r.trigger(c,"afterAdd",{object:h}),c},n.remove=function(c,h,f){var l=[].concat(h);r.trigger(c,"beforeRemove",{object:h});for(var d=0;d<l.length;d++){var p=l[d];switch(p.type){case"body":n.removeBody(c,p,f);break;case"constraint":n.removeConstraint(c,p,f);break;case"composite":n.removeComposite(c,p,f);break;case"mouseConstraint":n.removeConstraint(c,p.constraint);break}}return r.trigger(c,"afterRemove",{object:h}),c},n.addComposite=function(c,h){return c.composites.push(h),h.parent=c,n.setModified(c,!0,!0,!1),c},n.removeComposite=function(c,h,f){var l=a.indexOf(c.composites,h);if(l!==-1){var d=n.allBodies(h);n.removeCompositeAt(c,l);for(var p=0;p<d.length;p++)d[p].sleepCounter=0}if(f)for(var p=0;p<c.composites.length;p++)n.removeComposite(c.composites[p],h,!0);return c},n.removeCompositeAt=function(c,h){return c.composites.splice(h,1),n.setModified(c,!0,!0,!1),c},n.addBody=function(c,h){return c.bodies.push(h),n.setModified(c,!0,!0,!1),c},n.removeBody=function(c,h,f){var l=a.indexOf(c.bodies,h);if(l!==-1&&(n.removeBodyAt(c,l),h.sleepCounter=0),f)for(var d=0;d<c.composites.length;d++)n.removeBody(c.composites[d],h,!0);return c},n.removeBodyAt=function(c,h){return c.bodies.splice(h,1),n.setModified(c,!0,!0,!1),c},n.addConstraint=function(c,h){return c.constraints.push(h),n.setModified(c,!0,!0,!1),c},n.removeConstraint=function(c,h,f){var l=a.indexOf(c.constraints,h);if(l!==-1&&n.removeConstraintAt(c,l),f)for(var d=0;d<c.composites.length;d++)n.removeConstraint(c.composites[d],h,!0);return c},n.removeConstraintAt=function(c,h){return c.constraints.splice(h,1),n.setModified(c,!0,!0,!1),c},n.clear=function(c,h,f){if(f)for(var l=0;l<c.composites.length;l++)n.clear(c.composites[l],h,!0);return h?c.bodies=c.bodies.filter(function(d){return d.isStatic}):c.bodies.length=0,c.constraints.length=0,c.composites.length=0,n.setModified(c,!0,!0,!1),c},n.allBodies=function(c){if(c.cache&&c.cache.allBodies)return c.cache.allBodies;for(var h=[].concat(c.bodies),f=0;f<c.composites.length;f++)h=h.concat(n.allBodies(c.composites[f]));return c.cache&&(c.cache.allBodies=h),h},n.allConstraints=function(c){if(c.cache&&c.cache.allConstraints)return c.cache.allConstraints;for(var h=[].concat(c.constraints),f=0;f<c.composites.length;f++)h=h.concat(n.allConstraints(c.composites[f]));return c.cache&&(c.cache.allConstraints=h),h},n.allComposites=function(c){if(c.cache&&c.cache.allComposites)return c.cache.allComposites;for(var h=[].concat(c.composites),f=0;f<c.composites.length;f++)h=h.concat(n.allComposites(c.composites[f]));return c.cache&&(c.cache.allComposites=h),h},n.get=function(c,h,f){var l,d;switch(f){case"body":l=n.allBodies(c);break;case"constraint":l=n.allConstraints(c);break;case"composite":l=n.allComposites(c).concat(c);break}return l?(d=l.filter(function(p){return p.id.toString()===h.toString()}),d.length===0?null:d[0]):null},n.move=function(c,h,f){return n.remove(c,h),n.add(f,h),c},n.rebase=function(c){for(var h=n.allBodies(c).concat(n.allConstraints(c)).concat(n.allComposites(c)),f=0;f<h.length;f++)h[f].id=a.nextId();return c},n.translate=function(c,h,f){for(var l=f?n.allBodies(c):c.bodies,d=0;d<l.length;d++)u.translate(l[d],h);return c},n.rotate=function(c,h,f,l){for(var d=Math.cos(h),p=Math.sin(h),m=l?n.allBodies(c):c.bodies,x=0;x<m.length;x++){var b=m[x],v=b.position.x-f.x,T=b.position.y-f.y;u.setPosition(b,{x:f.x+(v*d-T*p),y:f.y+(v*p+T*d)}),u.rotate(b,h)}return c},n.scale=function(c,h,f,l,d){for(var p=d?n.allBodies(c):c.bodies,m=0;m<p.length;m++){var x=p[m],b=x.position.x-l.x,v=x.position.y-l.y;u.setPosition(x,{x:l.x+b*h,y:l.y+v*f}),u.scale(x,h,f)}return c},n.bounds=function(c){for(var h=n.allBodies(c),f=[],l=0;l<h.length;l+=1){var d=h[l];f.push(d.bounds.min,d.bounds.max)}return o.create(f)}})()},function(t,s,i){var n={};t.exports=n;var r=i(4),a=i(5),o=i(0);(function(){n._motionWakeThreshold=.18,n._motionSleepThreshold=.08,n._minBias=.9,n.update=function(u,c){for(var h=c/o._baseDelta,f=n._motionSleepThreshold,l=0;l<u.length;l++){var d=u[l],p=r.getSpeed(d),m=r.getAngularSpeed(d),x=p*p+m*m;if(d.force.x!==0||d.force.y!==0){n.set(d,!1);continue}var b=Math.min(d.motion,x),v=Math.max(d.motion,x);d.motion=n._minBias*b+(1-n._minBias)*v,d.sleepThreshold>0&&d.motion<f?(d.sleepCounter+=1,d.sleepCounter>=d.sleepThreshold/h&&n.set(d,!0)):d.sleepCounter>0&&(d.sleepCounter-=1)}},n.afterCollisions=function(u){for(var c=n._motionSleepThreshold,h=0;h<u.length;h++){var f=u[h];if(f.isActive){var l=f.collision,d=l.bodyA.parent,p=l.bodyB.parent;if(!(d.isSleeping&&p.isSleeping||d.isStatic||p.isStatic)&&(d.isSleeping||p.isSleeping)){var m=d.isSleeping&&!d.isStatic?d:p,x=m===d?p:d;!m.isStatic&&x.motion>c&&n.set(m,!1)}}}},n.set=function(u,c){var h=u.isSleeping;c?(u.isSleeping=!0,u.sleepCounter=u.sleepThreshold,u.positionImpulse.x=0,u.positionImpulse.y=0,u.positionPrev.x=u.position.x,u.positionPrev.y=u.position.y,u.anglePrev=u.angle,u.speed=0,u.angularSpeed=0,u.motion=0,h||a.trigger(u,"sleepStart")):(u.isSleeping=!1,u.sleepCounter=0,h&&a.trigger(u,"sleepEnd"))}})()},function(t,s,i){var n={};t.exports=n;var r=i(3),a=i(9);(function(){var o=[],u={overlap:0,axis:null},c={overlap:0,axis:null};n.create=function(h,f){return{pair:null,collided:!1,bodyA:h,bodyB:f,parentA:h.parent,parentB:f.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[null,null],supportCount:0}},n.collides=function(h,f,l){if(n._overlapAxes(u,h.vertices,f.vertices,h.axes),u.overlap<=0||(n._overlapAxes(c,f.vertices,h.vertices,f.axes),c.overlap<=0))return null;var d=l&&l.table[a.id(h,f)],p;d?p=d.collision:(p=n.create(h,f),p.collided=!0,p.bodyA=h.id<f.id?h:f,p.bodyB=h.id<f.id?f:h,p.parentA=p.bodyA.parent,p.parentB=p.bodyB.parent),h=p.bodyA,f=p.bodyB;var m;u.overlap<c.overlap?m=u:m=c;var x=p.normal,b=p.tangent,v=p.penetration,T=p.supports,g=m.overlap,w=m.axis,S=w.x,A=w.y,P=f.position.x-h.position.x,M=f.position.y-h.position.y;S*P+A*M>=0&&(S=-S,A=-A),x.x=S,x.y=A,b.x=-A,b.y=S,v.x=S*g,v.y=A*g,p.depth=g;var L=n._findSupports(h,f,x,1),C=0;if(r.contains(h.vertices,L[0])&&(T[C++]=L[0]),r.contains(h.vertices,L[1])&&(T[C++]=L[1]),C<2){var k=n._findSupports(f,h,x,-1);r.contains(f.vertices,k[0])&&(T[C++]=k[0]),C<2&&r.contains(f.vertices,k[1])&&(T[C++]=k[1])}return C===0&&(T[C++]=L[0]),p.supportCount=C,p},n._overlapAxes=function(h,f,l,d){var p=f.length,m=l.length,x=f[0].x,b=f[0].y,v=l[0].x,T=l[0].y,g=d.length,w=Number.MAX_VALUE,S=0,A,P,M,L,C,k;for(C=0;C<g;C++){var V=d[C],z=V.x,W=V.y,_=x*z+b*W,U=v*z+T*W,J=_,te=U;for(k=1;k<p;k+=1)L=f[k].x*z+f[k].y*W,L>J?J=L:L<_&&(_=L);for(k=1;k<m;k+=1)L=l[k].x*z+l[k].y*W,L>te?te=L:L<U&&(U=L);if(P=J-U,M=te-_,A=P<M?P:M,A<w&&(w=A,S=C,A<=0))break}h.axis=d[S],h.overlap=w},n._findSupports=function(h,f,l,d){var p=f.vertices,m=p.length,x=h.position.x,b=h.position.y,v=l.x*d,T=l.y*d,g=p[0],w=g,S=v*(x-w.x)+T*(b-w.y),A,P,M;for(M=1;M<m;M+=1)w=p[M],P=v*(x-w.x)+T*(b-w.y),P<S&&(S=P,g=w);return A=p[(m+g.index-1)%m],S=v*(x-A.x)+T*(b-A.y),w=p[(g.index+1)%m],v*(x-w.x)+T*(b-w.y)<S?(o[0]=g,o[1]=w,o):(o[0]=g,o[1]=A,o)}})()},function(t,s,i){var n={};t.exports=n;var r=i(16);(function(){n.create=function(a,o){var u=a.bodyA,c=a.bodyB,h={id:n.id(u,c),bodyA:u,bodyB:c,collision:a,contacts:[r.create(),r.create()],contactCount:0,separation:0,isActive:!0,isSensor:u.isSensor||c.isSensor,timeCreated:o,timeUpdated:o,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return n.update(h,a,o),h},n.update=function(a,o,u){var c=o.supports,h=o.supportCount,f=a.contacts,l=o.parentA,d=o.parentB;a.isActive=!0,a.timeUpdated=u,a.collision=o,a.separation=o.depth,a.inverseMass=l.inverseMass+d.inverseMass,a.friction=l.friction<d.friction?l.friction:d.friction,a.frictionStatic=l.frictionStatic>d.frictionStatic?l.frictionStatic:d.frictionStatic,a.restitution=l.restitution>d.restitution?l.restitution:d.restitution,a.slop=l.slop>d.slop?l.slop:d.slop,a.contactCount=h,o.pair=a;var p=c[0],m=f[0],x=c[1],b=f[1];(b.vertex===p||m.vertex===x)&&(f[1]=m,f[0]=m=b,b=f[1]),m.vertex=p,b.vertex=x},n.setActive=function(a,o,u){o?(a.isActive=!0,a.timeUpdated=u):(a.isActive=!1,a.contactCount=0)},n.id=function(a,o){return a.id<o.id?a.id.toString(36)+":"+o.id.toString(36):o.id.toString(36)+":"+a.id.toString(36)}})()},function(t,s,i){var n={};t.exports=n;var r=i(3),a=i(2),o=i(7),u=i(1),c=i(11),h=i(0);(function(){n._warming=.4,n._torqueDampen=1,n._minLength=1e-6,n.create=function(f){var l=f;l.bodyA&&!l.pointA&&(l.pointA={x:0,y:0}),l.bodyB&&!l.pointB&&(l.pointB={x:0,y:0});var d=l.bodyA?a.add(l.bodyA.position,l.pointA):l.pointA,p=l.bodyB?a.add(l.bodyB.position,l.pointB):l.pointB,m=a.magnitude(a.sub(d,p));l.length=typeof l.length<"u"?l.length:m,l.id=l.id||h.nextId(),l.label=l.label||"Constraint",l.type="constraint",l.stiffness=l.stiffness||(l.length>0?1:.7),l.damping=l.damping||0,l.angularStiffness=l.angularStiffness||0,l.angleA=l.bodyA?l.bodyA.angle:l.angleA,l.angleB=l.bodyB?l.bodyB.angle:l.angleB,l.plugin={};var x={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return l.length===0&&l.stiffness>.1?(x.type="pin",x.anchors=!1):l.stiffness<.9&&(x.type="spring"),l.render=h.extend(x,l.render),l},n.preSolveAll=function(f){for(var l=0;l<f.length;l+=1){var d=f[l],p=d.constraintImpulse;d.isStatic||p.x===0&&p.y===0&&p.angle===0||(d.position.x+=p.x,d.position.y+=p.y,d.angle+=p.angle)}},n.solveAll=function(f,l){for(var d=h.clamp(l/h._baseDelta,0,1),p=0;p<f.length;p+=1){var m=f[p],x=!m.bodyA||m.bodyA&&m.bodyA.isStatic,b=!m.bodyB||m.bodyB&&m.bodyB.isStatic;(x||b)&&n.solve(f[p],d)}for(p=0;p<f.length;p+=1)m=f[p],x=!m.bodyA||m.bodyA&&m.bodyA.isStatic,b=!m.bodyB||m.bodyB&&m.bodyB.isStatic,!x&&!b&&n.solve(f[p],d)},n.solve=function(f,l){var d=f.bodyA,p=f.bodyB,m=f.pointA,x=f.pointB;if(!(!d&&!p)){d&&!d.isStatic&&(a.rotate(m,d.angle-f.angleA,m),f.angleA=d.angle),p&&!p.isStatic&&(a.rotate(x,p.angle-f.angleB,x),f.angleB=p.angle);var b=m,v=x;if(d&&(b=a.add(d.position,m)),p&&(v=a.add(p.position,x)),!(!b||!v)){var T=a.sub(b,v),g=a.magnitude(T);g<n._minLength&&(g=n._minLength);var w=(g-f.length)/g,S=f.stiffness>=1||f.length===0,A=S?f.stiffness*l:f.stiffness*l*l,P=f.damping*l,M=a.mult(T,w*A),L=(d?d.inverseMass:0)+(p?p.inverseMass:0),C=(d?d.inverseInertia:0)+(p?p.inverseInertia:0),k=L+C,V,z,W,_,U;if(P>0){var J=a.create();W=a.div(T,g),U=a.sub(p&&a.sub(p.position,p.positionPrev)||J,d&&a.sub(d.position,d.positionPrev)||J),_=a.dot(W,U)}d&&!d.isStatic&&(z=d.inverseMass/L,d.constraintImpulse.x-=M.x*z,d.constraintImpulse.y-=M.y*z,d.position.x-=M.x*z,d.position.y-=M.y*z,P>0&&(d.positionPrev.x-=P*W.x*_*z,d.positionPrev.y-=P*W.y*_*z),V=a.cross(m,M)/k*n._torqueDampen*d.inverseInertia*(1-f.angularStiffness),d.constraintImpulse.angle-=V,d.angle-=V),p&&!p.isStatic&&(z=p.inverseMass/L,p.constraintImpulse.x+=M.x*z,p.constraintImpulse.y+=M.y*z,p.position.x+=M.x*z,p.position.y+=M.y*z,P>0&&(p.positionPrev.x+=P*W.x*_*z,p.positionPrev.y+=P*W.y*_*z),V=a.cross(x,M)/k*n._torqueDampen*p.inverseInertia*(1-f.angularStiffness),p.constraintImpulse.angle+=V,p.angle+=V)}}},n.postSolveAll=function(f){for(var l=0;l<f.length;l++){var d=f[l],p=d.constraintImpulse;if(!(d.isStatic||p.x===0&&p.y===0&&p.angle===0)){o.set(d,!1);for(var m=0;m<d.parts.length;m++){var x=d.parts[m];r.translate(x.vertices,p),m>0&&(x.position.x+=p.x,x.position.y+=p.y),p.angle!==0&&(r.rotate(x.vertices,p.angle,d.position),c.rotate(x.axes,p.angle),m>0&&a.rotateAbout(x.position,p.angle,d.position,x.position)),u.update(x.bounds,x.vertices,d.velocity)}p.angle*=n._warming,p.x*=n._warming,p.y*=n._warming}}},n.pointAWorld=function(f){return{x:(f.bodyA?f.bodyA.position.x:0)+(f.pointA?f.pointA.x:0),y:(f.bodyA?f.bodyA.position.y:0)+(f.pointA?f.pointA.y:0)}},n.pointBWorld=function(f){return{x:(f.bodyB?f.bodyB.position.x:0)+(f.pointB?f.pointB.x:0),y:(f.bodyB?f.bodyB.position.y:0)+(f.pointB?f.pointB.y:0)}},n.currentLength=function(f){var l=(f.bodyA?f.bodyA.position.x:0)+(f.pointA?f.pointA.x:0),d=(f.bodyA?f.bodyA.position.y:0)+(f.pointA?f.pointA.y:0),p=(f.bodyB?f.bodyB.position.x:0)+(f.pointB?f.pointB.x:0),m=(f.bodyB?f.bodyB.position.y:0)+(f.pointB?f.pointB.y:0),x=l-p,b=d-m;return Math.sqrt(x*x+b*b)}})()},function(t,s,i){var n={};t.exports=n;var r=i(2),a=i(0);(function(){n.fromVertices=function(o){for(var u={},c=0;c<o.length;c++){var h=(c+1)%o.length,f=r.normalise({x:o[h].y-o[c].y,y:o[c].x-o[h].x}),l=f.y===0?1/0:f.x/f.y;l=l.toFixed(3).toString(),u[l]=f}return a.values(u)},n.rotate=function(o,u){if(u!==0)for(var c=Math.cos(u),h=Math.sin(u),f=0;f<o.length;f++){var l=o[f],d;d=l.x*c-l.y*h,l.y=l.x*h+l.y*c,l.x=d}}})()},function(t,s,i){var n={};t.exports=n;var r=i(3),a=i(0),o=i(4),u=i(1),c=i(2);(function(){n.rectangle=function(h,f,l,d,p){p=p||{};var m={label:"Rectangle Body",position:{x:h,y:f},vertices:r.fromPath("L 0 0 L "+l+" 0 L "+l+" "+d+" L 0 "+d)};if(p.chamfer){var x=p.chamfer;m.vertices=r.chamfer(m.vertices,x.radius,x.quality,x.qualityMin,x.qualityMax),delete p.chamfer}return o.create(a.extend({},m,p))},n.trapezoid=function(h,f,l,d,p,m){m=m||{},p>=1&&a.warn("Bodies.trapezoid: slope parameter must be < 1."),p*=.5;var x=(1-p*2)*l,b=l*p,v=b+x,T=v+b,g;p<.5?g="L 0 0 L "+b+" "+-d+" L "+v+" "+-d+" L "+T+" 0":g="L 0 0 L "+v+" "+-d+" L "+T+" 0";var w={label:"Trapezoid Body",position:{x:h,y:f},vertices:r.fromPath(g)};if(m.chamfer){var S=m.chamfer;w.vertices=r.chamfer(w.vertices,S.radius,S.quality,S.qualityMin,S.qualityMax),delete m.chamfer}return o.create(a.extend({},w,m))},n.circle=function(h,f,l,d,p){d=d||{};var m={label:"Circle Body",circleRadius:l};p=p||25;var x=Math.ceil(Math.max(10,Math.min(p,l)));return x%2===1&&(x+=1),n.polygon(h,f,x,l,a.extend({},m,d))},n.polygon=function(h,f,l,d,p){if(p=p||{},l<3)return n.circle(h,f,d,p);for(var m=2*Math.PI/l,x="",b=m*.5,v=0;v<l;v+=1){var T=b+v*m,g=Math.cos(T)*d,w=Math.sin(T)*d;x+="L "+g.toFixed(3)+" "+w.toFixed(3)+" "}var S={label:"Polygon Body",position:{x:h,y:f},vertices:r.fromPath(x)};if(p.chamfer){var A=p.chamfer;S.vertices=r.chamfer(S.vertices,A.radius,A.quality,A.qualityMin,A.qualityMax),delete p.chamfer}return o.create(a.extend({},S,p))},n.fromVertices=function(h,f,l,d,p,m,x,b){var v=a.getDecomp(),T,g,w,S,A,P,M,L,C,k,V;for(T=!!(v&&v.quickDecomp),d=d||{},w=[],p=typeof p<"u"?p:!1,m=typeof m<"u"?m:.01,x=typeof x<"u"?x:10,b=typeof b<"u"?b:.01,a.isArray(l[0])||(l=[l]),k=0;k<l.length;k+=1)if(P=l[k],S=r.isConvex(P),A=!S,A&&!T&&a.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),S||!T)S?P=r.clockwiseSort(P):P=r.hull(P),w.push({position:{x:h,y:f},vertices:P});else{var z=P.map(function(E){return[E.x,E.y]});v.makeCCW(z),m!==!1&&v.removeCollinearPoints(z,m),b!==!1&&v.removeDuplicatePoints&&v.removeDuplicatePoints(z,b);var W=v.quickDecomp(z);for(M=0;M<W.length;M++){var _=W[M],U=_.map(function(E){return{x:E[0],y:E[1]}});x>0&&r.area(U)<x||w.push({position:r.centre(U),vertices:U})}}for(M=0;M<w.length;M++)w[M]=o.create(a.extend(w[M],d));if(p){var J=5;for(M=0;M<w.length;M++){var te=w[M];for(L=M+1;L<w.length;L++){var re=w[L];if(u.overlaps(te.bounds,re.bounds)){var oe=te.vertices,ue=re.vertices;for(C=0;C<te.vertices.length;C++)for(V=0;V<re.vertices.length;V++){var B=c.magnitudeSquared(c.sub(oe[(C+1)%oe.length],ue[V])),O=c.magnitudeSquared(c.sub(oe[C],ue[(V+1)%ue.length]));B<J&&O<J&&(oe[C].isInternal=!0,ue[V].isInternal=!0)}}}}}return w.length>1?(g=o.create(a.extend({parts:w.slice(0)},d)),o.setPosition(g,{x:h,y:f}),g):w[0]}})()},function(t,s,i){var n={};t.exports=n;var r=i(0),a=i(8);(function(){n.create=function(o){var u={bodies:[],collisions:[],pairs:null};return r.extend(u,o)},n.setBodies=function(o,u){o.bodies=u.slice(0)},n.clear=function(o){o.bodies=[],o.collisions=[]},n.collisions=function(o){var u=o.pairs,c=o.bodies,h=c.length,f=n.canCollide,l=a.collides,d=o.collisions,p=0,m,x;for(c.sort(n._compareBoundsX),m=0;m<h;m++){var b=c[m],v=b.bounds,T=b.bounds.max.x,g=b.bounds.max.y,w=b.bounds.min.y,S=b.isStatic||b.isSleeping,A=b.parts.length,P=A===1;for(x=m+1;x<h;x++){var M=c[x],L=M.bounds;if(L.min.x>T)break;if(!(g<L.min.y||w>L.max.y)&&!(S&&(M.isStatic||M.isSleeping))&&f(b.collisionFilter,M.collisionFilter)){var C=M.parts.length;if(P&&C===1){var k=l(b,M,u);k&&(d[p++]=k)}else for(var V=A>1?1:0,z=C>1?1:0,W=V;W<A;W++)for(var _=b.parts[W],v=_.bounds,U=z;U<C;U++){var J=M.parts[U],L=J.bounds;if(!(v.min.x>L.max.x||v.max.x<L.min.x||v.max.y<L.min.y||v.min.y>L.max.y)){var k=l(_,J,u);k&&(d[p++]=k)}}}}}return d.length!==p&&(d.length=p),d},n.canCollide=function(o,u){return o.group===u.group&&o.group!==0?o.group>0:(o.mask&u.category)!==0&&(u.mask&o.category)!==0},n._compareBoundsX=function(o,u){return o.bounds.min.x-u.bounds.min.x}})()},function(t,s,i){var n={};t.exports=n;var r=i(0);(function(){n.create=function(a){var o={};return a||r.log("Mouse.create: element was undefined, defaulting to document.body","warn"),o.element=a||document.body,o.absolute={x:0,y:0},o.position={x:0,y:0},o.mousedownPosition={x:0,y:0},o.mouseupPosition={x:0,y:0},o.offset={x:0,y:0},o.scale={x:1,y:1},o.wheelDelta=0,o.button=-1,o.pixelRatio=parseInt(o.element.getAttribute("data-pixel-ratio"),10)||1,o.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},o.mousemove=function(u){var c=n._getRelativeMousePosition(u,o.element,o.pixelRatio),h=u.changedTouches;h&&(o.button=0,u.preventDefault()),o.absolute.x=c.x,o.absolute.y=c.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y,o.sourceEvents.mousemove=u},o.mousedown=function(u){var c=n._getRelativeMousePosition(u,o.element,o.pixelRatio),h=u.changedTouches;h?(o.button=0,u.preventDefault()):o.button=u.button,o.absolute.x=c.x,o.absolute.y=c.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y,o.mousedownPosition.x=o.position.x,o.mousedownPosition.y=o.position.y,o.sourceEvents.mousedown=u},o.mouseup=function(u){var c=n._getRelativeMousePosition(u,o.element,o.pixelRatio),h=u.changedTouches;h&&u.preventDefault(),o.button=-1,o.absolute.x=c.x,o.absolute.y=c.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y,o.mouseupPosition.x=o.position.x,o.mouseupPosition.y=o.position.y,o.sourceEvents.mouseup=u},o.mousewheel=function(u){o.wheelDelta=Math.max(-1,Math.min(1,u.wheelDelta||-u.detail)),u.preventDefault(),o.sourceEvents.mousewheel=u},n.setElement(o,o.element),o},n.setElement=function(a,o){a.element=o,o.addEventListener("mousemove",a.mousemove,{passive:!0}),o.addEventListener("mousedown",a.mousedown,{passive:!0}),o.addEventListener("mouseup",a.mouseup,{passive:!0}),o.addEventListener("wheel",a.mousewheel,{passive:!1}),o.addEventListener("touchmove",a.mousemove,{passive:!1}),o.addEventListener("touchstart",a.mousedown,{passive:!1}),o.addEventListener("touchend",a.mouseup,{passive:!1})},n.clearSourceEvents=function(a){a.sourceEvents.mousemove=null,a.sourceEvents.mousedown=null,a.sourceEvents.mouseup=null,a.sourceEvents.mousewheel=null,a.wheelDelta=0},n.setOffset=function(a,o){a.offset.x=o.x,a.offset.y=o.y,a.position.x=a.absolute.x*a.scale.x+a.offset.x,a.position.y=a.absolute.y*a.scale.y+a.offset.y},n.setScale=function(a,o){a.scale.x=o.x,a.scale.y=o.y,a.position.x=a.absolute.x*a.scale.x+a.offset.x,a.position.y=a.absolute.y*a.scale.y+a.offset.y},n._getRelativeMousePosition=function(a,o,u){var c=o.getBoundingClientRect(),h=document.documentElement||document.body.parentNode||document.body,f=window.pageXOffset!==void 0?window.pageXOffset:h.scrollLeft,l=window.pageYOffset!==void 0?window.pageYOffset:h.scrollTop,d=a.changedTouches,p,m;return d?(p=d[0].pageX-c.left-f,m=d[0].pageY-c.top-l):(p=a.pageX-c.left-f,m=a.pageY-c.top-l),{x:p/(o.clientWidth/(o.width||o.clientWidth)*u),y:m/(o.clientHeight/(o.height||o.clientHeight)*u)}}})()},function(t,s,i){var n={};t.exports=n;var r=i(0);(function(){n._registry={},n.register=function(a){if(n.isPlugin(a)||r.warn("Plugin.register:",n.toString(a),"does not implement all required fields."),a.name in n._registry){var o=n._registry[a.name],u=n.versionParse(a.version).number,c=n.versionParse(o.version).number;u>c?(r.warn("Plugin.register:",n.toString(o),"was upgraded to",n.toString(a)),n._registry[a.name]=a):u<c?r.warn("Plugin.register:",n.toString(o),"can not be downgraded to",n.toString(a)):a!==o&&r.warn("Plugin.register:",n.toString(a),"is already registered to different plugin object")}else n._registry[a.name]=a;return a},n.resolve=function(a){return n._registry[n.dependencyParse(a).name]},n.toString=function(a){return typeof a=="string"?a:(a.name||"anonymous")+"@"+(a.version||a.range||"0.0.0")},n.isPlugin=function(a){return a&&a.name&&a.version&&a.install},n.isUsed=function(a,o){return a.used.indexOf(o)>-1},n.isFor=function(a,o){var u=a.for&&n.dependencyParse(a.for);return!a.for||o.name===u.name&&n.versionSatisfies(o.version,u.range)},n.use=function(a,o){if(a.uses=(a.uses||[]).concat(o||[]),a.uses.length===0){r.warn("Plugin.use:",n.toString(a),"does not specify any dependencies to install.");return}for(var u=n.dependencies(a),c=r.topologicalSort(u),h=[],f=0;f<c.length;f+=1)if(c[f]!==a.name){var l=n.resolve(c[f]);if(!l){h.push(" "+c[f]);continue}n.isUsed(a,l.name)||(n.isFor(l,a)||(r.warn("Plugin.use:",n.toString(l),"is for",l.for,"but installed on",n.toString(a)+"."),l._warned=!0),l.install?l.install(a):(r.warn("Plugin.use:",n.toString(l),"does not specify an install function."),l._warned=!0),l._warned?(h.push(" "+n.toString(l)),delete l._warned):h.push(" "+n.toString(l)),a.used.push(l.name))}h.length>0&&r.info(h.join("  "))},n.dependencies=function(a,o){var u=n.dependencyParse(a),c=u.name;if(o=o||{},!(c in o)){a=n.resolve(a)||a,o[c]=r.map(a.uses||[],function(f){n.isPlugin(f)&&n.register(f);var l=n.dependencyParse(f),d=n.resolve(f);return d&&!n.versionSatisfies(d.version,l.range)?(r.warn("Plugin.dependencies:",n.toString(d),"does not satisfy",n.toString(l),"used by",n.toString(u)+"."),d._warned=!0,a._warned=!0):d||(r.warn("Plugin.dependencies:",n.toString(f),"used by",n.toString(u),"could not be resolved."),a._warned=!0),l.name});for(var h=0;h<o[c].length;h+=1)n.dependencies(o[c][h],o);return o}},n.dependencyParse=function(a){if(r.isString(a)){var o=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/;return o.test(a)||r.warn("Plugin.dependencyParse:",a,"is not a valid dependency string."),{name:a.split("@")[0],range:a.split("@")[1]||"*"}}return{name:a.name,range:a.range||a.version}},n.versionParse=function(a){var o=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;o.test(a)||r.warn("Plugin.versionParse:",a,"is not a valid version or range.");var u=o.exec(a),c=Number(u[4]),h=Number(u[5]),f=Number(u[6]);return{isRange:!!(u[1]||u[2]),version:u[3],range:a,operator:u[1]||u[2]||"",major:c,minor:h,patch:f,parts:[c,h,f],prerelease:u[7],number:c*1e8+h*1e4+f}},n.versionSatisfies=function(a,o){o=o||"*";var u=n.versionParse(o),c=n.versionParse(a);if(u.isRange){if(u.operator==="*"||a==="*")return!0;if(u.operator===">")return c.number>u.number;if(u.operator===">=")return c.number>=u.number;if(u.operator==="~")return c.major===u.major&&c.minor===u.minor&&c.patch>=u.patch;if(u.operator==="^")return u.major>0?c.major===u.major&&c.number>=u.number:u.minor>0?c.minor===u.minor&&c.patch>=u.patch:c.patch===u.patch}return a===o||a==="*"}})()},function(t,s){var i={};t.exports=i,function(){i.create=function(n){return{vertex:n,normalImpulse:0,tangentImpulse:0}}}()},function(t,s,i){var n={};t.exports=n;var r=i(7),a=i(18),o=i(13),u=i(19),c=i(5),h=i(6),f=i(10),l=i(0),d=i(4);(function(){n._deltaMax=1e3/60,n.create=function(p){p=p||{};var m={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0,lastUpdatesPerFrame:0}},x=l.extend(m,p);return x.world=p.world||h.create({label:"World"}),x.pairs=p.pairs||u.create(),x.detector=p.detector||o.create(),x.detector.pairs=x.pairs,x.grid={buckets:[]},x.world.gravity=x.gravity,x.broadphase=x.grid,x.metrics={},x},n.update=function(p,m){var x=l.now(),b=p.world,v=p.detector,T=p.pairs,g=p.timing,w=g.timestamp,S;m>n._deltaMax&&l.warnOnce("Matter.Engine.update: delta argument is recommended to be less than or equal to",n._deltaMax.toFixed(3),"ms."),m=typeof m<"u"?m:l._baseDelta,m*=g.timeScale,g.timestamp+=m,g.lastDelta=m;var A={timestamp:g.timestamp,delta:m};c.trigger(p,"beforeUpdate",A);var P=h.allBodies(b),M=h.allConstraints(b);for(b.isModified&&(o.setBodies(v,P),h.setModified(b,!1,!1,!0)),p.enableSleeping&&r.update(P,m),n._bodiesApplyGravity(P,p.gravity),m>0&&n._bodiesUpdate(P,m),c.trigger(p,"beforeSolve",A),f.preSolveAll(P),S=0;S<p.constraintIterations;S++)f.solveAll(M,m);f.postSolveAll(P);var L=o.collisions(v);u.update(T,L,w),p.enableSleeping&&r.afterCollisions(T.list),T.collisionStart.length>0&&c.trigger(p,"collisionStart",{pairs:T.collisionStart,timestamp:g.timestamp,delta:m});var C=l.clamp(20/p.positionIterations,0,1);for(a.preSolvePosition(T.list),S=0;S<p.positionIterations;S++)a.solvePosition(T.list,m,C);for(a.postSolvePosition(P),f.preSolveAll(P),S=0;S<p.constraintIterations;S++)f.solveAll(M,m);for(f.postSolveAll(P),a.preSolveVelocity(T.list),S=0;S<p.velocityIterations;S++)a.solveVelocity(T.list,m);return n._bodiesUpdateVelocities(P),T.collisionActive.length>0&&c.trigger(p,"collisionActive",{pairs:T.collisionActive,timestamp:g.timestamp,delta:m}),T.collisionEnd.length>0&&c.trigger(p,"collisionEnd",{pairs:T.collisionEnd,timestamp:g.timestamp,delta:m}),n._bodiesClearForces(P),c.trigger(p,"afterUpdate",A),p.timing.lastElapsed=l.now()-x,p},n.merge=function(p,m){if(l.extend(p,m),m.world){p.world=m.world,n.clear(p);for(var x=h.allBodies(p.world),b=0;b<x.length;b++){var v=x[b];r.set(v,!1),v.id=l.nextId()}}},n.clear=function(p){u.clear(p.pairs),o.clear(p.detector)},n._bodiesClearForces=function(p){for(var m=p.length,x=0;x<m;x++){var b=p[x];b.force.x=0,b.force.y=0,b.torque=0}},n._bodiesApplyGravity=function(p,m){var x=typeof m.scale<"u"?m.scale:.001,b=p.length;if(!(m.x===0&&m.y===0||x===0))for(var v=0;v<b;v++){var T=p[v];T.isStatic||T.isSleeping||(T.force.y+=T.mass*m.y*x,T.force.x+=T.mass*m.x*x)}},n._bodiesUpdate=function(p,m){for(var x=p.length,b=0;b<x;b++){var v=p[b];v.isStatic||v.isSleeping||d.update(v,m)}},n._bodiesUpdateVelocities=function(p){for(var m=p.length,x=0;x<m;x++)d.updateVelocities(p[x])}})()},function(t,s,i){var n={};t.exports=n;var r=i(3),a=i(0),o=i(1);(function(){n._restingThresh=2,n._restingThreshTangent=Math.sqrt(6),n._positionDampen=.9,n._positionWarming=.8,n._frictionNormalMultiplier=5,n._frictionMaxStatic=Number.MAX_VALUE,n.preSolvePosition=function(u){var c,h,f,l=u.length;for(c=0;c<l;c++)h=u[c],h.isActive&&(f=h.contactCount,h.collision.parentA.totalContacts+=f,h.collision.parentB.totalContacts+=f)},n.solvePosition=function(u,c,h){var f,l,d,p,m,x,b,v,T=n._positionDampen*(h||1),g=a.clamp(c/a._baseDelta,0,1),w=u.length;for(f=0;f<w;f++)l=u[f],!(!l.isActive||l.isSensor)&&(d=l.collision,p=d.parentA,m=d.parentB,x=d.normal,l.separation=d.depth+x.x*(m.positionImpulse.x-p.positionImpulse.x)+x.y*(m.positionImpulse.y-p.positionImpulse.y));for(f=0;f<w;f++)l=u[f],!(!l.isActive||l.isSensor)&&(d=l.collision,p=d.parentA,m=d.parentB,x=d.normal,v=l.separation-l.slop*g,(p.isStatic||m.isStatic)&&(v*=2),p.isStatic||p.isSleeping||(b=T/p.totalContacts,p.positionImpulse.x+=x.x*v*b,p.positionImpulse.y+=x.y*v*b),m.isStatic||m.isSleeping||(b=T/m.totalContacts,m.positionImpulse.x-=x.x*v*b,m.positionImpulse.y-=x.y*v*b))},n.postSolvePosition=function(u){for(var c=n._positionWarming,h=u.length,f=r.translate,l=o.update,d=0;d<h;d++){var p=u[d],m=p.positionImpulse,x=m.x,b=m.y,v=p.velocity;if(p.totalContacts=0,x!==0||b!==0){for(var T=0;T<p.parts.length;T++){var g=p.parts[T];f(g.vertices,m),l(g.bounds,g.vertices,v),g.position.x+=x,g.position.y+=b}p.positionPrev.x+=x,p.positionPrev.y+=b,x*v.x+b*v.y<0?(m.x=0,m.y=0):(m.x*=c,m.y*=c)}}},n.preSolveVelocity=function(u){var c=u.length,h,f;for(h=0;h<c;h++){var l=u[h];if(!(!l.isActive||l.isSensor)){var d=l.contacts,p=l.contactCount,m=l.collision,x=m.parentA,b=m.parentB,v=m.normal,T=m.tangent;for(f=0;f<p;f++){var g=d[f],w=g.vertex,S=g.normalImpulse,A=g.tangentImpulse;if(S!==0||A!==0){var P=v.x*S+T.x*A,M=v.y*S+T.y*A;x.isStatic||x.isSleeping||(x.positionPrev.x+=P*x.inverseMass,x.positionPrev.y+=M*x.inverseMass,x.anglePrev+=x.inverseInertia*((w.x-x.position.x)*M-(w.y-x.position.y)*P)),b.isStatic||b.isSleeping||(b.positionPrev.x-=P*b.inverseMass,b.positionPrev.y-=M*b.inverseMass,b.anglePrev-=b.inverseInertia*((w.x-b.position.x)*M-(w.y-b.position.y)*P))}}}}},n.solveVelocity=function(u,c){var h=c/a._baseDelta,f=h*h,l=f*h,d=-n._restingThresh*h,p=n._restingThreshTangent,m=n._frictionNormalMultiplier*h,x=n._frictionMaxStatic,b=u.length,v,T,g,w;for(g=0;g<b;g++){var S=u[g];if(!(!S.isActive||S.isSensor)){var A=S.collision,P=A.parentA,M=A.parentB,L=A.normal.x,C=A.normal.y,k=A.tangent.x,V=A.tangent.y,z=S.inverseMass,W=S.friction*S.frictionStatic*m,_=S.contacts,U=S.contactCount,J=1/U,te=P.position.x-P.positionPrev.x,re=P.position.y-P.positionPrev.y,oe=P.angle-P.anglePrev,ue=M.position.x-M.positionPrev.x,B=M.position.y-M.positionPrev.y,O=M.angle-M.anglePrev;for(w=0;w<U;w++){var E=_[w],R=E.vertex,H=R.x-P.position.x,X=R.y-P.position.y,N=R.x-M.position.x,K=R.y-M.position.y,Q=te-X*oe,q=re+H*oe,G=ue-K*O,Y=B+N*O,Z=Q-G,ee=q-Y,F=L*Z+C*ee,I=k*Z+V*ee,$=S.separation+F,ae=Math.min($,1);ae=$<0?0:ae;var ve=ae*W;I<-ve||I>ve?(T=I>0?I:-I,v=S.friction*(I>0?1:-1)*l,v<-T?v=-T:v>T&&(v=T)):(v=I,T=x);var we=H*C-X*L,me=N*C-K*L,Ee=J/(z+P.inverseInertia*we*we+M.inverseInertia*me*me),Re=(1+S.restitution)*F*Ee;if(v*=Ee,F<d)E.normalImpulse=0;else{var Ye=E.normalImpulse;E.normalImpulse+=Re,E.normalImpulse>0&&(E.normalImpulse=0),Re=E.normalImpulse-Ye}if(I<-p||I>p)E.tangentImpulse=0;else{var D=E.tangentImpulse;E.tangentImpulse+=v,E.tangentImpulse<-T&&(E.tangentImpulse=-T),E.tangentImpulse>T&&(E.tangentImpulse=T),v=E.tangentImpulse-D}var ne=L*Re+k*v,he=C*Re+V*v;P.isStatic||P.isSleeping||(P.positionPrev.x+=ne*P.inverseMass,P.positionPrev.y+=he*P.inverseMass,P.anglePrev+=(H*he-X*ne)*P.inverseInertia),M.isStatic||M.isSleeping||(M.positionPrev.x-=ne*M.inverseMass,M.positionPrev.y-=he*M.inverseMass,M.anglePrev-=(N*he-K*ne)*M.inverseInertia)}}}}})()},function(t,s,i){var n={};t.exports=n;var r=i(9),a=i(0);(function(){n.create=function(o){return a.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},o)},n.update=function(o,u,c){var h=r.update,f=r.create,l=r.setActive,d=o.table,p=o.list,m=p.length,x=m,b=o.collisionStart,v=o.collisionEnd,T=o.collisionActive,g=u.length,w=0,S=0,A=0,P,M,L;for(L=0;L<g;L++)P=u[L],M=P.pair,M?(M.isActive&&(T[A++]=M),h(M,P,c)):(M=f(P,c),d[M.id]=M,b[w++]=M,p[x++]=M);for(x=0,m=p.length,L=0;L<m;L++)M=p[L],M.timeUpdated>=c?p[x++]=M:(l(M,!1,c),M.collision.bodyA.sleepCounter>0&&M.collision.bodyB.sleepCounter>0?p[x++]=M:(v[S++]=M,delete d[M.id]));p.length!==x&&(p.length=x),b.length!==w&&(b.length=w),v.length!==S&&(v.length=S),T.length!==A&&(T.length=A)},n.clear=function(o){return o.table={},o.list.length=0,o.collisionStart.length=0,o.collisionActive.length=0,o.collisionEnd.length=0,o}})()},function(t,s,i){var n=t.exports=i(21);n.Axes=i(11),n.Bodies=i(12),n.Body=i(4),n.Bounds=i(1),n.Collision=i(8),n.Common=i(0),n.Composite=i(6),n.Composites=i(22),n.Constraint=i(10),n.Contact=i(16),n.Detector=i(13),n.Engine=i(17),n.Events=i(5),n.Grid=i(23),n.Mouse=i(14),n.MouseConstraint=i(24),n.Pair=i(9),n.Pairs=i(19),n.Plugin=i(15),n.Query=i(25),n.Render=i(26),n.Resolver=i(18),n.Runner=i(27),n.SAT=i(28),n.Sleeping=i(7),n.Svg=i(29),n.Vector=i(2),n.Vertices=i(3),n.World=i(30),n.Engine.run=n.Runner.run,n.Common.deprecated(n.Engine,"run","Engine.run  use Matter.Runner.run(engine) instead")},function(t,s,i){var n={};t.exports=n;var r=i(15),a=i(0);(function(){n.name="matter-js",n.version="0.20.0",n.uses=[],n.used=[],n.use=function(){r.use(n,Array.prototype.slice.call(arguments))},n.before=function(o,u){return o=o.replace(/^Matter./,""),a.chainPathBefore(n,o,u)},n.after=function(o,u){return o=o.replace(/^Matter./,""),a.chainPathAfter(n,o,u)}})()},function(t,s,i){var n={};t.exports=n;var r=i(6),a=i(10),o=i(0),u=i(4),c=i(12),h=o.deprecated;(function(){n.stack=function(f,l,d,p,m,x,b){for(var v=r.create({label:"Stack"}),T=f,g=l,w,S=0,A=0;A<p;A++){for(var P=0,M=0;M<d;M++){var L=b(T,g,M,A,w,S);if(L){var C=L.bounds.max.y-L.bounds.min.y,k=L.bounds.max.x-L.bounds.min.x;C>P&&(P=C),u.translate(L,{x:k*.5,y:C*.5}),T=L.bounds.max.x+m,r.addBody(v,L),w=L,S+=1}else T+=m}g+=P+x,T=f}return v},n.chain=function(f,l,d,p,m,x){for(var b=f.bodies,v=1;v<b.length;v++){var T=b[v-1],g=b[v],w=T.bounds.max.y-T.bounds.min.y,S=T.bounds.max.x-T.bounds.min.x,A=g.bounds.max.y-g.bounds.min.y,P=g.bounds.max.x-g.bounds.min.x,M={bodyA:T,pointA:{x:S*l,y:w*d},bodyB:g,pointB:{x:P*p,y:A*m}},L=o.extend(M,x);r.addConstraint(f,a.create(L))}return f.label+=" Chain",f},n.mesh=function(f,l,d,p,m){var x=f.bodies,b,v,T,g,w;for(b=0;b<d;b++){for(v=1;v<l;v++)T=x[v-1+b*l],g=x[v+b*l],r.addConstraint(f,a.create(o.extend({bodyA:T,bodyB:g},m)));if(b>0)for(v=0;v<l;v++)T=x[v+(b-1)*l],g=x[v+b*l],r.addConstraint(f,a.create(o.extend({bodyA:T,bodyB:g},m))),p&&v>0&&(w=x[v-1+(b-1)*l],r.addConstraint(f,a.create(o.extend({bodyA:w,bodyB:g},m)))),p&&v<l-1&&(w=x[v+1+(b-1)*l],r.addConstraint(f,a.create(o.extend({bodyA:w,bodyB:g},m))))}return f.label+=" Mesh",f},n.pyramid=function(f,l,d,p,m,x,b){return n.stack(f,l,d,p,m,x,function(v,T,g,w,S,A){var P=Math.min(p,Math.ceil(d/2)),M=S?S.bounds.max.x-S.bounds.min.x:0;if(!(w>P)){w=P-w;var L=w,C=d-1-w;if(!(g<L||g>C)){A===1&&u.translate(S,{x:(g+(d%2===1?1:-1))*M,y:0});var k=S?g*M:0;return b(f+k+g*m,T,g,w,S,A)}}})},n.newtonsCradle=function(f,l,d,p,m){for(var x=r.create({label:"Newtons Cradle"}),b=0;b<d;b++){var v=1.9,T=c.circle(f+b*(p*v),l+m,p,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),g=a.create({pointA:{x:f+b*(p*v),y:l},bodyB:T});r.addBody(x,T),r.addConstraint(x,g)}return x},h(n,"newtonsCradle","Composites.newtonsCradle  moved to newtonsCradle example"),n.car=function(f,l,d,p,m){var x=u.nextGroup(!0),b=20,v=-d*.5+b,T=d*.5-b,g=0,w=r.create({label:"Car"}),S=c.rectangle(f,l,d,p,{collisionFilter:{group:x},chamfer:{radius:p*.5},density:2e-4}),A=c.circle(f+v,l+g,m,{collisionFilter:{group:x},friction:.8}),P=c.circle(f+T,l+g,m,{collisionFilter:{group:x},friction:.8}),M=a.create({bodyB:S,pointB:{x:v,y:g},bodyA:A,stiffness:1,length:0}),L=a.create({bodyB:S,pointB:{x:T,y:g},bodyA:P,stiffness:1,length:0});return r.addBody(w,S),r.addBody(w,A),r.addBody(w,P),r.addConstraint(w,M),r.addConstraint(w,L),w},h(n,"car","Composites.car  moved to car example"),n.softBody=function(f,l,d,p,m,x,b,v,T,g){T=o.extend({inertia:1/0},T),g=o.extend({stiffness:.2,render:{type:"line",anchors:!1}},g);var w=n.stack(f,l,d,p,m,x,function(S,A){return c.circle(S,A,v,T)});return n.mesh(w,d,p,b,g),w.label="Soft Body",w},h(n,"softBody","Composites.softBody  moved to softBody and cloth examples")})()},function(t,s,i){var n={};t.exports=n;var r=i(9),a=i(0),o=a.deprecated;(function(){n.create=function(u){var c={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return a.extend(c,u)},n.update=function(u,c,h,f){var l,d,p,m=h.world,x=u.buckets,b,v,T=!1;for(l=0;l<c.length;l++){var g=c[l];if(!(g.isSleeping&&!f)&&!(m.bounds&&(g.bounds.max.x<m.bounds.min.x||g.bounds.min.x>m.bounds.max.x||g.bounds.max.y<m.bounds.min.y||g.bounds.min.y>m.bounds.max.y))){var w=n._getRegion(u,g);if(!g.region||w.id!==g.region.id||f){(!g.region||f)&&(g.region=w);var S=n._regionUnion(w,g.region);for(d=S.startCol;d<=S.endCol;d++)for(p=S.startRow;p<=S.endRow;p++){v=n._getBucketId(d,p),b=x[v];var A=d>=w.startCol&&d<=w.endCol&&p>=w.startRow&&p<=w.endRow,P=d>=g.region.startCol&&d<=g.region.endCol&&p>=g.region.startRow&&p<=g.region.endRow;!A&&P&&P&&b&&n._bucketRemoveBody(u,b,g),(g.region===w||A&&!P||f)&&(b||(b=n._createBucket(x,v)),n._bucketAddBody(u,b,g))}g.region=w,T=!0}}}T&&(u.pairsList=n._createActivePairsList(u))},o(n,"update","Grid.update  replaced by Matter.Detector"),n.clear=function(u){u.buckets={},u.pairs={},u.pairsList=[]},o(n,"clear","Grid.clear  replaced by Matter.Detector"),n._regionUnion=function(u,c){var h=Math.min(u.startCol,c.startCol),f=Math.max(u.endCol,c.endCol),l=Math.min(u.startRow,c.startRow),d=Math.max(u.endRow,c.endRow);return n._createRegion(h,f,l,d)},n._getRegion=function(u,c){var h=c.bounds,f=Math.floor(h.min.x/u.bucketWidth),l=Math.floor(h.max.x/u.bucketWidth),d=Math.floor(h.min.y/u.bucketHeight),p=Math.floor(h.max.y/u.bucketHeight);return n._createRegion(f,l,d,p)},n._createRegion=function(u,c,h,f){return{id:u+","+c+","+h+","+f,startCol:u,endCol:c,startRow:h,endRow:f}},n._getBucketId=function(u,c){return"C"+u+"R"+c},n._createBucket=function(u,c){var h=u[c]=[];return h},n._bucketAddBody=function(u,c,h){var f=u.pairs,l=r.id,d=c.length,p;for(p=0;p<d;p++){var m=c[p];if(!(h.id===m.id||h.isStatic&&m.isStatic)){var x=l(h,m),b=f[x];b?b[2]+=1:f[x]=[h,m,1]}}c.push(h)},n._bucketRemoveBody=function(u,c,h){var f=u.pairs,l=r.id,d;c.splice(a.indexOf(c,h),1);var p=c.length;for(d=0;d<p;d++){var m=f[l(h,c[d])];m&&(m[2]-=1)}},n._createActivePairsList=function(u){var c,h=u.pairs,f=a.keys(h),l=f.length,d=[],p;for(p=0;p<l;p++)c=h[f[p]],c[2]>0?d.push(c):delete h[f[p]];return d}})()},function(t,s,i){var n={};t.exports=n;var r=i(3),a=i(7),o=i(14),u=i(5),c=i(13),h=i(10),f=i(6),l=i(0),d=i(1);(function(){n.create=function(p,m){var x=(p?p.mouse:null)||(m?m.mouse:null);x||(p&&p.render&&p.render.canvas?x=o.create(p.render.canvas):m&&m.element?x=o.create(m.element):(x=o.create(),l.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var b=h.create({label:"Mouse Constraint",pointA:x.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),v={type:"mouseConstraint",mouse:x,element:null,body:null,constraint:b,collisionFilter:{category:1,mask:4294967295,group:0}},T=l.extend(v,m);return u.on(p,"beforeUpdate",function(){var g=f.allBodies(p.world);n.update(T,g),n._triggerEvents(T)}),T},n.update=function(p,m){var x=p.mouse,b=p.constraint,v=p.body;if(x.button===0){if(b.bodyB)a.set(b.bodyB,!1),b.pointA=x.position;else for(var T=0;T<m.length;T++)if(v=m[T],d.contains(v.bounds,x.position)&&c.canCollide(v.collisionFilter,p.collisionFilter))for(var g=v.parts.length>1?1:0;g<v.parts.length;g++){var w=v.parts[g];if(r.contains(w.vertices,x.position)){b.pointA=x.position,b.bodyB=p.body=v,b.pointB={x:x.position.x-v.position.x,y:x.position.y-v.position.y},b.angleB=v.angle,a.set(v,!1),u.trigger(p,"startdrag",{mouse:x,body:v});break}}}else b.bodyB=p.body=null,b.pointB=null,v&&u.trigger(p,"enddrag",{mouse:x,body:v})},n._triggerEvents=function(p){var m=p.mouse,x=m.sourceEvents;x.mousemove&&u.trigger(p,"mousemove",{mouse:m}),x.mousedown&&u.trigger(p,"mousedown",{mouse:m}),x.mouseup&&u.trigger(p,"mouseup",{mouse:m}),o.clearSourceEvents(m)}})()},function(t,s,i){var n={};t.exports=n;var r=i(2),a=i(8),o=i(1),u=i(12),c=i(3);(function(){n.collides=function(h,f){for(var l=[],d=f.length,p=h.bounds,m=a.collides,x=o.overlaps,b=0;b<d;b++){var v=f[b],T=v.parts.length,g=T===1?0:1;if(x(v.bounds,p))for(var w=g;w<T;w++){var S=v.parts[w];if(x(S.bounds,p)){var A=m(S,h);if(A){l.push(A);break}}}}return l},n.ray=function(h,f,l,d){d=d||1e-100;for(var p=r.angle(f,l),m=r.magnitude(r.sub(f,l)),x=(l.x+f.x)*.5,b=(l.y+f.y)*.5,v=u.rectangle(x,b,m,d,{angle:p}),T=n.collides(v,h),g=0;g<T.length;g+=1){var w=T[g];w.body=w.bodyB=w.bodyA}return T},n.region=function(h,f,l){for(var d=[],p=0;p<h.length;p++){var m=h[p],x=o.overlaps(m.bounds,f);(x&&!l||!x&&l)&&d.push(m)}return d},n.point=function(h,f){for(var l=[],d=0;d<h.length;d++){var p=h[d];if(o.contains(p.bounds,f))for(var m=p.parts.length===1?0:1;m<p.parts.length;m++){var x=p.parts[m];if(o.contains(x.bounds,f)&&c.contains(x.vertices,f)){l.push(p);break}}}return l}})()},function(t,s,i){var n={};t.exports=n;var r=i(4),a=i(0),o=i(6),u=i(1),c=i(5),h=i(2),f=i(14);(function(){var l,d;typeof window<"u"&&(l=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(g){window.setTimeout(function(){g(a.now())},1e3/60)},d=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),n._goodFps=30,n._goodDelta=1e3/60,n.create=function(g){var w={engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],engineUpdatesHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",wireframeStrokeStyle:"#bbb",hasBounds:!!g.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},S=a.extend(w,g);return S.canvas&&(S.canvas.width=S.options.width||S.canvas.width,S.canvas.height=S.options.height||S.canvas.height),S.mouse=g.mouse,S.engine=g.engine,S.canvas=S.canvas||x(S.options.width,S.options.height),S.context=S.canvas.getContext("2d"),S.textures={},S.bounds=S.bounds||{min:{x:0,y:0},max:{x:S.canvas.width,y:S.canvas.height}},S.controller=n,S.options.showBroadphase=!1,S.options.pixelRatio!==1&&n.setPixelRatio(S,S.options.pixelRatio),a.isElement(S.element)&&S.element.appendChild(S.canvas),S},n.run=function(g){(function w(S){g.frameRequestId=l(w),p(g,S),n.world(g,S),g.context.setTransform(g.options.pixelRatio,0,0,g.options.pixelRatio,0,0),(g.options.showStats||g.options.showDebug)&&n.stats(g,g.context,S),(g.options.showPerformance||g.options.showDebug)&&n.performance(g,g.context,S),g.context.setTransform(1,0,0,1,0,0)})()},n.stop=function(g){d(g.frameRequestId)},n.setPixelRatio=function(g,w){var S=g.options,A=g.canvas;w==="auto"&&(w=b(A)),S.pixelRatio=w,A.setAttribute("data-pixel-ratio",w),A.width=S.width*w,A.height=S.height*w,A.style.width=S.width+"px",A.style.height=S.height+"px"},n.setSize=function(g,w,S){g.options.width=w,g.options.height=S,g.bounds.max.x=g.bounds.min.x+w,g.bounds.max.y=g.bounds.min.y+S,g.options.pixelRatio!==1?n.setPixelRatio(g,g.options.pixelRatio):(g.canvas.width=w,g.canvas.height=S)},n.lookAt=function(g,w,S,A){A=typeof A<"u"?A:!0,w=a.isArray(w)?w:[w],S=S||{x:0,y:0};for(var P={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},M=0;M<w.length;M+=1){var L=w[M],C=L.bounds?L.bounds.min:L.min||L.position||L,k=L.bounds?L.bounds.max:L.max||L.position||L;C&&k&&(C.x<P.min.x&&(P.min.x=C.x),k.x>P.max.x&&(P.max.x=k.x),C.y<P.min.y&&(P.min.y=C.y),k.y>P.max.y&&(P.max.y=k.y))}var V=P.max.x-P.min.x+2*S.x,z=P.max.y-P.min.y+2*S.y,W=g.canvas.height,_=g.canvas.width,U=_/W,J=V/z,te=1,re=1;J>U?re=J/U:te=U/J,g.options.hasBounds=!0,g.bounds.min.x=P.min.x,g.bounds.max.x=P.min.x+V*te,g.bounds.min.y=P.min.y,g.bounds.max.y=P.min.y+z*re,A&&(g.bounds.min.x+=V*.5-V*te*.5,g.bounds.max.x+=V*.5-V*te*.5,g.bounds.min.y+=z*.5-z*re*.5,g.bounds.max.y+=z*.5-z*re*.5),g.bounds.min.x-=S.x,g.bounds.max.x-=S.x,g.bounds.min.y-=S.y,g.bounds.max.y-=S.y,g.mouse&&(f.setScale(g.mouse,{x:(g.bounds.max.x-g.bounds.min.x)/g.canvas.width,y:(g.bounds.max.y-g.bounds.min.y)/g.canvas.height}),f.setOffset(g.mouse,g.bounds.min))},n.startViewTransform=function(g){var w=g.bounds.max.x-g.bounds.min.x,S=g.bounds.max.y-g.bounds.min.y,A=w/g.options.width,P=S/g.options.height;g.context.setTransform(g.options.pixelRatio/A,0,0,g.options.pixelRatio/P,0,0),g.context.translate(-g.bounds.min.x,-g.bounds.min.y)},n.endViewTransform=function(g){g.context.setTransform(g.options.pixelRatio,0,0,g.options.pixelRatio,0,0)},n.world=function(g,w){var S=a.now(),A=g.engine,P=A.world,M=g.canvas,L=g.context,C=g.options,k=g.timing,V=o.allBodies(P),z=o.allConstraints(P),W=C.wireframes?C.wireframeBackground:C.background,_=[],U=[],J,te={timestamp:A.timing.timestamp};if(c.trigger(g,"beforeRender",te),g.currentBackground!==W&&T(g,W),L.globalCompositeOperation="source-in",L.fillStyle="transparent",L.fillRect(0,0,M.width,M.height),L.globalCompositeOperation="source-over",C.hasBounds){for(J=0;J<V.length;J++){var re=V[J];u.overlaps(re.bounds,g.bounds)&&_.push(re)}for(J=0;J<z.length;J++){var oe=z[J],ue=oe.bodyA,B=oe.bodyB,O=oe.pointA,E=oe.pointB;ue&&(O=h.add(ue.position,oe.pointA)),B&&(E=h.add(B.position,oe.pointB)),!(!O||!E)&&(u.contains(g.bounds,O)||u.contains(g.bounds,E))&&U.push(oe)}n.startViewTransform(g),g.mouse&&(f.setScale(g.mouse,{x:(g.bounds.max.x-g.bounds.min.x)/g.options.width,y:(g.bounds.max.y-g.bounds.min.y)/g.options.height}),f.setOffset(g.mouse,g.bounds.min))}else U=z,_=V,g.options.pixelRatio!==1&&g.context.setTransform(g.options.pixelRatio,0,0,g.options.pixelRatio,0,0);!C.wireframes||A.enableSleeping&&C.showSleeping?n.bodies(g,_,L):(C.showConvexHulls&&n.bodyConvexHulls(g,_,L),n.bodyWireframes(g,_,L)),C.showBounds&&n.bodyBounds(g,_,L),(C.showAxes||C.showAngleIndicator)&&n.bodyAxes(g,_,L),C.showPositions&&n.bodyPositions(g,_,L),C.showVelocity&&n.bodyVelocity(g,_,L),C.showIds&&n.bodyIds(g,_,L),C.showSeparations&&n.separations(g,A.pairs.list,L),C.showCollisions&&n.collisions(g,A.pairs.list,L),C.showVertexNumbers&&n.vertexNumbers(g,_,L),C.showMousePosition&&n.mousePosition(g,g.mouse,L),n.constraints(U,L),C.hasBounds&&n.endViewTransform(g),c.trigger(g,"afterRender",te),k.lastElapsed=a.now()-S},n.stats=function(g,w,S){for(var A=g.engine,P=A.world,M=o.allBodies(P),L=0,C=55,k=44,V=0,z=0,W=0;W<M.length;W+=1)L+=M[W].parts.length;var _={Part:L,Body:M.length,Cons:o.allConstraints(P).length,Comp:o.allComposites(P).length,Pair:A.pairs.list.length};w.fillStyle="#0e0f19",w.fillRect(V,z,C*5.5,k),w.font="12px Arial",w.textBaseline="top",w.textAlign="right";for(var U in _){var J=_[U];w.fillStyle="#aaa",w.fillText(U,V+C,z+8),w.fillStyle="#eee",w.fillText(J,V+C,z+26),V+=C}},n.performance=function(g,w){var S=g.engine,A=g.timing,P=A.deltaHistory,M=A.elapsedHistory,L=A.timestampElapsedHistory,C=A.engineDeltaHistory,k=A.engineUpdatesHistory,V=A.engineElapsedHistory,z=S.timing.lastUpdatesPerFrame,W=S.timing.lastDelta,_=m(P),U=m(M),J=m(C),te=m(k),re=m(V),oe=m(L),ue=oe/_||0,B=Math.round(_/W),O=1e3/_||0,E=4,R=12,H=60,X=34,N=10,K=69;w.fillStyle="#0e0f19",w.fillRect(0,50,R*5+H*6+22,X),n.status(w,N,K,H,E,P.length,Math.round(O)+" fps",O/n._goodFps,function(Q){return P[Q]/_-1}),n.status(w,N+R+H,K,H,E,C.length,W.toFixed(2)+" dt",n._goodDelta/W,function(Q){return C[Q]/J-1}),n.status(w,N+(R+H)*2,K,H,E,k.length,z+" upf",Math.pow(a.clamp(te/B||1,0,1),4),function(Q){return k[Q]/te-1}),n.status(w,N+(R+H)*3,K,H,E,V.length,re.toFixed(2)+" ut",1-z*re/n._goodFps,function(Q){return V[Q]/re-1}),n.status(w,N+(R+H)*4,K,H,E,M.length,U.toFixed(2)+" rt",1-U/n._goodFps,function(Q){return M[Q]/U-1}),n.status(w,N+(R+H)*5,K,H,E,L.length,ue.toFixed(2)+" x",ue*ue*ue,function(Q){return(L[Q]/P[Q]/ue||0)-1})},n.status=function(g,w,S,A,P,M,L,C,k){g.strokeStyle="#888",g.fillStyle="#444",g.lineWidth=1,g.fillRect(w,S+7,A,1),g.beginPath(),g.moveTo(w,S+7-P*a.clamp(.4*k(0),-2,2));for(var V=0;V<A;V+=1)g.lineTo(w+V,S+7-(V<M?P*a.clamp(.4*k(V),-2,2):0));g.stroke(),g.fillStyle="hsl("+a.clamp(25+95*C,0,120)+",100%,60%)",g.fillRect(w,S-7,4,4),g.font="12px Arial",g.textBaseline="middle",g.textAlign="right",g.fillStyle="#eee",g.fillText(L,w+A,S-5)},n.constraints=function(g,w){for(var S=w,A=0;A<g.length;A++){var P=g[A];if(!(!P.render.visible||!P.pointA||!P.pointB)){var M=P.bodyA,L=P.bodyB,C,k;if(M?C=h.add(M.position,P.pointA):C=P.pointA,P.render.type==="pin")S.beginPath(),S.arc(C.x,C.y,3,0,2*Math.PI),S.closePath();else{if(L?k=h.add(L.position,P.pointB):k=P.pointB,S.beginPath(),S.moveTo(C.x,C.y),P.render.type==="spring")for(var V=h.sub(k,C),z=h.perp(h.normalise(V)),W=Math.ceil(a.clamp(P.length/5,12,20)),_,U=1;U<W;U+=1)_=U%2===0?1:-1,S.lineTo(C.x+V.x*(U/W)+z.x*_*4,C.y+V.y*(U/W)+z.y*_*4);S.lineTo(k.x,k.y)}P.render.lineWidth&&(S.lineWidth=P.render.lineWidth,S.strokeStyle=P.render.strokeStyle,S.stroke()),P.render.anchors&&(S.fillStyle=P.render.strokeStyle,S.beginPath(),S.arc(C.x,C.y,3,0,2*Math.PI),S.arc(k.x,k.y,3,0,2*Math.PI),S.closePath(),S.fill())}}},n.bodies=function(g,w,S){var A=S;g.engine;var P=g.options,M=P.showInternalEdges||!P.wireframes,L,C,k,V;for(k=0;k<w.length;k++)if(L=w[k],!!L.render.visible){for(V=L.parts.length>1?1:0;V<L.parts.length;V++)if(C=L.parts[V],!!C.render.visible){if(P.showSleeping&&L.isSleeping?A.globalAlpha=.5*C.render.opacity:C.render.opacity!==1&&(A.globalAlpha=C.render.opacity),C.render.sprite&&C.render.sprite.texture&&!P.wireframes){var z=C.render.sprite,W=v(g,z.texture);A.translate(C.position.x,C.position.y),A.rotate(C.angle),A.drawImage(W,W.width*-z.xOffset*z.xScale,W.height*-z.yOffset*z.yScale,W.width*z.xScale,W.height*z.yScale),A.rotate(-C.angle),A.translate(-C.position.x,-C.position.y)}else{if(C.circleRadius)A.beginPath(),A.arc(C.position.x,C.position.y,C.circleRadius,0,2*Math.PI);else{A.beginPath(),A.moveTo(C.vertices[0].x,C.vertices[0].y);for(var _=1;_<C.vertices.length;_++)!C.vertices[_-1].isInternal||M?A.lineTo(C.vertices[_].x,C.vertices[_].y):A.moveTo(C.vertices[_].x,C.vertices[_].y),C.vertices[_].isInternal&&!M&&A.moveTo(C.vertices[(_+1)%C.vertices.length].x,C.vertices[(_+1)%C.vertices.length].y);A.lineTo(C.vertices[0].x,C.vertices[0].y),A.closePath()}P.wireframes?(A.lineWidth=1,A.strokeStyle=g.options.wireframeStrokeStyle,A.stroke()):(A.fillStyle=C.render.fillStyle,C.render.lineWidth&&(A.lineWidth=C.render.lineWidth,A.strokeStyle=C.render.strokeStyle,A.stroke()),A.fill())}A.globalAlpha=1}}},n.bodyWireframes=function(g,w,S){var A=S,P=g.options.showInternalEdges,M,L,C,k,V;for(A.beginPath(),C=0;C<w.length;C++)if(M=w[C],!!M.render.visible)for(V=M.parts.length>1?1:0;V<M.parts.length;V++){for(L=M.parts[V],A.moveTo(L.vertices[0].x,L.vertices[0].y),k=1;k<L.vertices.length;k++)!L.vertices[k-1].isInternal||P?A.lineTo(L.vertices[k].x,L.vertices[k].y):A.moveTo(L.vertices[k].x,L.vertices[k].y),L.vertices[k].isInternal&&!P&&A.moveTo(L.vertices[(k+1)%L.vertices.length].x,L.vertices[(k+1)%L.vertices.length].y);A.lineTo(L.vertices[0].x,L.vertices[0].y)}A.lineWidth=1,A.strokeStyle=g.options.wireframeStrokeStyle,A.stroke()},n.bodyConvexHulls=function(g,w,S){var A=S,P,M,L;for(A.beginPath(),M=0;M<w.length;M++)if(P=w[M],!(!P.render.visible||P.parts.length===1)){for(A.moveTo(P.vertices[0].x,P.vertices[0].y),L=1;L<P.vertices.length;L++)A.lineTo(P.vertices[L].x,P.vertices[L].y);A.lineTo(P.vertices[0].x,P.vertices[0].y)}A.lineWidth=1,A.strokeStyle="rgba(255,255,255,0.2)",A.stroke()},n.vertexNumbers=function(g,w,S){var A=S,P,M,L;for(P=0;P<w.length;P++){var C=w[P].parts;for(L=C.length>1?1:0;L<C.length;L++){var k=C[L];for(M=0;M<k.vertices.length;M++)A.fillStyle="rgba(255,255,255,0.2)",A.fillText(P+"_"+M,k.position.x+(k.vertices[M].x-k.position.x)*.8,k.position.y+(k.vertices[M].y-k.position.y)*.8)}}},n.mousePosition=function(g,w,S){var A=S;A.fillStyle="rgba(255,255,255,0.8)",A.fillText(w.position.x+"  "+w.position.y,w.position.x+5,w.position.y-5)},n.bodyBounds=function(g,w,S){var A=S;g.engine;var P=g.options;A.beginPath();for(var M=0;M<w.length;M++){var L=w[M];if(L.render.visible)for(var C=w[M].parts,k=C.length>1?1:0;k<C.length;k++){var V=C[k];A.rect(V.bounds.min.x,V.bounds.min.y,V.bounds.max.x-V.bounds.min.x,V.bounds.max.y-V.bounds.min.y)}}P.wireframes?A.strokeStyle="rgba(255,255,255,0.08)":A.strokeStyle="rgba(0,0,0,0.1)",A.lineWidth=1,A.stroke()},n.bodyAxes=function(g,w,S){var A=S;g.engine;var P=g.options,M,L,C,k;for(A.beginPath(),L=0;L<w.length;L++){var V=w[L],z=V.parts;if(V.render.visible)if(P.showAxes)for(C=z.length>1?1:0;C<z.length;C++)for(M=z[C],k=0;k<M.axes.length;k++){var W=M.axes[k];A.moveTo(M.position.x,M.position.y),A.lineTo(M.position.x+W.x*20,M.position.y+W.y*20)}else for(C=z.length>1?1:0;C<z.length;C++)for(M=z[C],k=0;k<M.axes.length;k++)A.moveTo(M.position.x,M.position.y),A.lineTo((M.vertices[0].x+M.vertices[M.vertices.length-1].x)/2,(M.vertices[0].y+M.vertices[M.vertices.length-1].y)/2)}P.wireframes?(A.strokeStyle="indianred",A.lineWidth=1):(A.strokeStyle="rgba(255, 255, 255, 0.4)",A.globalCompositeOperation="overlay",A.lineWidth=2),A.stroke(),A.globalCompositeOperation="source-over"},n.bodyPositions=function(g,w,S){var A=S;g.engine;var P=g.options,M,L,C,k;for(A.beginPath(),C=0;C<w.length;C++)if(M=w[C],!!M.render.visible)for(k=0;k<M.parts.length;k++)L=M.parts[k],A.arc(L.position.x,L.position.y,3,0,2*Math.PI,!1),A.closePath();for(P.wireframes?A.fillStyle="indianred":A.fillStyle="rgba(0,0,0,0.5)",A.fill(),A.beginPath(),C=0;C<w.length;C++)M=w[C],M.render.visible&&(A.arc(M.positionPrev.x,M.positionPrev.y,2,0,2*Math.PI,!1),A.closePath());A.fillStyle="rgba(255,165,0,0.8)",A.fill()},n.bodyVelocity=function(g,w,S){var A=S;A.beginPath();for(var P=0;P<w.length;P++){var M=w[P];if(M.render.visible){var L=r.getVelocity(M);A.moveTo(M.position.x,M.position.y),A.lineTo(M.position.x+L.x,M.position.y+L.y)}}A.lineWidth=3,A.strokeStyle="cornflowerblue",A.stroke()},n.bodyIds=function(g,w,S){var A=S,P,M;for(P=0;P<w.length;P++)if(w[P].render.visible){var L=w[P].parts;for(M=L.length>1?1:0;M<L.length;M++){var C=L[M];A.font="12px Arial",A.fillStyle="rgba(255,255,255,0.5)",A.fillText(C.id,C.position.x+10,C.position.y-10)}}},n.collisions=function(g,w,S){var A=S,P=g.options,M,L,C,k;for(A.beginPath(),C=0;C<w.length;C++)if(M=w[C],!!M.isActive)for(L=M.collision,k=0;k<M.contactCount;k++){var V=M.contacts[k],z=V.vertex;A.rect(z.x-1.5,z.y-1.5,3.5,3.5)}for(P.wireframes?A.fillStyle="rgba(255,255,255,0.7)":A.fillStyle="orange",A.fill(),A.beginPath(),C=0;C<w.length;C++)if(M=w[C],!!M.isActive&&(L=M.collision,M.contactCount>0)){var W=M.contacts[0].vertex.x,_=M.contacts[0].vertex.y;M.contactCount===2&&(W=(M.contacts[0].vertex.x+M.contacts[1].vertex.x)/2,_=(M.contacts[0].vertex.y+M.contacts[1].vertex.y)/2),L.bodyB===L.supports[0].body||L.bodyA.isStatic===!0?A.moveTo(W-L.normal.x*8,_-L.normal.y*8):A.moveTo(W+L.normal.x*8,_+L.normal.y*8),A.lineTo(W,_)}P.wireframes?A.strokeStyle="rgba(255,165,0,0.7)":A.strokeStyle="orange",A.lineWidth=1,A.stroke()},n.separations=function(g,w,S){var A=S,P=g.options,M,L,C,k,V;for(A.beginPath(),V=0;V<w.length;V++)if(M=w[V],!!M.isActive){L=M.collision,C=L.bodyA,k=L.bodyB;var z=1;!k.isStatic&&!C.isStatic&&(z=.5),k.isStatic&&(z=0),A.moveTo(k.position.x,k.position.y),A.lineTo(k.position.x-L.penetration.x*z,k.position.y-L.penetration.y*z),z=1,!k.isStatic&&!C.isStatic&&(z=.5),C.isStatic&&(z=0),A.moveTo(C.position.x,C.position.y),A.lineTo(C.position.x+L.penetration.x*z,C.position.y+L.penetration.y*z)}P.wireframes?A.strokeStyle="rgba(255,165,0,0.5)":A.strokeStyle="orange",A.stroke()},n.inspector=function(g,w){g.engine;var S=g.selected,A=g.render,P=A.options,M;if(P.hasBounds){var L=A.bounds.max.x-A.bounds.min.x,C=A.bounds.max.y-A.bounds.min.y,k=L/A.options.width,V=C/A.options.height;w.scale(1/k,1/V),w.translate(-A.bounds.min.x,-A.bounds.min.y)}for(var z=0;z<S.length;z++){var W=S[z].data;switch(w.translate(.5,.5),w.lineWidth=1,w.strokeStyle="rgba(255,165,0,0.9)",w.setLineDash([1,2]),W.type){case"body":M=W.bounds,w.beginPath(),w.rect(Math.floor(M.min.x-3),Math.floor(M.min.y-3),Math.floor(M.max.x-M.min.x+6),Math.floor(M.max.y-M.min.y+6)),w.closePath(),w.stroke();break;case"constraint":var _=W.pointA;W.bodyA&&(_=W.pointB),w.beginPath(),w.arc(_.x,_.y,10,0,2*Math.PI),w.closePath(),w.stroke();break}w.setLineDash([]),w.translate(-.5,-.5)}g.selectStart!==null&&(w.translate(.5,.5),w.lineWidth=1,w.strokeStyle="rgba(255,165,0,0.6)",w.fillStyle="rgba(255,165,0,0.1)",M=g.selectBounds,w.beginPath(),w.rect(Math.floor(M.min.x),Math.floor(M.min.y),Math.floor(M.max.x-M.min.x),Math.floor(M.max.y-M.min.y)),w.closePath(),w.stroke(),w.fill(),w.translate(-.5,-.5)),P.hasBounds&&w.setTransform(1,0,0,1,0,0)};var p=function(g,w){var S=g.engine,A=g.timing,P=A.historySize,M=S.timing.timestamp;A.delta=w-A.lastTime||n._goodDelta,A.lastTime=w,A.timestampElapsed=M-A.lastTimestamp||0,A.lastTimestamp=M,A.deltaHistory.unshift(A.delta),A.deltaHistory.length=Math.min(A.deltaHistory.length,P),A.engineDeltaHistory.unshift(S.timing.lastDelta),A.engineDeltaHistory.length=Math.min(A.engineDeltaHistory.length,P),A.timestampElapsedHistory.unshift(A.timestampElapsed),A.timestampElapsedHistory.length=Math.min(A.timestampElapsedHistory.length,P),A.engineUpdatesHistory.unshift(S.timing.lastUpdatesPerFrame),A.engineUpdatesHistory.length=Math.min(A.engineUpdatesHistory.length,P),A.engineElapsedHistory.unshift(S.timing.lastElapsed),A.engineElapsedHistory.length=Math.min(A.engineElapsedHistory.length,P),A.elapsedHistory.unshift(A.lastElapsed),A.elapsedHistory.length=Math.min(A.elapsedHistory.length,P)},m=function(g){for(var w=0,S=0;S<g.length;S+=1)w+=g[S];return w/g.length||0},x=function(g,w){var S=document.createElement("canvas");return S.width=g,S.height=w,S.oncontextmenu=function(){return!1},S.onselectstart=function(){return!1},S},b=function(g){var w=g.getContext("2d"),S=window.devicePixelRatio||1,A=w.webkitBackingStorePixelRatio||w.mozBackingStorePixelRatio||w.msBackingStorePixelRatio||w.oBackingStorePixelRatio||w.backingStorePixelRatio||1;return S/A},v=function(g,w){var S=g.textures[w];return S||(S=g.textures[w]=new Image,S.src=w,S)},T=function(g,w){var S=w;/(jpg|gif|png)$/.test(w)&&(S="url("+w+")"),g.canvas.style.background=S,g.canvas.style.backgroundSize="contain",g.currentBackground=w}})()},function(t,s,i){var n={};t.exports=n;var r=i(5),a=i(17),o=i(0);(function(){n._maxFrameDelta=1e3/15,n._frameDeltaFallback=1e3/60,n._timeBufferMargin=1.5,n._elapsedNextEstimate=1,n._smoothingLowerBound=.1,n._smoothingUpperBound=.9,n.create=function(c){var h={delta:16.666666666666668,frameDelta:null,frameDeltaSmoothing:!0,frameDeltaSnapping:!0,frameDeltaHistory:[],frameDeltaHistorySize:100,frameRequestId:null,timeBuffer:0,timeLastTick:null,maxUpdates:null,maxFrameTime:33.333333333333336,lastUpdatesDeferred:0,enabled:!0},f=o.extend(h,c);return f.fps=0,f},n.run=function(c,h){return c.timeBuffer=n._frameDeltaFallback,function f(l){c.frameRequestId=n._onNextFrame(c,f),l&&c.enabled&&n.tick(c,h,l)}(),c},n.tick=function(c,h,f){var l=o.now(),d=c.delta,p=0,m=f-c.timeLastTick;if((!m||!c.timeLastTick||m>Math.max(n._maxFrameDelta,c.maxFrameTime))&&(m=c.frameDelta||n._frameDeltaFallback),c.frameDeltaSmoothing){c.frameDeltaHistory.push(m),c.frameDeltaHistory=c.frameDeltaHistory.slice(-c.frameDeltaHistorySize);var x=c.frameDeltaHistory.slice(0).sort(),b=c.frameDeltaHistory.slice(x.length*n._smoothingLowerBound,x.length*n._smoothingUpperBound),v=u(b);m=v||m}c.frameDeltaSnapping&&(m=1e3/Math.round(1e3/m)),c.frameDelta=m,c.timeLastTick=f,c.timeBuffer+=c.frameDelta,c.timeBuffer=o.clamp(c.timeBuffer,0,c.frameDelta+d*n._timeBufferMargin),c.lastUpdatesDeferred=0;var T=c.maxUpdates||Math.ceil(c.maxFrameTime/d),g={timestamp:h.timing.timestamp};r.trigger(c,"beforeTick",g),r.trigger(c,"tick",g);for(var w=o.now();d>0&&c.timeBuffer>=d*n._timeBufferMargin;){r.trigger(c,"beforeUpdate",g),a.update(h,d),r.trigger(c,"afterUpdate",g),c.timeBuffer-=d,p+=1;var S=o.now()-l,A=o.now()-w,P=S+n._elapsedNextEstimate*A/p;if(p>=T||P>c.maxFrameTime){c.lastUpdatesDeferred=Math.round(Math.max(0,c.timeBuffer/d-n._timeBufferMargin));break}}h.timing.lastUpdatesPerFrame=p,r.trigger(c,"afterTick",g),c.frameDeltaHistory.length>=100&&(c.lastUpdatesDeferred&&Math.round(c.frameDelta/d)>T?o.warnOnce("Matter.Runner: runner reached runner.maxUpdates, see docs."):c.lastUpdatesDeferred&&o.warnOnce("Matter.Runner: runner reached runner.maxFrameTime, see docs."),typeof c.isFixed<"u"&&o.warnOnce("Matter.Runner: runner.isFixed is now redundant, see docs."),(c.deltaMin||c.deltaMax)&&o.warnOnce("Matter.Runner: runner.deltaMin and runner.deltaMax were removed, see docs."),c.fps!==0&&o.warnOnce("Matter.Runner: runner.fps was replaced by runner.delta, see docs."))},n.stop=function(c){n._cancelNextFrame(c)},n._onNextFrame=function(c,h){if(typeof window<"u"&&window.requestAnimationFrame)c.frameRequestId=window.requestAnimationFrame(h);else throw new Error("Matter.Runner: missing required global window.requestAnimationFrame.");return c.frameRequestId},n._cancelNextFrame=function(c){if(typeof window<"u"&&window.cancelAnimationFrame)window.cancelAnimationFrame(c.frameRequestId);else throw new Error("Matter.Runner: missing required global window.cancelAnimationFrame.")};var u=function(c){for(var h=0,f=c.length,l=0;l<f;l+=1)h+=c[l];return h/f||0}})()},function(t,s,i){var n={};t.exports=n;var r=i(8),a=i(0),o=a.deprecated;(function(){n.collides=function(u,c){return r.collides(u,c)},o(n,"collides","SAT.collides  replaced by Collision.collides")})()},function(t,s,i){var n={};t.exports=n,i(1);var r=i(0);(function(){n.pathToVertices=function(a,o){typeof window<"u"&&!("SVGPathSeg"in window)&&r.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var u,c,h,f,l,d,p,m,x,b,v=[],T,g,w=0,S=0,A=0;o=o||15;var P=function(L,C,k){var V=k%2===1&&k>1;if(!x||L!=x.x||C!=x.y){x&&V?(T=x.x,g=x.y):(T=0,g=0);var z={x:T+L,y:g+C};(V||!x)&&(x=z),v.push(z),S=T+L,A=g+C}},M=function(L){var C=L.pathSegTypeAsLetter.toUpperCase();if(C!=="Z"){switch(C){case"M":case"L":case"T":case"C":case"S":case"Q":S=L.x,A=L.y;break;case"H":S=L.x;break;case"V":A=L.y;break}P(S,A,L.pathSegType)}};for(n._svgPathToAbsolute(a),h=a.getTotalLength(),d=[],u=0;u<a.pathSegList.numberOfItems;u+=1)d.push(a.pathSegList.getItem(u));for(p=d.concat();w<h;){if(b=a.getPathSegAtLength(w),l=d[b],l!=m){for(;p.length&&p[0]!=l;)M(p.shift());m=l}switch(l.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":f=a.getPointAtLength(w),P(f.x,f.y,0);break}w+=o}for(u=0,c=p.length;u<c;++u)M(p[u]);return v},n._svgPathToAbsolute=function(a){for(var o,u,c,h,f,l,d=a.pathSegList,p=0,m=0,x=d.numberOfItems,b=0;b<x;++b){var v=d.getItem(b),T=v.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(T))"x"in v&&(p=v.x),"y"in v&&(m=v.y);else switch("x1"in v&&(c=p+v.x1),"x2"in v&&(f=p+v.x2),"y1"in v&&(h=m+v.y1),"y2"in v&&(l=m+v.y2),"x"in v&&(p+=v.x),"y"in v&&(m+=v.y),T){case"m":d.replaceItem(a.createSVGPathSegMovetoAbs(p,m),b);break;case"l":d.replaceItem(a.createSVGPathSegLinetoAbs(p,m),b);break;case"h":d.replaceItem(a.createSVGPathSegLinetoHorizontalAbs(p),b);break;case"v":d.replaceItem(a.createSVGPathSegLinetoVerticalAbs(m),b);break;case"c":d.replaceItem(a.createSVGPathSegCurvetoCubicAbs(p,m,c,h,f,l),b);break;case"s":d.replaceItem(a.createSVGPathSegCurvetoCubicSmoothAbs(p,m,f,l),b);break;case"q":d.replaceItem(a.createSVGPathSegCurvetoQuadraticAbs(p,m,c,h),b);break;case"t":d.replaceItem(a.createSVGPathSegCurvetoQuadraticSmoothAbs(p,m),b);break;case"a":d.replaceItem(a.createSVGPathSegArcAbs(p,m,v.r1,v.r2,v.angle,v.largeArcFlag,v.sweepFlag),b);break;case"z":case"Z":p=o,m=u;break}(T=="M"||T=="m")&&(o=p,u=m)}}})()},function(t,s,i){var n={};t.exports=n;var r=i(6);i(0),function(){n.create=r.create,n.add=r.add,n.remove=r.remove,n.clear=r.clear,n.addComposite=r.addComposite,n.addBody=r.addBody,n.addConstraint=r.addConstraint}()}])})})(ta);class na{constructor(e,t){this.scene=e,this.object=t,this.keys={w:e.input.keyboard.addKey("w"),a:e.input.keyboard.addKey("a"),s:e.input.keyboard.addKey("s"),d:e.input.keyboard.addKey("d"),space:e.input.keyboard.addKey("space")},this.object.body.setAngularFactor(0,0,0),this.object.body.setFriction(.8)}update(){if(!this.object||!this.object.body)return;const e=6,t=7,s=this.object.body.velocity;let i=0,n=0;this.keys.w.isDown&&(n=-e),this.keys.s.isDown&&(n=e),this.keys.a.isDown&&(i=-e),this.keys.d.isDown&&(i=e),this.object.body.setVelocity(i,s.y,n);const r=Math.abs(s.y)<.1;mt.Input.Keyboard.JustDown(this.keys.space)&&r&&this.object.body.applyForceY(t)}}class sa extends Zo{constructor(){super({key:"MainScene"}),this.player=null,this.helper=null,this.flag=null,this.floor=null,this.isGameOver=!1,this.uiElements=[]}init(){this.accessThirdDimension()}preload(){this.third.load.preload("chip","src/assets/chip.glb"),this.third.load.preload("cube","src/assets/cube.glb"),this.third.load.preload("flag","src/assets/flag.glb"),this.third.load.preload("platform","src/assets/platform.glb")}async create(){var e;(e=this.third.physics.debug)==null||e.enable(),this.isGameOver=!1,this.uiElements=[],this.warpSpeed("-ground"),this.floor=this.third.add.box({width:100,height:1,depth:100,y:-10,color:16777215}),this.third.physics.add.existing(this.floor,{mass:0}),await this.loadStaticLevel(),await this.spawnCube(),await this.spawnPlayer()}async spawnPlayer(){const t=(await this.third.load.gltf("chip")).scene.clone();t.name="player",t.scale.set(1,1,1),t.position.set(9,3,0),t.rotation.y=Math.PI,this.third.add.existing(t),this.third.physics.add.existing(t,{shape:"box",height:2.5,width:1.6,depth:1.6,mass:1}),this.player=new na(this,t),this.third.physics.add.collider(t,this.floor,()=>{this.displayEndScreen("GAME OVER","#ff0000")})}async spawnCube(){const t=(await this.third.load.gltf("cube")).scene.clone();t.scale.set(1,1,1),t.position.set(5,2,0),this.third.add.existing(t),this.third.physics.add.existing(t,{shape:"box",width:2,depth:2,height:2,mass:1}),this.helper=t,this.third.physics.add.collider(this.helper,this.floor,()=>{this.displayEndScreen("GAME OVER","#ff0000")})}async loadStaticLevel(){const e=await this.third.load.gltf("flag");this.flag=e.scene.clone(),this.flag.scale.set(1,1,1),this.flag.position.set(-9,5.5,0),this.third.add.existing(this.flag),this.third.physics.add.existing(this.flag,{shape:"box",width:1.2,depth:1.2,height:7.6,mass:0});const t=async s=>{const n=(await this.third.load.gltf("platform")).scene.clone();n.scale.set(1,1,1),n.position.set(s,1,0),this.third.add.existing(n),this.third.physics.add.existing(n,{shape:"box",width:8,height:2,depth:2,mass:0})};await t(6),await t(-6)}displayEndScreen(e,t){if(this.isGameOver)return;this.isGameOver=!0;const s=this.cameras.main.width,i=this.cameras.main.height,n=this.add.text(s/2,i/2-50,e,{fontSize:"64px",fontStyle:"bold",color:t,stroke:"#000000",strokeThickness:6}).setOrigin(.5),r=this.add.text(s/2,i/2+50,"Click to Restart",{fontSize:"32px",color:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(.5);this.uiElements.push(n,r),this.input.once("pointerdown",()=>{this.resetLevel()})}resetLevel(){console.log("Resetting Level..."),this.scene.restart()}update(){var e,t;this.isGameOver||(t=(e=this.player)==null?void 0:e.object)!=null&&t.body&&(this.player.update(),this.third.camera.lookAt(this.player.object.position),this.flag&&this.player.object.position.distanceTo(this.flag.position)<2.5&&this.displayEndScreen("YOU WIN!","#00ff00"),this.player.object.position.y<-30&&this.displayEndScreen("GAME OVER","#ff0000"))}}const ia={type:mt.WEBGL,transparent:!0,scale:{mode:mt.Scale.FIT,autoCenter:mt.Scale.CENTER_BOTH,width:1280,height:720},enable3d:{ammo:{gravity:{x:0,y:-9.81,z:0}},debug:!0},scene:[sa],...ea()};window.addEventListener("load",()=>{$o(()=>new mt.Game(ia)).withPhysics("/lib")});
