import{c as pt,p as Gs,P as Ft}from"./phaser-c453c2dd.js";import{P as Mt,O as An,E as Ve,Q as Me,a as et,V as j,A as Jn,L as Ws,M as Te,b as ie,R as es,B as Tn,c as bn,d as ts,e as _t,f as js,g as yt,D as Sn,S as zt,h as Xs,i as Ie,C as Ks,j as Ys,k as Qs,T as qs,l as ns,m as Pt,n as Zs,o as Ke,p as mt,q as Gt,r as $s,s as Ne,t as _e,u as He,v as In,w as ss,x as is,y as it,z as Js,F as Ee,G as ei,W as rs,H as ti,I as ni,J as je,K as si,N as xt,U as Vt,X as Ct,Y as Wt,Z as Xe,_ as hn,$ as Nt,a0 as he,a1 as Ue,a2 as ii,a3 as ct,a4 as dn,a5 as vt,a6 as Ht,a7 as Mn,a8 as Pn,a9 as os,aa as as,ab as ls,ac as ri,ad as Ze,ae as cs,af as us,ag as pn,ah as mn,ai as oi,aj as gn,ak as fs,al as se,am as ai,an as li,ao as ci,ap as hs,aq as ds,ar as Zt,as as ui,at as ps,au as fi,av as hi,aw as di,ax as pi,ay as mi,az as gi,aA as yi,aB as xi,aC as vi,aD as wi,aE as Ai,aF as Ti,aG as bi,aH as $t,aI as tt,aJ as Si,aK as Mi,aL as Pi,aM as Ci,aN as Ei,aO as Ri,aP as Li,aQ as ot,aR as at,aS as On,aT as jt,aU as Ii,aV as ms,aW as gs,aX as Cn,aY as ys,aZ as xs,a_ as Oi,a$ as Di,b0 as vs,b1 as ki}from"./three-d92eb69f.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const t of i)if(t.type==="childList")for(const r of t.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function n(i){const t={};return i.integrity&&(t.integrity=i.integrity),i.referrerPolicy&&(t.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?t.credentials="include":i.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function s(i){if(i.ep)return;i.ep=!0;const t=n(i);fetch(i.href,t)}})();/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class wt{perspectiveCamera(e={}){return wt.Perspective(e)}orthographicCamera(e={}){return wt.Orthographic(e)}static Perspective(e={}){const{fov:n=50,aspect:s=window.innerWidth/window.innerHeight,near:i=.1,far:t=2e3,x:r=0,y:a=5,z:o=25}=e,u=new Mt(n,s,i,t);return u.position.set(r,a,o),u}static Orthographic(e={}){const n=window.innerWidth,s=window.innerHeight,{left:i=n/-2,right:t=n/2,top:r=s/2,bottom:a=s/-2,near:o=1,far:u=1e3,x:c=0,y:f=0,z:h=10}=e,l=new An(i,t,r,a,o,u);return l.position.set(c,f,h),l}}const It=new Map,Fi=5,Ae=(y,e=!1)=>{if(!It.has(y))It.set(y,1);else{const n=It.get(y);if(typeof n>"u"||n>=Fi)return;It.set(y,n+1)}e?console.error(`%c [enable3d] ${y} `,"background: #222; color: #bada55"):console.warn(`%c [enable3d] ${y} `,"background: #222; color: #bada55")};var En={},Xt={};Object.defineProperty(Xt,"__esModule",{value:!0});Xt.VERSION=void 0;Xt.VERSION="0.0.5";/**
 * @package      npmjs.com/package/@yandeu/events (events.min.js)
 *
 * @author       Arnout Kazemier (https://github.com/3rd-Eden)
 * @copyright    Copyright (c) 2014 Arnout Kazemier
 * @license      {@link https://github.com/primus/eventemitter3/blob/master/LICENSE|MIT}
 *
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/yandeu/events
 * @license      {@link https://github.com/yandeu/events/blob/master/LICENSE|MIT}
 */var Dn=pt&&pt.__spreadArray||function(y,e){for(var n=0,s=e.length,i=y.length;n<s;n++,i++)y[i]=e[n];return y};Object.defineProperty(En,"__esModule",{value:!0});var At=En.Events=void 0,Bi=Xt,Vi=function(){function y(e,n,s){s===void 0&&(s=!1),this.fn=e,this.context=n,this.once=s}return y}(),kn=function(y,e,n,s,i){if(typeof n!="function")throw new TypeError("The listener must be a function");var t=new Vi(n,s||y,i);return y._events.has(e)?y._events.get(e).fn?y._events.set(e,[y._events.get(e),t]):y._events.get(e).push(t):(y._events.set(e,t),y._eventsCount++),y},Ot=function(y,e){--y._eventsCount===0?y._events=new Map:y._events.delete(e)},Ni=function(){function y(){this._events=new Map,this._eventsCount=0}return Object.defineProperty(y,"VERSION",{get:function(){return Bi.VERSION},enumerable:!1,configurable:!0}),y.prototype.eventNames=function(){return Array.from(this._events.keys())},y.prototype.listeners=function(e){var n=this._events.get(e);if(!n)return[];if(n.fn)return[n.fn];for(var s=0,i=n.length,t=new Array(i);s<i;s++)t[s]=n[s].fn;return t},y.prototype.listenerCount=function(e){var n=this._events.get(e);return n?n.fn?1:n.length:0},y.prototype.emit=function(e){for(var n,s,i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];if(!this._events.has(e))return!1;var r=this._events.get(e),a;if(r.fn)return r.once&&this.removeListener(e,r.fn,void 0,!0),(n=r.fn).call.apply(n,Dn([r.context],i)),!0;var o=r.length;for(a=0;a<o;a++)r[a].once&&this.removeListener(e,r[a].fn,void 0,!0),(s=r[a].fn).call.apply(s,Dn([r[a].context],i));return!0},y.prototype.on=function(e,n,s){return kn(this,e,n,s,!1)},y.prototype.once=function(e,n,s){return kn(this,e,n,s,!0)},y.prototype.removeListener=function(e,n,s,i){if(!this._events.has(e))return this;if(!n)return Ot(this,e),this;var t=this._events.get(e);if(t.fn)t.fn===n&&(!i||t.once)&&(!s||t.context===s)&&Ot(this,e);else{for(var r=0,a=[],o=t.length;r<o;r++)(t[r].fn!==n||i&&!t[r].once||s&&t[r].context!==s)&&a.push(t[r]);a.length?this._events.set(e,a.length===1?a[0]:a):Ot(this,e)}return this},y.prototype.removeAllListeners=function(e){return e?this._events.delete(e)&&Ot(this,e):(this._events=new Map,this._eventsCount=0),this},Object.defineProperty(y.prototype,"off",{get:function(){return this.removeListener},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"addListener",{get:function(){return this.on},enumerable:!1,configurable:!0}),y}();At=En.Events=Ni;/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Hi{constructor(e,n){this.physics=e,this.ammo=n,this.ignoreScale=!1,this.isSoftBody=!1,this.offset={x:0,y:0,z:0},this.errors=[],this.checkCollisions=!1,this.impact=[],this.breakable=!1,this.fractureImpulse=1,this.didUpdate=!1,this.skipUpdate=!1,this._emitUpdateEvents=!1,this._needUpdate=!1,this.tmpEuler=new Ve,this.tmpQuaternion=new Me,this.tmpBtVector3=new Ammo.btVector3,this.tmpBtVector3_1=new Ammo.btVector3,this.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),this.eventEmitter=new At,this.name=n.name}destructor(){this.eventEmitter&&this.eventEmitter.removeAllListeners(),Ammo.destroy(this.tmpBtVector3),Ammo.destroy(this.tmpBtVector3_1),Ammo.destroy(this.tmpBtQuaternion),Ammo.destroy(this.ammo.getCollisionShape()),Ammo.destroy(this.ammo)}setupEventEmitter(){typeof this.eventEmitter>"u"&&(this.eventEmitter=new At)}get needUpdate(){return this._needUpdate}set needUpdate(e){!e&&this._needUpdate&&(this.didUpdate=!0),this._needUpdate=e}onUpdateEvent(e,n=!1){this.setupEventEmitter(),this._emitUpdateEvents=!0,n?this.eventEmitter.once("update",()=>{e()}):this.eventEmitter.on("update",()=>{e()})}get on(){return{update:e=>this.onUpdateEvent(e),collision:e=>this.onCollision(e)}}get once(){return{update:e=>this.onUpdateEvent(e,!0)}}onCollision(e){this.checkCollisions=!0,this.physics.collisionEvents.on("collision",n=>{const{bodies:s,event:i}=n;s[0].name===this.name?e(s[1],i):s[1].name===this.name&&e(s[0],i)})}transform(){const e=this.physics.worldTransform;this.ammo.getMotionState().getWorldTransform(e)}refresh(){const e=this.physics.worldTransform;this.ammo.getMotionState().setWorldTransform(e)}setRotation(e,n,s){const i=this.tmpEuler.set(e,n,s),t=this.tmpQuaternion.set(0,0,0,1);t.setFromEuler(i),this.tmpBtQuaternion.setValue(0,0,0,1);const r=this.tmpBtQuaternion;r.setValue(t.x,t.y,t.z,t.w),this.physics.worldTransform.setRotation(r)}get rotation(){let e,n,s;const t=this.physics.worldTransform.getRotation();let r=this.tmpQuaternion.set(t.x(),t.y(),t.z(),t.w());r.w>1&&(r=r.normalize());const a=2*Math.acos(r.w),o=Math.sqrt(1-r.w*r.w);return o<.001?(e=r.x,n=r.y,s=r.z):(e=r.x/o,n=r.y/o,s=r.z/o),{x:e*a,y:n*a,z:s*a}}get quaternion(){const n=this.physics.worldTransform.getRotation();return{x:n.x(),y:n.y(),z:n.z(),w:n.w()}}setPosition(e,n,s){this.physics.worldTransform.getOrigin().setValue(e,n,s)}get position(){const e=this.physics.worldTransform;return{x:e.getOrigin().x(),y:e.getOrigin().y(),z:e.getOrigin().z()}}get velocity(){return{x:this.ammo.getLinearVelocity().x(),y:this.ammo.getLinearVelocity().y(),z:this.ammo.getLinearVelocity().z()}}get angularVelocity(){return{x:this.ammo.getAngularVelocity().x(),y:this.ammo.getAngularVelocity().y(),z:this.ammo.getAngularVelocity().z()}}setVelocity(e,n,s){this.tmpBtVector3.setValue(e,n,s),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityX(e){this.tmpBtVector3.setValue(e,this.velocity.y,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityY(e){this.tmpBtVector3.setValue(this.velocity.x,e,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityZ(e){this.tmpBtVector3.setValue(this.velocity.x,this.velocity.y,e),this.ammo.setLinearVelocity(this.tmpBtVector3)}setAngularVelocity(e,n,s){this.tmpBtVector3.setValue(e,n,s),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityX(e){this.tmpBtVector3.setValue(e,this.angularVelocity.y,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityY(e){this.tmpBtVector3.setValue(this.angularVelocity.x,e,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityZ(e){this.tmpBtVector3.setValue(this.angularVelocity.x,this.angularVelocity.y,e),this.ammo.setAngularVelocity(this.tmpBtVector3)}applyForce(e,n,s){this.tmpBtVector3.setValue(e,n,s),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceX(e){this.tmpBtVector3.setValue(e,0,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceY(e){this.tmpBtVector3.setValue(0,e,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceZ(e){this.tmpBtVector3.setValue(0,0,e),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyCentralForce(e,n,s){this.tmpBtVector3.setValue(e,n,s),this.ammo.applyCentralForce(this.tmpBtVector3)}applyCentralImpulse(e,n,s){this.tmpBtVector3.setValue(e,n,s),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyCentralLocalForce(e,n,s){this.tmpBtVector3.setValue(e,n,s),this.ammo.applyCentralLocalForce(this.tmpBtVector3)}applyImpulse(e,n){this.tmpBtVector3.setValue(e.x||0,e.y||0,e.z||0),this.tmpBtVector3_1.setValue(n.x||0,n.y||0,n.z||0),this.ammo.applyImpulse(this.tmpBtVector3,this.tmpBtVector3_1)}applyLocalTorque(e,n,s){this.tmpBtVector3.setValue(e,n,s),this.ammo.applyLocalTorque(this.tmpBtVector3)}applyTorque(e,n,s){this.tmpBtVector3.setValue(e,n,s),this.ammo.applyTorque(this.tmpBtVector3)}applyTorqueImpulse(e,n,s){this.tmpBtVector3.setValue(e,n,s),this.ammo.applyTorqueImpulse(this.tmpBtVector3)}setCollisionFlags(e){this.ammo.setCollisionFlags(e)}getCollisionFlags(){return this.ammo.getCollisionFlags()}setRestitution(e){this.ammo.setRestitution(e)}setBounciness(e){this.setRestitution(e)}setFriction(e){this.ammo.setFriction(e)}setDamping(e,n){this.ammo.setDamping(e,n)}setGravity(e,n,s){this.tmpBtVector3.setValue(e,n,s),this.ammo.setGravity(this.tmpBtVector3)}setLinearFactor(e,n,s){this.tmpBtVector3.setValue(e,n,s),this.ammo.setLinearFactor(this.tmpBtVector3)}setAngularFactor(e,n,s){this.tmpBtVector3.setValue(e,n,s),this.ammo.setAngularFactor(this.tmpBtVector3)}setCcdMotionThreshold(e){this.ammo.setCcdMotionThreshold(e)}setCcdSweptSphereRadius(e){this.ammo.setCcdSweptSphereRadius(e)}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Ui extends et{constructor(){super(),this.isExtendedObject3D=!0,this.isGroup=!1,this.vector3=new j,this.hasBody=!1,this.fragmentDepth=0,this.breakable=!1,this.fractureImpulse=1,this._currentAnimation="",this._animationActions=new Map,this.name=`object-${this.id}`}get world(){return{theta:this.worldTheta,phi:this.worldPhi}}get worldTheta(){return this.getWorldDirection(this.vector3),Math.atan2(this.vector3.x,this.vector3.z)}get worldPhi(){return this.getWorldDirection(this.vector3),Math.acos(this.vector3.y)}set animationMixer(e){this._animationMixer=e}get animationMixer(){return this._animationMixer||(this._animationMixer=new Jn(this)),this._animationMixer}get anims(){return{current:this._currentAnimation,add:(e,n)=>this._animsAdd(e,n),get:e=>this._animsGet(e),play:(e,n=500,s=!0)=>this._animsPlay(e,n,s),mixer:this.animationMixer}}get animation(){return Ae('Please use "anims" instead of "animation"'),this.anims}_animsAdd(e,n){this._animationActions.set(e,this.animationMixer.clipAction(n))}_animsGet(e){const n=this._animationActions.get(e);return n||Ae(`Animation(${e}) not found!`),n}_animsPlay(e,n=500,s=!0){const i=this._animationActions.get(e),t=this._animationActions.get(this._currentAnimation);i&&(i.reset(),t&&(i.crossFadeFrom(t,n/1e3,!0),i.clampWhenFinished=!0),s||i.setLoop(Ws,0),i.play()),this._currentAnimation=e}setAction(e){Ae(`setAction(${e}) is deprecated. Use animation.play(${e}) instead!`)}traverse(e){super.traverse(e)}traverseVisible(e){super.traverseVisible(e)}traverseAncestors(e){super.traverseAncestors(e)}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class ws extends Te{constructor(e,n){super(e,n),this.isExtendedMesh=!0,this.isGroup=!1,this.vector3=new j,this.hasBody=!1,this.fragmentDepth=0,this.breakable=!1,this.fractureImpulse=1,this.name=`object-${this.id}`}get world(){return{theta:this.worldTheta,phi:this.worldPhi}}get worldTheta(){return this.getWorldDirection(this.vector3),Math.atan2(this.vector3.x,this.vector3.z)}get worldPhi(){return this.getWorldDirection(this.vector3),Math.acos(this.vector3.y)}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class _i{constructor(e,n){this.factory=e,this.addExisting=n}addPlane(e={},n={}){const s=this.factory.add.plane(e,n);return this.addExisting(s,e),s}addSphere(e={},n={}){const s=this.factory.add.sphere(e,n);return this.addExisting(s,e),s}addBox(e={},n={}){const s=this.factory.add.box(e,n);return this.addExisting(s,e),s}addGround(e,n={}){const s=this.factory.add.ground(e,n),i={...e,mass:0,collisionFlags:1};return this.addExisting(s,i),s}addCapsule(e={},n={}){const s=this.factory.add.capsule(e,n);return this.addExisting(s,e),s}addCylinder(e={},n={}){const s=this.factory.add.cylinder(e,n);return this.addExisting(s,e),s}addCone(e={},n={}){const s=this.factory.add.cone(e,n);return this.addExisting(s,e),s}addTorus(e={},n={}){const s=this.factory.add.torus(e,n);return this.addExisting(s,e),s}addExtrude(e,n={}){const s=this.factory.add.extrude(e,n);return s.translateX(1),this.addExisting(s),s}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class zi{constructor(e,n){this.worldTransform=e,this.physicsWorld=n,this.tmpBtVector3=new Ammo.btVector3}toAmmoV3(e,n=0){return new Ammo.btVector3(typeof(e==null?void 0:e.x)<"u"?e.x:n,typeof(e==null?void 0:e.y)<"u"?e.y:n,typeof(e==null?void 0:e.z)<"u"?e.z:n)}get addConstraints(){return{lock:(e,n,s)=>this.lock(e,n,s),fixed:(e,n,s)=>this.fixed(e,n,s),pointToPoint:(e,n,s,i)=>this.pointToPoint(e,n,s,i),hinge:(e,n,s,i)=>this.hinge(e,n,s,i),slider:(e,n,s={},i)=>this.slider(e,n,s,i),spring:(e,n,s={},i)=>this.spring(e,n,s,i),coneTwist:(e,n,s={frameA:{},frameB:{}},i)=>this.coneTwist(e,n,s,i),dof:(e,n,s,i)=>this.dof(e,n,s,i)}}getTransform(e,n,s={x:0,y:0,z:0},i=!1){s={x:0,y:0,z:0,...s};const t=(a,o)=>{var u=(a.x()-o.x())/2+s.x,c=(a.y()-o.y())/2+s.y,f=(a.z()-o.z())/2+s.z;return new Ammo.btVector3(u,c,f)},r=new Ammo.btTransform;if(r.setIdentity(),i){const a=t(e.getWorldTransform().getOrigin(),n.getWorldTransform().getOrigin()),o=new Ammo.btTransform;o.setIdentity(),o.setOrigin(a);const u=e.getCenterOfMassTransform().inverse().op_mul(n.getWorldTransform());return u.op_mul(o),{transformA:u,transformB:o}}else return r.setOrigin(new Ammo.btVector3(s.x,s.y,s.z)),{transformA:e.getCenterOfMassTransform().inverse().op_mul(n.getWorldTransform()).op_mul(r),transformB:r}}lock(e,n,s=!0){const i={x:0,y:0,z:0};return this.dof(e,n,{angularLowerLimit:i,angularUpperLimit:i},s)}fixed(e,n,s=!0){const i=this.getTransform(e.ammo,n.ammo);i.transformA.setRotation(e.ammo.getWorldTransform().getRotation()),i.transformB.setRotation(n.ammo.getWorldTransform().getRotation());const t=new Ammo.btFixedConstraint(e.ammo,n.ammo,i.transformA,i.transformB);return this.physicsWorld.addConstraint(t,s),t}pointToPoint(e,n,s={},i=!0){const{pivotA:t,pivotB:r}=s,a=new Ammo.btVector3((t==null?void 0:t.x)||0,(t==null?void 0:t.y)||0,(t==null?void 0:t.z)||0),o=new Ammo.btVector3((r==null?void 0:r.x)||0,(r==null?void 0:r.y)||0,(r==null?void 0:r.z)||0),u=new Ammo.btPoint2PointConstraint(e.ammo,n.ammo,a,o);return this.physicsWorld.addConstraint(u,i),u}hinge(e,n,s={},i=!0){const{pivotA:t,pivotB:r,axisA:a,axisB:o}=s,u=new Ammo.btVector3((t==null?void 0:t.x)||0,(t==null?void 0:t.y)||0,(t==null?void 0:t.z)||0),c=new Ammo.btVector3((r==null?void 0:r.x)||0,(r==null?void 0:r.y)||0,(r==null?void 0:r.z)||0),f=new Ammo.btVector3((a==null?void 0:a.x)||0,(a==null?void 0:a.y)||0,(a==null?void 0:a.z)||0),h=new Ammo.btVector3((o==null?void 0:o.x)||0,(o==null?void 0:o.y)||0,(o==null?void 0:o.z)||0),l=new Ammo.btHingeConstraint(e.ammo,n.ammo,u,c,f,h,!0);return this.physicsWorld.addConstraint(l,i),l}slider(e,n,s={},i=!0){const t=this.getTransform(e.ammo,n.ammo),{frameA:r={},frameB:a={},linearLowerLimit:o=0,linearUpperLimit:u=0,angularLowerLimit:c=0,angularUpperLimit:f=0}=s,h=t.transformA.getRotation();h.setEulerZYX(r.x||0,r.y||0,r.z||0),t.transformA.setRotation(h);const l=t.transformB.getRotation();l.setEulerZYX(a.x||0,a.y||0,a.z||0),t.transformB.setRotation(l);const d=new Ammo.btSliderConstraint(e.ammo,n.ammo,t.transformA,t.transformB,!0);return d.setLowerLinLimit(o),d.setUpperLinLimit(u),d.setLowerAngLimit(c),d.setUpperAngLimit(f),this.physicsWorld.addConstraint(d,i),d}spring(e,n,s={},i=!0){const{stiffness:t=50,damping:r=.01,angularLock:a=!1,linearLowerLimit:o={},linearUpperLimit:u={},angularLowerLimit:c={},angularUpperLimit:f={},offset:h={},center:l=!1,enableSpring:d=!0}=s,p={x:0,y:0,z:0,...h},m=this.getTransform(e.ammo,n.ammo,p,l),x=new Ammo.btGeneric6DofSpringConstraint(e.ammo,n.ammo,m.transformA,m.transformB,!0);this.tmpBtVector3.setValue(o.x||0,o.y||0,o.z||0),x.setLinearLowerLimit(this.tmpBtVector3),this.tmpBtVector3.setValue(u.x||0,u.y||0,u.z||0),x.setLinearUpperLimit(this.tmpBtVector3),a?(this.tmpBtVector3.setValue(0,0,0),x.setAngularLowerLimit(this.tmpBtVector3),x.setAngularUpperLimit(this.tmpBtVector3)):(console.log(c,f),x.setAngularLowerLimit(this.toAmmoV3(c,-Math.PI)),x.setAngularUpperLimit(this.toAmmoV3(f,Math.PI)));for(let T=0;T<3;T++)x.enableSpring(T,d),x.setStiffness(T,t),x.setDamping(T,r);return this.physicsWorld.addConstraint(x,i),x}coneTwist(e,n,s,i=!0){const{frameA:t,frameB:r}=s,a=new Ammo.btTransform;a.setIdentity(),a.getOrigin().setValue((t==null?void 0:t.x)||0,(t==null?void 0:t.y)||0,(t==null?void 0:t.z)||0);const o=new Ammo.btTransform;o.setIdentity(),o.getOrigin().setValue((r==null?void 0:r.x)||0,(r==null?void 0:r.y)||0,(r==null?void 0:r.z)||0),this.getTransform(e.ammo,n.ammo);const u=new Ammo.btConeTwistConstraint(n.ammo,e.ammo,a,o);return u.setAngularOnly(!0),this.physicsWorld.addConstraint(u,i),u}dof(e,n,s={},i=!0){const{offset:t,center:r=!1}=s,a={x:0,y:0,z:0,...t},o=this.getTransform(e.ammo,n.ammo,a,r),u=new Ammo.btGeneric6DofConstraint(e.ammo,n.ammo,o.transformA,o.transformB,!0),{linearLowerLimit:c,linearUpperLimit:f,angularLowerLimit:h,angularUpperLimit:l}=s,d=this.toAmmoV3(c),p=this.toAmmoV3(f),m=this.toAmmoV3(h,-Math.PI),x=this.toAmmoV3(l,Math.PI);return u.setLinearLowerLimit(d),u.setLinearUpperLimit(p),u.setAngularLowerLimit(m),u.setAngularUpperLimit(x),Ammo.destroy(d),Ammo.destroy(p),Ammo.destroy(m),Ammo.destroy(x),this.physicsWorld.addConstraint(u,i),u}}/**
 * @author       Kevin Lee (https://github.com/InfiniteLee)
 * @copyright    Copyright (c) 2020 Kevin Lee; Project Url: https://github.com/InfiniteLee/three-to-ammo
 * @license      {@link https://github.com/InfiniteLee/three-to-ammo/blob/master/LICENSE|MPL-2.0}
 */const Et={BOX:"box",CYLINDER:"cylinder",SPHERE:"sphere",CAPSULE:"capsule",CONE:"cone",HULL:"hull",HACD:"hacd",VHACD:"vhacd",MESH:"mesh",HEIGHTFIELD:"heightfield"},Rt={ALL:"all",MANUAL:"manual"},Gi=function(){const y=new j,e=new j,n=new ie;return function(s,i,t,r={}){if(r.type=Et.HULL,Kt(r),r.fit===Rt.MANUAL)return console.warn("cannot use fit: manual with type: hull"),null;const a=Rn(s,i),o=new Ammo.btVector3,u=new Ammo.btConvexHullShape;u.setMargin(r.margin),e.addVectors(a.max,a.min).multiplyScalar(.5);let c=0;for(let d=0;d<s.length;d++)c+=s[d].length/3;const f=r.hullMaxVertices||1e5;c>f&&console.warn(`too many vertices for hull shape; sampling ~${f} from ~${c} vertices`);const h=Math.min(1,f/c);for(let d=0;d<s.length;d++){const p=s[d];n.fromArray(i[d]);for(let m=0;m<p.length;m+=3){const x=d===s.length-1&&m===p.length-3;(Math.random()<=h||x)&&(y.set(p[m],p[m+1],p[m+2]).applyMatrix4(n).sub(e),o.setValue(y.x,y.y,y.z),u.addPoint(o,x))}}let l=u;if(u.getNumVertices()>=100){const d=new Ammo.btShapeHull(u);d.buildHull(r.margin),Ammo.destroy(u),l=new Ammo.btConvexHullShape(Ammo.getPointer(d.getVertexPointer()),d.numVertices()),Ammo.destroy(d)}return Ammo.destroy(o),Yt(l,r,Qt(t,r)),l}}(),Wi=function(){const y=new j,e=new j,n=new ie;return function(s,i,t,r,a={}){if(a.type=Et.HACD,Kt(a),a.fit===Rt.MANUAL)return console.warn("cannot use fit: manual with type: hacd"),[];if(!Ammo.hasOwnProperty("HACD"))return console.warn("HACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];const o=Rn(s,i);Qt(r,a);let u=0,c=0;e.addVectors(o.max,o.min).multiplyScalar(.5);for(let T=0;T<s.length;T++)u+=s[T].length/3,t&&t[T]?c+=t[T].length/3:c+=s[T].length/9;const f=new Ammo.HACD;a.hasOwnProperty("compacityWeight")&&f.SetCompacityWeight(a.compacityWeight),a.hasOwnProperty("volumeWeight")&&f.SetVolumeWeight(a.volumeWeight),a.hasOwnProperty("nClusters")&&f.SetNClusters(a.nClusters),a.hasOwnProperty("nVerticesPerCH")&&f.SetNVerticesPerCH(a.nVerticesPerCH),a.hasOwnProperty("concavity")&&f.SetConcavity(a.concavity);const h=Ammo._malloc(u*3*8),l=Ammo._malloc(c*3*4);f.SetPoints(h),f.SetTriangles(l),f.SetNPoints(u),f.SetNTriangles(c);let d=h/8,p=l/4;for(let T=0;T<s.length;T++){const v=s[T];n.fromArray(i[T]);for(let b=0;b<v.length;b+=3)y.set(v[b+0],v[b+1],v[b+2]).applyMatrix4(n).sub(e),Ammo.HEAPF64[d+0]=y.x,Ammo.HEAPF64[d+1]=y.y,Ammo.HEAPF64[d+2]=y.z,d+=3;if(t[T]){const b=t[T];for(let g=0;g<b.length;g++)Ammo.HEAP32[p]=b[g],p++}else for(let b=0;b<v.length/3;b++)Ammo.HEAP32[p]=b,p++}f.Compute(),Ammo._free(h),Ammo._free(l);const m=f.GetNClusters(),x=[];for(let T=0;T<m;T++){const v=new Ammo.btConvexHullShape;v.setMargin(a.margin);const b=f.GetNPointsCH(T),g=f.GetNTrianglesCH(T),w=Ammo._malloc(b*3*8),S=Ammo._malloc(g*3*4);f.GetCH(T,w,S);const A=w/8;for(let P=0;P<b;P++){const M=new Ammo.btVector3,L=Ammo.HEAPF64[A+P*3+0],E=Ammo.HEAPF64[A+P*3+1],D=Ammo.HEAPF64[A+P*3+2];M.setValue(L,E,D),v.addPoint(M,P===b-1),Ammo.destroy(M)}Yt(),x.push(v)}return x}}(),ji=function(){const y=new j,e=new j,n=new ie;return function(s,i,t,r,a={}){if(a.type=Et.VHACD,Kt(a),a.fit===Rt.MANUAL)return console.warn("cannot use fit: manual with type: vhacd"),[];if(!Ammo.hasOwnProperty("VHACD"))return console.warn("VHACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];const o=Rn(s,i);Qt(r,a);let u=0,c=0;e.addVectors(o.max,o.min).multiplyScalar(.5);for(let b=0;b<s.length;b++)u+=s[b].length/3,t&&t[b]?c+=t[b].length/3:c+=s[b].length/9;const f=new Ammo.VHACD,h=new Ammo.Parameters;a.hasOwnProperty("resolution")&&h.set_m_resolution(a.resolution),a.hasOwnProperty("depth")&&h.set_m_depth(a.depth),a.hasOwnProperty("concavity")&&h.set_m_concavity(a.concavity),a.hasOwnProperty("planeDownsampling")&&h.set_m_planeDownsampling(a.planeDownsampling),a.hasOwnProperty("convexhullDownsampling")&&h.set_m_convexhullDownsampling(a.convexhullDownsampling),a.hasOwnProperty("alpha")&&h.set_m_alpha(a.alpha),a.hasOwnProperty("beta")&&h.set_m_beta(a.beta),a.hasOwnProperty("gamma")&&h.set_m_gamma(a.gamma),a.hasOwnProperty("pca")&&h.set_m_pca(a.pca),a.hasOwnProperty("mode")&&h.set_m_mode(a.mode),a.hasOwnProperty("maxNumVerticesPerCH")&&h.set_m_maxNumVerticesPerCH(a.maxNumVerticesPerCH),a.hasOwnProperty("minVolumePerCH")&&h.set_m_minVolumePerCH(a.minVolumePerCH),a.hasOwnProperty("convexhullApproximation")&&h.set_m_convexhullApproximation(a.convexhullApproximation),a.hasOwnProperty("oclAcceleration")&&h.set_m_oclAcceleration(a.oclAcceleration);const l=Ammo._malloc(u*3*8+3),d=Ammo._malloc(c*3*4);let p=l/8,m=d/4;for(let b=0;b<s.length;b++){const g=s[b];n.fromArray(i[b]);for(let w=0;w<g.length;w+=3)y.set(g[w+0],g[w+1],g[w+2]).applyMatrix4(n).sub(e),Ammo.HEAPF64[p+0]=y.x,Ammo.HEAPF64[p+1]=y.y,Ammo.HEAPF64[p+2]=y.z,p+=3;if(t[b]){const w=t[b];for(let S=0;S<w.length;S++)Ammo.HEAP32[m]=w[S],m++}else for(let w=0;w<g.length/3;w++)Ammo.HEAP32[m]=w,m++}f.Compute(l,3,u,d,3,c,h),Ammo._free(l),Ammo._free(d);const x=f.GetNConvexHulls(),T=[],v=new Ammo.ConvexHull;for(let b=0;b<x;b++){f.GetConvexHull(b,v);const g=v.get_m_nPoints();v.get_m_points();const w=new Ammo.btConvexHullShape;w.setMargin(a.margin);for(let S=0;S<g;S++){const A=new Ammo.btVector3,P=v.get_m_points(S*3+0),M=v.get_m_points(S*3+1),L=v.get_m_points(S*3+2);A.setValue(P,M,L),w.addPoint(A,S===g-1),Ammo.destroy(A)}Yt(),T.push(w)}return Ammo.destroy(v),Ammo.destroy(f),T}}(),Jt=function(){const y=new j,e=new j,n=new j,s=new ie;return function(i,t,r,a,o={}){if(o.type=Et.MESH,Kt(o),o.fit===Rt.MANUAL)return console.warn("cannot use fit: manual with type: mesh"),null;const u=Qt(a,o),c=new Ammo.btVector3,f=new Ammo.btVector3,h=new Ammo.btVector3,l=new Ammo.btTriangleMesh(!0,!1);for(let m=0;m<i.length;m++){const x=i[m],T=r[m]?r[m]:null;if(s.fromArray(t[m]),T)for(let v=0;v<T.length;v+=3){const b=T[v]*3,g=T[v+1]*3,w=T[v+2]*3;y.set(x[b],x[b+1],x[b+2]).applyMatrix4(s),e.set(x[g],x[g+1],x[g+2]).applyMatrix4(s),n.set(x[w],x[w+1],x[w+2]).applyMatrix4(s),c.setValue(y.x,y.y,y.z),f.setValue(e.x,e.y,e.z),h.setValue(n.x,n.y,n.z),l.addTriangle(c,f,h,!1)}else for(let v=0;v<x.length;v+=9)y.set(x[v+0],x[v+1],x[v+2]).applyMatrix4(s),e.set(x[v+3],x[v+4],x[v+5]).applyMatrix4(s),n.set(x[v+6],x[v+7],x[v+8]).applyMatrix4(s),c.setValue(y.x,y.y,y.z),f.setValue(e.x,e.y,e.z),h.setValue(n.x,n.y,n.z),l.addTriangle(c,f,h,!1)}const d=new Ammo.btVector3(u.x,u.y,u.z);l.setScaling(d),Ammo.destroy(d);let p;return o.concave?p=new Ammo.btBvhTriangleMeshShape(l,!0,!0):p=new Ammo.btConvexTriangleMeshShape(l,!0),p.resources=[l],Ammo.destroy(c),Ammo.destroy(f),Ammo.destroy(h),Yt(),p}}();function Kt(y){y.type=y.type||Et.HULL,y.margin=y.hasOwnProperty("margin")?y.margin:.01}const Yt=function(y,e,n){},Xi=function(){const y=new ie;return function(e,n,s){parseInt(es)>=123?y.copy(e.matrixWorld).invert():y.getInverse(e.matrixWorld),new j().setFromMatrixScale(e.matrixWorld),e.traverse(t=>{const r=new ie;t.isMesh&&(n.includeInvisible||t.el&&t.el.object3D.visible||t.visible)&&(t===e?r.identity():(t.updateWorldMatrix(!0),r.multiplyMatrices(y,t.matrixWorld)),s(t.geometry.isBufferGeometry?t.geometry.attributes.position.array:t.geometry.vertices,r.elements,t.geometry.index?t.geometry.index.array:null))})}}(),Qt=function(){const y=new ie;return function(e,n={}){const s=new j(1,1,1);return n.fit===Rt.ALL&&(y.fromArray(e),s.setFromMatrixScale(y)),s}}();(function(){const y=new j;return function(e,n,s){let i=0,{x:t,y:r,z:a}=s.getCenter(y);return As(e,n,o=>{const u=t-o.x,c=r-o.y,f=a-o.z;i=Math.max(i,u*u+c*c+f*f)}),Math.sqrt(i)}})();const Rn=function(y,e){const n=new Tn;let s=1/0,i=1/0,t=1/0,r=-1/0,a=-1/0,o=-1/0;return n.min.set(0,0,0),n.max.set(0,0,0),As(y,e,u=>{u.x<s&&(s=u.x),u.y<i&&(i=u.y),u.z<t&&(t=u.z),u.x>r&&(r=u.x),u.y>a&&(a=u.y),u.z>o&&(o=u.z)}),n.min.set(s,i,t),n.max.set(r,a,o),n},As=function(){const y=new j,e=new ie;return function(n,s,i){for(let t=0;t<n.length;t++){e.fromArray(s[t]);for(let r=0;r<n[t].length;r+=3)y.set(n[t][r],n[t][r+1],n[t][r+2]).applyMatrix4(e),i(y)}}}();/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */const Ki=(y,e)=>{const{radius:n=1,tube:s=.4,tubularSegments:i=8}=y,t=Math.PI,r=i,a=Math.sqrt(2*s*s-2*s*s*Math.cos(2*t/r)),o=new Ammo.btVector3(s,t/r+.5*a,s),u=new Ammo.btCylinderShape(o);u.setMargin(.05);const c=new Ammo.btCompoundShape,f=new Ammo.btVector3(0,0,1),h=new Ammo.btVector3(0,n,0),l=new Ammo.btQuaternion(e.x,e.y,e.z,e.w);for(let d=0;d<r;d++){const p=d*2*t/r,m=h.rotate(f,p),x=new Ammo.btTransform;l.setRotation(f,p+Math.PI/2),x.setIdentity(),x.setOrigin(m),x.setRotation(l),c.addChildShape(x,u)}return c};class Ts{constructor(){this._defaultMaterial=new bn({color:13421772})}get(){return this._defaultMaterial}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class bs{constructor(e){this.scene=e,this.isHeadless=e==="headless",this.defaultMaterial=new Ts}get make(){return{plane:(e={},n={})=>this.makePlane(e,n),box:(e={},n={})=>this.makeBox(e,n),sphere:(e={},n={})=>this.makeSphere(e,n),capsule:(e={},n={})=>this.makeCapsule(e,n),cylinder:(e={},n={})=>this.makeCylinder(e,n),cone:(e={},n={})=>this.makeCone(e,n),torus:(e={},n={})=>this.makeTorus(e,n),extrude:(e,n={})=>this.makeExtrude(e,n)}}get add(){return{mesh:e=>this.addMesh(e),existing:e=>this.addExisting(e),plane:(e={},n={})=>this.addPlane(e,n),box:(e={},n={})=>this.addBox(e,n),ground:(e,n={})=>this.addGround(e,n),sphere:(e={},n={})=>this.addSphere(e,n),capsule:(e={},n={})=>this.addCapsule(e,n),cylinder:(e={},n={})=>this.addCylinder(e,n),cone:(e={},n={})=>this.addCone(e,n),torus:(e={},n={})=>this.addTorus(e,n),extrude:(e,n={})=>this.addExtrude(e,n),material:(e={})=>this.addMaterial(e)}}addExisting(...e){this.scene!=="headless"&&this.scene.add(...e)}addMesh(e){if(Array.isArray(e))for(let n=0;n<e.length;n++)this.addExisting(e[n]);else this.addExisting(e);return this}createMesh(e,n,s){const{x:i=0,y:t=0,z:r=0}=s;let a;switch(!Array.isArray(n)&&n.type){case"LineBasicMaterial":a=new _t(e,n);break;case"PointsMaterial":a=new ts(e,n);break;default:a=new ws(e,n);break}return a.position.set(i,t,r),a.castShadow=a.receiveShadow=!0,a}makeExtrude(e,n){const{x:s,y:i,z:t,name:r,shape:a,autoCenter:o=!0,breakable:u=!1,...c}=e,{depth:f=1,bevelEnabled:h=!1}=c,l=new js(a,{depth:f,bevelEnabled:h,...c}),d=this.addMaterial(n),p=this.createMesh(l,d,{x:s,y:i,z:t});return o&&p.geometry.center(),p.name=r||`body_id_${p.id}`,p.shape="extrude",p}addExtrude(e,n={}){const s=this.makeExtrude(e,n);return this.addExisting(s),s}makePlane(e,n){const{x:s,y:i,z:t,name:r,breakable:a=!1,...o}=e,u=new yt(o.width||1,o.height||1,o.widthSegments||1,o.heightSegments||1),c=this.addMaterial(n);c.side=Sn;const f=this.createMesh(u,c,{x:s,y:i,z:t});return f.name=r||`body_id_${f.id}`,f.shape="plane",f}addPlane(e,n){const s=this.makePlane(e,n);return this.addExisting(s),s}makeSphere(e,n){const{x:s,y:i,z:t,name:r,breakable:a=!1,...o}=e,u=new zt(o.radius||1,o.widthSegments||16,o.heightSegments||12,o.phiStart||void 0,o.phiLength||void 0,o.thetaStart||void 0,o.thetaLength||void 0),c=this.addMaterial(n),f=this.createMesh(u,c,{x:s,y:i,z:t});return f.name=r||`body_id_${f.id}`,f.shape="sphere",f}addSphere(e={},n={}){const s=this.makeSphere(e,n);return this.addExisting(s),s}makeBox(e,n){const{x:s,y:i,z:t,name:r,breakable:a=!1,...o}=e,u=new Xs(o.width||1,o.height||1,o.depth||1,o.widthSegments||void 0,o.heightSegments||void 0,o.depthSegments||void 0),c=this.addMaterial(n),f=this.createMesh(u,c,{x:s,y:i,z:t});return f.name=r||`body_id_${f.id}`,f.shape="box",f}addBox(e={},n={}){const s=this.makeBox(e,n);return this.addExisting(s),s}addGround(e,n={}){const s=this.makeBox(e,n);return s.rotateX(Ie.degToRad(90)),this.addExisting(s),s}makeCapsule(e={},n={}){const{x:s,y:i,z:t,name:r,breakable:a=!1,...o}=e,u=new Ks(o.radius||.5,o.length||1,o.capSegments||4,o.radialSegments||16),c=this.addMaterial(n),f=this.createMesh(u,c,{x:s,y:i,z:t});return f.name=r||`body_id_${f.id}`,f.shape="capsule",f}addCapsule(e={},n={}){const s=this.makeCapsule(e,n);return this.addExisting(s),s}makeCylinder(e={},n={}){const{x:s,y:i,z:t,name:r,breakable:a=!1,...o}=e,u=new Ys(o.radiusTop||1,o.radiusBottom||1,o.height||1,o.radiusSegments||void 0,o.heightSegments||void 0,o.openEnded||void 0,o.thetaStart||void 0,o.thetaLength||void 0),c=this.addMaterial(n),f=this.createMesh(u,c,{x:s,y:i,z:t});return f.name=r||`body_id_${f.id}`,f.shape="cylinder",f}addCylinder(e={},n={}){const s=this.makeCylinder(e,n);return this.addExisting(s),s}makeCone(e={},n={}){const{x:s,y:i,z:t,name:r,breakable:a=!1,...o}=e,u=new Qs(o.radius||1,o.height||1,o.radiusSegments||8,o.heightSegments||1,o.openEnded||!1,o.thetaStart||0,o.thetaLength||2*Math.PI),c=this.addMaterial(n),f=this.createMesh(u,c,{x:s,y:i,z:t});return f.name=r||`body_id_${f.id}`,f.shape="cone",f}addCone(e={},n={}){const s=this.makeCone(e,n);return this.addExisting(s),s}makeTorus(e={},n={}){const{x:s,y:i,z:t,name:r,breakable:a=!1,...o}=e,u=new qs(o.radius||void 0,o.tube||void 0,o.radialSegments||void 0,o.tubularSegments||void 0,o.arc||void 0),c=this.addMaterial(n),f=this.createMesh(u,c,{x:s,y:i,z:t});return f.name=r||`body_id_${f.id}`,f.shape="torus",f}addTorus(e={},n={}){const s=this.makeTorus(e,n);return this.addExisting(s),s}addMaterial(e={}){const n=Object.keys(e)[0];let s;if(this.scene==="headless")return this.defaultMaterial.get();switch(n){case"basic":s=new Ne(e.basic);break;case"normal":s=new $s(e.normal);break;case"standard":s=new Gt(e.standard);break;case"lambert":s=new bn(e.lambert);break;case"phong":s=new mt(e.phong);break;case"physical":typeof e.physical<"u"?s=new Ke(e.physical):(Ae("You need to pass parameters to the physical material. (Fallback to default material)"),s=this.defaultMaterial.get());break;case"toon":s=new Zs(e.toon);break;case"line":s=new Pt(e.line);break;case"points":s=new ns(e.points);break;case"custom":s=e.custom||this.defaultMaterial.get();break;default:s=this.defaultMaterial.get();break}return s}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Yi extends At{addCollider(e,n,s){!e.body||!n.body||(e.body.checkCollisions=!0,n.body.checkCollisions=!0,this.on("collision",i=>{var a,o;const{bodies:t,event:r}=i;(a=t[0])!=null&&a.name&&((o=t[1])!=null&&o.name)&&(e!=null&&e.name)&&(n!=null&&n.name)&&(t[0].name===e.name&&t[1].name===n.name||t[1].name===e.name&&t[0].name===n.name)&&s(r)}))}}/**
 * @author       Kevin Lee (https://github.com/InfiniteLee)
 * @copyright    Copyright (c) 2019 Kevin Lee; Project Url: https://github.com/InfiniteLee/ammo-debug-drawer
 * @license      {@link https://github.com/InfiniteLee/ammo-debug-drawer/blob/master/LICENSE|MPL-2.0}
 */const Fn={NoDebug:0,DrawWireframe:1,DrawAabb:2,DrawFeaturesText:4,DrawContactPoints:8,NoDeactivation:16,NoHelpText:32,DrawText:64,ProfileTimings:128,EnableSatComparison:256,DisableBulletLCP:512,EnableCCD:1024,DrawConstraints:2048,DrawConstraintLimits:4096,FastWireframe:8192,DrawNormals:16384,DrawOnTop:32768,MAX_DEBUG_DRAW_MODE:4294967295};class Qi{constructor(e,n,s={}){this.scene=e,this.world=n,this.options=s,this.debugDrawMode=s.debugDrawMode||Fn.DrawWireframe;const i=this.debugDrawMode&Fn.DrawOnTop||!1,t=s.maxBufferSize||1e6;this.geometry=new _e;const r=new Float32Array(t*3),a=new Float32Array(t*3);this.geometry.setAttribute("position",new He(r,3).setUsage(In)),this.geometry.setAttribute("color",new He(a,3).setUsage(In)),this.index=0;const o=new Pt({vertexColors:!0,depthTest:!i});this.mesh=new ss(this.geometry,o),i&&(this.mesh.renderOrder=999),this.mesh.frustumCulled=!1,this.enabled=!1,this.debugDrawer=new Ammo.DebugDrawer,this.debugDrawer.drawLine=this.drawLine.bind(this),this.debugDrawer.drawContactPoint=this.drawContactPoint.bind(this),this.debugDrawer.reportErrorWarning=this.reportErrorWarning.bind(this),this.debugDrawer.draw3dText=this.draw3dText.bind(this),this.debugDrawer.setDebugMode=this.setDebugMode.bind(this),this.debugDrawer.getDebugMode=this.getDebugMode.bind(this),this.world.setDebugDrawer(this.debugDrawer)}enable(){this.enabled=!0,this.scene.add(this.mesh)}disable(){this.enabled=!1,this.scene.remove(this.mesh)}update(){this.enabled&&(this.index!=0&&(this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0),this.index=0,this.world.debugDrawWorld(),this.geometry.setDrawRange(0,this.index))}drawLine(e,n,s){const i=Ammo.HEAPF32,t=i[(s+0)/4],r=i[(s+4)/4],a=i[(s+8)/4],o=i[(e+0)/4],u=i[(e+4)/4],c=i[(e+8)/4];this.geometry.attributes.position.setXYZ(this.index,o,u,c),this.geometry.attributes.color.setXYZ(this.index++,t,r,a);const f=i[(n+0)/4],h=i[(n+4)/4],l=i[(n+8)/4];this.geometry.attributes.position.setXYZ(this.index,f,h,l),this.geometry.attributes.color.setXYZ(this.index++,t,r,a)}drawContactPoint(e,n,s,i,t){const r=Ammo.HEAPF32,a=r[(t+0)/4],o=r[(t+4)/4],u=r[(t+8)/4],c=r[(e+0)/4],f=r[(e+4)/4],h=r[(e+8)/4];this.geometry.attributes.position.setXYZ(this.index,c,f,h),this.geometry.attributes.color.setXYZ(this.index++,a,o,u);const l=r[(n+0)/4]*s,d=r[(n+4)/4]*s,p=r[(n+8)/4]*s;this.geometry.attributes.position.setXYZ(this.index,c+l,f+d,h+p),this.geometry.attributes.color.setXYZ(this.index++,a,o,u)}reportErrorWarning(e){Ammo.hasOwnProperty("Pointer_stringify")?console.warn(Ammo.Pointer_stringify(e)):this.warnedOnce||(this.warnedOnce=!0,console.warn("Cannot print warningString, please rebuild Ammo.js using 'debug' flag"))}draw3dText(e,n){console.warn("TODO: draw3dText")}setDebugMode(e){this.debugDrawMode=e}getDebugMode(){return this.debugDrawMode}}const Bt=0,qi=1,Zi=new j,Bn=new is,en=new it,Vn=new j,Dt=new Js;class $i{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new Nn,this.unassigned=new Nn,this.vertices=[]}setFromPoints(e){if(e.length>=4){this.makeEmpty();for(let n=0,s=e.length;n<s;n++)this.vertices.push(new Ji(e[n]));this.compute()}return this}setFromObject(e){const n=[];return e.updateMatrixWorld(!0),e.traverse(function(s){const i=s.geometry;if(i!==void 0){const t=i.attributes.position;if(t!==void 0)for(let r=0,a=t.count;r<a;r++){const o=new j;o.fromBufferAttribute(t,r).applyMatrix4(s.matrixWorld),n.push(o)}}}),this.setFromPoints(n)}containsPoint(e){const n=this.faces;for(let s=0,i=n.length;s<i;s++)if(n[s].distanceToPoint(e)>this.tolerance)return!1;return!0}intersectRay(e,n){const s=this.faces;let i=-1/0,t=1/0;for(let r=0,a=s.length;r<a;r++){const o=s[r],u=o.distanceToPoint(e.origin),c=o.normal.dot(e.direction);if(u>0&&c>=0)return null;const f=c!==0?-u/c:0;if(!(f<=0)&&(c>0?t=Math.min(f,t):i=Math.max(f,i),i>t))return null}return i!==-1/0?e.at(i,n):e.at(t,n),n}intersectsRay(e){return this.intersectRay(e,Zi)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(e,n){return e.face=n,n.outside===null?this.assigned.append(e):this.assigned.insertBefore(n.outside,e),n.outside=e,this}removeVertexFromFace(e,n){return e===n.outside&&(e.next!==null&&e.next.face===n?n.outside=e.next:n.outside=null),this.assigned.remove(e),this}removeAllVerticesFromFace(e){if(e.outside!==null){const n=e.outside;let s=e.outside;for(;s.next!==null&&s.next.face===e;)s=s.next;return this.assigned.removeSubList(n,s),n.prev=s.next=null,e.outside=null,n}}deleteFaceVertices(e,n){const s=this.removeAllVerticesFromFace(e);if(s!==void 0)if(n===void 0)this.unassigned.appendChain(s);else{let i=s;do{const t=i.next;n.distanceToPoint(i.point)>this.tolerance?this.addVertexToFace(i,n):this.unassigned.append(i),i=t}while(i!==null)}return this}resolveUnassignedPoints(e){if(this.unassigned.isEmpty()===!1){let n=this.unassigned.first();do{const s=n.next;let i=this.tolerance,t=null;for(let r=0;r<e.length;r++){const a=e[r];if(a.mark===Bt){const o=a.distanceToPoint(n.point);if(o>i&&(i=o,t=a),i>1e3*this.tolerance)break}}t!==null&&this.addVertexToFace(n,t),n=s}while(n!==null)}return this}computeExtremes(){const e=new j,n=new j,s=[],i=[];for(let t=0;t<3;t++)s[t]=i[t]=this.vertices[0];e.copy(this.vertices[0].point),n.copy(this.vertices[0].point);for(let t=0,r=this.vertices.length;t<r;t++){const a=this.vertices[t],o=a.point;for(let u=0;u<3;u++)o.getComponent(u)<e.getComponent(u)&&(e.setComponent(u,o.getComponent(u)),s[u]=a);for(let u=0;u<3;u++)o.getComponent(u)>n.getComponent(u)&&(n.setComponent(u,o.getComponent(u)),i[u]=a)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e.x),Math.abs(n.x))+Math.max(Math.abs(e.y),Math.abs(n.y))+Math.max(Math.abs(e.z),Math.abs(n.z))),{min:s,max:i}}computeInitialHull(){const e=this.vertices,n=this.computeExtremes(),s=n.min,i=n.max;let t=0,r=0;for(let h=0;h<3;h++){const l=i[h].point.getComponent(h)-s[h].point.getComponent(h);l>t&&(t=l,r=h)}const a=s[r],o=i[r];let u,c;t=0,Bn.set(a.point,o.point);for(let h=0,l=this.vertices.length;h<l;h++){const d=e[h];if(d!==a&&d!==o){Bn.closestPointToPoint(d.point,!0,Vn);const p=Vn.distanceToSquared(d.point);p>t&&(t=p,u=d)}}t=-1,en.setFromCoplanarPoints(a.point,o.point,u.point);for(let h=0,l=this.vertices.length;h<l;h++){const d=e[h];if(d!==a&&d!==o&&d!==u){const p=Math.abs(en.distanceToPoint(d.point));p>t&&(t=p,c=d)}}const f=[];if(en.distanceToPoint(c.point)<0){f.push(ke.create(a,o,u),ke.create(c,o,a),ke.create(c,u,o),ke.create(c,a,u));for(let h=0;h<3;h++){const l=(h+1)%3;f[h+1].getEdge(2).setTwin(f[0].getEdge(l)),f[h+1].getEdge(1).setTwin(f[l+1].getEdge(0))}}else{f.push(ke.create(a,u,o),ke.create(c,a,o),ke.create(c,o,u),ke.create(c,u,a));for(let h=0;h<3;h++){const l=(h+1)%3;f[h+1].getEdge(2).setTwin(f[0].getEdge((3-h)%3)),f[h+1].getEdge(0).setTwin(f[l+1].getEdge(1))}}for(let h=0;h<4;h++)this.faces.push(f[h]);for(let h=0,l=e.length;h<l;h++){const d=e[h];if(d!==a&&d!==o&&d!==u&&d!==c){t=this.tolerance;let p=null;for(let m=0;m<4;m++){const x=this.faces[m].distanceToPoint(d.point);x>t&&(t=x,p=this.faces[m])}p!==null&&this.addVertexToFace(d,p)}}return this}reindexFaces(){const e=[];for(let n=0;n<this.faces.length;n++){const s=this.faces[n];s.mark===Bt&&e.push(s)}return this.faces=e,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let e,n=0;const s=this.assigned.first().face;let i=s.outside;do{const t=s.distanceToPoint(i.point);t>n&&(n=t,e=i),i=i.next}while(i!==null&&i.face===s);return e}}computeHorizon(e,n,s,i){this.deleteFaceVertices(s),s.mark=qi;let t;n===null?t=n=s.getEdge(0):t=n.next;do{const r=t.twin,a=r.face;a.mark===Bt&&(a.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,r,a,i):i.push(t)),t=t.next}while(t!==n);return this}addAdjoiningFace(e,n){const s=ke.create(e,n.tail(),n.head());return this.faces.push(s),s.getEdge(-1).setTwin(n.twin),s.getEdge(0)}addNewFaces(e,n){this.newFaces=[];let s=null,i=null;for(let t=0;t<n.length;t++){const r=n[t],a=this.addAdjoiningFace(e,r);s===null?s=a:a.next.setTwin(i),this.newFaces.push(a.face),i=a}return s.next.setTwin(i),this}addVertexToHull(e){const n=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,n),this.addNewFaces(e,n),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let e;for(this.computeInitialHull();(e=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}class ke{constructor(){this.normal=new j,this.midpoint=new j,this.area=0,this.constant=0,this.outside=null,this.mark=Bt,this.edge=null}static create(e,n,s){const i=new ke,t=new tn(e,i),r=new tn(n,i),a=new tn(s,i);return t.next=a.prev=r,r.next=t.prev=a,a.next=r.prev=t,i.edge=t,i.compute()}getEdge(e){let n=this.edge;for(;e>0;)n=n.next,e--;for(;e<0;)n=n.prev,e++;return n}compute(){const e=this.edge.tail(),n=this.edge.head(),s=this.edge.next.head();return Dt.set(e.point,n.point,s.point),Dt.getNormal(this.normal),Dt.getMidpoint(this.midpoint),this.area=Dt.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(e){return this.normal.dot(e)-this.constant}}class tn{constructor(e,n){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=n}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const e=this.head(),n=this.tail();return n!==null?n.point.distanceTo(e.point):-1}lengthSquared(){const e=this.head(),n=this.tail();return n!==null?n.point.distanceToSquared(e.point):-1}setTwin(e){return this.twin=e,e.twin=this,this}}class Ji{constructor(e){this.point=e,this.prev=null,this.next=null,this.face=null}}class Nn{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(e,n){return n.prev=e.prev,n.next=e,n.prev===null?this.head=n:n.prev.next=n,e.prev=n,this}insertAfter(e,n){return n.prev=e,n.next=e.next,n.next===null?this.tail=n:n.next.prev=n,e.next=n,this}append(e){return this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this}appendChain(e){for(this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail;e.next!==null;)e=e.next;return this.tail=e,this}remove(e){return e.prev===null?this.head=e.next:e.prev.next=e.next,e.next===null?this.tail=e.prev:e.next.prev=e.prev,this}removeSubList(e,n){return e.prev===null?this.head=n.next:e.prev.next=n.next,n.next===null?this.tail=e.prev:n.next.prev=e.prev,this}isEmpty(){return this.head===null}}class er extends _e{constructor(e=[]){super();const n=[],s=[],t=new $i().setFromPoints(e).faces;for(let r=0;r<t.length;r++){const a=t[r];let o=a.edge;do{const u=o.head().point;n.push(u.x,u.y,u.z),s.push(a.normal.x,a.normal.y,a.normal.z),o=o.next}while(o!==a.edge)}this.setAttribute("position",new Ee(n,3)),this.setAttribute("normal",new Ee(s,3))}}const Hn=y=>{const e=window.THREE&&window.THREE.ConvexGeometry?window.THREE.ConvexGeometry:er;return new e(y)},ze=function(y,e){this.minSizeForBreak=y||1.4,this.smallDelta=e||1e-4,this.tempLine1=new is,this.tempPlane1=new it,this.tempPlane2=new it,this.tempPlane_Cut=new it,this.tempCM1=new j,this.tempCM2=new j,this.tempVector3=new j,this.tempVector3_2=new j,this.tempVector3_3=new j,this.tempVector3_P0=new j,this.tempVector3_P1=new j,this.tempVector3_P2=new j,this.tempVector3_N0=new j,this.tempVector3_N1=new j,this.tempVector3_AB=new j,this.tempVector3_CB=new j,this.tempResultObjects={object1:null,object2:null},this.segments=[];for(var n=30*30,s=0;s<n;s++)this.segments[s]=!1};ze.prototype={constructor:ze,prepareBreakableObject:function(y,e,n,s,i){y.geometry.isBufferGeometry||console.error("THREE.ConvexObjectBreaker.prepareBreakableObject(): Parameter object must have a BufferGeometry."),y.userData.ammoPhysicsData={};var t=y.userData.ammoPhysicsData;t.mass=e,t.velocity=n.clone(),t.angularVelocity=s.clone(),t.breakable=i},subdivideByImpact:function(y,e,n,s,i){var t=[],r=this.tempPlane1,a=this.tempPlane2;this.tempVector3.addVectors(e,n),r.setFromCoplanarPoints(e,y.position,this.tempVector3);var o=i+s,u=this;function c(f,h,l,d){if(Math.random()<d*.05||d>o){t.push(f);return}var p=Math.PI;d===0?(a.normal.copy(r.normal),a.constant=r.constant):d<=s?(p=(l-h)*(.2+.6*Math.random())+h,u.tempVector3_2.copy(y.position).sub(e).applyAxisAngle(n,p).add(e),a.setFromCoplanarPoints(e,u.tempVector3,u.tempVector3_2)):(p=(.5*(d&1)+.2*(2-Math.random()))*Math.PI,u.tempVector3_2.copy(e).sub(f.position).applyAxisAngle(n,p).add(f.position),u.tempVector3_3.copy(n).add(f.position),a.setFromCoplanarPoints(f.position,u.tempVector3_3,u.tempVector3_2)),u.cutByPlane(f,a,u.tempResultObjects);var m=u.tempResultObjects.object1,x=u.tempResultObjects.object2;m&&c(m,h,p,d+1),x&&c(x,p,l,d+1)}return c(y,0,2*Math.PI,0),t},cutByPlane:function(y,e,n){var s=y.geometry,i=s.attributes.position.array,t=s.attributes.normal.array,r=i.length/3,a=r/3,o=s.getIndex();o&&(o=o.array,a=o.length/3);function u(Q,q){var G=Q*3+q;return o?o[G]:G}for(var c=[],f=[],h=this.smallDelta,l=r*r,d=0;d<l;d++)this.segments[d]=!1;for(var p=this.tempVector3_P0,m=this.tempVector3_P1,x=this.tempVector3_N0,T=this.tempVector3_N1,d=0;d<a-1;d++){var v=u(d,0),b=u(d,1),g=u(d,2);x.set(t[v],t[v]+1,t[v]+2);for(var w=d+1;w<a;w++){var S=u(w,0),A=u(w,1),P=u(w,2);T.set(t[S],t[S]+1,t[S]+2);var M=1-x.dot(T)<h;M&&(v===S||v===A||v===P?b===S||b===A||b===P?(this.segments[v*r+b]=!0,this.segments[b*r+v]=!0):(this.segments[g*r+v]=!0,this.segments[v*r+g]=!0):(b===S||b===A||b===P)&&(this.segments[g*r+b]=!0,this.segments[b*r+g]=!0))}}var L=this.tempPlane_Cut;y.updateMatrix(),ze.transformPlaneToLocalSpace(e,y.matrix,L);for(var d=0;d<a;d++)for(var E=u(d,0),D=u(d,1),V=u(d,2),z=0;z<3;z++){var W=z===0?E:z===1?D:V,_=z===0?D:z===1?V:E,U=this.segments[W*r+_];if(!U){this.segments[W*r+_]=!0,this.segments[_*r+W]=!0,p.set(i[3*W],i[3*W+1],i[3*W+2]),m.set(i[3*_],i[3*_+1],i[3*_+2]);var J=0,re=L.distanceToPoint(p);re>h?(J=2,f.push(p.clone())):re<-h?(J=1,c.push(p.clone())):(J=3,c.push(p.clone()),f.push(p.clone()));var te=0,re=L.distanceToPoint(m);if(re>h?(te=2,f.push(m.clone())):re<-h?(te=1,c.push(m.clone())):(te=3,c.push(m.clone()),f.push(m.clone())),J===1&&te===2||J===2&&te===1){this.tempLine1.start.copy(p),this.tempLine1.end.copy(m);var oe=new j;if(oe=L.intersectLine(this.tempLine1,oe),oe===void 0)return console.error("Internal error: segment does not intersect plane."),n.segmentedObject1=null,n.segmentedObject2=null,0;c.push(oe),f.push(oe.clone())}}}var ue=y.userData.ammoPhysicsData.mass*.5;this.tempCM1.set(0,0,0);var B=0,O=c.length;if(O>0){for(var d=0;d<O;d++)this.tempCM1.add(c[d]);this.tempCM1.divideScalar(O);for(var d=0;d<O;d++){var C=c[d];C.sub(this.tempCM1),B=Math.max(B,C.x,C.y,C.z)}this.tempCM1.add(y.position)}this.tempCM2.set(0,0,0);var R=0,H=f.length;if(H>0){for(var d=0;d<H;d++)this.tempCM2.add(f[d]);this.tempCM2.divideScalar(H);for(var d=0;d<H;d++){var C=f[d];C.sub(this.tempCM2),R=Math.max(R,C.x,C.y,C.z)}this.tempCM2.add(y.position)}var X=null,N=null,K=0;if(O>4)try{X=new Te(Hn(c),y.material),X.position.copy(this.tempCM1),X.quaternion.copy(y.quaternion),X.userData=y.userData,this.prepareBreakableObject(X,ue,y.userData.ammoPhysicsData.velocity,y.userData.ammoPhysicsData.angularVelocity,2*B>this.minSizeForBreak),K++}catch(Q){Ae("Error in ConvexObjectBreaker.ts",!0),Ae(Q,!0)}if(H>4)try{N=new Te(Hn(f),y.material),N.position.copy(this.tempCM2),N.quaternion.copy(y.quaternion),N.userData=y.userData,this.prepareBreakableObject(N,ue,y.userData.ammoPhysicsData.velocity,y.userData.ammoPhysicsData.angularVelocity,2*R>this.minSizeForBreak),K++}catch(Q){Ae("Error in ConvexObjectBreaker.ts",!0),Ae(Q,!0)}return n.object1=X,n.object2=N,K}};ze.transformFreeVector=function(y,e){var n=y.x,s=y.y,i=y.z,t=e.elements;return y.x=t[0]*n+t[4]*s+t[8]*i,y.y=t[1]*n+t[5]*s+t[9]*i,y.z=t[2]*n+t[6]*s+t[10]*i,y};ze.transformFreeVectorInverse=function(y,e){var n=y.x,s=y.y,i=y.z,t=e.elements;return y.x=t[0]*n+t[1]*s+t[2]*i,y.y=t[4]*n+t[5]*s+t[6]*i,y.z=t[8]*n+t[9]*s+t[10]*i,y};ze.transformTiedVectorInverse=function(y,e){var n=y.x,s=y.y,i=y.z,t=e.elements;return y.x=t[0]*n+t[1]*s+t[2]*i-t[12],y.y=t[4]*n+t[5]*s+t[6]*i-t[13],y.z=t[8]*n+t[9]*s+t[10]*i-t[14],y};ze.transformPlaneToLocalSpace=function(){var y=new j;return function(n,s,i){i.normal.copy(n.normal),i.constant=n.constant;var t=ze.transformTiedVectorInverse(n.coplanarPoint(y),s);ze.transformFreeVectorInverse(i.normal,s),i.constant=-t.dot(i.normal)}}();const tr=(()=>{try{if(typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function"){const y=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(y instanceof WebAssembly.Module)return new WebAssembly.Instance(y)instanceof WebAssembly.Instance}}catch(y){y instanceof Error&&console.error(y.message)}return!1})(),Un=(y,e)=>{var n=document.createElement("script");n.onload=()=>{e()},n.onerror=()=>{throw new Error(`failed to load ${y}`)},n.async=!0,n.src=y,document.head.appendChild(n)},nr=(y,e)=>{tr?Un(`${y}/ammo.wasm.js`,()=>e()):Un(`${y}/ammo.js`,()=>e())};function Ss(y,e){e.forEach(n=>{Object.getOwnPropertyNames(n.prototype).forEach(s=>{Object.defineProperty(y.prototype,s,Object.getOwnPropertyDescriptor(n.prototype,s)||Object.create(null))})})}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class sr{constructor(e){this.physics=e}getHitPointWorld(){const e=this._btRayCallback.get_m_hitPointWorld();return{x:e.x(),y:e.y(),z:e.z()}}getHitNormalWorld(){const e=this._btRayCallback.get_m_hitNormalWorld();return{x:e.x(),y:e.y(),z:e.z()}}getCollisionObject(){return Ammo.castObject(this._btRayCallback.get_m_collisionObject(),Ammo.btRigidBody).threeObject}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class ir{constructor(e){this.physics=e}getHitPointsWorld(){const e=this._btRayCallback.get_m_hitPointWorld(),n=[];for(let s=e.size()-1;s>=0;s--){const i=e.at(s);n.push({x:i.x(),y:i.y(),z:i.z()})}return n}getHitPointWorld(){return Ae("Use getHitPointsWorld() instead of getHitPointWorld() for the AllHitsRayCaster!"),this.getHitPointsWorld()}getHitNormalsWorld(){const e=this._btRayCallback.get_m_hitNormalWorld(),n=[];for(let s=e.size()-1;s>=0;s--){const i=e.at(s);n.push({x:i.x(),y:i.y(),z:i.z()})}return n}getCollisionObjects(){const e=[],n=this._btRayCallback.get_m_collisionObjects();for(let s=n.size()-1;s>=0;s--){const i=Ammo.castObject(n.at(s),Ammo.btRigidBody);e.push(i.threeObject)}return e}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Ms{constructor(e){this.physics=e}setRayFromWorld(e=0,n=0,s=0){this._btRayFrom.setValue(e,n,s)}setRayToWorld(e=0,n=0,s=0){this._btRayTo.setValue(e,n,s)}hasHit(){return this._btRayCallback.hasHit()}rayTest(){typeof this._btRayCallback<"u"&&Ammo.destroy(this._btRayCallback),this._btRayCallback=this.type==="closest"?new Ammo.ClosestRayResultCallback(this._btRayFrom,this._btRayTo):new Ammo.AllHitsRayResultCallback(this._btRayFrom,this._btRayTo),this.physics.physicsWorld.rayTest(this._btRayFrom,this._btRayTo,this._btRayCallback)}destroy(){typeof this._btRayFrom<"u"&&Ammo.destroy(this._btRayFrom),typeof this._btRayTo<"u"&&Ammo.destroy(this._btRayTo),typeof this._btRayCallback<"u"&&Ammo.destroy(this._btRayCallback)}}class Ps{constructor(e){this.physics=e,this.type="closest",this._btRayFrom=new Ammo.btVector3(0,0,0),this._btRayTo=new Ammo.btVector3(0,0,0)}}class Cs{constructor(e){this.physics=e,this.type="allHits",this._btRayFrom=new Ammo.btVector3(0,0,0),this._btRayTo=new Ammo.btVector3(0,0,0)}}Ss(Ps,[Ms,sr]);Ss(Cs,[Ms,ir]);/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class rr extends At{constructor(e,n={}){super(),this.scene=e,this.config=n,this.rigidBodies=[],this.earlierDetectedCollisions=[],this.complexShapes=["plane","hull","hacd","vhacd","convexMesh","concaveMesh"],this.gravity=n.gravity||{x:0,y:-9.81,z:0},this.isHeadless=e==="headless",this.tmpEuler=new Ve,this.tmpQuaternion=new Me,this.tmpVector3=new j,this.tmpVector3a=new j,this.tmpMatrix4=new ie,this.tmpMatrix4a=new ie,this.tmpBtVector3=new Ammo.btVector3,this.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),this.emptyV3=new j,this.impactPoint=new j,this.impactNormal=new j,e!=="headless"&&(this.defaultMaterial=new Ts),this.start()}get tmpTrans(){return console.warn("Use worldTransform instead of tmpTrans."),this.worldTransform}set tmpTrans(e){console.warn("Use worldTransform instead of tmpTrans."),this.worldTransform=e}destroy(e){var t;const n=Object.keys(e).includes("body")?e.body:e;if(typeof(n==null?void 0:n.ammo)>"u")return;let s=n.ammo.threeObject;const i=s.name;if(i&&s&&(t=s==null?void 0:s.body)!=null&&t.ammo){s.body.isSoftBody?this.physicsWorld.removeSoftBody(s.body.ammo):this.physicsWorld.removeRigidBody(s.body.ammo),s.body.destructor(),s.body=void 0,s.hasBody=!1,delete n.ammo.threeObject;for(let r=0;r<this.rigidBodies.length;r++)this.rigidBodies[r].name===i&&(this.rigidBodies.splice(r,1),r--)}this.scene==="headless"&&s&&(s=null)}setup(){if(this.worldTransform=new Ammo.btTransform,typeof this.config.setupPhysicsWorld=="function"?this.physicsWorld=this.config.setupPhysicsWorld():this.physicsWorld=this.setupPhysicsWorld(),this.scene!=="headless"){this.convexBreaker=new ze,this.objectsToRemove=[],this.numObjectsToRemove=0;for(let e=0;e<500;e++)this.objectsToRemove[e]=null}this.collisionEvents=new Yi,this.factory=new bs(this.scene),this.shapes=new _i(this.factory,(e,n)=>this.addExisting(e,n)),this.constraints=new zi(this.worldTransform,this.physicsWorld),this.scene!=="headless"&&(this.debugDrawer=new Qi(this.scene,this.physicsWorld,{}))}updateDebugger(){this.scene!=="headless"&&this.debugDrawer&&this.debugDrawer.enabled&&this.debugDrawer.update()}setupPhysicsWorld(){const e=this.gravity,{softBodies:n=!1}=this.config;let s;if(!n){const i=new Ammo.btDefaultCollisionConfiguration,t=new Ammo.btCollisionDispatcher(i),r=new Ammo.btDbvtBroadphase,a=new Ammo.btSequentialImpulseConstraintSolver;s=new Ammo.btDiscreteDynamicsWorld(t,r,a,i)}if(n){const i=new Ammo.btSoftBodyRigidBodyCollisionConfiguration,t=new Ammo.btCollisionDispatcher(i),r=new Ammo.btDbvtBroadphase,a=new Ammo.btSequentialImpulseConstraintSolver,o=new Ammo.btDefaultSoftBodySolver;s=new Ammo.btSoftRigidDynamicsWorld(t,r,a,i,o)}return s.setGravity(new Ammo.btVector3(e.x,e.y,e.z)),s}createDebrisFromBreakableObject(e,n){this.scene!=="headless"&&(e.material=n.material,e.shape="hull",e.fragmentDepth=n.fragmentDepth+1,e.name=`${n.name}__DEBRIS_${e.id}`,this.scene.add(e),this.addExisting(e,{autoCenter:!0}),e.body.fractureImpulse=n.body.fractureImpulse,e.body.breakable=!1,setTimeout(()=>{e.body.breakable=!0},2500))}removeDebris(e){this.scene!=="headless"&&(this.scene.remove(e),this.destroy(e))}update(e){this.updatePhysics(e),this.detectCollisions()}updatePhysics(e){const n=e/1e3;this.physicsWorld.stepSimulation(n,this.config.maxSubSteps||4,this.config.fixedTimeStep||1/60);for(let s=0;s<this.rigidBodies.length;s++){const i=this.rigidBodies[s];i.body.impact=[];const r=i.body.ammo.getMotionState();if(r){if(r.getWorldTransform(this.worldTransform),i.body.didUpdate&&(i.body._emitUpdateEvents&&i.body.eventEmitter.emit("update"),i.body.didUpdate=!1),i.body.ammo.isKinematicObject()&&i.body.needUpdate)i.getWorldQuaternion(this.tmpQuaternion),i.getWorldPosition(this.tmpVector3),this.tmpBtVector3.setValue(this.tmpVector3.x,this.tmpVector3.y,this.tmpVector3.z),this.tmpBtQuaternion.setValue(this.tmpQuaternion.x,this.tmpQuaternion.y,this.tmpQuaternion.z,this.tmpQuaternion.w),this.worldTransform.setOrigin(this.tmpBtVector3),this.worldTransform.setRotation(this.tmpBtQuaternion),r.setWorldTransform(this.worldTransform),i.body.needUpdate=!1;else if(!i.body.skipUpdate){if(!i.body.ammo.isStaticObject()){const a=this.worldTransform.getOrigin(),o=this.worldTransform.getRotation(),u=i.body.offset;if(i.body.ignoreScale)this.tmpVector3a.set(i.scale.x,i.scale.y,i.scale.z);else{const c=i.body.ammo.getCollisionShape().getLocalScaling();this.tmpVector3a.set(c.x(),c.y(),c.z())}this.tmpVector3.set(a.x()+u.x,a.y()+u.y,a.z()+u.z),this.tmpQuaternion.set(o.x(),o.y(),o.z(),o.w()),this.tmpMatrix4.compose(this.tmpVector3,this.tmpQuaternion,this.tmpVector3a),i.parent?parseInt(es)>=123?this.tmpMatrix4a.copy(i.parent.matrixWorld).invert():this.tmpMatrix4a.getInverse(i.parent.matrixWorld):this.tmpMatrix4a.identity(),this.tmpMatrix4a.multiply(this.tmpMatrix4),this.tmpMatrix4a.decompose(i.position,i.quaternion,i.scale)}}}}}detectCollisions(){var i,t;const e=[];this.impactPoint.set(0,0,0),this.impactNormal.set(0,0,0);const n=this.physicsWorld.getDispatcher(),s=n.getNumManifolds();for(let r=0;r<s;r++){const a=n.getManifoldByIndexInternal(r),o=a.getNumContacts(),u=Ammo.castObject(a.getBody0(),Ammo.btRigidBody),c=Ammo.castObject(a.getBody1(),Ammo.btRigidBody),f=u.threeObject,h=c.threeObject;if(!f||!h||u.name===""&&c.name==="")continue;const l=(i=f.body)==null?void 0:i.checkCollisions,d=(t=h.body)==null?void 0:t.checkCollisions,p=f.body.breakable,m=h.body.breakable,x=f.body.fractureImpulse,T=h.body.fractureImpulse,v=l||d,b=p||m;if(typeof f.fragmentDepth>"u"&&(f.fragmentDepth=0),typeof h.fragmentDepth>"u"&&(h.fragmentDepth=0),!v&&!b)continue;let g=!1,w=0,S="start";for(let P=0;P<o;P++){const M=a.getContactPoint(P);if(M.getDistance()<=0){g=!0;const E=M.getAppliedImpulse(),D=M.get_m_positionWorldOnB(),V=M.get_m_normalWorldOnB();if(l||d){const z=[f.uuid,h.uuid].sort(),W=`${z[0]}__${z[1]}`;if(this.earlierDetectedCollisions.find(_=>_.combinedName===W)&&(S="collision"),!e.find(_=>_.combinedName===W)){e.push({combinedName:W,collision:!0});const _={x:D.x(),y:D.y(),z:D.z()},U={x:V.x(),y:V.y(),z:V.z()};f.body.impact.push({impulse:E,point:_,normal:U,name:h.name}),h.body.impact.push({impulse:E,point:_,normal:U,name:f.name}),this.collisionEvents.emit("collision",{bodies:[f,h],event:S})}}E>=w&&(w=E,(p||m)&&(this.impactPoint.set(D.x(),D.y(),D.z()),this.impactNormal.set(V.x(),V.y(),V.z())));break}}if(!g||!b)continue;const A=2;if(this.emptyV3.set(0,0,0),f.userData.ammoPhysicsData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:p,physicsBody:u},h.userData.ammoPhysicsData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:m,physicsBody:c},p&&w>x&&f.fragmentDepth<A){const P=this.convexBreaker.subdivideByImpact(f,this.impactPoint,this.impactNormal,1,2),M=P.length;for(let L=0;L<M;L++){const E=u.getLinearVelocity(),D=u.getAngularVelocity(),V=P[L];V.userData.ammoPhysicsData.velocity.set(E.x(),E.y(),E.z()),V.userData.ammoPhysicsData.angularVelocity.set(D.x(),D.y(),D.z()),this.createDebrisFromBreakableObject(V,f)}this.objectsToRemove[this.numObjectsToRemove++]=f}if(m&&w>T&&h.fragmentDepth<A){const P=this.convexBreaker.subdivideByImpact(h,this.impactPoint,this.impactNormal,1,2),M=P.length;for(let L=0;L<M;L++){const E=c.getLinearVelocity(),D=c.getAngularVelocity(),V=P[L];V.userData.ammoPhysicsData.velocity.set(E.x(),E.y(),E.z()),V.userData.ammoPhysicsData.angularVelocity.set(D.x(),D.y(),D.z()),this.createDebrisFromBreakableObject(V,h)}this.objectsToRemove[this.numObjectsToRemove++]=h}}for(let r=0;r<this.numObjectsToRemove;r++)this.removeDebris(this.objectsToRemove[r]);this.numObjectsToRemove=0,this.earlierDetectedCollisions.forEach(r=>{const{combinedName:a}=r;if(!e.find(o=>o.combinedName===a)){const o=a.split("__"),u=this.rigidBodies.find(h=>h.uuid===o[0]),c=this.rigidBodies.find(h=>h.uuid===o[1]),f="end";u&&c&&this.collisionEvents.emit("collision",{bodies:[u,c],event:f})}}),this.earlierDetectedCollisions=[...e]}setGravity(e=0,n=-9.8,s=0){this.tmpBtVector3.setValue(e,n,s),this.physicsWorld.setGravity(this.tmpBtVector3)}get debug(){return this.isHeadless?null:{enable:()=>{this.debugDrawer.enable()},mode:(e=1)=>{this.debugDrawer.setDebugMode(e)},disable:()=>{this.debugDrawer.disable()}}}start(){if(typeof Ammo>"u"){Ae("Are you sure you included ammo.js?");return}typeof Ammo=="function"?Ammo().then(()=>{this.setup()}):this.setup()}get add(){return{collider:(e,n,s)=>this.collisionEvents.addCollider(e,n,s),constraints:this.constraints.addConstraints,existing:(e,n)=>this.addExisting(e,n),plane:(e={},n={})=>this.shapes.addPlane(e,n),sphere:(e={},n={})=>this.shapes.addSphere(e,n),ground:(e={},n={})=>this.shapes.addGround(e,n),box:(e={},n={})=>this.shapes.addBox(e,n),capsule:(e={},n={})=>this.shapes.addCapsule(e,n),cylinder:(e={},n={})=>this.shapes.addCylinder(e,n),cone:(e={},n={})=>this.shapes.addCone(e,n),torus:(e={},n={})=>this.shapes.addTorus(e,n),extrude:(e,n={})=>this.shapes.addExtrude(e,n),raycaster:(e="closest")=>e==="closest"?new Ps(this):new Cs(this)}}prepareThreeObjectForCollisionShape(e,n={}){var o,u;const{autoCenter:s=!1}=n,i={width:1,height:1,depth:1,radius:1,radiusTop:1,radiusBottom:1,tube:.4,tubularSegments:6};let t="unknown";const r=((o=e.geometry)==null?void 0:o.type)||"unknown";/box/i.test(r)?t="box":/cone/i.test(r)?t="cone":/cylinder/i.test(r)?t="cylinder":/extrude/i.test(r)?t="extrude":/plane/i.test(r)?t="plane":/sphere/i.test(r)?t="sphere":/torus/i.test(r)&&(t="torus");let a={...i,...(u=e==null?void 0:e.geometry)==null?void 0:u.parameters};if(n.shape?(a={...i,...n},t=n.shape):e.shape&&(t=e.shape),Object.keys(a).forEach(c=>{typeof a[c]>"u"&&i[c]&&(a[c]=i[c])}),s){if(e.isMesh&&e.geometry)e.geometry.center();else if(e.isGroup){const c=new Tn,f=new j;c.setFromObject(e).getCenter(f),e.traverse(h=>{h.isMesh&&h.geometry.translate(-f.x,-f.y,-f.z)})}}return t==="cylinder"&&(a.radius=n.radius||a.radiusTop),t==="extrude"&&(t="hacd"),(t==="mesh"||t==="convex")&&(t="convexMesh"),t==="concave"&&(t="concaveMesh"),t==="unknown"&&(Ae(`Shape for ${e==null?void 0:e.name} not recognized! Will fallback to box.`),t="box"),{shape:t,params:a,object:e}}createCollisionShape(e,n,s){const i=s!=null&&s.quaternion?s==null?void 0:s.quaternion:new Me(0,0,0,1),{axis:t="y"}=n,r=new Ammo.btVector3,a=s==null?void 0:s.geometry;s&&(a!=null&&a.isGeometry)&&(s.geometry=new _e().fromGeometry(a));const o=d=>{const p=new ie().elements,m=[],x=[],T=[];return Xi(d,{},(v,b,g)=>{m.push(v),x.push(b),T.push(g)}),{vertices:m,matrices:x,indexes:T,matrixWorld:p}};let u={};this.complexShapes.indexOf(e)!==-1&&(u=o(s));let c;switch(e){case"box":r.setValue(n.width/2,n.height/2,n.depth/2),c=new Ammo.btBoxShape(r);break;case"sphere":c=new Ammo.btSphereShape(n.radius);break;case"cylinder":switch(t){case"y":r.setValue(n.radius,n.height/2,n.radius),c=new Ammo.btCylinderShape(r);break;case"x":r.setValue(n.height/2,n.radius,n.radius),c=new Ammo.btCylinderShapeX(r);break;case"z":r.setValue(n.radius,n.radius,n.height/2),c=new Ammo.btCylinderShapeZ(r);break}break;case"cone":switch(t){case"y":c=new Ammo.btConeShape(n.radius,n.height);break;case"x":c=new Ammo.btConeShapeX(n.radius,n.height);break;case"z":c=new Ammo.btConeShapeZ(n.radius,n.height);break}break;case"capsule":switch(t){case"y":c=new Ammo.btCapsuleShape(n.radius,n.height);break;case"x":c=new Ammo.btCapsuleShapeX(n.radius,n.height);break;case"z":c=new Ammo.btCapsuleShapeZ(n.radius,n.height);break}break;case"torus":c=Ki(n,i);break;case"plane":c=Jt(u.vertices,u.matrices,u.indexes,u.matrixWorld,{...n,concave:!1});break;case"hull":c=Gi(u.vertices,u.matrices,u.matrixWorld,n);break;case"hacd":c=Wi(u.vertices,u.matrices,u.indexes,u.matrixWorld,n);break;case"vhacd":c=ji(u.vertices,u.matrices,u.indexes,u.matrixWorld,n);break;case"convexMesh":c=Jt(u.vertices,u.matrices,u.indexes,u.matrixWorld,{...n,concave:!1});break;case"concaveMesh":c=Jt(u.vertices,u.matrices,u.indexes,u.matrixWorld,{...n,concave:!0});break}Ammo.destroy(r);const{x:f,y:h,z:l}=n;return(f||h||l)&&(c._compoundOffset={x:f||0,y:h||0,z:l||0}),Array.isArray(c)&&(c=this.mergeCollisionShapesToCompoundShape(c)),c}mergeCollisionShapesToCompoundShape(e){const n=new Ammo.btCompoundShape;return e.forEach(s=>{const{_childOffset:i,_compoundOffset:t}=s;if(i){const{pos:r,quat:a,scale:o,margin:u}=i,c=this.applyPosQuatScaleMargin(s,r,a,o,u);n.addChildShape(c,s)}else if(t){const r=new Ammo.btTransform;r.setIdentity(),r.setOrigin(new Ammo.btVector3(t.x,t.y,t.z)),n.addChildShape(r,s)}else{const r=new Ammo.btTransform;r.setIdentity(),n.addChildShape(r,s)}}),n}addExisting(e,n={}){const{hasBody:s}=e;if(s){Ae(`Object "${e.name}" already has a physical body!`);return}const i=new j,t=new Me,r=new j;e.getWorldPosition(i),e.getWorldQuaternion(t),e.getWorldScale(r);const a=(n.collisionFlags||0).toString(2).slice(-1)==="1",o=(n.collisionFlags||0).toString(2).slice(-2,-1)==="1",{shape:u="unknown",compound:c=[],mass:f=a||o?0:1,collisionFlags:h=0,collisionGroup:l=1,collisionMask:d=-1,offset:p=void 0,breakable:m=!1,addChildren:x=!0,margin:T=.01,ignoreScale:v=!1,fractureImpulse:b=1}=n;if(v&&r.set(1,1,1),c.length>=1){const P=c.map(D=>this.createCollisionShape(D.shape,D)),M=this.mergeCollisionShapesToCompoundShape(P),L=this.applyPosQuatScaleMargin(M,i,t,r,T),E=this.collisionShapeToRigidBody(M,L,f,o);this.addRigidBodyToWorld(e,E,h,l,d,p),e.body.breakable=m,e.body.fractureImpulse=b,e.body.ignoreScale=v;return}const g=[];if(u!=="unknown"||e.isMesh){const P=this.prepareThreeObjectForCollisionShape(e,n),M=this.createCollisionShape(P.shape,P.params,P.object);g.push(M)}if(u==="unknown"&&x&&e.children.length>=1&&e.children.forEach(P=>{if(P.isMesh){const M=this.prepareThreeObjectForCollisionShape(P),L=this.createCollisionShape(M.shape,M.params,M.object);L._childOffset={pos:P.position.clone(),quat:P.quaternion.clone(),scale:P.scale.clone(),margin:T},g.push(L)}}),g.length===0){const P=this.prepareThreeObjectForCollisionShape(e,n),M=this.createCollisionShape(P.shape,P.params,P.object);g.push(M)}const w=g.length===1?g[0]:this.mergeCollisionShapesToCompoundShape(g),S=this.applyPosQuatScaleMargin(w,i,t,r,T),A=this.collisionShapeToRigidBody(w,S,f,o);this.addRigidBodyToWorld(e,A,h,l,d,p),e.body.breakable=m,e.body.fractureImpulse=b,e.body.ignoreScale=v}addRigidBodyToWorld(e,n,s,i,t,r){this.rigidBodies.push(e),this.physicsWorld.addRigidBody(n,i,t);const a=Object.values(n)[0];e.name||(e.name=`object-${e.id}`),n.name=e.name,e.body=new Hi(this,n),e.hasBody=!0,e.ptr=a,n.threeObject=e,r&&(e.body.offset={x:0,y:0,z:0,...r}),e.body.setCollisionFlags(s)}applyPosQuatScaleMargin(e,n=new j,s=new Me,i=new j,t=.01){e.setMargin(t);const r=new Ammo.btQuaternion(0,0,0,1);r.setValue(s.x,s.y,s.z,s.w);const a=new Ammo.btTransform;a.setIdentity(),a.getOrigin().setValue(n.x,n.y,n.z),a.setRotation(r),Ammo.destroy(r);const o=new Ammo.btVector3(i.x,i.y,i.z);return e.setLocalScaling(o),Ammo.destroy(o),a}collisionShapeToRigidBody(e,n,s,i){const t=new Ammo.btDefaultMotionState(n),r=new Ammo.btVector3(0,0,0);s>0&&e.calculateLocalInertia(s,r);const a=new Ammo.btRigidBodyConstructionInfo(s,t,e,r),o=new Ammo.btRigidBody(a);return(s>0||i)&&o.setActivationState(4),o}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class or{constructor(e={}){this.threeGraphicsConfig=e;const{alpha:n=!1,anisotropy:s=1,camera:i=wt.Perspective({z:25,y:5}),antialias:t=!1,usePhysics:r=!0,renderer:a}=e;this.textureAnisotropy=s,this.camera=i,this.scene=new ei,this.renderer=a||new rs({antialias:t,alpha:n}),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=ti,this.cache=ni,this.cache.enabled=!0,r&&(typeof Ammo<"u"?this.physics=new rr(this.scene,e):Ae("Are you sure you included ammo.js?"))}}const ar="0.25.4",lr=`Powered by enable3d v${ar}`;console.log(`%c %c %c %c %c ${lr} %c https://enable3d.io/`,"background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none");/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var _n=function(y){return URL.createObjectURL(new Blob([y],{type:"text/javascript"}))};try{URL.revokeObjectURL(_n(""))}catch{_n=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var Oe=Uint8Array,Je=Uint16Array,yn=Uint32Array,Es=new Oe([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Rs=new Oe([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),cr=new Oe([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ls=function(y,e){for(var n=new Je(31),s=0;s<31;++s)n[s]=e+=1<<y[s-1];for(var i=new yn(n[30]),s=1;s<30;++s)for(var t=n[s];t<n[s+1];++t)i[t]=t-n[s]<<5|s;return[n,i]},Is=Ls(Es,2),Os=Is[0],ur=Is[1];Os[28]=258,ur[258]=28;var fr=Ls(Rs,0),hr=fr[0],xn=new Je(32768);for(var de=0;de<32768;++de){var Qe=(de&43690)>>>1|(de&21845)<<1;Qe=(Qe&52428)>>>2|(Qe&13107)<<2,Qe=(Qe&61680)>>>4|(Qe&3855)<<4,xn[de]=((Qe&65280)>>>8|(Qe&255)<<8)>>>1}var gt=function(y,e,n){for(var s=y.length,i=0,t=new Je(e);i<s;++i)++t[y[i]-1];var r=new Je(e);for(i=0;i<e;++i)r[i]=r[i-1]+t[i-1]<<1;var a;if(n){a=new Je(1<<e);var o=15-e;for(i=0;i<s;++i)if(y[i])for(var u=i<<4|y[i],c=e-y[i],f=r[y[i]-1]++<<c,h=f|(1<<c)-1;f<=h;++f)a[xn[f]>>>o]=u}else for(a=new Je(s),i=0;i<s;++i)y[i]&&(a[i]=xn[r[y[i]-1]++]>>>15-y[i]);return a},Lt=new Oe(288);for(var de=0;de<144;++de)Lt[de]=8;for(var de=144;de<256;++de)Lt[de]=9;for(var de=256;de<280;++de)Lt[de]=7;for(var de=280;de<288;++de)Lt[de]=8;var Ds=new Oe(32);for(var de=0;de<32;++de)Ds[de]=5;var dr=gt(Lt,9,1),pr=gt(Ds,5,1),nn=function(y){for(var e=y[0],n=1;n<y.length;++n)y[n]>e&&(e=y[n]);return e},De=function(y,e,n){var s=e/8|0;return(y[s]|y[s+1]<<8)>>(e&7)&n},sn=function(y,e){var n=e/8|0;return(y[n]|y[n+1]<<8|y[n+2]<<16)>>(e&7)},mr=function(y){return(y/8|0)+(y&7&&1)},gr=function(y,e,n){(e==null||e<0)&&(e=0),(n==null||n>y.length)&&(n=y.length);var s=new(y instanceof Je?Je:y instanceof yn?yn:Oe)(n-e);return s.set(y.subarray(e,n)),s},yr=function(y,e,n){var s=y.length;if(!s||n&&!n.l&&s<5)return e||new Oe(0);var i=!e||n,t=!n||n.i;n||(n={}),e||(e=new Oe(s*3));var r=function(C){var R=e.length;if(C>R){var H=new Oe(Math.max(R*2,C));H.set(e),e=H}},a=n.f||0,o=n.p||0,u=n.b||0,c=n.l,f=n.d,h=n.m,l=n.n,d=s*8;do{if(!c){n.f=a=De(y,o,1);var p=De(y,o+1,3);if(o+=3,p)if(p==1)c=dr,f=pr,h=9,l=5;else if(p==2){var v=De(y,o,31)+257,b=De(y,o+10,15)+4,g=v+De(y,o+5,31)+1;o+=14;for(var w=new Oe(g),S=new Oe(19),A=0;A<b;++A)S[cr[A]]=De(y,o+A*3,7);o+=b*3;for(var P=nn(S),M=(1<<P)-1,L=gt(S,P,1),A=0;A<g;){var E=L[De(y,o,M)];o+=E&15;var m=E>>>4;if(m<16)w[A++]=m;else{var D=0,V=0;for(m==16?(V=3+De(y,o,3),o+=2,D=w[A-1]):m==17?(V=3+De(y,o,7),o+=3):m==18&&(V=11+De(y,o,127),o+=7);V--;)w[A++]=D}}var z=w.subarray(0,v),W=w.subarray(v);h=nn(z),l=nn(W),c=gt(z,h,1),f=gt(W,l,1)}else throw"invalid block type";else{var m=mr(o)+4,x=y[m-4]|y[m-3]<<8,T=m+x;if(T>s){if(t)throw"unexpected EOF";break}i&&r(u+x),e.set(y.subarray(m,T),u),n.b=u+=x,n.p=o=T*8;continue}if(o>d){if(t)throw"unexpected EOF";break}}i&&r(u+131072);for(var _=(1<<h)-1,U=(1<<l)-1,J=o;;J=o){var D=c[sn(y,o)&_],te=D>>>4;if(o+=D&15,o>d){if(t)throw"unexpected EOF";break}if(!D)throw"invalid length/literal";if(te<256)e[u++]=te;else if(te==256){J=o,c=null;break}else{var re=te-254;if(te>264){var A=te-257,oe=Es[A];re=De(y,o,(1<<oe)-1)+Os[A],o+=oe}var ue=f[sn(y,o)&U],B=ue>>>4;if(!ue)throw"invalid distance";o+=ue&15;var W=hr[B];if(B>3){var oe=Rs[B];W+=sn(y,o)&(1<<oe)-1,o+=oe}if(o>d){if(t)throw"unexpected EOF";break}i&&r(u+131072);for(var O=u+re;u<O;u+=4)e[u]=e[u-W],e[u+1]=e[u+1-W],e[u+2]=e[u+2-W],e[u+3]=e[u+3-W];u=O}}n.l=c,n.p=J,n.b=u,c&&(a=1,n.m=h,n.d=f,n.n=l)}while(!a);return u==e.length?e:gr(e,0,u)},xr=new Oe(0),vr=function(y){if((y[0]&15)!=8||y[0]>>>4>7||(y[0]<<8|y[1])%31)throw"invalid zlib data";if(y[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function wr(y,e){return yr((vr(y),y.subarray(2,-4)),e)}var Ar=typeof TextDecoder<"u"&&new TextDecoder,Tr=0;try{Ar.decode(xr,{stream:!0}),Tr=1}catch{}function ks(y,e,n){const s=n.length-y-1;if(e>=n[s])return s-1;if(e<=n[y])return y;let i=y,t=s,r=Math.floor((i+t)/2);for(;e<n[r]||e>=n[r+1];)e<n[r]?t=r:i=r,r=Math.floor((i+t)/2);return r}function br(y,e,n,s){const i=[],t=[],r=[];i[0]=1;for(let a=1;a<=n;++a){t[a]=e-s[y+1-a],r[a]=s[y+a]-e;let o=0;for(let u=0;u<a;++u){const c=r[u+1],f=t[a-u],h=i[u]/(c+f);i[u]=o+c*h,o=f*h}i[a]=o}return i}function Sr(y,e,n,s){const i=ks(y,s,e),t=br(i,s,y,e),r=new je(0,0,0,0);for(let a=0;a<=y;++a){const o=n[i-y+a],u=t[a],c=o.w*u;r.x+=o.x*c,r.y+=o.y*c,r.z+=o.z*c,r.w+=o.w*u}return r}function Mr(y,e,n,s,i){const t=[];for(let f=0;f<=n;++f)t[f]=0;const r=[];for(let f=0;f<=s;++f)r[f]=t.slice(0);const a=[];for(let f=0;f<=n;++f)a[f]=t.slice(0);a[0][0]=1;const o=t.slice(0),u=t.slice(0);for(let f=1;f<=n;++f){o[f]=e-i[y+1-f],u[f]=i[y+f]-e;let h=0;for(let l=0;l<f;++l){const d=u[l+1],p=o[f-l];a[f][l]=d+p;const m=a[l][f-1]/a[f][l];a[l][f]=h+d*m,h=p*m}a[f][f]=h}for(let f=0;f<=n;++f)r[0][f]=a[f][n];for(let f=0;f<=n;++f){let h=0,l=1;const d=[];for(let p=0;p<=n;++p)d[p]=t.slice(0);d[0][0]=1;for(let p=1;p<=s;++p){let m=0;const x=f-p,T=n-p;f>=p&&(d[l][0]=d[h][0]/a[T+1][x],m=d[l][0]*a[x][T]);const v=x>=-1?1:-x,b=f-1<=T?p-1:n-f;for(let w=v;w<=b;++w)d[l][w]=(d[h][w]-d[h][w-1])/a[T+1][x+w],m+=d[l][w]*a[x+w][T];f<=T&&(d[l][p]=-d[h][p-1]/a[T+1][f],m+=d[l][p]*a[f][T]),r[p][f]=m;const g=h;h=l,l=g}}let c=n;for(let f=1;f<=s;++f){for(let h=0;h<=n;++h)r[f][h]*=c;c*=n-f}return r}function Pr(y,e,n,s,i){const t=i<y?i:y,r=[],a=ks(y,s,e),o=Mr(a,s,y,t,e),u=[];for(let c=0;c<n.length;++c){const f=n[c].clone(),h=f.w;f.x*=h,f.y*=h,f.z*=h,u[c]=f}for(let c=0;c<=t;++c){const f=u[a-y].clone().multiplyScalar(o[c][0]);for(let h=1;h<=y;++h)f.add(u[a-y+h].clone().multiplyScalar(o[c][h]));r[c]=f}for(let c=t+1;c<=i+1;++c)r[c]=new je(0,0,0);return r}function Cr(y,e){let n=1;for(let i=2;i<=y;++i)n*=i;let s=1;for(let i=2;i<=e;++i)s*=i;for(let i=2;i<=y-e;++i)s*=i;return n/s}function Er(y){const e=y.length,n=[],s=[];for(let t=0;t<e;++t){const r=y[t];n[t]=new j(r.x,r.y,r.z),s[t]=r.w}const i=[];for(let t=0;t<e;++t){const r=n[t].clone();for(let a=1;a<=t;++a)r.sub(i[t-a].clone().multiplyScalar(Cr(t,a)*s[a]));i[t]=r.divideScalar(s[0])}return i}function Rr(y,e,n,s,i){const t=Pr(y,e,n,s,i);return Er(t)}class Lr extends si{constructor(e,n,s,i,t){super(),this.degree=e,this.knots=n,this.controlPoints=[],this.startKnot=i||0,this.endKnot=t||this.knots.length-1;for(let r=0;r<s.length;++r){const a=s[r];this.controlPoints[r]=new je(a.x,a.y,a.z,a.w)}}getPoint(e,n=new j){const s=n,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),t=Sr(this.degree,this.knots,this.controlPoints,i);return t.w!==1&&t.divideScalar(t.w),s.set(t.x,t.y,t.z)}getTangent(e,n=new j){const s=n,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),t=Rr(this.degree,this.knots,this.controlPoints,i,1);return s.copy(t[1]).normalize(),s}}let le,ye,Se;class Ir extends xt{constructor(e){super(e)}load(e,n,s,i){const t=this,r=t.path===""?Vt.extractUrlBase(e):t.path,a=new Ct(this.manager);a.setPath(t.path),a.setResponseType("arraybuffer"),a.setRequestHeader(t.requestHeader),a.setWithCredentials(t.withCredentials),a.load(e,function(o){try{n(t.parse(o,r))}catch(u){i?i(u):console.error(u),t.manager.itemError(e)}},s,i)}parse(e,n){if(Vr(e))le=new Br().parse(e);else{const i=Ns(e);if(!Nr(i))throw new Error("THREE.FBXLoader: Unknown format.");if(Gn(i)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Gn(i));le=new Fr().parse(i)}const s=new Wt(this.manager).setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin);return new Or(s,this.manager).parse(le)}}class Or{constructor(e,n){this.textureLoader=e,this.manager=n}parse(){ye=this.parseConnections();const e=this.parseImages(),n=this.parseTextures(e),s=this.parseMaterials(n),i=this.parseDeformers(),t=new Dr().parse(i);return this.parseScene(i,t,s),Se}parseConnections(){const e=new Map;return"Connections"in le&&le.Connections.connections.forEach(function(s){const i=s[0],t=s[1],r=s[2];e.has(i)||e.set(i,{parents:[],children:[]});const a={ID:t,relationship:r};e.get(i).parents.push(a),e.has(t)||e.set(t,{parents:[],children:[]});const o={ID:i,relationship:r};e.get(t).children.push(o)}),e}parseImages(){const e={},n={};if("Video"in le.Objects){const s=le.Objects.Video;for(const i in s){const t=s[i],r=parseInt(i);if(e[r]=t.RelativeFilename||t.Filename,"Content"in t){const a=t.Content instanceof ArrayBuffer&&t.Content.byteLength>0,o=typeof t.Content=="string"&&t.Content!=="";if(a||o){const u=this.parseImage(s[i]);n[t.RelativeFilename||t.Filename]=u}}}}for(const s in e){const i=e[s];n[i]!==void 0?e[s]=n[i]:e[s]=e[s].split("\\").pop()}return e}parseImage(e){const n=e.Content,s=e.RelativeFilename||e.Filename,i=s.slice(s.lastIndexOf(".")+1).toLowerCase();let t;switch(i){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",s),t="image/tga";break;default:console.warn('FBXLoader: Image type "'+i+'" is not supported.');return}if(typeof n=="string")return"data:"+t+";base64,"+n;{const r=new Uint8Array(n);return window.URL.createObjectURL(new Blob([r],{type:t}))}}parseTextures(e){const n=new Map;if("Texture"in le.Objects){const s=le.Objects.Texture;for(const i in s){const t=this.parseTexture(s[i],e);n.set(parseInt(i),t)}}return n}parseTexture(e,n){const s=this.loadTexture(e,n);s.ID=e.id,s.name=e.attrName;const i=e.WrapModeU,t=e.WrapModeV,r=i!==void 0?i.value:0,a=t!==void 0?t.value:0;if(s.wrapS=r===0?Xe:hn,s.wrapT=a===0?Xe:hn,"Scaling"in e){const o=e.Scaling.value;s.repeat.x=o[0],s.repeat.y=o[1]}if("Translation"in e){const o=e.Translation.value;s.offset.x=o[0],s.offset.y=o[1]}return s}loadTexture(e,n){let s;const i=this.textureLoader.path,t=ye.get(e.id).children;t!==void 0&&t.length>0&&n[t[0].ID]!==void 0&&(s=n[t[0].ID],(s.indexOf("blob:")===0||s.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let r;const a=e.FileName.slice(-3).toLowerCase();if(a==="tga"){const o=this.manager.getHandler(".tga");o===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),r=new Nt):(o.setPath(this.textureLoader.path),r=o.load(s))}else a==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),r=new Nt):r=this.textureLoader.load(s);return this.textureLoader.setPath(i),r}parseMaterials(e){const n=new Map;if("Material"in le.Objects){const s=le.Objects.Material;for(const i in s){const t=this.parseMaterial(s[i],e);t!==null&&n.set(parseInt(i),t)}}return n}parseMaterial(e,n){const s=e.id,i=e.attrName;let t=e.ShadingModel;if(typeof t=="object"&&(t=t.value),!ye.has(s))return null;const r=this.parseParameters(e,n,s);let a;switch(t.toLowerCase()){case"phong":a=new mt;break;case"lambert":a=new bn;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',t),a=new mt;break}return a.setValues(r),a.name=i,a}parseParameters(e,n,s){const i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=new he().fromArray(e.Diffuse.value).convertSRGBToLinear():e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(i.color=new he().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=new he().fromArray(e.Emissive.value).convertSRGBToLinear():e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(i.emissive=new he().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=new he().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(i.specular=new he().fromArray(e.SpecularColor.value).convertSRGBToLinear());const t=this;return ye.get(s).children.forEach(function(r){const a=r.relationship;switch(a){case"Bump":i.bumpMap=t.getTexture(n,r.ID);break;case"Maya|TEX_ao_map":i.aoMap=t.getTexture(n,r.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=t.getTexture(n,r.ID),i.map!==void 0&&(i.map.colorSpace=Ue);break;case"DisplacementColor":i.displacementMap=t.getTexture(n,r.ID);break;case"EmissiveColor":i.emissiveMap=t.getTexture(n,r.ID),i.emissiveMap!==void 0&&(i.emissiveMap.colorSpace=Ue);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=t.getTexture(n,r.ID);break;case"ReflectionColor":i.envMap=t.getTexture(n,r.ID),i.envMap!==void 0&&(i.envMap.mapping=ii,i.envMap.colorSpace=Ue);break;case"SpecularColor":i.specularMap=t.getTexture(n,r.ID),i.specularMap!==void 0&&(i.specularMap.colorSpace=Ue);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=t.getTexture(n,r.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),i}getTexture(e,n){return"LayeredTexture"in le.Objects&&n in le.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=ye.get(n).children[0].ID),e.get(n)}parseDeformers(){const e={},n={};if("Deformer"in le.Objects){const s=le.Objects.Deformer;for(const i in s){const t=s[i],r=ye.get(parseInt(i));if(t.attrType==="Skin"){const a=this.parseSkeleton(r,s);a.ID=i,r.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=r.parents[0].ID,e[i]=a}else if(t.attrType==="BlendShape"){const a={id:i};a.rawTargets=this.parseMorphTargets(r,s),a.id=i,r.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),n[i]=a}}}return{skeletons:e,morphTargets:n}}parseSkeleton(e,n){const s=[];return e.children.forEach(function(i){const t=n[i.ID];if(t.attrType!=="Cluster")return;const r={ID:i.ID,indices:[],weights:[],transformLink:new ie().fromArray(t.TransformLink.a)};"Indexes"in t&&(r.indices=t.Indexes.a,r.weights=t.Weights.a),s.push(r)}),{rawBones:s,bones:[]}}parseMorphTargets(e,n){const s=[];for(let i=0;i<e.children.length;i++){const t=e.children[i],r=n[t.ID],a={name:r.attrName,initialWeight:r.DeformPercent,id:r.id,fullWeights:r.FullWeights.a};if(r.attrType!=="BlendShapeChannel")return;a.geoID=ye.get(parseInt(t.ID)).children.filter(function(o){return o.relationship===void 0})[0].ID,s.push(a)}return s}parseScene(e,n,s){Se=new ct;const i=this.parseModels(e.skeletons,n,s),t=le.Objects.Model,r=this;i.forEach(function(o){const u=t[o.ID];r.setLookAtProperties(o,u),ye.get(o.ID).parents.forEach(function(f){const h=i.get(f.ID);h!==void 0&&h.add(o)}),o.parent===null&&Se.add(o)}),this.bindSkeleton(e.skeletons,n,i),this.createAmbientLight(),Se.traverse(function(o){if(o.userData.transformData){o.parent&&(o.userData.transformData.parentMatrix=o.parent.matrix,o.userData.transformData.parentMatrixWorld=o.parent.matrixWorld);const u=Bs(o.userData.transformData);o.applyMatrix4(u),o.updateWorldMatrix()}});const a=new kr().parse();Se.children.length===1&&Se.children[0].isGroup&&(Se.children[0].animations=a,Se=Se.children[0]),Se.animations=a}parseModels(e,n,s){const i=new Map,t=le.Objects.Model;for(const r in t){const a=parseInt(r),o=t[r],u=ye.get(a);let c=this.buildSkeleton(u,e,a,o.attrName);if(!c){switch(o.attrType){case"Camera":c=this.createCamera(u);break;case"Light":c=this.createLight(u);break;case"Mesh":c=this.createMesh(u,n,s);break;case"NurbsCurve":c=this.createCurve(u,n);break;case"LimbNode":case"Root":c=new dn;break;case"Null":default:c=new ct;break}c.name=o.attrName?vt.sanitizeNodeName(o.attrName):"",c.ID=a}this.getTransformData(c,o),i.set(a,c)}return i}buildSkeleton(e,n,s,i){let t=null;return e.parents.forEach(function(r){for(const a in n){const o=n[a];o.rawBones.forEach(function(u,c){if(u.ID===r.ID){const f=t;t=new dn,t.matrixWorld.copy(u.transformLink),t.name=i?vt.sanitizeNodeName(i):"",t.ID=s,o.bones[c]=t,f!==null&&t.add(f)}})}}),t}createCamera(e){let n,s;if(e.children.forEach(function(i){const t=le.Objects.NodeAttribute[i.ID];t!==void 0&&(s=t)}),s===void 0)n=new et;else{let i=0;s.CameraProjectionType!==void 0&&s.CameraProjectionType.value===1&&(i=1);let t=1;s.NearPlane!==void 0&&(t=s.NearPlane.value/1e3);let r=1e3;s.FarPlane!==void 0&&(r=s.FarPlane.value/1e3);let a=window.innerWidth,o=window.innerHeight;s.AspectWidth!==void 0&&s.AspectHeight!==void 0&&(a=s.AspectWidth.value,o=s.AspectHeight.value);const u=a/o;let c=45;s.FieldOfView!==void 0&&(c=s.FieldOfView.value);const f=s.FocalLength?s.FocalLength.value:null;switch(i){case 0:n=new Mt(c,u,t,r),f!==null&&n.setFocalLength(f);break;case 1:n=new An(-a/2,a/2,o/2,-o/2,t,r);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),n=new et;break}}return n}createLight(e){let n,s;if(e.children.forEach(function(i){const t=le.Objects.NodeAttribute[i.ID];t!==void 0&&(s=t)}),s===void 0)n=new et;else{let i;s.LightType===void 0?i=0:i=s.LightType.value;let t=16777215;s.Color!==void 0&&(t=new he().fromArray(s.Color.value).convertSRGBToLinear());let r=s.Intensity===void 0?1:s.Intensity.value/100;s.CastLightOnObject!==void 0&&s.CastLightOnObject.value===0&&(r=0);let a=0;s.FarAttenuationEnd!==void 0&&(s.EnableFarAttenuation!==void 0&&s.EnableFarAttenuation.value===0?a=0:a=s.FarAttenuationEnd.value);const o=1;switch(i){case 0:n=new Ht(t,r,a,o);break;case 1:n=new Pn(t,r);break;case 2:let u=Math.PI/3;s.InnerAngle!==void 0&&(u=Ie.degToRad(s.InnerAngle.value));let c=0;s.OuterAngle!==void 0&&(c=Ie.degToRad(s.OuterAngle.value),c=Math.max(c,1)),n=new Mn(t,r,a,u,c,o);break;default:console.warn("THREE.FBXLoader: Unknown light type "+s.LightType.value+", defaulting to a PointLight."),n=new Ht(t,r);break}s.CastShadows!==void 0&&s.CastShadows.value===1&&(n.castShadow=!0)}return n}createMesh(e,n,s){let i,t=null,r=null;const a=[];return e.children.forEach(function(o){n.has(o.ID)&&(t=n.get(o.ID)),s.has(o.ID)&&a.push(s.get(o.ID))}),a.length>1?r=a:a.length>0?r=a[0]:(r=new mt({name:xt.DEFAULT_MATERIAL_NAME,color:13421772}),a.push(r)),"color"in t.attributes&&a.forEach(function(o){o.vertexColors=!0}),t.FBX_Deformer?(i=new os(t,r),i.normalizeSkinWeights()):i=new Te(t,r),i}createCurve(e,n){const s=e.children.reduce(function(t,r){return n.has(r.ID)&&(t=n.get(r.ID)),t},null),i=new Pt({name:xt.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new _t(s,i)}getTransformData(e,n){const s={};"InheritType"in n&&(s.inheritType=parseInt(n.InheritType.value)),"RotationOrder"in n?s.eulerOrder=Vs(n.RotationOrder.value):s.eulerOrder="ZYX","Lcl_Translation"in n&&(s.translation=n.Lcl_Translation.value),"PreRotation"in n&&(s.preRotation=n.PreRotation.value),"Lcl_Rotation"in n&&(s.rotation=n.Lcl_Rotation.value),"PostRotation"in n&&(s.postRotation=n.PostRotation.value),"Lcl_Scaling"in n&&(s.scale=n.Lcl_Scaling.value),"ScalingOffset"in n&&(s.scalingOffset=n.ScalingOffset.value),"ScalingPivot"in n&&(s.scalingPivot=n.ScalingPivot.value),"RotationOffset"in n&&(s.rotationOffset=n.RotationOffset.value),"RotationPivot"in n&&(s.rotationPivot=n.RotationPivot.value),e.userData.transformData=s}setLookAtProperties(e,n){"LookAtProperty"in n&&ye.get(e.ID).children.forEach(function(i){if(i.relationship==="LookAtProperty"){const t=le.Objects.Model[i.ID];if("Lcl_Translation"in t){const r=t.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(r),Se.add(e.target)):e.lookAt(new j().fromArray(r))}}})}bindSkeleton(e,n,s){const i=this.parsePoseNodes();for(const t in e){const r=e[t];ye.get(parseInt(r.ID)).parents.forEach(function(o){if(n.has(o.ID)){const u=o.ID;ye.get(u).parents.forEach(function(f){s.has(f.ID)&&s.get(f.ID).bind(new as(r.bones),i[f.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in le.Objects){const n=le.Objects.Pose;for(const s in n)if(n[s].attrType==="BindPose"&&n[s].NbPoseNodes>0){const i=n[s].PoseNode;Array.isArray(i)?i.forEach(function(t){e[t.Node]=new ie().fromArray(t.Matrix.a)}):e[i.Node]=new ie().fromArray(i.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in le&&"AmbientColor"in le.GlobalSettings){const e=le.GlobalSettings.AmbientColor.value,n=e[0],s=e[1],i=e[2];if(n!==0||s!==0||i!==0){const t=new he(n,s,i).convertSRGBToLinear();Se.add(new ls(t,1))}}}}class Dr{constructor(){this.negativeMaterialIndices=!1}parse(e){const n=new Map;if("Geometry"in le.Objects){const s=le.Objects.Geometry;for(const i in s){const t=ye.get(parseInt(i)),r=this.parseGeometry(t,s[i],e);n.set(parseInt(i),r)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),n}parseGeometry(e,n,s){switch(n.attrType){case"Mesh":return this.parseMeshGeometry(e,n,s);case"NurbsCurve":return this.parseNurbsGeometry(n)}}parseMeshGeometry(e,n,s){const i=s.skeletons,t=[],r=e.parents.map(function(f){return le.Objects.Model[f.ID]});if(r.length===0)return;const a=e.children.reduce(function(f,h){return i[h.ID]!==void 0&&(f=i[h.ID]),f},null);e.children.forEach(function(f){s.morphTargets[f.ID]!==void 0&&t.push(s.morphTargets[f.ID])});const o=r[0],u={};"RotationOrder"in o&&(u.eulerOrder=Vs(o.RotationOrder.value)),"InheritType"in o&&(u.inheritType=parseInt(o.InheritType.value)),"GeometricTranslation"in o&&(u.translation=o.GeometricTranslation.value),"GeometricRotation"in o&&(u.rotation=o.GeometricRotation.value),"GeometricScaling"in o&&(u.scale=o.GeometricScaling.value);const c=Bs(u);return this.genGeometry(n,a,t,c)}genGeometry(e,n,s,i){const t=new _e;e.attrName&&(t.name=e.attrName);const r=this.parseGeoNode(e,n),a=this.genBuffers(r),o=new Ee(a.vertex,3);if(o.applyMatrix4(i),t.setAttribute("position",o),a.colors.length>0&&t.setAttribute("color",new Ee(a.colors,3)),n&&(t.setAttribute("skinIndex",new ri(a.weightsIndices,4)),t.setAttribute("skinWeight",new Ee(a.vertexWeights,4)),t.FBX_Deformer=n),a.normal.length>0){const u=new Ze().getNormalMatrix(i),c=new Ee(a.normal,3);c.applyNormalMatrix(u),t.setAttribute("normal",c)}if(a.uvs.forEach(function(u,c){const f=c===0?"uv":`uv${c}`;t.setAttribute(f,new Ee(a.uvs[c],2))}),r.material&&r.material.mappingType!=="AllSame"){let u=a.materialIndex[0],c=0;if(a.materialIndex.forEach(function(f,h){f!==u&&(t.addGroup(c,h-c,u),u=f,c=h)}),t.groups.length>0){const f=t.groups[t.groups.length-1],h=f.start+f.count;h!==a.materialIndex.length&&t.addGroup(h,a.materialIndex.length-h,u)}t.groups.length===0&&t.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(t,e,s,i),t}parseGeoNode(e,n){const s={};if(s.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],s.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(s.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(s.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(s.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){s.uv=[];let i=0;for(;e.LayerElementUV[i];)e.LayerElementUV[i].UV&&s.uv.push(this.parseUVs(e.LayerElementUV[i])),i++}return s.weightTable={},n!==null&&(s.skeleton=n,n.rawBones.forEach(function(i,t){i.indices.forEach(function(r,a){s.weightTable[r]===void 0&&(s.weightTable[r]=[]),s.weightTable[r].push({id:t,weight:i.weights[a]})})})),s}genBuffers(e){const n={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let s=0,i=0,t=!1,r=[],a=[],o=[],u=[],c=[],f=[];const h=this;return e.vertexIndices.forEach(function(l,d){let p,m=!1;l<0&&(l=l^-1,m=!0);let x=[],T=[];if(r.push(l*3,l*3+1,l*3+2),e.color){const v=kt(d,s,l,e.color);o.push(v[0],v[1],v[2])}if(e.skeleton){if(e.weightTable[l]!==void 0&&e.weightTable[l].forEach(function(v){T.push(v.weight),x.push(v.id)}),T.length>4){t||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),t=!0);const v=[0,0,0,0],b=[0,0,0,0];T.forEach(function(g,w){let S=g,A=x[w];b.forEach(function(P,M,L){if(S>P){L[M]=S,S=P;const E=v[M];v[M]=A,A=E}})}),x=v,T=b}for(;T.length<4;)T.push(0),x.push(0);for(let v=0;v<4;++v)c.push(T[v]),f.push(x[v])}if(e.normal){const v=kt(d,s,l,e.normal);a.push(v[0],v[1],v[2])}e.material&&e.material.mappingType!=="AllSame"&&(p=kt(d,s,l,e.material)[0],p<0&&(h.negativeMaterialIndices=!0,p=0)),e.uv&&e.uv.forEach(function(v,b){const g=kt(d,s,l,v);u[b]===void 0&&(u[b]=[]),u[b].push(g[0]),u[b].push(g[1])}),i++,m&&(i>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),h.genFace(n,e,r,p,a,o,u,c,f,i),s++,i=0,r=[],a=[],o=[],u=[],c=[],f=[])}),n}genFace(e,n,s,i,t,r,a,o,u,c){for(let f=2;f<c;f++)e.vertex.push(n.vertexPositions[s[0]]),e.vertex.push(n.vertexPositions[s[1]]),e.vertex.push(n.vertexPositions[s[2]]),e.vertex.push(n.vertexPositions[s[(f-1)*3]]),e.vertex.push(n.vertexPositions[s[(f-1)*3+1]]),e.vertex.push(n.vertexPositions[s[(f-1)*3+2]]),e.vertex.push(n.vertexPositions[s[f*3]]),e.vertex.push(n.vertexPositions[s[f*3+1]]),e.vertex.push(n.vertexPositions[s[f*3+2]]),n.skeleton&&(e.vertexWeights.push(o[0]),e.vertexWeights.push(o[1]),e.vertexWeights.push(o[2]),e.vertexWeights.push(o[3]),e.vertexWeights.push(o[(f-1)*4]),e.vertexWeights.push(o[(f-1)*4+1]),e.vertexWeights.push(o[(f-1)*4+2]),e.vertexWeights.push(o[(f-1)*4+3]),e.vertexWeights.push(o[f*4]),e.vertexWeights.push(o[f*4+1]),e.vertexWeights.push(o[f*4+2]),e.vertexWeights.push(o[f*4+3]),e.weightsIndices.push(u[0]),e.weightsIndices.push(u[1]),e.weightsIndices.push(u[2]),e.weightsIndices.push(u[3]),e.weightsIndices.push(u[(f-1)*4]),e.weightsIndices.push(u[(f-1)*4+1]),e.weightsIndices.push(u[(f-1)*4+2]),e.weightsIndices.push(u[(f-1)*4+3]),e.weightsIndices.push(u[f*4]),e.weightsIndices.push(u[f*4+1]),e.weightsIndices.push(u[f*4+2]),e.weightsIndices.push(u[f*4+3])),n.color&&(e.colors.push(r[0]),e.colors.push(r[1]),e.colors.push(r[2]),e.colors.push(r[(f-1)*3]),e.colors.push(r[(f-1)*3+1]),e.colors.push(r[(f-1)*3+2]),e.colors.push(r[f*3]),e.colors.push(r[f*3+1]),e.colors.push(r[f*3+2])),n.material&&n.material.mappingType!=="AllSame"&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),n.normal&&(e.normal.push(t[0]),e.normal.push(t[1]),e.normal.push(t[2]),e.normal.push(t[(f-1)*3]),e.normal.push(t[(f-1)*3+1]),e.normal.push(t[(f-1)*3+2]),e.normal.push(t[f*3]),e.normal.push(t[f*3+1]),e.normal.push(t[f*3+2])),n.uv&&n.uv.forEach(function(h,l){e.uvs[l]===void 0&&(e.uvs[l]=[]),e.uvs[l].push(a[l][0]),e.uvs[l].push(a[l][1]),e.uvs[l].push(a[l][(f-1)*2]),e.uvs[l].push(a[l][(f-1)*2+1]),e.uvs[l].push(a[l][f*2]),e.uvs[l].push(a[l][f*2+1])})}addMorphTargets(e,n,s,i){if(s.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const t=this;s.forEach(function(r){r.rawTargets.forEach(function(a){const o=le.Objects.Geometry[a.geoID];o!==void 0&&t.genMorphGeometry(e,n,o,i,a.name)})})}genMorphGeometry(e,n,s,i,t){const r=n.PolygonVertexIndex!==void 0?n.PolygonVertexIndex.a:[],a=s.Vertices!==void 0?s.Vertices.a:[],o=s.Indexes!==void 0?s.Indexes.a:[],u=e.attributes.position.count*3,c=new Float32Array(u);for(let d=0;d<o.length;d++){const p=o[d]*3;c[p]=a[d*3],c[p+1]=a[d*3+1],c[p+2]=a[d*3+2]}const f={vertexIndices:r,vertexPositions:c},h=this.genBuffers(f),l=new Ee(h.vertex,3);l.name=t||s.attrName,l.applyMatrix4(i),e.morphAttributes.position.push(l)}parseNormals(e){const n=e.MappingInformationType,s=e.ReferenceInformationType,i=e.Normals.a;let t=[];return s==="IndexToDirect"&&("NormalIndex"in e?t=e.NormalIndex.a:"NormalsIndex"in e&&(t=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:t,mappingType:n,referenceType:s}}parseUVs(e){const n=e.MappingInformationType,s=e.ReferenceInformationType,i=e.UV.a;let t=[];return s==="IndexToDirect"&&(t=e.UVIndex.a),{dataSize:2,buffer:i,indices:t,mappingType:n,referenceType:s}}parseVertexColors(e){const n=e.MappingInformationType,s=e.ReferenceInformationType,i=e.Colors.a;let t=[];s==="IndexToDirect"&&(t=e.ColorIndex.a);for(let r=0,a=new he;r<i.length;r+=4)a.fromArray(i,r).convertSRGBToLinear().toArray(i,r);return{dataSize:4,buffer:i,indices:t,mappingType:n,referenceType:s}}parseMaterialIndices(e){const n=e.MappingInformationType,s=e.ReferenceInformationType;if(n==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:s};const i=e.Materials.a,t=[];for(let r=0;r<i.length;++r)t.push(r);return{dataSize:1,buffer:i,indices:t,mappingType:n,referenceType:s}}parseNurbsGeometry(e){const n=parseInt(e.Order);if(isNaN(n))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new _e;const s=n-1,i=e.KnotVector.a,t=[],r=e.Points.a;for(let f=0,h=r.length;f<h;f+=4)t.push(new je().fromArray(r,f));let a,o;if(e.Form==="Closed")t.push(t[0]);else if(e.Form==="Periodic"){a=s,o=i.length-1-a;for(let f=0;f<s;++f)t.push(t[f])}const c=new Lr(s,i,t,a,o).getPoints(t.length*12);return new _e().setFromPoints(c)}}class kr{parse(){const e=[],n=this.parseClips();if(n!==void 0)for(const s in n){const i=n[s],t=this.addClip(i);e.push(t)}return e}parseClips(){if(le.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const n=this.parseAnimationLayers(e);return this.parseAnimStacks(n)}parseAnimationCurveNodes(){const e=le.Objects.AnimationCurveNode,n=new Map;for(const s in e){const i=e[s];if(i.attrName.match(/S|R|T|DeformPercent/)!==null){const t={id:i.id,attr:i.attrName,curves:{}};n.set(t.id,t)}}return n}parseAnimationCurves(e){const n=le.Objects.AnimationCurve;for(const s in n){const i={id:n[s].id,times:n[s].KeyTime.a.map(Hr),values:n[s].KeyValueFloat.a},t=ye.get(i.id);if(t!==void 0){const r=t.parents[0].ID,a=t.parents[0].relationship;a.match(/X/)?e.get(r).curves.x=i:a.match(/Y/)?e.get(r).curves.y=i:a.match(/Z/)?e.get(r).curves.z=i:a.match(/DeformPercent/)&&e.has(r)&&(e.get(r).curves.morph=i)}}}parseAnimationLayers(e){const n=le.Objects.AnimationLayer,s=new Map;for(const i in n){const t=[],r=ye.get(parseInt(i));r!==void 0&&(r.children.forEach(function(o,u){if(e.has(o.ID)){const c=e.get(o.ID);if(c.curves.x!==void 0||c.curves.y!==void 0||c.curves.z!==void 0){if(t[u]===void 0){const f=ye.get(o.ID).parents.filter(function(h){return h.relationship!==void 0})[0].ID;if(f!==void 0){const h=le.Objects.Model[f.toString()];if(h===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",o);return}const l={modelName:h.attrName?vt.sanitizeNodeName(h.attrName):"",ID:h.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Se.traverse(function(d){d.ID===h.id&&(l.transform=d.matrix,d.userData.transformData&&(l.eulerOrder=d.userData.transformData.eulerOrder))}),l.transform||(l.transform=new ie),"PreRotation"in h&&(l.preRotation=h.PreRotation.value),"PostRotation"in h&&(l.postRotation=h.PostRotation.value),t[u]=l}}t[u]&&(t[u][c.attr]=c)}else if(c.curves.morph!==void 0){if(t[u]===void 0){const f=ye.get(o.ID).parents.filter(function(x){return x.relationship!==void 0})[0].ID,h=ye.get(f).parents[0].ID,l=ye.get(h).parents[0].ID,d=ye.get(l).parents[0].ID,p=le.Objects.Model[d],m={modelName:p.attrName?vt.sanitizeNodeName(p.attrName):"",morphName:le.Objects.Deformer[f].attrName};t[u]=m}t[u][c.attr]=c}}}),s.set(parseInt(i),t))}return s}parseAnimStacks(e){const n=le.Objects.AnimationStack,s={};for(const i in n){const t=ye.get(parseInt(i)).children;t.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const r=e.get(t[0].ID);s[i]={name:n[i].attrName,layer:r}}return s}addClip(e){let n=[];const s=this;return e.layer.forEach(function(i){n=n.concat(s.generateTracks(i))}),new cs(e.name,-1,n)}generateTracks(e){const n=[];let s=new j,i=new Me,t=new j;if(e.transform&&e.transform.decompose(s,i,t),s=s.toArray(),i=new Ve().setFromQuaternion(i,e.eulerOrder).toArray(),t=t.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const r=this.generateVectorTrack(e.modelName,e.T.curves,s,"position");r!==void 0&&n.push(r)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const r=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);r!==void 0&&n.push(r)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const r=this.generateVectorTrack(e.modelName,e.S.curves,t,"scale");r!==void 0&&n.push(r)}if(e.DeformPercent!==void 0){const r=this.generateMorphTrack(e);r!==void 0&&n.push(r)}return n}generateVectorTrack(e,n,s,i){const t=this.getTimesForAllAxes(n),r=this.getKeyframeTrackValues(t,n,s);return new us(e+"."+i,t,r)}generateRotationTrack(e,n,s,i,t,r){n.x!==void 0&&(this.interpolateRotations(n.x),n.x.values=n.x.values.map(Ie.degToRad)),n.y!==void 0&&(this.interpolateRotations(n.y),n.y.values=n.y.values.map(Ie.degToRad)),n.z!==void 0&&(this.interpolateRotations(n.z),n.z.values=n.z.values.map(Ie.degToRad));const a=this.getTimesForAllAxes(n),o=this.getKeyframeTrackValues(a,n,s);i!==void 0&&(i=i.map(Ie.degToRad),i.push(r),i=new Ve().fromArray(i),i=new Me().setFromEuler(i)),t!==void 0&&(t=t.map(Ie.degToRad),t.push(r),t=new Ve().fromArray(t),t=new Me().setFromEuler(t).invert());const u=new Me,c=new Ve,f=[];for(let h=0;h<o.length;h+=3)c.set(o[h],o[h+1],o[h+2],r),u.setFromEuler(c),i!==void 0&&u.premultiply(i),t!==void 0&&u.multiply(t),u.toArray(f,h/3*4);return new pn(e+".quaternion",a,f)}generateMorphTrack(e){const n=e.DeformPercent.curves.morph,s=n.values.map(function(t){return t/100}),i=Se.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new mn(e.modelName+".morphTargetInfluences["+i+"]",n.times,s)}getTimesForAllAxes(e){let n=[];if(e.x!==void 0&&(n=n.concat(e.x.times)),e.y!==void 0&&(n=n.concat(e.y.times)),e.z!==void 0&&(n=n.concat(e.z.times)),n=n.sort(function(s,i){return s-i}),n.length>1){let s=1,i=n[0];for(let t=1;t<n.length;t++){const r=n[t];r!==i&&(n[s]=r,i=r,s++)}n=n.slice(0,s)}return n}getKeyframeTrackValues(e,n,s){const i=s,t=[];let r=-1,a=-1,o=-1;return e.forEach(function(u){if(n.x&&(r=n.x.times.indexOf(u)),n.y&&(a=n.y.times.indexOf(u)),n.z&&(o=n.z.times.indexOf(u)),r!==-1){const c=n.x.values[r];t.push(c),i[0]=c}else t.push(i[0]);if(a!==-1){const c=n.y.values[a];t.push(c),i[1]=c}else t.push(i[1]);if(o!==-1){const c=n.z.values[o];t.push(c),i[2]=c}else t.push(i[2])}),t}interpolateRotations(e){for(let n=1;n<e.values.length;n++){const s=e.values[n-1],i=e.values[n]-s,t=Math.abs(i);if(t>=180){const r=t/180,a=i/r;let o=s+a;const u=e.times[n-1],f=(e.times[n]-u)/r;let h=u+f;const l=[],d=[];for(;h<e.times[n];)l.push(h),h+=f,d.push(o),o+=a;e.times=Wn(e.times,n,l),e.values=Wn(e.values,n,d)}}}}class Fr{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,n){this.currentProp=e,this.currentPropName=n}parse(e){this.currentIndent=0,this.allNodes=new Fs,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const n=this,s=e.split(/[\r\n]+/);return s.forEach(function(i,t){const r=i.match(/^[\s\t]*;/),a=i.match(/^[\s\t]*$/);if(r||a)return;const o=i.match("^\\t{"+n.currentIndent+"}(\\w+):(.*){",""),u=i.match("^\\t{"+n.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),c=i.match("^\\t{"+(n.currentIndent-1)+"}}");o?n.parseNodeBegin(i,o):u?n.parseNodeProperty(i,u,s[++t]):c?n.popStack():i.match(/^[^\s\t}]/)&&n.parseNodePropertyContinued(i)}),this.allNodes}parseNodeBegin(e,n){const s=n[1].trim().replace(/^"/,"").replace(/"$/,""),i=n[2].split(",").map(function(o){return o.trim().replace(/^"/,"").replace(/"$/,"")}),t={name:s},r=this.parseNodeAttr(i),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(s,t):s in a?(s==="PoseNode"?a.PoseNode.push(t):a[s].id!==void 0&&(a[s]={},a[s][a[s].id]=a[s]),r.id!==""&&(a[s][r.id]=t)):typeof r.id=="number"?(a[s]={},a[s][r.id]=t):s!=="Properties70"&&(s==="PoseNode"?a[s]=[t]:a[s]=t),typeof r.id=="number"&&(t.id=r.id),r.name!==""&&(t.attrName=r.name),r.type!==""&&(t.attrType=r.type),this.pushStack(t)}parseNodeAttr(e){let n=e[0];e[0]!==""&&(n=parseInt(e[0]),isNaN(n)&&(n=e[0]));let s="",i="";return e.length>1&&(s=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:n,name:s,type:i}}parseNodeProperty(e,n,s){let i=n[1].replace(/^"/,"").replace(/"$/,"").trim(),t=n[2].replace(/^"/,"").replace(/"$/,"").trim();i==="Content"&&t===","&&(t=s.replace(/"/g,"").replace(/,$/,"").trim());const r=this.getCurrentNode();if(r.name==="Properties70"){this.parseNodeSpecialProperty(e,i,t);return}if(i==="C"){const o=t.split(",").slice(1),u=parseInt(o[0]),c=parseInt(o[1]);let f=t.split(",").slice(3);f=f.map(function(h){return h.trim().replace(/^"/,"")}),i="connections",t=[u,c],_r(t,f),r[i]===void 0&&(r[i]=[])}i==="Node"&&(r.id=t),i in r&&Array.isArray(r[i])?r[i].push(t):i!=="a"?r[i]=t:r.a=t,this.setCurrentProp(r,i),i==="a"&&t.slice(-1)!==","&&(r.a=on(t))}parseNodePropertyContinued(e){const n=this.getCurrentNode();n.a+=e,e.slice(-1)!==","&&(n.a=on(n.a))}parseNodeSpecialProperty(e,n,s){const i=s.split('",').map(function(c){return c.trim().replace(/^\"/,"").replace(/\s/,"_")}),t=i[0],r=i[1],a=i[2],o=i[3];let u=i[4];switch(r){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":u=parseFloat(u);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":u=on(u);break}this.getPrevNode()[t]={type:r,type2:a,flag:o,value:u},this.setCurrentProp(this.getPrevNode(),t)}}class Br{parse(e){const n=new zn(e);n.skip(23);const s=n.getUint32();if(s<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+s);const i=new Fs;for(;!this.endOfContent(n);){const t=this.parseNode(n,s);t!==null&&i.add(t.name,t)}return i}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,n){const s={},i=n>=7500?e.getUint64():e.getUint32(),t=n>=7500?e.getUint64():e.getUint32();n>=7500?e.getUint64():e.getUint32();const r=e.getUint8(),a=e.getString(r);if(i===0)return null;const o=[];for(let h=0;h<t;h++)o.push(this.parseProperty(e));const u=o.length>0?o[0]:"",c=o.length>1?o[1]:"",f=o.length>2?o[2]:"";for(s.singleProperty=t===1&&e.getOffset()===i;i>e.getOffset();){const h=this.parseNode(e,n);h!==null&&this.parseSubNode(a,s,h)}return s.propertyList=o,typeof u=="number"&&(s.id=u),c!==""&&(s.attrName=c),f!==""&&(s.attrType=f),a!==""&&(s.name=a),s}parseSubNode(e,n,s){if(s.singleProperty===!0){const i=s.propertyList[0];Array.isArray(i)?(n[s.name]=s,s.a=i):n[s.name]=i}else if(e==="Connections"&&s.name==="C"){const i=[];s.propertyList.forEach(function(t,r){r!==0&&i.push(t)}),n.connections===void 0&&(n.connections=[]),n.connections.push(i)}else if(s.name==="Properties70")Object.keys(s).forEach(function(t){n[t]=s[t]});else if(e==="Properties70"&&s.name==="P"){let i=s.propertyList[0],t=s.propertyList[1];const r=s.propertyList[2],a=s.propertyList[3];let o;i.indexOf("Lcl ")===0&&(i=i.replace("Lcl ","Lcl_")),t.indexOf("Lcl ")===0&&(t=t.replace("Lcl ","Lcl_")),t==="Color"||t==="ColorRGB"||t==="Vector"||t==="Vector3D"||t.indexOf("Lcl_")===0?o=[s.propertyList[4],s.propertyList[5],s.propertyList[6]]:o=s.propertyList[4],n[i]={type:t,type2:r,flag:a,value:o}}else n[s.name]===void 0?typeof s.id=="number"?(n[s.name]={},n[s.name][s.id]=s):n[s.name]=s:s.name==="PoseNode"?(Array.isArray(n[s.name])||(n[s.name]=[n[s.name]]),n[s.name].push(s)):n[s.name][s.id]===void 0&&(n[s.name][s.id]=s)}parseProperty(e){const n=e.getString(1);let s;switch(n){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return s=e.getUint32(),e.getArrayBuffer(s);case"S":return s=e.getUint32(),e.getString(s);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=e.getUint32(),t=e.getUint32(),r=e.getUint32();if(t===0)switch(n){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}const a=wr(new Uint8Array(e.getArrayBuffer(r))),o=new zn(a.buffer);switch(n){case"b":case"c":return o.getBooleanArray(i);case"d":return o.getFloat64Array(i);case"f":return o.getFloat32Array(i);case"i":return o.getInt32Array(i);case"l":return o.getInt64Array(i)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+n)}}}class zn{constructor(e,n){this.dv=new DataView(e),this.offset=0,this.littleEndian=n!==void 0?n:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const n=[];for(let s=0;s<e;s++)n.push(this.getBoolean());return n}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const n=[];for(let s=0;s<e;s++)n.push(this.getInt32());return n}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,n;return this.littleEndian?(e=this.getUint32(),n=this.getUint32()):(n=this.getUint32(),e=this.getUint32()),n&2147483648?(n=~n&4294967295,e=~e&4294967295,e===4294967295&&(n=n+1&4294967295),e=e+1&4294967295,-(n*4294967296+e)):n*4294967296+e}getInt64Array(e){const n=[];for(let s=0;s<e;s++)n.push(this.getInt64());return n}getUint64(){let e,n;return this.littleEndian?(e=this.getUint32(),n=this.getUint32()):(n=this.getUint32(),e=this.getUint32()),n*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const n=[];for(let s=0;s<e;s++)n.push(this.getFloat32());return n}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const n=[];for(let s=0;s<e;s++)n.push(this.getFloat64());return n}getArrayBuffer(e){const n=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,n}getString(e){const n=this.offset;let s=new Uint8Array(this.dv.buffer,n,e);this.skip(e);const i=s.indexOf(0);return i>=0&&(s=new Uint8Array(this.dv.buffer,n,i)),this._textDecoder.decode(s)}}class Fs{add(e,n){this[e]=n}}function Vr(y){const e="Kaydara FBX Binary  \0";return y.byteLength>=e.length&&e===Ns(y,0,e.length)}function Nr(y){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function s(i){const t=y[i-1];return y=y.slice(n+i),n++,t}for(let i=0;i<e.length;++i)if(s(1)===e[i])return!1;return!0}function Gn(y){const e=/FBXVersion: (\d+)/,n=y.match(e);if(n)return parseInt(n[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Hr(y){return y/46186158e3}const Ur=[];function kt(y,e,n,s){let i;switch(s.mappingType){case"ByPolygonVertex":i=y;break;case"ByPolygon":i=e;break;case"ByVertice":i=n;break;case"AllSame":i=s.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+s.mappingType)}s.referenceType==="IndexToDirect"&&(i=s.indices[i]);const t=i*s.dataSize,r=t+s.dataSize;return zr(Ur,s.buffer,t,r)}const rn=new Ve,lt=new j;function Bs(y){const e=new ie,n=new ie,s=new ie,i=new ie,t=new ie,r=new ie,a=new ie,o=new ie,u=new ie,c=new ie,f=new ie,h=new ie,l=y.inheritType?y.inheritType:0;if(y.translation&&e.setPosition(lt.fromArray(y.translation)),y.preRotation){const M=y.preRotation.map(Ie.degToRad);M.push(y.eulerOrder||Ve.DEFAULT_ORDER),n.makeRotationFromEuler(rn.fromArray(M))}if(y.rotation){const M=y.rotation.map(Ie.degToRad);M.push(y.eulerOrder||Ve.DEFAULT_ORDER),s.makeRotationFromEuler(rn.fromArray(M))}if(y.postRotation){const M=y.postRotation.map(Ie.degToRad);M.push(y.eulerOrder||Ve.DEFAULT_ORDER),i.makeRotationFromEuler(rn.fromArray(M)),i.invert()}y.scale&&t.scale(lt.fromArray(y.scale)),y.scalingOffset&&a.setPosition(lt.fromArray(y.scalingOffset)),y.scalingPivot&&r.setPosition(lt.fromArray(y.scalingPivot)),y.rotationOffset&&o.setPosition(lt.fromArray(y.rotationOffset)),y.rotationPivot&&u.setPosition(lt.fromArray(y.rotationPivot)),y.parentMatrixWorld&&(f.copy(y.parentMatrix),c.copy(y.parentMatrixWorld));const d=n.clone().multiply(s).multiply(i),p=new ie;p.extractRotation(c);const m=new ie;m.copyPosition(c);const x=m.clone().invert().multiply(c),T=p.clone().invert().multiply(x),v=t,b=new ie;if(l===0)b.copy(p).multiply(d).multiply(T).multiply(v);else if(l===1)b.copy(p).multiply(T).multiply(d).multiply(v);else{const L=new ie().scale(new j().setFromMatrixScale(f)).clone().invert(),E=T.clone().multiply(L);b.copy(p).multiply(d).multiply(E).multiply(v)}const g=u.clone().invert(),w=r.clone().invert();let S=e.clone().multiply(o).multiply(u).multiply(n).multiply(s).multiply(i).multiply(g).multiply(a).multiply(r).multiply(t).multiply(w);const A=new ie().copyPosition(S),P=c.clone().multiply(A);return h.copyPosition(P),S=h.clone().multiply(b),S.premultiply(c.invert()),S}function Vs(y){y=y||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return y===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[y]}function on(y){return y.split(",").map(function(n){return parseFloat(n)})}function Ns(y,e,n){return e===void 0&&(e=0),n===void 0&&(n=y.byteLength),new TextDecoder().decode(new Uint8Array(y,e,n))}function _r(y,e){for(let n=0,s=y.length,i=e.length;n<i;n++,s++)y[s]=e[n]}function zr(y,e,n,s){for(let i=n,t=0;i<s;i++,t++)y[t]=e[i];return y}function Wn(y,e,n){return y.slice(0,e).concat(n).concat(y.slice(e))}function jn(y,e){if(e===oi)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),y;if(e===gn||e===fs){let n=y.getIndex();if(n===null){const r=[],a=y.getAttribute("position");if(a!==void 0){for(let o=0;o<a.count;o++)r.push(o);y.setIndex(r),n=y.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),y}const s=n.count-2,i=[];if(e===gn)for(let r=1;r<=s;r++)i.push(n.getX(0)),i.push(n.getX(r)),i.push(n.getX(r+1));else for(let r=0;r<s;r++)r%2===0?(i.push(n.getX(r)),i.push(n.getX(r+1)),i.push(n.getX(r+2))):(i.push(n.getX(r+2)),i.push(n.getX(r+1)),i.push(n.getX(r)));i.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const t=y.clone();return t.setIndex(i),t.clearGroups(),t}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),y}class Hs extends xt{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new Kr(n)}),this.register(function(n){return new to(n)}),this.register(function(n){return new no(n)}),this.register(function(n){return new so(n)}),this.register(function(n){return new Qr(n)}),this.register(function(n){return new qr(n)}),this.register(function(n){return new Zr(n)}),this.register(function(n){return new $r(n)}),this.register(function(n){return new Xr(n)}),this.register(function(n){return new Jr(n)}),this.register(function(n){return new Yr(n)}),this.register(function(n){return new eo(n)}),this.register(function(n){return new Wr(n)}),this.register(function(n){return new io(n)}),this.register(function(n){return new ro(n)})}load(e,n,s,i){const t=this;let r;this.resourcePath!==""?r=this.resourcePath:this.path!==""?r=this.path:r=Vt.extractUrlBase(e),this.manager.itemStart(e);const a=function(u){i?i(u):console.error(u),t.manager.itemError(e),t.manager.itemEnd(e)},o=new Ct(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(u){try{t.parse(u,r,function(c){n(c),t.manager.itemEnd(e)},a)}catch(c){a(c)}},s,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,s,i){let t;const r={},a={},o=new TextDecoder;if(typeof e=="string")t=JSON.parse(e);else if(e instanceof ArrayBuffer)if(o.decode(new Uint8Array(e,0,4))===Us){try{r[ce.KHR_BINARY_GLTF]=new oo(e)}catch(f){i&&i(f);return}t=JSON.parse(r[ce.KHR_BINARY_GLTF].content)}else t=JSON.parse(o.decode(e));else t=e;if(t.asset===void 0||t.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const u=new wo(t,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const f=this.pluginCallbacks[c](u);a[f.name]=f,r[f.name]=!0}if(t.extensionsUsed)for(let c=0;c<t.extensionsUsed.length;++c){const f=t.extensionsUsed[c],h=t.extensionsRequired||[];switch(f){case ce.KHR_MATERIALS_UNLIT:r[f]=new jr;break;case ce.KHR_DRACO_MESH_COMPRESSION:r[f]=new ao(t,this.dracoLoader);break;case ce.KHR_TEXTURE_TRANSFORM:r[f]=new lo;break;case ce.KHR_MESH_QUANTIZATION:r[f]=new co;break;default:h.indexOf(f)>=0&&a[f]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+f+'".')}}u.setExtensions(r),u.setPlugins(a),u.parse(s,i)}parseAsync(e,n){const s=this;return new Promise(function(i,t){s.parse(e,n,i,t)})}}function Gr(){let y={};return{get:function(e){return y[e]},add:function(e,n){y[e]=n},remove:function(e){delete y[e]},removeAll:function(){y={}}}}const ce={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Wr{constructor(e){this.parser=e,this.name=ce.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,n=this.parser.json.nodes||[];for(let s=0,i=n.length;s<i;s++){const t=n[s];t.extensions&&t.extensions[this.name]&&t.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,t.extensions[this.name].light)}}_loadLight(e){const n=this.parser,s="light:"+e;let i=n.cache.get(s);if(i)return i;const t=n.json,o=((t.extensions&&t.extensions[this.name]||{}).lights||[])[e];let u;const c=new he(16777215);o.color!==void 0&&c.fromArray(o.color);const f=o.range!==void 0?o.range:0;switch(o.type){case"directional":u=new Pn(c),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new Ht(c),u.distance=f;break;case"spot":u=new Mn(c),u.distance=f,o.spot=o.spot||{},o.spot.innerConeAngle=o.spot.innerConeAngle!==void 0?o.spot.innerConeAngle:0,o.spot.outerConeAngle=o.spot.outerConeAngle!==void 0?o.spot.outerConeAngle:Math.PI/4,u.angle=o.spot.outerConeAngle,u.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return u.position.set(0,0,0),u.decay=2,$e(u,o),o.intensity!==void 0&&(u.intensity=o.intensity),u.name=n.createUniqueName(o.name||"light_"+e),i=Promise.resolve(u),n.cache.add(s,i),i}getDependency(e,n){if(e==="light")return this._loadLight(n)}createNodeAttachment(e){const n=this,s=this.parser,t=s.json.nodes[e],a=(t.extensions&&t.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(o){return s._getNodeRef(n.cache,a,o)})}}class jr{constructor(){this.name=ce.KHR_MATERIALS_UNLIT}getMaterialType(){return Ne}extendParams(e,n,s){const i=[];e.color=new he(1,1,1),e.opacity=1;const t=n.pbrMetallicRoughness;if(t){if(Array.isArray(t.baseColorFactor)){const r=t.baseColorFactor;e.color.fromArray(r),e.opacity=r[3]}t.baseColorTexture!==void 0&&i.push(s.assignTexture(e,"map",t.baseColorTexture,Ue))}return Promise.all(i)}}class Xr{constructor(e){this.parser=e,this.name=ce.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,n){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const t=i.extensions[this.name].emissiveStrength;return t!==void 0&&(n.emissiveIntensity=t),Promise.resolve()}}class Kr{constructor(e){this.parser=e,this.name=ce.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Ke}extendMaterialParams(e,n){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const t=[],r=i.extensions[this.name];if(r.clearcoatFactor!==void 0&&(n.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&t.push(s.assignTexture(n,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&t.push(s.assignTexture(n,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(t.push(s.assignTexture(n,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const a=r.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new se(a,a)}return Promise.all(t)}}class Yr{constructor(e){this.parser=e,this.name=ce.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Ke}extendMaterialParams(e,n){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const t=[],r=i.extensions[this.name];return r.iridescenceFactor!==void 0&&(n.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&t.push(s.assignTexture(n,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(n.iridescenceIOR=r.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&t.push(s.assignTexture(n,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(t)}}class Qr{constructor(e){this.parser=e,this.name=ce.KHR_MATERIALS_SHEEN}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Ke}extendMaterialParams(e,n){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const t=[];n.sheenColor=new he(0,0,0),n.sheenRoughness=0,n.sheen=1;const r=i.extensions[this.name];return r.sheenColorFactor!==void 0&&n.sheenColor.fromArray(r.sheenColorFactor),r.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&t.push(s.assignTexture(n,"sheenColorMap",r.sheenColorTexture,Ue)),r.sheenRoughnessTexture!==void 0&&t.push(s.assignTexture(n,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(t)}}class qr{constructor(e){this.parser=e,this.name=ce.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Ke}extendMaterialParams(e,n){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const t=[],r=i.extensions[this.name];return r.transmissionFactor!==void 0&&(n.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&t.push(s.assignTexture(n,"transmissionMap",r.transmissionTexture)),Promise.all(t)}}class Zr{constructor(e){this.parser=e,this.name=ce.KHR_MATERIALS_VOLUME}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Ke}extendMaterialParams(e,n){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const t=[],r=i.extensions[this.name];n.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&t.push(s.assignTexture(n,"thicknessMap",r.thicknessTexture)),n.attenuationDistance=r.attenuationDistance||1/0;const a=r.attenuationColor||[1,1,1];return n.attenuationColor=new he(a[0],a[1],a[2]),Promise.all(t)}}class $r{constructor(e){this.parser=e,this.name=ce.KHR_MATERIALS_IOR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Ke}extendMaterialParams(e,n){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const t=i.extensions[this.name];return n.ior=t.ior!==void 0?t.ior:1.5,Promise.resolve()}}class Jr{constructor(e){this.parser=e,this.name=ce.KHR_MATERIALS_SPECULAR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Ke}extendMaterialParams(e,n){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const t=[],r=i.extensions[this.name];n.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&t.push(s.assignTexture(n,"specularIntensityMap",r.specularTexture));const a=r.specularColorFactor||[1,1,1];return n.specularColor=new he(a[0],a[1],a[2]),r.specularColorTexture!==void 0&&t.push(s.assignTexture(n,"specularColorMap",r.specularColorTexture,Ue)),Promise.all(t)}}class eo{constructor(e){this.parser=e,this.name=ce.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Ke}extendMaterialParams(e,n){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const t=[],r=i.extensions[this.name];return r.anisotropyStrength!==void 0&&(n.anisotropy=r.anisotropyStrength),r.anisotropyRotation!==void 0&&(n.anisotropyRotation=r.anisotropyRotation),r.anisotropyTexture!==void 0&&t.push(s.assignTexture(n,"anisotropyMap",r.anisotropyTexture)),Promise.all(t)}}class to{constructor(e){this.parser=e,this.name=ce.KHR_TEXTURE_BASISU}loadTexture(e){const n=this.parser,s=n.json,i=s.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const t=i.extensions[this.name],r=n.options.ktx2Loader;if(!r){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(e,t.source,r)}}class no{constructor(e){this.parser=e,this.name=ce.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const n=this.name,s=this.parser,i=s.json,t=i.textures[e];if(!t.extensions||!t.extensions[n])return null;const r=t.extensions[n],a=i.images[r.source];let o=s.textureLoader;if(a.uri){const u=s.options.manager.getHandler(a.uri);u!==null&&(o=u)}return this.detectSupport().then(function(u){if(u)return s.loadTextureImage(e,r.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class so{constructor(e){this.parser=e,this.name=ce.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const n=this.name,s=this.parser,i=s.json,t=i.textures[e];if(!t.extensions||!t.extensions[n])return null;const r=t.extensions[n],a=i.images[r.source];let o=s.textureLoader;if(a.uri){const u=s.options.manager.getHandler(a.uri);u!==null&&(o=u)}return this.detectSupport().then(function(u){if(u)return s.loadTextureImage(e,r.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class io{constructor(e){this.name=ce.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const n=this.parser.json,s=n.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const i=s.extensions[this.name],t=this.parser.getDependency("buffer",i.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return t.then(function(a){const o=i.byteOffset||0,u=i.byteLength||0,c=i.count,f=i.byteStride,h=new Uint8Array(a,o,u);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(c,f,h,i.mode,i.filter).then(function(l){return l.buffer}):r.ready.then(function(){const l=new ArrayBuffer(c*f);return r.decodeGltfBuffer(new Uint8Array(l),c,f,h,i.mode,i.filter),l})})}else return null}}class ro{constructor(e){this.name=ce.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const n=this.parser.json,s=n.nodes[e];if(!s.extensions||!s.extensions[this.name]||s.mesh===void 0)return null;const i=n.meshes[s.mesh];for(const u of i.primitives)if(u.mode!==Le.TRIANGLES&&u.mode!==Le.TRIANGLE_STRIP&&u.mode!==Le.TRIANGLE_FAN&&u.mode!==void 0)return null;const r=s.extensions[this.name].attributes,a=[],o={};for(const u in r)a.push(this.parser.getDependency("accessor",r[u]).then(c=>(o[u]=c,o[u])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(u=>{const c=u.pop(),f=c.isGroup?c.children:[c],h=u[0].count,l=[];for(const d of f){const p=new ie,m=new j,x=new Me,T=new j(1,1,1),v=new ai(d.geometry,d.material,h);for(let b=0;b<h;b++)o.TRANSLATION&&m.fromBufferAttribute(o.TRANSLATION,b),o.ROTATION&&x.fromBufferAttribute(o.ROTATION,b),o.SCALE&&T.fromBufferAttribute(o.SCALE,b),v.setMatrixAt(b,p.compose(m,x,T));for(const b in o)b!=="TRANSLATION"&&b!=="ROTATION"&&b!=="SCALE"&&d.geometry.setAttribute(b,o[b]);et.prototype.copy.call(v,d),this.parser.assignFinalMaterial(v),l.push(v)}return c.isGroup?(c.clear(),c.add(...l),c):l[0]}))}}const Us="glTF",dt=12,Xn={JSON:1313821514,BIN:5130562};class oo{constructor(e){this.name=ce.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(e,0,dt),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==Us)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-dt,t=new DataView(e,dt);let r=0;for(;r<i;){const a=t.getUint32(r,!0);r+=4;const o=t.getUint32(r,!0);if(r+=4,o===Xn.JSON){const u=new Uint8Array(e,dt+r,a);this.content=s.decode(u)}else if(o===Xn.BIN){const u=dt+r;this.body=e.slice(u,u+a)}r+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ao{constructor(e,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ce.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(e,n){const s=this.json,i=this.dracoLoader,t=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,a={},o={},u={};for(const c in r){const f=vn[c]||c.toLowerCase();a[f]=r[c]}for(const c in e.attributes){const f=vn[c]||c.toLowerCase();if(r[c]!==void 0){const h=s.accessors[e.attributes[c]],l=ut[h.componentType];u[f]=l.name,o[f]=h.normalized===!0}}return n.getDependency("bufferView",t).then(function(c){return new Promise(function(f){i.decodeDracoFile(c,function(h){for(const l in h.attributes){const d=h.attributes[l],p=o[l];p!==void 0&&(d.normalized=p)}f(h)},a,u)})})}}class lo{constructor(){this.name=ce.KHR_TEXTURE_TRANSFORM}extendTexture(e,n){return(n.texCoord===void 0||n.texCoord===e.channel)&&n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(e=e.clone(),n.texCoord!==void 0&&(e.channel=n.texCoord),n.offset!==void 0&&e.offset.fromArray(n.offset),n.rotation!==void 0&&(e.rotation=n.rotation),n.scale!==void 0&&e.repeat.fromArray(n.scale),e.needsUpdate=!0),e}}class co{constructor(){this.name=ce.KHR_MESH_QUANTIZATION}}class _s extends wi{constructor(e,n,s,i){super(e,n,s,i)}copySampleValue_(e){const n=this.resultBuffer,s=this.sampleValues,i=this.valueSize,t=e*i*3+i;for(let r=0;r!==i;r++)n[r]=s[t+r];return n}interpolate_(e,n,s,i){const t=this.resultBuffer,r=this.sampleValues,a=this.valueSize,o=a*2,u=a*3,c=i-n,f=(s-n)/c,h=f*f,l=h*f,d=e*u,p=d-u,m=-2*l+3*h,x=l-h,T=1-m,v=x-h+f;for(let b=0;b!==a;b++){const g=r[p+b+a],w=r[p+b+o]*c,S=r[d+b+a],A=r[d+b]*c;t[b]=T*g+v*w+m*S+x*A}return t}}const uo=new Me;class fo extends _s{interpolate_(e,n,s,i){const t=super.interpolate_(e,n,s,i);return uo.fromArray(t).normalize().toArray(t),t}}const Le={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},ut={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Kn={9728:fi,9729:hs,9984:hi,9985:di,9986:pi,9987:ds},Yn={33071:hn,33648:mi,10497:Xe},an={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},vn={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},qe={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ho={CUBICSPLINE:void 0,LINEAR:ps,STEP:gi},ln={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function po(y){return y.DefaultMaterial===void 0&&(y.DefaultMaterial=new Gt({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:yi})),y.DefaultMaterial}function nt(y,e,n){for(const s in n.extensions)y[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=n.extensions[s])}function $e(y,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(y.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function mo(y,e,n){let s=!1,i=!1,t=!1;for(let u=0,c=e.length;u<c;u++){const f=e[u];if(f.POSITION!==void 0&&(s=!0),f.NORMAL!==void 0&&(i=!0),f.COLOR_0!==void 0&&(t=!0),s&&i&&t)break}if(!s&&!i&&!t)return Promise.resolve(y);const r=[],a=[],o=[];for(let u=0,c=e.length;u<c;u++){const f=e[u];if(s){const h=f.POSITION!==void 0?n.getDependency("accessor",f.POSITION):y.attributes.position;r.push(h)}if(i){const h=f.NORMAL!==void 0?n.getDependency("accessor",f.NORMAL):y.attributes.normal;a.push(h)}if(t){const h=f.COLOR_0!==void 0?n.getDependency("accessor",f.COLOR_0):y.attributes.color;o.push(h)}}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(o)]).then(function(u){const c=u[0],f=u[1],h=u[2];return s&&(y.morphAttributes.position=c),i&&(y.morphAttributes.normal=f),t&&(y.morphAttributes.color=h),y.morphTargetsRelative=!0,y})}function go(y,e){if(y.updateMorphTargets(),e.weights!==void 0)for(let n=0,s=e.weights.length;n<s;n++)y.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(y.morphTargetInfluences.length===n.length){y.morphTargetDictionary={};for(let s=0,i=n.length;s<i;s++)y.morphTargetDictionary[n[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function yo(y){let e;const n=y.extensions&&y.extensions[ce.KHR_DRACO_MESH_COMPRESSION];if(n?e="draco:"+n.bufferView+":"+n.indices+":"+cn(n.attributes):e=y.indices+":"+cn(y.attributes)+":"+y.mode,y.targets!==void 0)for(let s=0,i=y.targets.length;s<i;s++)e+=":"+cn(y.targets[s]);return e}function cn(y){let e="";const n=Object.keys(y).sort();for(let s=0,i=n.length;s<i;s++)e+=n[s]+":"+y[n[s]]+";";return e}function wn(y){switch(y){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function xo(y){return y.search(/\.jpe?g($|\?)/i)>0||y.search(/^data\:image\/jpeg/)===0?"image/jpeg":y.search(/\.webp($|\?)/i)>0||y.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const vo=new ie;class wo{constructor(e={},n={}){this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new Gr,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,i=!1,t=-1;typeof navigator<"u"&&(s=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,i=navigator.userAgent.indexOf("Firefox")>-1,t=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||s||i&&t<98?this.textureLoader=new Wt(this.options.manager):this.textureLoader=new li(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Ct(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,n){const s=this,i=this.json,t=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(r){const a={scene:r[0][i.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:i.asset,parser:s,userData:{}};nt(t,a,i),$e(a,i),Promise.all(s._invokeAll(function(o){return o.afterRoot&&o.afterRoot(a)})).then(function(){e(a)})}).catch(n)}_markDefs(){const e=this.json.nodes||[],n=this.json.skins||[],s=this.json.meshes||[];for(let i=0,t=n.length;i<t;i++){const r=n[i].joints;for(let a=0,o=r.length;a<o;a++)e[r[a]].isBone=!0}for(let i=0,t=e.length;i<t;i++){const r=e[i];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(s[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,n){n!==void 0&&(e.refs[n]===void 0&&(e.refs[n]=e.uses[n]=0),e.refs[n]++)}_getNodeRef(e,n,s){if(e.refs[n]<=1)return s;const i=s.clone(),t=(r,a)=>{const o=this.associations.get(r);o!=null&&this.associations.set(a,o);for(const[u,c]of r.children.entries())t(c,a.children[u])};return t(s,i),i.name+="_instance_"+e.uses[n]++,i}_invokeOne(e){const n=Object.values(this.plugins);n.push(this);for(let s=0;s<n.length;s++){const i=e(n[s]);if(i)return i}return null}_invokeAll(e){const n=Object.values(this.plugins);n.unshift(this);const s=[];for(let i=0;i<n.length;i++){const t=e(n[i]);t&&s.push(t)}return s}getDependency(e,n){const s=e+":"+n;let i=this.cache.get(s);if(!i){switch(e){case"scene":i=this.loadScene(n);break;case"node":i=this._invokeOne(function(t){return t.loadNode&&t.loadNode(n)});break;case"mesh":i=this._invokeOne(function(t){return t.loadMesh&&t.loadMesh(n)});break;case"accessor":i=this.loadAccessor(n);break;case"bufferView":i=this._invokeOne(function(t){return t.loadBufferView&&t.loadBufferView(n)});break;case"buffer":i=this.loadBuffer(n);break;case"material":i=this._invokeOne(function(t){return t.loadMaterial&&t.loadMaterial(n)});break;case"texture":i=this._invokeOne(function(t){return t.loadTexture&&t.loadTexture(n)});break;case"skin":i=this.loadSkin(n);break;case"animation":i=this._invokeOne(function(t){return t.loadAnimation&&t.loadAnimation(n)});break;case"camera":i=this.loadCamera(n);break;default:if(i=this._invokeOne(function(t){return t!=this&&t.getDependency&&t.getDependency(e,n)}),!i)throw new Error("Unknown type: "+e);break}this.cache.add(s,i)}return i}getDependencies(e){let n=this.cache.get(e);if(!n){const s=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];n=Promise.all(i.map(function(t,r){return s.getDependency(e,r)})),this.cache.add(e,n)}return n}loadBuffer(e){const n=this.json.buffers[e],s=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&e===0)return Promise.resolve(this.extensions[ce.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(t,r){s.load(Vt.resolveURL(n.uri,i.path),t,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(e){const n=this.json.bufferViews[e];return this.getDependency("buffer",n.buffer).then(function(s){const i=n.byteLength||0,t=n.byteOffset||0;return s.slice(t,t+i)})}loadAccessor(e){const n=this,s=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0){const r=an[i.type],a=ut[i.componentType],o=i.normalized===!0,u=new a(i.count*r);return Promise.resolve(new He(u,r,o))}const t=[];return i.bufferView!==void 0?t.push(this.getDependency("bufferView",i.bufferView)):t.push(null),i.sparse!==void 0&&(t.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),t.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(t).then(function(r){const a=r[0],o=an[i.type],u=ut[i.componentType],c=u.BYTES_PER_ELEMENT,f=c*o,h=i.byteOffset||0,l=i.bufferView!==void 0?s.bufferViews[i.bufferView].byteStride:void 0,d=i.normalized===!0;let p,m;if(l&&l!==f){const x=Math.floor(h/l),T="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+x+":"+i.count;let v=n.cache.get(T);v||(p=new u(a,x*l,i.count*l/c),v=new ci(p,l/c),n.cache.add(T,v)),m=new xi(v,o,h%l/c,d)}else a===null?p=new u(i.count*o):p=new u(a,h,i.count*o),m=new He(p,o,d);if(i.sparse!==void 0){const x=an.SCALAR,T=ut[i.sparse.indices.componentType],v=i.sparse.indices.byteOffset||0,b=i.sparse.values.byteOffset||0,g=new T(r[1],v,i.sparse.count*x),w=new u(r[2],b,i.sparse.count*o);a!==null&&(m=new He(m.array.slice(),m.itemSize,m.normalized));for(let S=0,A=g.length;S<A;S++){const P=g[S];if(m.setX(P,w[S*o]),o>=2&&m.setY(P,w[S*o+1]),o>=3&&m.setZ(P,w[S*o+2]),o>=4&&m.setW(P,w[S*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return m})}loadTexture(e){const n=this.json,s=this.options,t=n.textures[e].source,r=n.images[t];let a=this.textureLoader;if(r.uri){const o=s.manager.getHandler(r.uri);o!==null&&(a=o)}return this.loadTextureImage(e,t,a)}loadTextureImage(e,n,s){const i=this,t=this.json,r=t.textures[e],a=t.images[n],o=(a.uri||a.bufferView)+":"+r.sampler;if(this.textureCache[o])return this.textureCache[o];const u=this.loadImageSource(n,s).then(function(c){c.flipY=!1,c.name=r.name||a.name||"",c.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(c.name=a.uri);const h=(t.samplers||{})[r.sampler]||{};return c.magFilter=Kn[h.magFilter]||hs,c.minFilter=Kn[h.minFilter]||ds,c.wrapS=Yn[h.wrapS]||Xe,c.wrapT=Yn[h.wrapT]||Xe,i.associations.set(c,{textures:e}),c}).catch(function(){return null});return this.textureCache[o]=u,u}loadImageSource(e,n){const s=this,i=this.json,t=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(f=>f.clone());const r=i.images[e],a=self.URL||self.webkitURL;let o=r.uri||"",u=!1;if(r.bufferView!==void 0)o=s.getDependency("bufferView",r.bufferView).then(function(f){u=!0;const h=new Blob([f],{type:r.mimeType});return o=a.createObjectURL(h),o});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const c=Promise.resolve(o).then(function(f){return new Promise(function(h,l){let d=h;n.isImageBitmapLoader===!0&&(d=function(p){const m=new Nt(p);m.needsUpdate=!0,h(m)}),n.load(Vt.resolveURL(f,t.path),d,void 0,l)})}).then(function(f){return u===!0&&a.revokeObjectURL(o),f.userData.mimeType=r.mimeType||xo(r.uri),f}).catch(function(f){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),f});return this.sourceCache[e]=c,c}assignTexture(e,n,s,i){const t=this;return this.getDependency("texture",s.index).then(function(r){if(!r)return null;if(s.texCoord!==void 0&&s.texCoord>0&&(r=r.clone(),r.channel=s.texCoord),t.extensions[ce.KHR_TEXTURE_TRANSFORM]){const a=s.extensions!==void 0?s.extensions[ce.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const o=t.associations.get(r);r=t.extensions[ce.KHR_TEXTURE_TRANSFORM].extendTexture(r,a),t.associations.set(r,o)}}return i!==void 0&&(r.colorSpace=i),e[n]=r,r})}assignFinalMaterial(e){const n=e.geometry;let s=e.material;const i=n.attributes.tangent===void 0,t=n.attributes.color!==void 0,r=n.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+s.uuid;let o=this.cache.get(a);o||(o=new ns,Zt.prototype.copy.call(o,s),o.color.copy(s.color),o.map=s.map,o.sizeAttenuation=!1,this.cache.add(a,o)),s=o}else if(e.isLine){const a="LineBasicMaterial:"+s.uuid;let o=this.cache.get(a);o||(o=new Pt,Zt.prototype.copy.call(o,s),o.color.copy(s.color),o.map=s.map,this.cache.add(a,o)),s=o}if(i||t||r){let a="ClonedMaterial:"+s.uuid+":";i&&(a+="derivative-tangents:"),t&&(a+="vertex-colors:"),r&&(a+="flat-shading:");let o=this.cache.get(a);o||(o=s.clone(),t&&(o.vertexColors=!0),r&&(o.flatShading=!0),i&&(o.normalScale&&(o.normalScale.y*=-1),o.clearcoatNormalScale&&(o.clearcoatNormalScale.y*=-1)),this.cache.add(a,o),this.associations.set(o,this.associations.get(s))),s=o}e.material=s}getMaterialType(){return Gt}loadMaterial(e){const n=this,s=this.json,i=this.extensions,t=s.materials[e];let r;const a={},o=t.extensions||{},u=[];if(o[ce.KHR_MATERIALS_UNLIT]){const f=i[ce.KHR_MATERIALS_UNLIT];r=f.getMaterialType(),u.push(f.extendParams(a,t,n))}else{const f=t.pbrMetallicRoughness||{};if(a.color=new he(1,1,1),a.opacity=1,Array.isArray(f.baseColorFactor)){const h=f.baseColorFactor;a.color.fromArray(h),a.opacity=h[3]}f.baseColorTexture!==void 0&&u.push(n.assignTexture(a,"map",f.baseColorTexture,Ue)),a.metalness=f.metallicFactor!==void 0?f.metallicFactor:1,a.roughness=f.roughnessFactor!==void 0?f.roughnessFactor:1,f.metallicRoughnessTexture!==void 0&&(u.push(n.assignTexture(a,"metalnessMap",f.metallicRoughnessTexture)),u.push(n.assignTexture(a,"roughnessMap",f.metallicRoughnessTexture))),r=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(e)}),u.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(e,a)})))}t.doubleSided===!0&&(a.side=Sn);const c=t.alphaMode||ln.OPAQUE;if(c===ln.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,c===ln.MASK&&(a.alphaTest=t.alphaCutoff!==void 0?t.alphaCutoff:.5)),t.normalTexture!==void 0&&r!==Ne&&(u.push(n.assignTexture(a,"normalMap",t.normalTexture)),a.normalScale=new se(1,1),t.normalTexture.scale!==void 0)){const f=t.normalTexture.scale;a.normalScale.set(f,f)}return t.occlusionTexture!==void 0&&r!==Ne&&(u.push(n.assignTexture(a,"aoMap",t.occlusionTexture)),t.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=t.occlusionTexture.strength)),t.emissiveFactor!==void 0&&r!==Ne&&(a.emissive=new he().fromArray(t.emissiveFactor)),t.emissiveTexture!==void 0&&r!==Ne&&u.push(n.assignTexture(a,"emissiveMap",t.emissiveTexture,Ue)),Promise.all(u).then(function(){const f=new r(a);return t.name&&(f.name=t.name),$e(f,t),n.associations.set(f,{materials:e}),t.extensions&&nt(i,f,t),f})}createUniqueName(e){const n=vt.sanitizeNodeName(e||"");return n in this.nodeNamesUsed?n+"_"+ ++this.nodeNamesUsed[n]:(this.nodeNamesUsed[n]=0,n)}loadGeometries(e){const n=this,s=this.extensions,i=this.primitiveCache;function t(a){return s[ce.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,n).then(function(o){return Qn(o,a,n)})}const r=[];for(let a=0,o=e.length;a<o;a++){const u=e[a],c=yo(u),f=i[c];if(f)r.push(f.promise);else{let h;u.extensions&&u.extensions[ce.KHR_DRACO_MESH_COMPRESSION]?h=t(u):h=Qn(new _e,u,n),i[c]={primitive:u,promise:h},r.push(h)}}return Promise.all(r)}loadMesh(e){const n=this,s=this.json,i=this.extensions,t=s.meshes[e],r=t.primitives,a=[];for(let o=0,u=r.length;o<u;o++){const c=r[o].material===void 0?po(this.cache):this.getDependency("material",r[o].material);a.push(c)}return a.push(n.loadGeometries(r)),Promise.all(a).then(function(o){const u=o.slice(0,o.length-1),c=o[o.length-1],f=[];for(let l=0,d=c.length;l<d;l++){const p=c[l],m=r[l];let x;const T=u[l];if(m.mode===Le.TRIANGLES||m.mode===Le.TRIANGLE_STRIP||m.mode===Le.TRIANGLE_FAN||m.mode===void 0)x=t.isSkinnedMesh===!0?new os(p,T):new Te(p,T),x.isSkinnedMesh===!0&&x.normalizeSkinWeights(),m.mode===Le.TRIANGLE_STRIP?x.geometry=jn(x.geometry,fs):m.mode===Le.TRIANGLE_FAN&&(x.geometry=jn(x.geometry,gn));else if(m.mode===Le.LINES)x=new ss(p,T);else if(m.mode===Le.LINE_STRIP)x=new _t(p,T);else if(m.mode===Le.LINE_LOOP)x=new ui(p,T);else if(m.mode===Le.POINTS)x=new ts(p,T);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);Object.keys(x.geometry.morphAttributes).length>0&&go(x,t),x.name=n.createUniqueName(t.name||"mesh_"+e),$e(x,t),m.extensions&&nt(i,x,m),n.assignFinalMaterial(x),f.push(x)}for(let l=0,d=f.length;l<d;l++)n.associations.set(f[l],{meshes:e,primitives:l});if(f.length===1)return t.extensions&&nt(i,f[0],t),f[0];const h=new ct;t.extensions&&nt(i,h,t),n.associations.set(h,{meshes:e});for(let l=0,d=f.length;l<d;l++)h.add(f[l]);return h})}loadCamera(e){let n;const s=this.json.cameras[e],i=s[s.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return s.type==="perspective"?n=new Mt(Ie.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):s.type==="orthographic"&&(n=new An(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),s.name&&(n.name=this.createUniqueName(s.name)),$e(n,s),Promise.resolve(n)}loadSkin(e){const n=this.json.skins[e],s=[];for(let i=0,t=n.joints.length;i<t;i++)s.push(this._loadNodeShallow(n.joints[i]));return n.inverseBindMatrices!==void 0?s.push(this.getDependency("accessor",n.inverseBindMatrices)):s.push(null),Promise.all(s).then(function(i){const t=i.pop(),r=i,a=[],o=[];for(let u=0,c=r.length;u<c;u++){const f=r[u];if(f){a.push(f);const h=new ie;t!==null&&h.fromArray(t.array,u*16),o.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[u])}return new as(a,o)})}loadAnimation(e){const n=this.json,s=this,i=n.animations[e],t=i.name?i.name:"animation_"+e,r=[],a=[],o=[],u=[],c=[];for(let f=0,h=i.channels.length;f<h;f++){const l=i.channels[f],d=i.samplers[l.sampler],p=l.target,m=p.node,x=i.parameters!==void 0?i.parameters[d.input]:d.input,T=i.parameters!==void 0?i.parameters[d.output]:d.output;p.node!==void 0&&(r.push(this.getDependency("node",m)),a.push(this.getDependency("accessor",x)),o.push(this.getDependency("accessor",T)),u.push(d),c.push(p))}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(o),Promise.all(u),Promise.all(c)]).then(function(f){const h=f[0],l=f[1],d=f[2],p=f[3],m=f[4],x=[];for(let T=0,v=h.length;T<v;T++){const b=h[T],g=l[T],w=d[T],S=p[T],A=m[T];if(b===void 0)continue;b.updateMatrix&&(b.updateMatrix(),b.matrixAutoUpdate=!0);const P=s._createAnimationTracks(b,g,w,S,A);if(P)for(let M=0;M<P.length;M++)x.push(P[M])}return new cs(t,void 0,x)})}createNodeMesh(e){const n=this.json,s=this,i=n.nodes[e];return i.mesh===void 0?null:s.getDependency("mesh",i.mesh).then(function(t){const r=s._getNodeRef(s.meshCache,i.mesh,t);return i.weights!==void 0&&r.traverse(function(a){if(a.isMesh)for(let o=0,u=i.weights.length;o<u;o++)a.morphTargetInfluences[o]=i.weights[o]}),r})}loadNode(e){const n=this.json,s=this,i=n.nodes[e],t=s._loadNodeShallow(e),r=[],a=i.children||[];for(let u=0,c=a.length;u<c;u++)r.push(s.getDependency("node",a[u]));const o=i.skin===void 0?Promise.resolve(null):s.getDependency("skin",i.skin);return Promise.all([t,Promise.all(r),o]).then(function(u){const c=u[0],f=u[1],h=u[2];h!==null&&c.traverse(function(l){l.isSkinnedMesh&&l.bind(h,vo)});for(let l=0,d=f.length;l<d;l++)c.add(f[l]);return c})}_loadNodeShallow(e){const n=this.json,s=this.extensions,i=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const t=n.nodes[e],r=t.name?i.createUniqueName(t.name):"",a=[],o=i._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(e)});return o&&a.push(o),t.camera!==void 0&&a.push(i.getDependency("camera",t.camera).then(function(u){return i._getNodeRef(i.cameraCache,t.camera,u)})),i._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(e)}).forEach(function(u){a.push(u)}),this.nodeCache[e]=Promise.all(a).then(function(u){let c;if(t.isBone===!0?c=new dn:u.length>1?c=new ct:u.length===1?c=u[0]:c=new et,c!==u[0])for(let f=0,h=u.length;f<h;f++)c.add(u[f]);if(t.name&&(c.userData.name=t.name,c.name=r),$e(c,t),t.extensions&&nt(s,c,t),t.matrix!==void 0){const f=new ie;f.fromArray(t.matrix),c.applyMatrix4(f)}else t.translation!==void 0&&c.position.fromArray(t.translation),t.rotation!==void 0&&c.quaternion.fromArray(t.rotation),t.scale!==void 0&&c.scale.fromArray(t.scale);return i.associations.has(c)||i.associations.set(c,{}),i.associations.get(c).nodes=e,c}),this.nodeCache[e]}loadScene(e){const n=this.extensions,s=this.json.scenes[e],i=this,t=new ct;s.name&&(t.name=i.createUniqueName(s.name)),$e(t,s),s.extensions&&nt(n,t,s);const r=s.nodes||[],a=[];for(let o=0,u=r.length;o<u;o++)a.push(i.getDependency("node",r[o]));return Promise.all(a).then(function(o){for(let c=0,f=o.length;c<f;c++)t.add(o[c]);const u=c=>{const f=new Map;for(const[h,l]of i.associations)(h instanceof Zt||h instanceof Nt)&&f.set(h,l);return c.traverse(h=>{const l=i.associations.get(h);l!=null&&f.set(h,l)}),f};return i.associations=u(t),t})}_createAnimationTracks(e,n,s,i,t){const r=[],a=e.name?e.name:e.uuid,o=[];qe[t.path]===qe.weights?e.traverse(function(h){h.morphTargetInfluences&&o.push(h.name?h.name:h.uuid)}):o.push(a);let u;switch(qe[t.path]){case qe.weights:u=mn;break;case qe.rotation:u=pn;break;case qe.position:case qe.scale:default:switch(s.itemSize){case 1:u=mn;break;case 2:case 3:u=us;break}break}const c=i.interpolation!==void 0?ho[i.interpolation]:ps,f=this._getArrayFromAccessor(s);for(let h=0,l=o.length;h<l;h++){const d=new u(o[h]+"."+qe[t.path],n.array,f,c);c==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(d),r.push(d)}return r}_getArrayFromAccessor(e){let n=e.array;if(e.normalized){const s=wn(n.constructor),i=new Float32Array(n.length);for(let t=0,r=n.length;t<r;t++)i[t]=n[t]*s;n=i}return n}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(s){const i=this instanceof pn?fo:_s;return new i(this.times,this.values,this.getValueSize()/3,s)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Ao(y,e,n){const s=e.attributes,i=new Tn;if(s.POSITION!==void 0){const a=n.json.accessors[s.POSITION],o=a.min,u=a.max;if(o!==void 0&&u!==void 0){if(i.set(new j(o[0],o[1],o[2]),new j(u[0],u[1],u[2])),a.normalized){const c=wn(ut[a.componentType]);i.min.multiplyScalar(c),i.max.multiplyScalar(c)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const t=e.targets;if(t!==void 0){const a=new j,o=new j;for(let u=0,c=t.length;u<c;u++){const f=t[u];if(f.POSITION!==void 0){const h=n.json.accessors[f.POSITION],l=h.min,d=h.max;if(l!==void 0&&d!==void 0){if(o.setX(Math.max(Math.abs(l[0]),Math.abs(d[0]))),o.setY(Math.max(Math.abs(l[1]),Math.abs(d[1]))),o.setZ(Math.max(Math.abs(l[2]),Math.abs(d[2]))),h.normalized){const p=wn(ut[h.componentType]);o.multiplyScalar(p)}a.max(o)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(a)}y.boundingBox=i;const r=new vi;i.getCenter(r.center),r.radius=i.min.distanceTo(i.max)/2,y.boundingSphere=r}function Qn(y,e,n){const s=e.attributes,i=[];function t(r,a){return n.getDependency("accessor",r).then(function(o){y.setAttribute(a,o)})}for(const r in s){const a=vn[r]||r.toLowerCase();a in y.attributes||i.push(t(s[r],a))}if(e.indices!==void 0&&!y.index){const r=n.getDependency("accessor",e.indices).then(function(a){y.setIndex(a)});i.push(r)}return $e(y,e),Ao(y,e,n),Promise.all(i).then(function(){return e.targets!==void 0?mo(y,e.targets,n):y})}const To=Ue;class Tt extends xt{constructor(e){super(e),this.defaultDPI=90,this.defaultUnit="px"}load(e,n,s,i){const t=this,r=new Ct(t.manager);r.setPath(t.path),r.setRequestHeader(t.requestHeader),r.setWithCredentials(t.withCredentials),r.load(e,function(a){try{n(t.parse(a))}catch(o){i?i(o):console.error(o),t.manager.itemError(e)}},s,i)}parse(e){const n=this;function s(B,O){if(B.nodeType!==1)return;const C=b(B);let R=!1,H=null;switch(B.nodeName){case"svg":O=d(B,O);break;case"style":t(B);break;case"g":O=d(B,O);break;case"path":O=d(B,O),B.hasAttribute("d")&&(H=i(B));break;case"rect":O=d(B,O),H=o(B);break;case"polygon":O=d(B,O),H=u(B);break;case"polyline":O=d(B,O),H=c(B);break;case"circle":O=d(B,O),H=f(B);break;case"ellipse":O=d(B,O),H=h(B);break;case"line":O=d(B,O),H=l(B);break;case"defs":R=!0;break;case"use":O=d(B,O);const K=(B.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),Q=B.viewportElement.getElementById(K);Q?s(Q,O):console.warn("SVGLoader: 'use node' references non-existent node id: "+K);break}H&&(O.fill!==void 0&&O.fill!=="none"&&H.color.setStyle(O.fill,To),w(H,re),E.push(H),H.userData={node:B,style:O});const X=B.childNodes;for(let N=0;N<X.length;N++){const K=X[N];R&&K.nodeName!=="style"&&K.nodeName!=="defs"||s(K,O)}C&&(V.pop(),V.length>0?re.copy(V[V.length-1]):re.identity())}function i(B){const O=new tt,C=new se,R=new se,H=new se;let X=!0,N=!1;const K=B.getAttribute("d");if(K===""||K==="none")return null;const Q=K.match(/[a-df-z][^a-df-z]*/ig);for(let q=0,G=Q.length;q<G;q++){const Y=Q[q],Z=Y.charAt(0),ee=Y.slice(1).trim();X===!0&&(N=!0,X=!1);let F;switch(Z){case"M":F=m(ee);for(let I=0,$=F.length;I<$;I+=2)C.x=F[I+0],C.y=F[I+1],R.x=C.x,R.y=C.y,I===0?O.moveTo(C.x,C.y):O.lineTo(C.x,C.y),I===0&&H.copy(C);break;case"H":F=m(ee);for(let I=0,$=F.length;I<$;I++)C.x=F[I],R.x=C.x,R.y=C.y,O.lineTo(C.x,C.y),I===0&&N===!0&&H.copy(C);break;case"V":F=m(ee);for(let I=0,$=F.length;I<$;I++)C.y=F[I],R.x=C.x,R.y=C.y,O.lineTo(C.x,C.y),I===0&&N===!0&&H.copy(C);break;case"L":F=m(ee);for(let I=0,$=F.length;I<$;I+=2)C.x=F[I+0],C.y=F[I+1],R.x=C.x,R.y=C.y,O.lineTo(C.x,C.y),I===0&&N===!0&&H.copy(C);break;case"C":F=m(ee);for(let I=0,$=F.length;I<$;I+=6)O.bezierCurveTo(F[I+0],F[I+1],F[I+2],F[I+3],F[I+4],F[I+5]),R.x=F[I+2],R.y=F[I+3],C.x=F[I+4],C.y=F[I+5],I===0&&N===!0&&H.copy(C);break;case"S":F=m(ee);for(let I=0,$=F.length;I<$;I+=4)O.bezierCurveTo(p(C.x,R.x),p(C.y,R.y),F[I+0],F[I+1],F[I+2],F[I+3]),R.x=F[I+0],R.y=F[I+1],C.x=F[I+2],C.y=F[I+3],I===0&&N===!0&&H.copy(C);break;case"Q":F=m(ee);for(let I=0,$=F.length;I<$;I+=4)O.quadraticCurveTo(F[I+0],F[I+1],F[I+2],F[I+3]),R.x=F[I+0],R.y=F[I+1],C.x=F[I+2],C.y=F[I+3],I===0&&N===!0&&H.copy(C);break;case"T":F=m(ee);for(let I=0,$=F.length;I<$;I+=2){const ae=p(C.x,R.x),ve=p(C.y,R.y);O.quadraticCurveTo(ae,ve,F[I+0],F[I+1]),R.x=ae,R.y=ve,C.x=F[I+0],C.y=F[I+1],I===0&&N===!0&&H.copy(C)}break;case"A":F=m(ee,[3,4],7);for(let I=0,$=F.length;I<$;I+=7){if(F[I+5]==C.x&&F[I+6]==C.y)continue;const ae=C.clone();C.x=F[I+5],C.y=F[I+6],R.x=C.x,R.y=C.y,r(O,F[I],F[I+1],F[I+2],F[I+3],F[I+4],ae,C),I===0&&N===!0&&H.copy(C)}break;case"m":F=m(ee);for(let I=0,$=F.length;I<$;I+=2)C.x+=F[I+0],C.y+=F[I+1],R.x=C.x,R.y=C.y,I===0?O.moveTo(C.x,C.y):O.lineTo(C.x,C.y),I===0&&H.copy(C);break;case"h":F=m(ee);for(let I=0,$=F.length;I<$;I++)C.x+=F[I],R.x=C.x,R.y=C.y,O.lineTo(C.x,C.y),I===0&&N===!0&&H.copy(C);break;case"v":F=m(ee);for(let I=0,$=F.length;I<$;I++)C.y+=F[I],R.x=C.x,R.y=C.y,O.lineTo(C.x,C.y),I===0&&N===!0&&H.copy(C);break;case"l":F=m(ee);for(let I=0,$=F.length;I<$;I+=2)C.x+=F[I+0],C.y+=F[I+1],R.x=C.x,R.y=C.y,O.lineTo(C.x,C.y),I===0&&N===!0&&H.copy(C);break;case"c":F=m(ee);for(let I=0,$=F.length;I<$;I+=6)O.bezierCurveTo(C.x+F[I+0],C.y+F[I+1],C.x+F[I+2],C.y+F[I+3],C.x+F[I+4],C.y+F[I+5]),R.x=C.x+F[I+2],R.y=C.y+F[I+3],C.x+=F[I+4],C.y+=F[I+5],I===0&&N===!0&&H.copy(C);break;case"s":F=m(ee);for(let I=0,$=F.length;I<$;I+=4)O.bezierCurveTo(p(C.x,R.x),p(C.y,R.y),C.x+F[I+0],C.y+F[I+1],C.x+F[I+2],C.y+F[I+3]),R.x=C.x+F[I+0],R.y=C.y+F[I+1],C.x+=F[I+2],C.y+=F[I+3],I===0&&N===!0&&H.copy(C);break;case"q":F=m(ee);for(let I=0,$=F.length;I<$;I+=4)O.quadraticCurveTo(C.x+F[I+0],C.y+F[I+1],C.x+F[I+2],C.y+F[I+3]),R.x=C.x+F[I+0],R.y=C.y+F[I+1],C.x+=F[I+2],C.y+=F[I+3],I===0&&N===!0&&H.copy(C);break;case"t":F=m(ee);for(let I=0,$=F.length;I<$;I+=2){const ae=p(C.x,R.x),ve=p(C.y,R.y);O.quadraticCurveTo(ae,ve,C.x+F[I+0],C.y+F[I+1]),R.x=ae,R.y=ve,C.x=C.x+F[I+0],C.y=C.y+F[I+1],I===0&&N===!0&&H.copy(C)}break;case"a":F=m(ee,[3,4],7);for(let I=0,$=F.length;I<$;I+=7){if(F[I+5]==0&&F[I+6]==0)continue;const ae=C.clone();C.x+=F[I+5],C.y+=F[I+6],R.x=C.x,R.y=C.y,r(O,F[I],F[I+1],F[I+2],F[I+3],F[I+4],ae,C),I===0&&N===!0&&H.copy(C)}break;case"Z":case"z":O.currentPath.autoClose=!0,O.currentPath.curves.length>0&&(C.copy(H),O.currentPath.currentPoint.copy(C),X=!0);break;default:console.warn(Y)}N=!1}return O}function t(B){if(!(!B.sheet||!B.sheet.cssRules||!B.sheet.cssRules.length))for(let O=0;O<B.sheet.cssRules.length;O++){const C=B.sheet.cssRules[O];if(C.type!==1)continue;const R=C.selectorText.split(/,/gm).filter(Boolean).map(H=>H.trim());for(let H=0;H<R.length;H++){const X=Object.fromEntries(Object.entries(C.style).filter(([,N])=>N!==""));D[R[H]]=Object.assign(D[R[H]]||{},X)}}}function r(B,O,C,R,H,X,N,K){if(O==0||C==0){B.lineTo(K.x,K.y);return}R=R*Math.PI/180,O=Math.abs(O),C=Math.abs(C);const Q=(N.x-K.x)/2,q=(N.y-K.y)/2,G=Math.cos(R)*Q+Math.sin(R)*q,Y=-Math.sin(R)*Q+Math.cos(R)*q;let Z=O*O,ee=C*C;const F=G*G,I=Y*Y,$=F/Z+I/ee;if($>1){const fe=Math.sqrt($);O=fe*O,C=fe*C,Z=O*O,ee=C*C}const ae=Z*I+ee*F,ve=(Z*ee-ae)/ae;let we=Math.sqrt(Math.max(0,ve));H===X&&(we=-we);const me=we*O*Y/C,Ce=-we*C*G/O,Re=Math.cos(R)*me-Math.sin(R)*Ce+(N.x+K.x)/2,Ye=Math.sin(R)*me+Math.cos(R)*Ce+(N.y+K.y)/2,k=a(1,0,(G-me)/O,(Y-Ce)/C),ne=a((G-me)/O,(Y-Ce)/C,(-G-me)/O,(-Y-Ce)/C)%(Math.PI*2);B.currentPath.absellipse(Re,Ye,O,C,k,k+ne,X===0,R)}function a(B,O,C,R){const H=B*C+O*R,X=Math.sqrt(B*B+O*O)*Math.sqrt(C*C+R*R);let N=Math.acos(Math.max(-1,Math.min(1,H/X)));return B*R-O*C<0&&(N=-N),N}function o(B){const O=v(B.getAttribute("x")||0),C=v(B.getAttribute("y")||0),R=v(B.getAttribute("rx")||B.getAttribute("ry")||0),H=v(B.getAttribute("ry")||B.getAttribute("rx")||0),X=v(B.getAttribute("width")),N=v(B.getAttribute("height")),K=1-.551915024494,Q=new tt;return Q.moveTo(O+R,C),Q.lineTo(O+X-R,C),(R!==0||H!==0)&&Q.bezierCurveTo(O+X-R*K,C,O+X,C+H*K,O+X,C+H),Q.lineTo(O+X,C+N-H),(R!==0||H!==0)&&Q.bezierCurveTo(O+X,C+N-H*K,O+X-R*K,C+N,O+X-R,C+N),Q.lineTo(O+R,C+N),(R!==0||H!==0)&&Q.bezierCurveTo(O+R*K,C+N,O,C+N-H*K,O,C+N-H),Q.lineTo(O,C+H),(R!==0||H!==0)&&Q.bezierCurveTo(O,C+H*K,O+R*K,C,O+R,C),Q}function u(B){function O(X,N,K){const Q=v(N),q=v(K);H===0?R.moveTo(Q,q):R.lineTo(Q,q),H++}const C=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,R=new tt;let H=0;return B.getAttribute("points").replace(C,O),R.currentPath.autoClose=!0,R}function c(B){function O(X,N,K){const Q=v(N),q=v(K);H===0?R.moveTo(Q,q):R.lineTo(Q,q),H++}const C=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,R=new tt;let H=0;return B.getAttribute("points").replace(C,O),R.currentPath.autoClose=!1,R}function f(B){const O=v(B.getAttribute("cx")||0),C=v(B.getAttribute("cy")||0),R=v(B.getAttribute("r")||0),H=new $t;H.absarc(O,C,R,0,Math.PI*2);const X=new tt;return X.subPaths.push(H),X}function h(B){const O=v(B.getAttribute("cx")||0),C=v(B.getAttribute("cy")||0),R=v(B.getAttribute("rx")||0),H=v(B.getAttribute("ry")||0),X=new $t;X.absellipse(O,C,R,H,0,Math.PI*2);const N=new tt;return N.subPaths.push(X),N}function l(B){const O=v(B.getAttribute("x1")||0),C=v(B.getAttribute("y1")||0),R=v(B.getAttribute("x2")||0),H=v(B.getAttribute("y2")||0),X=new tt;return X.moveTo(O,C),X.lineTo(R,H),X.currentPath.autoClose=!1,X}function d(B,O){O=Object.assign({},O);let C={};if(B.hasAttribute("class")){const N=B.getAttribute("class").split(/\s/).filter(Boolean).map(K=>K.trim());for(let K=0;K<N.length;K++)C=Object.assign(C,D["."+N[K]])}B.hasAttribute("id")&&(C=Object.assign(C,D["#"+B.getAttribute("id")]));function R(N,K,Q){Q===void 0&&(Q=function(G){return G.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),G}),B.hasAttribute(N)&&(O[K]=Q(B.getAttribute(N))),C[N]&&(O[K]=Q(C[N])),B.style&&B.style[N]!==""&&(O[K]=Q(B.style[N]))}function H(N){return Math.max(0,Math.min(1,v(N)))}function X(N){return Math.max(0,v(N))}return R("fill","fill"),R("fill-opacity","fillOpacity",H),R("fill-rule","fillRule"),R("opacity","opacity",H),R("stroke","stroke"),R("stroke-opacity","strokeOpacity",H),R("stroke-width","strokeWidth",X),R("stroke-linejoin","strokeLineJoin"),R("stroke-linecap","strokeLineCap"),R("stroke-miterlimit","strokeMiterLimit",X),R("visibility","visibility"),O}function p(B,O){return B-(O-B)}function m(B,O,C){if(typeof B!="string")throw new TypeError("Invalid input: "+typeof B);const R={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},H=0,X=1,N=2,K=3;let Q=H,q=!0,G="",Y="";const Z=[];function ee(ae,ve,we){const me=new SyntaxError('Unexpected character "'+ae+'" at index '+ve+".");throw me.partial=we,me}function F(){G!==""&&(Y===""?Z.push(Number(G)):Z.push(Number(G)*Math.pow(10,Number(Y)))),G="",Y=""}let I;const $=B.length;for(let ae=0;ae<$;ae++){if(I=B[ae],Array.isArray(O)&&O.includes(Z.length%C)&&R.FLAGS.test(I)){Q=X,G=I,F();continue}if(Q===H){if(R.WHITESPACE.test(I))continue;if(R.DIGIT.test(I)||R.SIGN.test(I)){Q=X,G=I;continue}if(R.POINT.test(I)){Q=N,G=I;continue}R.COMMA.test(I)&&(q&&ee(I,ae,Z),q=!0)}if(Q===X){if(R.DIGIT.test(I)){G+=I;continue}if(R.POINT.test(I)){G+=I,Q=N;continue}if(R.EXP.test(I)){Q=K;continue}R.SIGN.test(I)&&G.length===1&&R.SIGN.test(G[0])&&ee(I,ae,Z)}if(Q===N){if(R.DIGIT.test(I)){G+=I;continue}if(R.EXP.test(I)){Q=K;continue}R.POINT.test(I)&&G[G.length-1]==="."&&ee(I,ae,Z)}if(Q===K){if(R.DIGIT.test(I)){Y+=I;continue}if(R.SIGN.test(I)){if(Y===""){Y+=I;continue}Y.length===1&&R.SIGN.test(Y)&&ee(I,ae,Z)}}R.WHITESPACE.test(I)?(F(),Q=H,q=!1):R.COMMA.test(I)?(F(),Q=H,q=!0):R.SIGN.test(I)?(F(),Q=X,G=I):R.POINT.test(I)?(F(),Q=N,G=I):ee(I,ae,Z)}return F(),Z}const x=["mm","cm","in","pt","pc","px"],T={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:72/6,pc:1,px:-1},px:{px:1}};function v(B){let O="px";if(typeof B=="string"||B instanceof String)for(let R=0,H=x.length;R<H;R++){const X=x[R];if(B.endsWith(X)){O=X,B=B.substring(0,B.length-X.length);break}}let C;return O==="px"&&n.defaultUnit!=="px"?C=T.in[n.defaultUnit]/n.defaultDPI:(C=T[O][n.defaultUnit],C<0&&(C=T[O].in*n.defaultDPI)),C*parseFloat(B)}function b(B){if(!(B.hasAttribute("transform")||B.nodeName==="use"&&(B.hasAttribute("x")||B.hasAttribute("y"))))return null;const O=g(B);return V.length>0&&O.premultiply(V[V.length-1]),re.copy(O),V.push(O),O}function g(B){const O=new Ze,C=z;if(B.nodeName==="use"&&(B.hasAttribute("x")||B.hasAttribute("y"))){const R=v(B.getAttribute("x")),H=v(B.getAttribute("y"));O.translate(R,H)}if(B.hasAttribute("transform")){const R=B.getAttribute("transform").split(")");for(let H=R.length-1;H>=0;H--){const X=R[H].trim();if(X==="")continue;const N=X.indexOf("("),K=X.length;if(N>0&&N<K){const Q=X.slice(0,N),q=m(X.slice(N+1));switch(C.identity(),Q){case"translate":if(q.length>=1){const G=q[0];let Y=0;q.length>=2&&(Y=q[1]),C.translate(G,Y)}break;case"rotate":if(q.length>=1){let G=0,Y=0,Z=0;G=q[0]*Math.PI/180,q.length>=3&&(Y=q[1],Z=q[2]),W.makeTranslation(-Y,-Z),_.makeRotation(G),U.multiplyMatrices(_,W),W.makeTranslation(Y,Z),C.multiplyMatrices(W,U)}break;case"scale":if(q.length>=1){const G=q[0];let Y=G;q.length>=2&&(Y=q[1]),C.scale(G,Y)}break;case"skewX":q.length===1&&C.set(1,Math.tan(q[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":q.length===1&&C.set(1,0,0,Math.tan(q[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":q.length===6&&C.set(q[0],q[2],q[4],q[1],q[3],q[5],0,0,1);break}}O.premultiply(C)}}return O}function w(B,O){function C(N){te.set(N.x,N.y,1).applyMatrix3(O),N.set(te.x,te.y)}function R(N){const K=N.xRadius,Q=N.yRadius,q=Math.cos(N.aRotation),G=Math.sin(N.aRotation),Y=new j(K*q,K*G,0),Z=new j(-Q*G,Q*q,0),ee=Y.applyMatrix3(O),F=Z.applyMatrix3(O),I=z.set(ee.x,F.x,0,ee.y,F.y,0,0,0,1),$=W.copy(I).invert(),we=_.copy($).transpose().multiply($).elements,me=L(we[0],we[1],we[4]),Ce=Math.sqrt(me.rt1),Re=Math.sqrt(me.rt2);if(N.xRadius=1/Ce,N.yRadius=1/Re,N.aRotation=Math.atan2(me.sn,me.cs),!((N.aEndAngle-N.aStartAngle)%(2*Math.PI)<Number.EPSILON)){const k=W.set(Ce,0,0,0,Re,0,0,0,1),ne=_.set(me.cs,me.sn,0,-me.sn,me.cs,0,0,0,1),fe=k.multiply(ne).multiply(I),xe=be=>{const{x:rt,y:Fe}=new j(Math.cos(be),Math.sin(be),0).applyMatrix3(fe);return Math.atan2(Fe,rt)};N.aStartAngle=xe(N.aStartAngle),N.aEndAngle=xe(N.aEndAngle),S(O)&&(N.aClockwise=!N.aClockwise)}}function H(N){const K=P(O),Q=M(O);N.xRadius*=K,N.yRadius*=Q;const q=K>Number.EPSILON?Math.atan2(O.elements[1],O.elements[0]):Math.atan2(-O.elements[3],O.elements[4]);N.aRotation+=q,S(O)&&(N.aStartAngle*=-1,N.aEndAngle*=-1,N.aClockwise=!N.aClockwise)}const X=B.subPaths;for(let N=0,K=X.length;N<K;N++){const q=X[N].curves;for(let G=0;G<q.length;G++){const Y=q[G];Y.isLineCurve?(C(Y.v1),C(Y.v2)):Y.isCubicBezierCurve?(C(Y.v0),C(Y.v1),C(Y.v2),C(Y.v3)):Y.isQuadraticBezierCurve?(C(Y.v0),C(Y.v1),C(Y.v2)):Y.isEllipseCurve&&(J.set(Y.aX,Y.aY),C(J),Y.aX=J.x,Y.aY=J.y,A(O)?R(Y):H(Y))}}}function S(B){const O=B.elements;return O[0]*O[4]-O[1]*O[3]<0}function A(B){const O=B.elements,C=O[0]*O[3]+O[1]*O[4];if(C===0)return!1;const R=P(B),H=M(B);return Math.abs(C/(R*H))>Number.EPSILON}function P(B){const O=B.elements;return Math.sqrt(O[0]*O[0]+O[1]*O[1])}function M(B){const O=B.elements;return Math.sqrt(O[3]*O[3]+O[4]*O[4])}function L(B,O,C){let R,H,X,N,K;const Q=B+C,q=B-C,G=Math.sqrt(q*q+4*O*O);return Q>0?(R=.5*(Q+G),K=1/R,H=B*K*C-O*K*O):Q<0?H=.5*(Q-G):(R=.5*G,H=-.5*G),q>0?X=q+G:X=q-G,Math.abs(X)>2*Math.abs(O)?(K=-2*O/X,N=1/Math.sqrt(1+K*K),X=K*N):Math.abs(O)===0?(X=1,N=0):(K=-.5*X/O,X=1/Math.sqrt(1+K*K),N=K*X),q>0&&(K=X,X=-N,N=K),{rt1:R,rt2:H,cs:X,sn:N}}const E=[],D={},V=[],z=new Ze,W=new Ze,_=new Ze,U=new Ze,J=new se,te=new j,re=new Ze,oe=new DOMParser().parseFromString(e,"image/svg+xml");return s(oe.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:E,xml:oe.documentElement}}static createShapes(e){const s={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},i={loc:s.ORIGIN,t:0};function t(p,m,x,T){const v=p.x,b=m.x,g=x.x,w=T.x,S=p.y,A=m.y,P=x.y,M=T.y,L=(w-g)*(S-P)-(M-P)*(v-g),E=(b-v)*(S-P)-(A-S)*(v-g),D=(M-P)*(b-v)-(w-g)*(A-S),V=L/D,z=E/D;if(D===0&&L!==0||V<=0||V>=1||z<0||z>1)return null;if(L===0&&D===0){for(let W=0;W<2;W++)if(r(W===0?x:T,p,m),i.loc==s.ORIGIN){const _=W===0?x:T;return{x:_.x,y:_.y,t:i.t}}else if(i.loc==s.BETWEEN){const _=+(v+i.t*(b-v)).toPrecision(10),U=+(S+i.t*(A-S)).toPrecision(10);return{x:_,y:U,t:i.t}}return null}else{for(let U=0;U<2;U++)if(r(U===0?x:T,p,m),i.loc==s.ORIGIN){const J=U===0?x:T;return{x:J.x,y:J.y,t:i.t}}const W=+(v+V*(b-v)).toPrecision(10),_=+(S+V*(A-S)).toPrecision(10);return{x:W,y:_,t:V}}}function r(p,m,x){const T=x.x-m.x,v=x.y-m.y,b=p.x-m.x,g=p.y-m.y,w=T*g-b*v;if(p.x===m.x&&p.y===m.y){i.loc=s.ORIGIN,i.t=0;return}if(p.x===x.x&&p.y===x.y){i.loc=s.DESTINATION,i.t=1;return}if(w<-Number.EPSILON){i.loc=s.LEFT;return}if(w>Number.EPSILON){i.loc=s.RIGHT;return}if(T*b<0||v*g<0){i.loc=s.BEHIND;return}if(Math.sqrt(T*T+v*v)<Math.sqrt(b*b+g*g)){i.loc=s.BEYOND;return}let S;T!==0?S=b/T:S=g/v,i.loc=s.BETWEEN,i.t=S}function a(p,m){const x=[],T=[];for(let v=1;v<p.length;v++){const b=p[v-1],g=p[v];for(let w=1;w<m.length;w++){const S=m[w-1],A=m[w],P=t(b,g,S,A);P!==null&&x.find(M=>M.t<=P.t+Number.EPSILON&&M.t>=P.t-Number.EPSILON)===void 0&&(x.push(P),T.push(new se(P.x,P.y)))}}return T}function o(p,m,x){const T=new se;m.getCenter(T);const v=[];return x.forEach(b=>{b.boundingBox.containsPoint(T)&&a(p,b.points).forEach(w=>{v.push({identifier:b.identifier,isCW:b.isCW,point:w})})}),v.sort((b,g)=>b.point.x-g.point.x),v}function u(p,m,x,T,v){(v==null||v==="")&&(v="nonzero");const b=new se;p.boundingBox.getCenter(b);const g=[new se(x,b.y),new se(T,b.y)],w=o(g,p.boundingBox,m);w.sort((E,D)=>E.point.x-D.point.x);const S=[],A=[];w.forEach(E=>{E.identifier===p.identifier?S.push(E):A.push(E)});const P=S[0].point.x,M=[];let L=0;for(;L<A.length&&A[L].point.x<P;)M.length>0&&M[M.length-1]===A[L].identifier?M.pop():M.push(A[L].identifier),L++;if(M.push(p.identifier),v==="evenodd"){const E=M.length%2===0,D=M[M.length-2];return{identifier:p.identifier,isHole:E,for:D}}else if(v==="nonzero"){let E=!0,D=null,V=null;for(let z=0;z<M.length;z++){const W=M[z];E?(V=m[W].isCW,E=!1,D=W):V!==m[W].isCW&&(V=m[W].isCW,E=!0)}return{identifier:p.identifier,isHole:E,for:D}}else console.warn('fill-rule: "'+v+'" is currently not implemented.')}let c=999999999,f=-999999999,h=e.subPaths.map(p=>{const m=p.getPoints();let x=-999999999,T=999999999,v=-999999999,b=999999999;for(let g=0;g<m.length;g++){const w=m[g];w.y>x&&(x=w.y),w.y<T&&(T=w.y),w.x>v&&(v=w.x),w.x<b&&(b=w.x)}return f<=v&&(f=v+1),c>=b&&(c=b-1),{curves:p.curves,points:m,isCW:Ai.isClockWise(m),identifier:-1,boundingBox:new Ti(new se(b,T),new se(v,x))}});h=h.filter(p=>p.points.length>1);for(let p=0;p<h.length;p++)h[p].identifier=p;const l=h.map(p=>u(p,h,c,f,e.userData?e.userData.style.fillRule:void 0)),d=[];return h.forEach(p=>{if(!l[p.identifier].isHole){const x=new bi;x.curves=p.curves,l.filter(v=>v.isHole&&v.for===p.identifier).forEach(v=>{const b=h[v.identifier],g=new $t;g.curves=b.curves,x.holes.push(g)}),d.push(x)}}),d}static getStrokeStyle(e,n,s,i,t){return e=e!==void 0?e:1,n=n!==void 0?n:"#000",s=s!==void 0?s:"miter",i=i!==void 0?i:"butt",t=t!==void 0?t:4,{strokeColor:n,strokeWidth:e,strokeLineJoin:s,strokeLineCap:i,strokeMiterLimit:t}}static pointsToStroke(e,n,s,i){const t=[],r=[],a=[];if(Tt.pointsToStrokeWithBuffers(e,n,s,i,t,r,a)===0)return null;const o=new _e;return o.setAttribute("position",new Ee(t,3)),o.setAttribute("normal",new Ee(r,3)),o.setAttribute("uv",new Ee(a,2)),o}static pointsToStrokeWithBuffers(e,n,s,i,t,r,a,o){const u=new se,c=new se,f=new se,h=new se,l=new se,d=new se,p=new se,m=new se,x=new se,T=new se,v=new se,b=new se,g=new se,w=new se,S=new se,A=new se,P=new se;s=s!==void 0?s:12,i=i!==void 0?i:.001,o=o!==void 0?o:0,e=q(e);const M=e.length;if(M<2)return 0;const L=e[0].equals(e[M-1]);let E,D=e[0],V;const z=n.strokeWidth/2,W=1/(M-1);let _=0,U,J,te,re,oe=!1,ue=0,B=o*3,O=o*2;C(e[0],e[1],u).multiplyScalar(z),m.copy(e[0]).sub(u),x.copy(e[0]).add(u),T.copy(m),v.copy(x);for(let G=1;G<M;G++){E=e[G],G===M-1?L?V=e[1]:V=void 0:V=e[G+1];const Y=u;if(C(D,E,Y),f.copy(Y).multiplyScalar(z),b.copy(E).sub(f),g.copy(E).add(f),U=_+W,J=!1,V!==void 0){C(E,V,c),f.copy(c).multiplyScalar(z),w.copy(E).sub(f),S.copy(E).add(f),te=!0,f.subVectors(V,D),Y.dot(f)<0&&(te=!1),G===1&&(oe=te),f.subVectors(V,E),f.normalize();const Z=Math.abs(Y.dot(f));if(Z>Number.EPSILON){const ee=z/Z;f.multiplyScalar(-ee),h.subVectors(E,D),l.copy(h).setLength(ee).add(f),A.copy(l).negate();const F=l.length(),I=h.length();h.divideScalar(I),d.subVectors(V,E);const $=d.length();switch(d.divideScalar($),h.dot(A)<I&&d.dot(A)<$&&(J=!0),P.copy(l).add(E),A.add(E),re=!1,J?te?(S.copy(A),g.copy(A)):(w.copy(A),b.copy(A)):X(),n.strokeLineJoin){case"bevel":N(te,J,U);break;case"round":K(te,J),te?H(E,b,w,U,0):H(E,S,g,U,1);break;case"miter":case"miter-clip":default:const ae=z*n.strokeMiterLimit/F;if(ae<1)if(n.strokeLineJoin!=="miter-clip"){N(te,J,U);break}else K(te,J),te?(d.subVectors(P,b).multiplyScalar(ae).add(b),p.subVectors(P,w).multiplyScalar(ae).add(w),R(b,U,0),R(d,U,0),R(E,U,.5),R(E,U,.5),R(d,U,0),R(p,U,0),R(E,U,.5),R(p,U,0),R(w,U,0)):(d.subVectors(P,g).multiplyScalar(ae).add(g),p.subVectors(P,S).multiplyScalar(ae).add(S),R(g,U,1),R(d,U,1),R(E,U,.5),R(E,U,.5),R(d,U,1),R(p,U,1),R(E,U,.5),R(p,U,1),R(S,U,1));else J?(te?(R(x,_,1),R(m,_,0),R(P,U,0),R(x,_,1),R(P,U,0),R(A,U,1)):(R(x,_,1),R(m,_,0),R(P,U,1),R(m,_,0),R(A,U,0),R(P,U,1)),te?w.copy(P):S.copy(P)):te?(R(b,U,0),R(P,U,0),R(E,U,.5),R(E,U,.5),R(P,U,0),R(w,U,0)):(R(g,U,1),R(P,U,1),R(E,U,.5),R(E,U,.5),R(P,U,1),R(S,U,1)),re=!0;break}}else X()}else X();!L&&G===M-1&&Q(e[0],T,v,te,!0,_),_=U,D=E,m.copy(w),x.copy(S)}if(!L)Q(E,b,g,te,!1,U);else if(J&&t){let G=P,Y=A;oe!==te&&(G=A,Y=P),te?(re||oe)&&(Y.toArray(t,0*3),Y.toArray(t,3*3),re&&G.toArray(t,1*3)):(re||!oe)&&(Y.toArray(t,1*3),Y.toArray(t,3*3),re&&G.toArray(t,0*3))}return ue;function C(G,Y,Z){return Z.subVectors(Y,G),Z.set(-Z.y,Z.x).normalize()}function R(G,Y,Z){t&&(t[B]=G.x,t[B+1]=G.y,t[B+2]=0,r&&(r[B]=0,r[B+1]=0,r[B+2]=1),B+=3,a&&(a[O]=Y,a[O+1]=Z,O+=2)),ue+=3}function H(G,Y,Z,ee,F){u.copy(Y).sub(G).normalize(),c.copy(Z).sub(G).normalize();let I=Math.PI;const $=u.dot(c);Math.abs($)<1&&(I=Math.abs(Math.acos($))),I/=s,f.copy(Y);for(let ae=0,ve=s-1;ae<ve;ae++)h.copy(f).rotateAround(G,I),R(f,ee,F),R(h,ee,F),R(G,ee,.5),f.copy(h);R(h,ee,F),R(Z,ee,F),R(G,ee,.5)}function X(){R(x,_,1),R(m,_,0),R(b,U,0),R(x,_,1),R(b,U,1),R(g,U,0)}function N(G,Y,Z){Y?G?(R(x,_,1),R(m,_,0),R(b,U,0),R(x,_,1),R(b,U,0),R(A,U,1),R(b,Z,0),R(w,Z,0),R(A,Z,.5)):(R(x,_,1),R(m,_,0),R(g,U,1),R(m,_,0),R(A,U,0),R(g,U,1),R(g,Z,1),R(S,Z,0),R(A,Z,.5)):G?(R(b,Z,0),R(w,Z,0),R(E,Z,.5)):(R(g,Z,1),R(S,Z,0),R(E,Z,.5))}function K(G,Y){Y&&(G?(R(x,_,1),R(m,_,0),R(b,U,0),R(x,_,1),R(b,U,0),R(A,U,1),R(b,_,0),R(E,U,.5),R(A,U,1),R(E,U,.5),R(w,_,0),R(A,U,1)):(R(x,_,1),R(m,_,0),R(g,U,1),R(m,_,0),R(A,U,0),R(g,U,1),R(g,_,1),R(A,U,0),R(E,U,.5),R(E,U,.5),R(A,U,0),R(S,_,1)))}function Q(G,Y,Z,ee,F,I){switch(n.strokeLineCap){case"round":F?H(G,Z,Y,I,.5):H(G,Y,Z,I,.5);break;case"square":if(F)u.subVectors(Y,G),c.set(u.y,-u.x),f.addVectors(u,c).add(G),h.subVectors(c,u).add(G),ee?(f.toArray(t,1*3),h.toArray(t,0*3),h.toArray(t,3*3)):(f.toArray(t,1*3),f.toArray(t,3*3),h.toArray(t,0*3));else{u.subVectors(Z,G),c.set(u.y,-u.x),f.addVectors(u,c).add(G),h.subVectors(c,u).add(G);const $=t.length;ee?(f.toArray(t,$-1*3),h.toArray(t,$-2*3),h.toArray(t,$-4*3)):(f.toArray(t,$-2*3),h.toArray(t,$-1*3),h.toArray(t,$-4*3))}break}}function q(G){let Y=!1;for(let ee=1,F=G.length-1;ee<F;ee++)if(G[ee].distanceTo(G[ee+1])<i){Y=!0;break}if(!Y)return G;const Z=[];Z.push(G[0]);for(let ee=1,F=G.length-1;ee<F;ee++)G[ee].distanceTo(G[ee+1])>=i&&Z.push(G[ee]);return Z.push(G[G.length-1]),Z}}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class bo{constructor(e,n){this.cache=e,this.textureAnisotropy=n}get fileLoader(){return this._fileLoader||(this._fileLoader=new Ct),this._fileLoader}get imageLoader(){return this._imgLoader||(this._imgLoader=new Si),this._imgLoader}get svgLoader(){return this._svgLoader||(this._svgLoader=new Tt),this._svgLoader}get textureLoader(){return this._textureLoader||(this._textureLoader=new Wt),this._textureLoader}get objectLoader(){return this._objectLoader||(this._objectLoader=new Mi),this._objectLoader}get gltfLoader(){return this._gltfLoader||(this._gltfLoader=new Hs),this._gltfLoader}get fbxLoader(){return this._fbxLoader||(this._fbxLoader=new Ir),this._fbxLoader}async preload(e,n){return this.cache.add(e,n),new Promise(s=>{const i=/\.fbx$|\.glb$|\.gltf$/.test(n);/\.jpe?g$|\.png$/.test(n)?this.textureLoader.load(n,r=>s(r)):(i?this.fileLoader.setResponseType("arraybuffer"):this.fileLoader.setResponseType("undefined"),this.fileLoader.load(n,r=>s(r)))})}async textureAtlas(e,n,s="JSONHash"){let i=JSON.parse(await this.file(n));if(i.textures){const a=i.textures[0].frames;let o={frames:{}};a.forEach(u=>{o={...o,frames:{...o.frames,[u.filename]:{frame:u.frame,rotated:u.rotated,sourceSize:u.sourceSize,spriteSourceSize:u.spriteSourceSize,trimmed:u.trimmed}}}}),i=o}return{texture:await this.texture(e),json:i}}file(e){const n=this.cache.get(e);return e=n||e,new Promise(s=>{this.fileLoader.load(e,i=>s(i))})}svg(e){const n=this.cache.get(e);return e=n||e,new Promise(s=>{this.svgLoader.load(e,i=>s(i))})}texture(e){if(!/^data:image\/[\S]+;base64,/gm.test(e)){const s=this.cache.get(e);e=s||e}return new Promise(s=>{this.textureLoader.load(e,i=>{i.anisotropy=this.textureAnisotropy,i.needsUpdate=!0,s(i)})})}object(e){const n=this.cache.get(e);return e=n||e,new Promise(s=>{this.objectLoader.load(e,i=>{s(i)})})}gltf(e){const n=this.cache.get(e);return e=n||e,new Promise(s=>{this.gltfLoader.load(e,i=>{s(i)})})}fbx(e){const n=this.cache.get(e);return e=n||e,new Promise(s=>{this.fbxLoader.load(e,i=>{s(i)})})}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class So extends et{constructor(e,n,s,i){super(),this.scene=e,this.light=n,this.size=s,this.color=i,this.geo=new zt(s||.2,16,8),this.mat=new Ne({color:i||n.color}),this.mesh=new Te(this.geo,this.mat),this.add(this.mesh),n.add(this)}dispose(){this.mesh.geometry.dispose(),Array.isArray(this.mesh.material)?this.mesh.material.forEach(e=>e.dispose()):this.mesh.material.dispose(),this.remove(this.mesh)}update(){}}class Mo{constructor(e){this.scene=e}get helper(){return{directionalLightHelper:(e,n,s)=>{const i=new Pi(e,n,s);return this.scene.add(i),i},spotLightHelper:(e,n)=>{const s=new Ci(e,n);return this.scene.add(s),s},pointLightHelper:(e,n,s)=>new So(this.scene,e,n,s)}}directionalLight(e={}){const{color:n=16777215,intensity:s=1}=e,i=new Pn(n,s);return i.castShadow=!0,this.scene.add(i),i}hemisphereLight(e={}){const{skyColor:n=16777215,groundColor:s=16777215,intensity:i=1}=e,t=new Ei(n,s,i);return this.scene.add(t),t}ambientLight(e={}){const{color:n=16777215,intensity:s=1}=e,i=new ls(n,s);return this.scene.add(i),i}pointLight(e={}){const{color:n=16777215,intensity:s=1,distance:i=0,decay:t=1}=e,r=new Ht(n,s,i,t);return r.castShadow=!0,this.scene.add(r),r}spotLight(e={}){const{color:n=16777215,intensity:s=1,distance:i=0,angle:t=Math.PI/8,penumbra:r=0,decay:a=1}=e,o=new Mn(n,s,i,t,r,a);return o.castShadow=!0,this.scene.add(o),o}rectAreaLight(e={}){const{color:n=16777215,intensity:s=1,width:i=10,height:t=10}=e,r=new Ri(n,s,i,t);return this.scene.add(r),r}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2022 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Po{constructor(e){this.scene=e}add(e,n={}){const s=this.make(e,n);return s?this.scene.add(s):console.warn("Could not make heightmap"),s}make(e,n={}){const{image:s}=e,{width:i,height:t}=s,{colorScale:r,heightScale:a=100,colorSpace:o=""}=n,u=document.createElement("canvas");u.width=i,u.height=t;const c=u.getContext("2d");if(!c)return;c.drawImage(e.image,0,0);const f=c.getImageData(0,0,i,t),h=new yt(10,10,i-1,t-1);let l={color:13421772,side:Sn};r&&(l={...l,vertexColors:!0});const d=new mt(l),p=new ws(h,d);p.receiveShadow=p.castShadow=!0,p.shape="concave";const m=h.attributes.position.array;for(let x=0;x<m.length;x++){const T=f.data[x*4]/a;m[x*3+2]=T}if(r){const x=h.attributes.position.count;h.setAttribute("color",new He(new Float32Array(x*3),3));const T=new he,v=h.attributes.position,b=h.attributes.color;let g,w;for(let S=0;S<x;S++)g=v.getZ(S),w=r(g).hsl(),T.setHSL(w[0]/360,w[1],w[2],o),b.setXYZ(S,T.r,T.g,T.b)}return p.rotateX(-Math.PI/2),p.updateMatrix(),h.computeVertexNormals(),p.name="heightmap",p}}const qn={type:"change"},un={type:"start"},Zn={type:"end"};class Co extends Li{constructor(e,n){super(),this.object=e,this.domElement=n,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new j,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:ot.ROTATE,MIDDLE:ot.DOLLY,RIGHT:ot.PAN},this.touches={ONE:at.ROTATE,TWO:at.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(k){k.addEventListener("keydown",$),this._domElementKeyEvents=k},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",$),this._domElementKeyEvents=null},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(qn),s.update(),t=i.NONE},this.update=function(){const k=new j,ne=new Me().setFromUnitVectors(e.up,new j(0,1,0)),fe=ne.clone().invert(),xe=new j,be=new Me,rt=new j,Fe=2*Math.PI;return function(){const Ln=s.object.position;k.copy(Ln).sub(s.target),k.applyQuaternion(ne),a.setFromVector3(k),s.autoRotate&&t===i.NONE&&P(S()),s.enableDamping?(a.theta+=o.theta*s.dampingFactor,a.phi+=o.phi*s.dampingFactor):(a.theta+=o.theta,a.phi+=o.phi);let Ge=s.minAzimuthAngle,We=s.maxAzimuthAngle;return isFinite(Ge)&&isFinite(We)&&(Ge<-Math.PI?Ge+=Fe:Ge>Math.PI&&(Ge-=Fe),We<-Math.PI?We+=Fe:We>Math.PI&&(We-=Fe),Ge<=We?a.theta=Math.max(Ge,Math.min(We,a.theta)):a.theta=a.theta>(Ge+We)/2?Math.max(Ge,a.theta):Math.min(We,a.theta)),a.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=u,a.radius=Math.max(s.minDistance,Math.min(s.maxDistance,a.radius)),s.enableDamping===!0?s.target.addScaledVector(c,s.dampingFactor):s.target.add(c),k.setFromSpherical(a),k.applyQuaternion(fe),Ln.copy(s.target).add(k),s.object.lookAt(s.target),s.enableDamping===!0?(o.theta*=1-s.dampingFactor,o.phi*=1-s.dampingFactor,c.multiplyScalar(1-s.dampingFactor)):(o.set(0,0,0),c.set(0,0,0)),u=1,f||xe.distanceToSquared(s.object.position)>r||8*(1-be.dot(s.object.quaternion))>r||rt.distanceToSquared(s.target)>0?(s.dispatchEvent(qn),xe.copy(s.object.position),be.copy(s.object.quaternion),rt.copy(s.target),f=!1,!0):!1}}(),this.dispose=function(){s.domElement.removeEventListener("contextmenu",we),s.domElement.removeEventListener("pointerdown",G),s.domElement.removeEventListener("pointercancel",Z),s.domElement.removeEventListener("wheel",I),s.domElement.removeEventListener("pointermove",Y),s.domElement.removeEventListener("pointerup",Z),s._domElementKeyEvents!==null&&(s._domElementKeyEvents.removeEventListener("keydown",$),s._domElementKeyEvents=null)};const s=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let t=i.NONE;const r=1e-6,a=new On,o=new On;let u=1;const c=new j;let f=!1;const h=new se,l=new se,d=new se,p=new se,m=new se,x=new se,T=new se,v=new se,b=new se,g=[],w={};function S(){return 2*Math.PI/60/60*s.autoRotateSpeed}function A(){return Math.pow(.95,s.zoomSpeed)}function P(k){o.theta-=k}function M(k){o.phi-=k}const L=function(){const k=new j;return function(fe,xe){k.setFromMatrixColumn(xe,0),k.multiplyScalar(-fe),c.add(k)}}(),E=function(){const k=new j;return function(fe,xe){s.screenSpacePanning===!0?k.setFromMatrixColumn(xe,1):(k.setFromMatrixColumn(xe,0),k.crossVectors(s.object.up,k)),k.multiplyScalar(fe),c.add(k)}}(),D=function(){const k=new j;return function(fe,xe){const be=s.domElement;if(s.object.isPerspectiveCamera){const rt=s.object.position;k.copy(rt).sub(s.target);let Fe=k.length();Fe*=Math.tan(s.object.fov/2*Math.PI/180),L(2*fe*Fe/be.clientHeight,s.object.matrix),E(2*xe*Fe/be.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(L(fe*(s.object.right-s.object.left)/s.object.zoom/be.clientWidth,s.object.matrix),E(xe*(s.object.top-s.object.bottom)/s.object.zoom/be.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function V(k){s.object.isPerspectiveCamera?u/=k:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*k)),s.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function z(k){s.object.isPerspectiveCamera?u*=k:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/k)),s.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function W(k){h.set(k.clientX,k.clientY)}function _(k){T.set(k.clientX,k.clientY)}function U(k){p.set(k.clientX,k.clientY)}function J(k){l.set(k.clientX,k.clientY),d.subVectors(l,h).multiplyScalar(s.rotateSpeed);const ne=s.domElement;P(2*Math.PI*d.x/ne.clientHeight),M(2*Math.PI*d.y/ne.clientHeight),h.copy(l),s.update()}function te(k){v.set(k.clientX,k.clientY),b.subVectors(v,T),b.y>0?V(A()):b.y<0&&z(A()),T.copy(v),s.update()}function re(k){m.set(k.clientX,k.clientY),x.subVectors(m,p).multiplyScalar(s.panSpeed),D(x.x,x.y),p.copy(m),s.update()}function oe(k){k.deltaY<0?z(A()):k.deltaY>0&&V(A()),s.update()}function ue(k){let ne=!1;switch(k.code){case s.keys.UP:k.ctrlKey||k.metaKey||k.shiftKey?M(2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):D(0,s.keyPanSpeed),ne=!0;break;case s.keys.BOTTOM:k.ctrlKey||k.metaKey||k.shiftKey?M(-2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):D(0,-s.keyPanSpeed),ne=!0;break;case s.keys.LEFT:k.ctrlKey||k.metaKey||k.shiftKey?P(2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):D(s.keyPanSpeed,0),ne=!0;break;case s.keys.RIGHT:k.ctrlKey||k.metaKey||k.shiftKey?P(-2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):D(-s.keyPanSpeed,0),ne=!0;break}ne&&(k.preventDefault(),s.update())}function B(){if(g.length===1)h.set(g[0].pageX,g[0].pageY);else{const k=.5*(g[0].pageX+g[1].pageX),ne=.5*(g[0].pageY+g[1].pageY);h.set(k,ne)}}function O(){if(g.length===1)p.set(g[0].pageX,g[0].pageY);else{const k=.5*(g[0].pageX+g[1].pageX),ne=.5*(g[0].pageY+g[1].pageY);p.set(k,ne)}}function C(){const k=g[0].pageX-g[1].pageX,ne=g[0].pageY-g[1].pageY,fe=Math.sqrt(k*k+ne*ne);T.set(0,fe)}function R(){s.enableZoom&&C(),s.enablePan&&O()}function H(){s.enableZoom&&C(),s.enableRotate&&B()}function X(k){if(g.length==1)l.set(k.pageX,k.pageY);else{const fe=Ye(k),xe=.5*(k.pageX+fe.x),be=.5*(k.pageY+fe.y);l.set(xe,be)}d.subVectors(l,h).multiplyScalar(s.rotateSpeed);const ne=s.domElement;P(2*Math.PI*d.x/ne.clientHeight),M(2*Math.PI*d.y/ne.clientHeight),h.copy(l)}function N(k){if(g.length===1)m.set(k.pageX,k.pageY);else{const ne=Ye(k),fe=.5*(k.pageX+ne.x),xe=.5*(k.pageY+ne.y);m.set(fe,xe)}x.subVectors(m,p).multiplyScalar(s.panSpeed),D(x.x,x.y),p.copy(m)}function K(k){const ne=Ye(k),fe=k.pageX-ne.x,xe=k.pageY-ne.y,be=Math.sqrt(fe*fe+xe*xe);v.set(0,be),b.set(0,Math.pow(v.y/T.y,s.zoomSpeed)),V(b.y),T.copy(v)}function Q(k){s.enableZoom&&K(k),s.enablePan&&N(k)}function q(k){s.enableZoom&&K(k),s.enableRotate&&X(k)}function G(k){s.enabled!==!1&&(g.length===0&&(s.domElement.setPointerCapture(k.pointerId),s.domElement.addEventListener("pointermove",Y),s.domElement.addEventListener("pointerup",Z)),me(k),k.pointerType==="touch"?ae(k):ee(k))}function Y(k){s.enabled!==!1&&(k.pointerType==="touch"?ve(k):F(k))}function Z(k){Ce(k),g.length===0&&(s.domElement.releasePointerCapture(k.pointerId),s.domElement.removeEventListener("pointermove",Y),s.domElement.removeEventListener("pointerup",Z)),s.dispatchEvent(Zn),t=i.NONE}function ee(k){let ne;switch(k.button){case 0:ne=s.mouseButtons.LEFT;break;case 1:ne=s.mouseButtons.MIDDLE;break;case 2:ne=s.mouseButtons.RIGHT;break;default:ne=-1}switch(ne){case ot.DOLLY:if(s.enableZoom===!1)return;_(k),t=i.DOLLY;break;case ot.ROTATE:if(k.ctrlKey||k.metaKey||k.shiftKey){if(s.enablePan===!1)return;U(k),t=i.PAN}else{if(s.enableRotate===!1)return;W(k),t=i.ROTATE}break;case ot.PAN:if(k.ctrlKey||k.metaKey||k.shiftKey){if(s.enableRotate===!1)return;W(k),t=i.ROTATE}else{if(s.enablePan===!1)return;U(k),t=i.PAN}break;default:t=i.NONE}t!==i.NONE&&s.dispatchEvent(un)}function F(k){switch(t){case i.ROTATE:if(s.enableRotate===!1)return;J(k);break;case i.DOLLY:if(s.enableZoom===!1)return;te(k);break;case i.PAN:if(s.enablePan===!1)return;re(k);break}}function I(k){s.enabled===!1||s.enableZoom===!1||t!==i.NONE||(k.preventDefault(),s.dispatchEvent(un),oe(k),s.dispatchEvent(Zn))}function $(k){s.enabled===!1||s.enablePan===!1||ue(k)}function ae(k){switch(Re(k),g.length){case 1:switch(s.touches.ONE){case at.ROTATE:if(s.enableRotate===!1)return;B(),t=i.TOUCH_ROTATE;break;case at.PAN:if(s.enablePan===!1)return;O(),t=i.TOUCH_PAN;break;default:t=i.NONE}break;case 2:switch(s.touches.TWO){case at.DOLLY_PAN:if(s.enableZoom===!1&&s.enablePan===!1)return;R(),t=i.TOUCH_DOLLY_PAN;break;case at.DOLLY_ROTATE:if(s.enableZoom===!1&&s.enableRotate===!1)return;H(),t=i.TOUCH_DOLLY_ROTATE;break;default:t=i.NONE}break;default:t=i.NONE}t!==i.NONE&&s.dispatchEvent(un)}function ve(k){switch(Re(k),t){case i.TOUCH_ROTATE:if(s.enableRotate===!1)return;X(k),s.update();break;case i.TOUCH_PAN:if(s.enablePan===!1)return;N(k),s.update();break;case i.TOUCH_DOLLY_PAN:if(s.enableZoom===!1&&s.enablePan===!1)return;Q(k),s.update();break;case i.TOUCH_DOLLY_ROTATE:if(s.enableZoom===!1&&s.enableRotate===!1)return;q(k),s.update();break;default:t=i.NONE}}function we(k){s.enabled!==!1&&k.preventDefault()}function me(k){g.push(k)}function Ce(k){delete w[k.pointerId];for(let ne=0;ne<g.length;ne++)if(g[ne].pointerId==k.pointerId){g.splice(ne,1);return}}function Re(k){let ne=w[k.pointerId];ne===void 0&&(ne=new se,w[k.pointerId]=ne),ne.set(k.pageX,k.pageY)}function Ye(k){const ne=k.pointerId===g[0].pointerId?g[1]:g[0];return w[ne.pointerId]}s.domElement.addEventListener("contextmenu",we),s.domElement.addEventListener("pointerdown",G),s.domElement.addEventListener("pointercancel",Z),s.domElement.addEventListener("wheel",I,{passive:!1}),this.update()}}class Eo{constructor(e,n,s,i,t,r,a){this.scene=e,this.renderer=n,this.camera=s,this.lights=i,this.physics=t,this.load=r,this.factories=a}async warpSpeed(...e){let n={};const s=e.filter(o=>/^-\w+/.test(o)),i=s.length>0;if((e.length===0||i)&&(e=["light","camera","lookAtCenter","ground","grid","orbitControls","fog","sky"]),i&&s.map(u=>u.substr(1)).forEach(u=>{const c=e.indexOf(u);e.splice(c,1)}),e.includes("sky")){const o=["varying vec3 vWorldPosition;","","void main() {","","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","","}"].join(`
`),u=["uniform vec3 topColor;","uniform vec3 bottomColor;","uniform float offset;","uniform float exponent;","","varying vec3 vWorldPosition;","","void main() {","","float h = normalize( vWorldPosition + offset ).y;","gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h , 0.0), exponent ), 0.0 ) ), 1.0 );","","}"].join(`
`),c={topColor:{value:new he(30719)},bottomColor:{value:new he(15595007)},offset:{value:33},exponent:{value:.6}};var t=new zt(500,32,15),r=new jt({uniforms:c,vertexShader:o,fragmentShader:u,side:Ii}),a=new Te(t,r);this.scene.add(a)}if(e.includes("camera")&&(this.camera.position.set(0,6,12),n={camera:this.camera,...n}),e.includes("light")){const u=this.lights.hemisphereLight({skyColor:16777215,groundColor:0,intensity:1}),c=this.lights.ambientLight({color:16777215,intensity:1}),f=this.lights.directionalLight({color:16777215,intensity:1});f.position.set(100,200,50);const h=20;f.shadow.camera.top=h,f.shadow.camera.bottom=-h,f.shadow.camera.left=-h,f.shadow.camera.right=h,f.shadow.mapSize.set(1024,1024),n={lights:{ambientLight:c,directionalLight:f,hemisphereLight:u},...n}}if(e.includes("lookAtCenter")&&this.camera.lookAt(this.scene.position),e.includes("ground")){const o=e.includes("grid"),u="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOnAAADusBZ+q87AAAAJtJREFUeJzt0EENwDAAxLDbNP6UOxh+NEYQ5dl2drFv286598GrA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAu37AD8eaBH5JQdVbAAAAAElFTkSuQmCC",c=await this.load.texture(u);c.wrapS=c.wrapT=Xe,c.repeat.set(21,21);const f={name:"ground",width:21,height:21,depth:1,y:-.5},h={phong:{map:o?c:null,color:16777215}};let l;window.__loadPhysics?(l=this.physics.add.ground(f,h),l.body.setRestitution(1)):l=this.factories.add.ground(f,h),l.receiveShadow=!0,n={ground:l,...n}}return e.includes("orbitControls")&&(n={orbitControls:new Co(this.camera,document.getElementById("enable3d-phaser-canvas")||this.renderer.domElement),...n}),n}}class Ro{constructor(){this._mixers=[]}animationMixer(e){const n=new Jn(e);return this.mixers.add(n),n}get mixers(){return{create:e=>this.animationMixer(e),add:e=>this._mixers.push(e),get:()=>this._mixers,update:e=>{var n;return(n=this._mixers)==null?void 0:n.forEach(s=>s.update(e/1e3))}}}}class bt extends Te{constructor(e,n={}){super(e),this.isReflector=!0,this.type="Reflector",this.camera=new Mt;const s=this,i=n.color!==void 0?new he(n.color):new he(8355711),t=n.textureWidth||512,r=n.textureHeight||512,a=n.clipBias||0,o=n.shader||bt.ReflectorShader,u=n.multisample!==void 0?n.multisample:4,c=new it,f=new j,h=new j,l=new j,d=new ie,p=new j(0,0,-1),m=new je,x=new j,T=new j,v=new je,b=new ie,g=this.camera,w=new ms(t,r,{samples:u,type:gs}),S=new jt({name:o.name!==void 0?o.name:"unspecified",uniforms:Cn.clone(o.uniforms),fragmentShader:o.fragmentShader,vertexShader:o.vertexShader});S.uniforms.tDiffuse.value=w.texture,S.uniforms.color.value=i,S.uniforms.textureMatrix.value=b,this.material=S,this.onBeforeRender=function(A,P,M){if(h.setFromMatrixPosition(s.matrixWorld),l.setFromMatrixPosition(M.matrixWorld),d.extractRotation(s.matrixWorld),f.set(0,0,1),f.applyMatrix4(d),x.subVectors(h,l),x.dot(f)>0)return;x.reflect(f).negate(),x.add(h),d.extractRotation(M.matrixWorld),p.set(0,0,-1),p.applyMatrix4(d),p.add(l),T.subVectors(h,p),T.reflect(f).negate(),T.add(h),g.position.copy(x),g.up.set(0,1,0),g.up.applyMatrix4(d),g.up.reflect(f),g.lookAt(T),g.far=M.far,g.updateMatrixWorld(),g.projectionMatrix.copy(M.projectionMatrix),b.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),b.multiply(g.projectionMatrix),b.multiply(g.matrixWorldInverse),b.multiply(s.matrixWorld),c.setFromNormalAndCoplanarPoint(f,h),c.applyMatrix4(g.matrixWorldInverse),m.set(c.normal.x,c.normal.y,c.normal.z,c.constant);const L=g.projectionMatrix;v.x=(Math.sign(m.x)+L.elements[8])/L.elements[0],v.y=(Math.sign(m.y)+L.elements[9])/L.elements[5],v.z=-1,v.w=(1+L.elements[10])/L.elements[14],m.multiplyScalar(2/m.dot(v)),L.elements[2]=m.x,L.elements[6]=m.y,L.elements[10]=m.z+1-a,L.elements[14]=m.w,s.visible=!1;const E=A.getRenderTarget(),D=A.xr.enabled,V=A.shadowMap.autoUpdate,z=A.outputColorSpace,W=A.toneMapping;A.xr.enabled=!1,A.shadowMap.autoUpdate=!1,A.outputColorSpace=ys,A.toneMapping=xs,A.setRenderTarget(w),A.state.buffers.depth.setMask(!0),A.autoClear===!1&&A.clear(),A.render(P,g),A.xr.enabled=D,A.shadowMap.autoUpdate=V,A.outputColorSpace=z,A.toneMapping=W,A.setRenderTarget(E);const _=M.viewport;_!==void 0&&A.state.viewport(_),s.visible=!0},this.getRenderTarget=function(){return w},this.dispose=function(){w.dispose(),s.material.dispose()}}}bt.ReflectorShader={name:"ReflectorShader",uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		#include <common>
		#include <logdepthbuf_pars_vertex>

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			#include <logdepthbuf_vertex>

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		varying vec4 vUv;

		#include <logdepthbuf_pars_fragment>

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			#include <logdepthbuf_fragment>

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>

		}`};class St extends Te{constructor(e,n={}){super(e),this.isRefractor=!0,this.type="Refractor",this.camera=new Mt;const s=this,i=n.color!==void 0?new he(n.color):new he(8355711),t=n.textureWidth||512,r=n.textureHeight||512,a=n.clipBias||0,o=n.shader||St.RefractorShader,u=n.multisample!==void 0?n.multisample:4,c=this.camera;c.matrixAutoUpdate=!1,c.userData.refractor=!0;const f=new it,h=new ie,l=new ms(t,r,{samples:u,type:gs});this.material=new jt({uniforms:Cn.clone(o.uniforms),vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,transparent:!0}),this.material.uniforms.color.value=i,this.material.uniforms.tDiffuse.value=l.texture,this.material.uniforms.textureMatrix.value=h;const d=function(){const v=new j,b=new j,g=new ie,w=new j,S=new j;return function(P){return v.setFromMatrixPosition(s.matrixWorld),b.setFromMatrixPosition(P.matrixWorld),w.subVectors(v,b),g.extractRotation(s.matrixWorld),S.set(0,0,1),S.applyMatrix4(g),w.dot(S)<0}}(),p=function(){const v=new j,b=new j,g=new Me,w=new j;return function(){s.matrixWorld.decompose(b,g,w),v.set(0,0,1).applyQuaternion(g).normalize(),v.negate(),f.setFromNormalAndCoplanarPoint(v,b)}}(),m=function(){const v=new it,b=new je,g=new je;return function(S){c.matrixWorld.copy(S.matrixWorld),c.matrixWorldInverse.copy(c.matrixWorld).invert(),c.projectionMatrix.copy(S.projectionMatrix),c.far=S.far,v.copy(f),v.applyMatrix4(c.matrixWorldInverse),b.set(v.normal.x,v.normal.y,v.normal.z,v.constant);const A=c.projectionMatrix;g.x=(Math.sign(b.x)+A.elements[8])/A.elements[0],g.y=(Math.sign(b.y)+A.elements[9])/A.elements[5],g.z=-1,g.w=(1+A.elements[10])/A.elements[14],b.multiplyScalar(2/b.dot(g)),A.elements[2]=b.x,A.elements[6]=b.y,A.elements[10]=b.z+1-a,A.elements[14]=b.w}}();function x(v){h.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),h.multiply(v.projectionMatrix),h.multiply(v.matrixWorldInverse),h.multiply(s.matrixWorld)}function T(v,b,g){s.visible=!1;const w=v.getRenderTarget(),S=v.xr.enabled,A=v.shadowMap.autoUpdate,P=v.outputColorSpace,M=v.toneMapping;v.xr.enabled=!1,v.shadowMap.autoUpdate=!1,v.outputColorSpace=ys,v.toneMapping=xs,v.setRenderTarget(l),v.autoClear===!1&&v.clear(),v.render(b,c),v.xr.enabled=S,v.shadowMap.autoUpdate=A,v.outputColorSpace=P,v.toneMapping=M,v.setRenderTarget(w);const L=g.viewport;L!==void 0&&v.state.viewport(L),s.visible=!0}this.onBeforeRender=function(v,b,g){g.userData.refractor!==!0&&d(g)&&(p(),x(g),m(g),T(v,b,g))},this.getRenderTarget=function(){return l},this.dispose=function(){l.dispose(),s.material.dispose()}}}St.RefractorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`

		uniform mat4 textureMatrix;

		varying vec4 vUv;

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform vec3 color;
		uniform sampler2D tDiffuse;

		varying vec4 vUv;

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>

		}`};class qt extends Te{constructor(e,n={}){super(e),this.isWater=!0,this.type="Water";const s=this,i=n.color!==void 0?new he(n.color):new he(16777215),t=n.textureWidth||512,r=n.textureHeight||512,a=n.clipBias||0,o=n.flowDirection||new se(1,0),u=n.flowSpeed||.03,c=n.reflectivity||.02,f=n.scale||1,h=n.shader||qt.WaterShader,l=new Wt,d=n.flowMap||void 0,p=n.normalMap0||l.load("textures/water/Water_1_M_Normal.jpg"),m=n.normalMap1||l.load("textures/water/Water_2_M_Normal.jpg"),x=.15,T=x*.5,v=new ie,b=new Di;if(bt===void 0){console.error("THREE.Water: Required component Reflector not found.");return}if(St===void 0){console.error("THREE.Water: Required component Refractor not found.");return}const g=new bt(e,{textureWidth:t,textureHeight:r,clipBias:a}),w=new St(e,{textureWidth:t,textureHeight:r,clipBias:a});g.matrixAutoUpdate=!1,w.matrixAutoUpdate=!1,this.material=new jt({uniforms:Cn.merge([Oi.fog,h.uniforms]),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,transparent:!0,fog:!0}),d!==void 0?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:d}):this.material.uniforms.flowDirection={type:"v2",value:o},p.wrapS=p.wrapT=Xe,m.wrapS=m.wrapT=Xe,this.material.uniforms.tReflectionMap.value=g.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=w.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=p,this.material.uniforms.tNormalMap1.value=m,this.material.uniforms.color.value=i,this.material.uniforms.reflectivity.value=c,this.material.uniforms.textureMatrix.value=v,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=T,this.material.uniforms.config.value.z=T,this.material.uniforms.config.value.w=f;function S(P){v.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),v.multiply(P.projectionMatrix),v.multiply(P.matrixWorldInverse),v.multiply(s.matrixWorld)}function A(){const P=b.getDelta(),M=s.material.uniforms.config;M.value.x+=u*P,M.value.y=M.value.x+T,M.value.x>=x?(M.value.x=0,M.value.y=T):M.value.y>=x&&(M.value.y=M.value.y-x)}this.onBeforeRender=function(P,M,L){S(L),A(),s.visible=!1,g.matrixWorld.copy(s.matrixWorld),w.matrixWorld.copy(s.matrixWorld),g.onBeforeRender(P,M,L),w.onBeforeRender(P,M,L),s.visible=!0}}}qt.WaterShader={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new je}},vertexShader:`

		#include <common>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>

		uniform mat4 textureMatrix;

		varying vec4 vCoord;
		varying vec2 vUv;
		varying vec3 vToEye;

		void main() {

			vUv = uv;
			vCoord = textureMatrix * vec4( position, 1.0 );

			vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
			vToEye = cameraPosition - worldPosition.xyz;

			vec4 mvPosition =  viewMatrix * worldPosition; // used in fog_vertex
			gl_Position = projectionMatrix * mvPosition;

			#include <logdepthbuf_vertex>
			#include <fog_vertex>

		}`,fragmentShader:`

		#include <common>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>

		uniform sampler2D tReflectionMap;
		uniform sampler2D tRefractionMap;
		uniform sampler2D tNormalMap0;
		uniform sampler2D tNormalMap1;

		#ifdef USE_FLOWMAP
			uniform sampler2D tFlowMap;
		#else
			uniform vec2 flowDirection;
		#endif

		uniform vec3 color;
		uniform float reflectivity;
		uniform vec4 config;

		varying vec4 vCoord;
		varying vec2 vUv;
		varying vec3 vToEye;

		void main() {

			#include <logdepthbuf_fragment>

			float flowMapOffset0 = config.x;
			float flowMapOffset1 = config.y;
			float halfCycle = config.z;
			float scale = config.w;

			vec3 toEye = normalize( vToEye );

			// determine flow direction
			vec2 flow;
			#ifdef USE_FLOWMAP
				flow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;
			#else
				flow = flowDirection;
			#endif
			flow.x *= - 1.0;

			// sample normal maps (distort uvs with flowdata)
			vec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );
			vec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );

			// linear interpolate to get the final normal color
			float flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;
			vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );

			// calculate normal vector
			vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );

			// calculate the fresnel term to blend reflection and refraction maps
			float theta = max( dot( toEye, normal ), 0.0 );
			float reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );

			// calculate final uv coords
			vec3 coord = vCoord.xyz / vCoord.w;
			vec2 uv = coord.xy + coord.z * normal.xz * 0.05;

			vec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );
			vec4 refractColor = texture2D( tRefractionMap, uv );

			// multiply water color with the mix of both textures
			gl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>

		}`};const Lo=(y,e,n={})=>{const{width:s=20,height:i=20,x:t=0,y:r=0,z:a=0,color:o="#ffffff",scale:u=4,flowX:c=1,flowY:f=1,normalMap0:h=void 0,normalMap1:l=void 0}=n,d=new yt(s,i),p=new Gt({color:30654,transparent:!0,opacity:.8}),m=new Te(d,p);m.position.set(t,r,a),m.rotation.x=Math.PI*-.5,y.add(m);const x=new yt(s,i),T=new qt(x,{color:o,scale:u,flowDirection:new se(c,f),textureWidth:1024,textureHeight:1024,normalMap0:h,normalMap1:l,encoding:e.outputEncoding});return T.position.set(t,r+.1,a),T.rotation.x=Math.PI*-.5,y.add(T),{ground:m,water:T}};class Io{constructor(e,n,s){this.scene=e,this.renderer=n,this.factories=s}water(e={}){Lo(this.scene,this.renderer,e)}textureCube(e){e.length!==6&&Ae("You need to pass 6 urls to textureCube()");const n=new Oo;return e.forEach((s,i)=>{s.wrapS=s.wrapT=Xe;const t=this.factories.add.material({phong:{map:s}});n.materials[i]=t}),n}}class Oo{constructor(){this.materials=new Array(6)}get texture(){return{left:this.getTexture(0),right:this.getTexture(1),up:this.getTexture(2),down:this.getTexture(3),front:this.getTexture(4),back:this.getTexture(5)}}getTexture(e){return this.materials[e].map}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Do{constructor(e,n){this.camera=e,this.renderer=n,this.tmpVector2=new se}fromSVGtoShape(e){if(e){const n=new Tt,s=[];return n.parse(e).paths.forEach(i=>{Tt.createShapes(i).forEach(t=>{s.push(t)})}),s}return[]}from3dto2d(e){const n=new j(e.x,e.y,e.z),s=this.renderer.domElement;this.camera.updateMatrixWorld(),n.project(this.camera);const i=Math.round((n.x+1)*(s.width/2)),t=Math.round((-n.y+1)*(s.height/2));return new se(i,t)}from2dto3d(e,n,s){var a;if(!this.tmpPlane){const o=new yt(1e4,1e4),u=new Ne({transparent:!0,opacity:.25});this.tmpPlane=new Te(o,u),this.tmpPlane.name="_tmp_raycast_plane"}this.tmpRaycaster||(this.tmpRaycaster=new vs),this.tmpVector3||(this.tmpVector3=new j);let i;this.tmpPlane.setRotationFromEuler(this.camera.rotation);const t=this.camera.position;this.tmpPlane.position.set(t.x,t.y,t.z),this.camera.getWorldDirection(this.tmpVector3),this.tmpPlane.position.add(this.tmpVector3.clone().multiplyScalar(s)),this.tmpPlane.updateMatrix(),this.tmpPlane.updateMatrixWorld(!0),this.tmpVector2.set(e,n),this.tmpRaycaster.setFromCamera(this.tmpVector2,this.camera);const r=this.tmpRaycaster.intersectObjects([this.tmpPlane]);return((a=r[0])==null?void 0:a.object.name)==="_tmp_raycast_plane"&&(i=r[0].point),i}}class ft{static createButton(e){const n=document.createElement("button");function s(){let o=null;async function u(f){f.addEventListener("end",c),await e.xr.setSession(f),n.textContent="EXIT VR",o=f}function c(){o.removeEventListener("end",c),n.textContent="ENTER VR",o=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="ENTER VR",n.onmouseenter=function(){n.style.opacity="1.0"},n.onmouseleave=function(){n.style.opacity="0.5"},n.onclick=function(){if(o===null){const f={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]};navigator.xr.requestSession("immersive-vr",f).then(u)}else o.end()}}function i(){n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null}function t(){i(),n.textContent="VR NOT SUPPORTED"}function r(o){i(),console.warn("Exception when trying to call xr.isSessionSupported",o),n.textContent="VR NOT ALLOWED"}function a(o){o.style.position="absolute",o.style.bottom="20px",o.style.padding="12px 6px",o.style.border="1px solid #fff",o.style.borderRadius="4px",o.style.background="rgba(0,0,0,0.1)",o.style.color="#fff",o.style.font="normal 13px sans-serif",o.style.textAlign="center",o.style.opacity="0.5",o.style.outline="none",o.style.zIndex="999"}if("xr"in navigator)return n.id="VRButton",n.style.display="none",a(n),navigator.xr.isSessionSupported("immersive-vr").then(function(o){o?s():t(),o&&ft.xrSessionIsGranted&&n.click()}).catch(r),n;{const o=document.createElement("a");return window.isSecureContext===!1?(o.href=document.location.href.replace(/^http:/,"https:"),o.innerHTML="WEBXR NEEDS HTTPS"):(o.href="https://immersiveweb.dev/",o.innerHTML="WEBXR NOT AVAILABLE"),o.style.left="calc(50% - 90px)",o.style.width="180px",o.style.textDecoration="none",a(o),o}}static registerSessionGrantedListener(){if("xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",()=>{ft.xrSessionIsGranted=!0})}}}ft.xrSessionIsGranted=!1;ft.registerSessionGrantedListener();const ge={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function zs(y){const e=await fetch(y);if(e.ok)return e.json();throw new Error(e.statusText)}async function ko(y){if(!y)throw new Error("No basePath supplied");return await zs(`${y}/profilesList.json`)}async function Fo(y,e,n=null,s=!0){if(!y)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const i=await ko(e);let t;if(y.profiles.some(o=>{const u=i[o];return u&&(t={profileId:o,profilePath:`${e}/${u.path}`,deprecated:!!u.deprecated}),!!t}),!t){if(!n)throw new Error("No matching profile name found");const o=i[n];if(!o)throw new Error(`No matching profile name found and default profile "${n}" missing.`);t={profileId:n,profilePath:`${e}/${o.path}`,deprecated:!!o.deprecated}}const r=await zs(t.profilePath);let a;if(s){let o;if(y.handedness==="any"?o=r.layouts[Object.keys(r.layouts)[0]]:o=r.layouts[y.handedness],!o)throw new Error(`No matching handedness, ${y.handedness}, in profile ${t.profileId}`);o.assetPath&&(a=t.profilePath.replace("profile.json",o.assetPath))}return{profile:r,assetPath:a}}const Bo={xAxis:0,yAxis:0,button:0,state:ge.ComponentState.DEFAULT};function Vo(y=0,e=0){let n=y,s=e;if(Math.sqrt(y*y+e*e)>1){const r=Math.atan2(e,y);n=Math.cos(r),s=Math.sin(r)}return{normalizedXAxis:n*.5+.5,normalizedYAxis:s*.5+.5}}class No{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===ge.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(Bo)}updateFromComponent({xAxis:e,yAxis:n,button:s,state:i}){const{normalizedXAxis:t,normalizedYAxis:r}=Vo(e,n);switch(this.componentProperty){case ge.ComponentProperty.X_AXIS:this.value=this.states.includes(i)?t:.5;break;case ge.ComponentProperty.Y_AXIS:this.value=this.states.includes(i)?r:.5;break;case ge.ComponentProperty.BUTTON:this.value=this.states.includes(i)?s:0;break;case ge.ComponentProperty.STATE:this.valueNodeProperty===ge.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(i):this.value=this.states.includes(i)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class Ho{constructor(e,n){if(!e||!n||!n.visualResponses||!n.gamepadIndices||Object.keys(n.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=n.type,this.rootNodeName=n.rootNodeName,this.touchPointNodeName=n.touchPointNodeName,this.visualResponses={},Object.keys(n.visualResponses).forEach(s=>{const i=new No(n.visualResponses[s]);this.visualResponses[s]=i}),this.gamepadIndices=Object.assign({},n.gamepadIndices),this.values={state:ge.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=ge.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const n=e.buttons[this.gamepadIndices.button];this.values.button=n.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,n.pressed||this.values.button===1?this.values.state=ge.ComponentState.PRESSED:(n.touched||this.values.button>ge.ButtonTouchThreshold)&&(this.values.state=ge.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===ge.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>ge.AxisTouchThreshold&&(this.values.state=ge.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===ge.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>ge.AxisTouchThreshold&&(this.values.state=ge.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(n=>{n.updateFromComponent(this.values)})}}class Uo{constructor(e,n,s){if(!e)throw new Error("No xrInputSource supplied");if(!n)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=s,this.id=n.profileId,this.layoutDescription=n.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(i=>{const t=this.layoutDescription.components[i];this.components[i]=new Ho(i,t)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(n=>{e.push(n.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}const _o="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",zo="generic-trigger";class Go extends et{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(n=>{n.isMesh&&(n.material.envMap=this.envMap,n.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(n=>{Object.values(n.visualResponses).forEach(s=>{const{valueNode:i,minNode:t,maxNode:r,value:a,valueNodeProperty:o}=s;i&&(o===ge.VisualResponseProperty.VISIBILITY?i.visible=a:o===ge.VisualResponseProperty.TRANSFORM&&(i.quaternion.slerpQuaternions(t.quaternion,r.quaternion,a),i.position.lerpVectors(t.position,r.position,a)))})}))}}function Wo(y,e){Object.values(y.components).forEach(n=>{const{type:s,touchPointNodeName:i,visualResponses:t}=n;if(s===ge.ComponentType.TOUCHPAD)if(n.touchPointNode=e.getObjectByName(i),n.touchPointNode){const r=new zt(.001),a=new Ne({color:255}),o=new Te(r,a);n.touchPointNode.add(o)}else console.warn(`Could not find touch dot, ${n.touchPointNodeName}, in touchpad component ${n.id}`);Object.values(t).forEach(r=>{const{valueNodeName:a,minNodeName:o,maxNodeName:u,valueNodeProperty:c}=r;if(c===ge.VisualResponseProperty.TRANSFORM){if(r.minNode=e.getObjectByName(o),r.maxNode=e.getObjectByName(u),!r.minNode){console.warn(`Could not find ${o} in the model`);return}if(!r.maxNode){console.warn(`Could not find ${u} in the model`);return}}r.valueNode=e.getObjectByName(a),r.valueNode||console.warn(`Could not find ${a} in the model`)})})}function $n(y,e){Wo(y.motionController,e),y.envMap&&e.traverse(n=>{n.isMesh&&(n.material.envMap=y.envMap,n.material.needsUpdate=!0)}),y.add(e)}class jo{constructor(e=null){this.gltfLoader=e,this.path=_o,this._assetCache={},this.gltfLoader||(this.gltfLoader=new Hs)}createControllerModel(e){const n=new Go;let s=null;return e.addEventListener("connected",i=>{const t=i.data;t.targetRayMode!=="tracked-pointer"||!t.gamepad||Fo(t,this.path,zo).then(({profile:r,assetPath:a})=>{n.motionController=new Uo(t,r,a);const o=this._assetCache[n.motionController.assetUrl];if(o)s=o.scene.clone(),$n(n,s);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(n.motionController.assetUrl,u=>{this._assetCache[n.motionController.assetUrl]=u,s=u.scene.clone(),$n(n,s)},null,()=>{throw new Error(`Asset ${n.motionController.assetUrl} missing or malformed.`)})}}).catch(r=>{console.warn(r)})}),e.addEventListener("disconnected",()=>{n.motionController=null,n.remove(s),s=null}),n}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Xo{constructor(e,n){this._renderer=e,this._scene=n,this.controllerModelFactory=new jo;const s=new Ui;s.name="dot",this.cameraGroup=new ct,this.cameraGroup.add(s),n.add(this.cameraGroup),e.xr.enabled=!0;const i=ft.createButton(e);i.style.cssText+="background: rgba(0, 0, 0, 0.8); ",document.body.appendChild(i),this._renderer.xr.getCamera().add(this.cameraGroup)}get isPresenting(){var e,n;return!!((n=(e=this._renderer)==null?void 0:e.xr)!=null&&n.isPresenting)}getController(e){const n=this._renderer.xr.getController(e);return this.cameraGroup.add(n),n}getControllerGrip(e){const n=this._renderer.xr.getControllerGrip(e),s=this.controllerModelFactory.createControllerModel(n);return n.add(s),this.cameraGroup.add(n),n}getControllerRay(e){const{targetRayMode:n}=e;if(n==="tracked-pointer"){const s=new _e;s.setAttribute("position",new Ee([0,0,0,0,0,-1],3)),s.setAttribute("color",new Ee([1,0,0,1,1,1],3));const i=new Pt({vertexColors:!0});return new _t(s,i)}if(n==="gaze"){const s=new ki(.02,.04,32).translate(0,0,-1),i=new Ne({color:"red",opacity:.5,transparent:!0});return new Te(s,i)}}get camera(){return this.WebXRCamera}get WebXRCamera(){var e;return{group:this.cameraGroup,position:(e=this._renderer.xr.getCamera())==null?void 0:e.position,rotation:this.isPresenting?this._renderer.xr.getCamera().rotation:void 0,getWorldDirection:n=>this.isPresenting?this._renderer.xr.getCamera().getWorldDirection(n):void 0}}}const Ko=(y=20,e)=>{if(!window.__loadPhysics){console.log("There is not much fun without physics enabled!");return}for(let n=0;n<y;n++){const s=["standard","basic","normal","phong","line","points"],i=(r,a)=>Math.floor(Math.random()*(a-r+1)+r),t=r=>r[Math.floor(Math.random()*r.length)];Math.random()>.5?e.add.box({x:i(-10,10),y:i(10,20),z:i(-10,10),width:i(1,2)/10,height:i(1,2)/10,depth:i(1,2)/10,mass:1},{[t(s)]:{color:Math.floor(Math.random()*16777215)}}).body.setRestitution(Math.floor(Math.random()*10)/20):e.add.sphere({x:i(-10,10),y:i(10,20),z:i(-10,10),radius:i(1,2)/10,mass:1},{[t(s)]:{color:Math.floor(Math.random()*16777215)}}).body.setRestitution(Math.floor(Math.random()*10)/20)}};class fn{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y,this.array[this.top++]=e.z}}class Yo{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y}}class Be{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}clone(){const e=new Be;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(n=>n.clone()),e}invert(){for(let n=0;n<this.polygons.length;n++)this.polygons[n].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let n=new Array,s=new Array;for(let i=0;i<e.length;i++)this.plane.splitPolygon(e[i],n,s,n,s);return this.front&&(n=this.front.clipPolygons(n)),this.back?s=this.back.clipPolygons(s):s=[],n.concat(s)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());const n=[],s=[];for(let i=0;i<e.length;i++)this.plane.splitPolygon(e[i],this.polygons,this.polygons,n,s);n.length&&(this.front||(this.front=new Be),this.front.build(n)),s.length&&(this.back||(this.back=new Be),this.back.build(s))}}class Pe{constructor(e=0,n=0,s=0){this.x=e,this.y=n,this.z=s}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new Pe(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}times(e){return this.x*=e,this.y*=e,this.z*=e,this}dividedBy(e){return this.x/=e,this.y/=e,this.z/=e,this}lerp(e,n){return this.add(new Pe().copy(e).sub(this).times(n))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(e){const n=this.clone(),s=n.x,i=n.y,t=n.z,r=e.x,a=e.y,o=e.z;return this.x=i*o-t*a,this.y=t*r-s*o,this.z=s*a-i*r,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}toVector3(){return new j(this.x,this.y,this.z)}}class st{constructor(e,n){this.normal=e,this.w=n,this.normal=e,this.w=n}clone(){return new st(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(e,n,s,i,t){let c=0;const f=[];for(let h=0;h<e.vertices.length;h++){const l=this.normal.dot(e.vertices[h].pos)-this.w,d=l<-st.EPSILON?2:l>st.EPSILON?1:0;c|=d,f.push(d)}switch(c){case 0:(this.normal.dot(e.plane.normal)>0?n:s).push(e);break;case 1:i.push(e);break;case 2:t.push(e);break;case 3:{const h=[],l=[];for(let d=0;d<e.vertices.length;d++){const p=(d+1)%e.vertices.length,m=f[d],x=f[p],T=e.vertices[d],v=e.vertices[p];if(m!=2&&h.push(T),m!=1&&l.push(m!=2?T.clone():T),(m|x)==3){const b=(this.w-this.normal.dot(T.pos))/this.normal.dot(new Pe().copy(v.pos).sub(T.pos)),g=T.interpolate(v,b);h.push(g),l.push(g.clone())}}h.length>=3&&i.push(new ht(h,e.shared)),l.length>=3&&t.push(new ht(l,e.shared));break}}}static fromPoints(e,n,s){const i=new Pe().copy(n).sub(e).cross(new Pe().copy(s).sub(e)).normalize();return new st(i.clone(),i.dot(e))}}st.EPSILON=1e-5;class ht{constructor(e,n){this.vertices=e,this.shared=n,this.plane=st.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){return new ht(this.vertices.map(e=>e.clone()),this.shared)}flip(){this.vertices.reverse().map(e=>e.flip()),this.plane.flip()}}class Ut{constructor(e,n,s,i){this.pos=new Pe().copy(e),this.normal=new Pe().copy(n),this.uv=new Pe().copy(s),this.uv.z=0,i&&(this.color=new Pe().copy(i))}clone(){return new Ut(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(e,n){return new Ut(this.pos.clone().lerp(e.pos,n),this.normal.clone().lerp(e.normal,n),this.uv.clone().lerp(e.uv,n),this.color&&e.color&&this.color.clone().lerp(e.color,n))}}class pe{constructor(){this.polygons=[]}static fromPolygons(e){const n=new pe;return n.polygons=e,n}static fromGeometry(e,n){let s=[];const i=e.attributes.position,t=e.attributes.normal,r=e.attributes.uv,a=e.attributes.color,o=e.groups;let u;if(e.index)u=e.index.array;else{u=new Uint16Array(i.array.length/i.itemSize|0);for(let f=0;f<u.length;f++)u[f]=f}const c=u.length/3|0;s=new Array(c);for(let f=0,h=0,l=u.length;f<l;f+=3,h++){const d=new Array(3);for(let p=0;p<3;p++){const m=u[f+p],x=m*3,T=m*2,v=i.array[x],b=i.array[x+1],g=i.array[x+2],w=t.array[x],S=t.array[x+1],A=t.array[x+2],P=r==null?void 0:r.array[T],M=r==null?void 0:r.array[T+1];d[p]=new Ut(new Pe(v,b,g),new Pe(w,S,A),new Pe(P,M,0),a&&new Pe(a.array[x],a.array[x+1],a.array[x+2]))}if(n===void 0&&o&&o.length>0)for(const p of o)f>=p.start&&f<p.start+p.count&&(s[h]=new ht(d,p.materialIndex));else s[h]=new ht(d,n)}return pe.fromPolygons(s.filter(f=>!Number.isNaN(f.plane.normal.x)))}static toGeometry(e,n){let s=0;const i=e.polygons;for(const l of i)s+=l.vertices.length-2;const t=new _e,r=new fn(s*3*3),a=new fn(s*3*3),o=new Yo(s*2*3);let u;const c=[],f=[];for(const l of i){const d=l.vertices,p=d.length;l.shared!==void 0&&(c[l.shared]||(c[l.shared]=[])),p&&d[0].color!==void 0&&(u||(u=new fn(s*3*3)));for(let m=3;m<=p;m++)(l.shared===void 0?f:c[l.shared]).push(r.top/3,r.top/3+1,r.top/3+2),r.write(d[0].pos),r.write(d[m-2].pos),r.write(d[m-1].pos),a.write(d[0].normal),a.write(d[m-2].normal),a.write(d[m-1].normal),o&&(o.write(d[0].uv),o.write(d[m-2].uv),o.write(d[m-1].uv)),u&&(u.write(d[0].color),u.write(d[m-2].color),u.write(d[m-1].color))}t.setAttribute("position",new He(r.array,3)),t.setAttribute("normal",new He(a.array,3)),o&&t.setAttribute("uv",new He(o.array,2)),u&&t.setAttribute("color",new He(u.array,3));for(let l=0;l<c.length;l++)c[l]===void 0&&(c[l]=[]);if(c.length){let l=[],d=0;for(let p=0;p<c.length;p++)t.addGroup(d,c[p].length,p),d+=c[p].length,l=l.concat(c[p]);t.addGroup(d,f.length,c.length),l=l.concat(f),t.setIndex(l)}const h=new ie().copy(n).invert();return t.applyMatrix4(h),t.computeBoundingSphere(),t.computeBoundingBox(),t}static fromMesh(e,n){const s=pe.fromGeometry(e.geometry,n),i=new j,t=new Ze;t.getNormalMatrix(e.matrix);for(let r=0;r<s.polygons.length;r++){const a=s.polygons[r];for(let o=0;o<a.vertices.length;o++){const u=a.vertices[o];u.pos.copy(i.copy(u.pos.toVector3()).applyMatrix4(e.matrix)),u.normal.copy(i.copy(u.normal.toVector3()).applyMatrix3(t))}}return s}static toMesh(e,n,s){const i=pe.toGeometry(e,n),t=new Te(i,s);return t.matrix.copy(n),t.matrix.decompose(t.position,t.quaternion,t.scale),t.rotation.setFromQuaternion(t.quaternion),t.updateMatrixWorld(),t.castShadow=t.receiveShadow=!0,t}static union(e,n){const s=pe.fromMesh(e),i=pe.fromMesh(n);return pe.toMesh(s.union(i),e.matrix,e.material)}static subtract(e,n){const s=pe.fromMesh(e),i=pe.fromMesh(n);return pe.toMesh(s.subtract(i),e.matrix,e.material)}static intersect(e,n){const s=pe.fromMesh(e),i=pe.fromMesh(n);return pe.toMesh(s.intersect(i),e.matrix,e.material)}clone(){const e=new pe;return e.polygons=this.polygons.map(n=>n.clone()).filter(n=>Number.isFinite(n.plane.w)),e}toPolygons(){return this.polygons}union(e){const n=new Be(this.clone().polygons),s=new Be(e.clone().polygons);return n.clipTo(s),s.clipTo(n),s.invert(),s.clipTo(n),s.invert(),n.build(s.allPolygons()),pe.fromPolygons(n.allPolygons())}subtract(e){const n=new Be(this.clone().polygons),s=new Be(e.clone().polygons);return n.invert(),n.clipTo(s),s.clipTo(n),s.invert(),s.clipTo(n),s.invert(),n.build(s.allPolygons()),n.invert(),pe.fromPolygons(n.allPolygons())}intersect(e){const n=new Be(this.clone().polygons),s=new Be(e.clone().polygons);return n.invert(),s.clipTo(n),s.invert(),n.clipTo(s),s.clipTo(n),n.build(s.allPolygons()),n.invert(),pe.fromPolygons(n.allPolygons())}inverse(){const e=this.clone();for(const n of e.polygons)n.flip();return e}toMesh(e,n){return pe.toMesh(this,e,n)}toGeometry(e){return pe.toGeometry(this,e)}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2022 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Qo{static union(e,n){return this.doCSG(e,n,"union")}static subtract(e,n){return this.doCSG(e,n,"subtract")}static intersect(e,n){return this.doCSG(e,n,"intersect")}static doCSG(e,n,s){if(e.updateMatrix(),n.updateMatrix(),s==="union")return pe.union(e,n);if(s==="subtract")return pe.subtract(e,n);if(s==="intersect")return pe.intersect(e,n)}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class qo extends or{constructor(e,n={}){var u;const s=document.getElementById("enable3d-three-canvas");let i={};s&&(i={canvas:s}),n.renderer=new rs({...i,antialias:n.antialias||!1}),super(n),(u=e.sys.game.canvas.parentElement)==null||u.insertBefore(n.renderer.domElement,e.sys.game.canvas),e.sys.game.canvas.style.position="relative";const t=()=>{var d,p;if(!n.renderer)return;const{width:c,height:f,marginLeft:h,marginTop:l}=e.sys.game.canvas.style;n.renderer.domElement.id="enable3d-three-canvas",(d=this.camera)!=null&&d.aspect&&(this.camera.aspect=e.sys.game.scale.baseSize.width/e.sys.game.scale.baseSize.height),(p=this.camera)==null||p.updateProjectionMatrix(),n.renderer.setSize(e.sys.game.scale.baseSize.width,e.sys.game.scale.baseSize.height),n.renderer.domElement.style.width=c,n.renderer.domElement.style.height=f,n.renderer.domElement.style.marginLeft=h,n.renderer.domElement.style.marginTop=l};t(),e.scale.on("resize",()=>{t()});const r=document.createElement("style");r.innerText=`
      #enable3d-phaser-canvas:focus,
      #enable3d-three-canvas:focus {
        outline: none;
      }

      #enable3d-three-canvas {
        position: absolute;
      }
    `,document.head.appendChild(r);const{enableXR:a=!1}=n;if(this.isXrEnabled=a,this.scene3D=e,a&&(this.webXR=new Xo(this.renderer,this.scene)),this.isXrEnabled){let c=0;this.renderer.setAnimationLoop(f=>{if(this.renderer.xr.isPresenting){const h=f-c;c=f,e.updateLoopXR(f,h),this.renderer.state.reset(),this.preRender(),this.composer?this.composer.render():this.renderer.render(this.scene,this.camera),this.postRender()}})}const o=e.add.extern();o.render=c=>{this.renderer.xr.isPresenting||(this.preRender(),this.composer?this.composer.render():this.renderer.render(this.scene,this.camera),this.postRender())},e.events.on("postupdate",(c,f)=>{var h,l,d;(h=this.animationMixers)==null||h.update(f),(l=this.physics)==null||l.update(f),(d=this.physics)==null||d.updateDebugger()}),this.load=new bo(this.cache,this.textureAnisotropy),this.lights=new Mo(this.scene),this.transform=new Do(this.camera,this.renderer),this.csg=Qo,this.heightMap=new Po(this.scene),this.factories=new bs(this.scene),this.misc=new Io(this.scene,this.renderer,this.factories),this.cameras=new wt,this.ws=new Eo(this.scene,this.renderer,this.camera,this.lights,this.physics,this.load,this.factories),this.mixers=new Ro,e.events.once("shutdown",()=>{e.clearThirdDimension(),e.events.removeListener("update")})}preRender(){}postRender(){}destroy(e){var n;(n=this.physics)==null||n.destroy(e.body),this.scene.remove(e),e=null}async warpSpeed(...e){return await this.ws.warpSpeed(...e)}haveSomeFun(e=20){Ko(e,this.physics)}get animationMixers(){var e;return(e=this.mixers)==null?void 0:e.mixers}get make(){return this.factories.make}get add(){return this.factories.add}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Zo extends Gs.Scene{constructor(e){super(e)}async warpSpeed(...e){return await this.third.warpSpeed(...e)}haveSomeFun(e=20){this.third.haveSomeFun(e)}requestThirdDimension(){Ae("You do not need requestThirdDimension() anymore. Place accessThirdDimension() inside init() instead!")}clearThirdDimension(){for(const e in this.third)delete this.third[e];delete this.third}accessThirdDimension(e={}){this.clearThirdDimension(),this.third=new qo(this,e),this.cameras.main.transparent=!0,this.cameras.main.setBackgroundColor("rgba(0,0,0,0)"),this.third.scene.background=new he("white")}updateLoopXR(e,n){this.preUpdateXR(e,n),this.updateXR(e,n),this.postUpdateXR(e,n)}preUpdateXR(e,n){}updateXR(e,n){}postUpdateXR(e,n){this.third.isXrEnabled&&(this.time.update(e,n),this.third.physics.update(n),this.third.physics.updateDebugger(),this.third.animationMixers.update(n))}}window.__loadPhysics=!1;window.__ammoPath="";const $o=y=>(window.setTimeout(()=>{window.__loadPhysics?nr(window.__ammoPath,()=>{Ammo().then(()=>{y()})}):y()},50),{withPhysics(e){window.__loadPhysics=!0,window.__ammoPath=e}});/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */const Jo=()=>{try{const y=document.createElement("canvas");return!!(window.WebGL2RenderingContext&&y.getContext("webgl2"))}catch{return!1}},ea=(y={})=>{const{antialias:e=!0,parent:n=void 0,canvasId:s="enable3d-phaser-canvas"}=y,i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");i.id=s;const t=n?document.getElementById(n):document.body;t?t.appendChild(i):Ae(`Parent "${n}" not found!`);const r={antialias:e},a=r.alpha!==void 0?r.alpha:!0,o=r.depth!==void 0?r.depth:!0,u=r.stencil!==void 0?r.stencil:!0,c=r.antialias!==void 0?r.antialias:!1,f=r.premultipliedAlpha!==void 0?r.premultipliedAlpha:!0,h=r.preserveDrawingBuffer!==void 0?r.preserveDrawingBuffer:!1,l=r.powerPreference!==void 0?r.powerPreference:"default",d=r.failIfMajorPerformanceCaveat!==void 0?r.failIfMajorPerformanceCaveat:!1,m={...{alpha:a,depth:o,stencil:u,antialias:c,premultipliedAlpha:f,preserveDrawingBuffer:h,powerPreference:l,failIfMajorPerformanceCaveat:d,xrCompatible:!0}},x=Jo()?"webgl2":"webgl",T=i.getContext(x,m);return{canvas:i,context:T}};/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */document.createElement("canvas");new vs;new se;new se;new se;var ta={exports:{}};/*!
 * matter-js 0.20.0 by @liabru
 * http://brm.io/matter-js/
 * License MIT
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) Liam Brummitt and contributors.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */(function(y,e){(function(s,i){y.exports=i()})(pt,function(){return function(n){var s={};function i(t){if(s[t])return s[t].exports;var r=s[t]={i:t,l:!1,exports:{}};return n[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=n,i.c=s,i.d=function(t,r,a){i.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:a})},i.r=function(t){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,r){if(r&1&&(t=i(t)),r&8||r&4&&typeof t=="object"&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),r&2&&typeof t!="string")for(var o in t)i.d(a,o,(function(u){return t[u]}).bind(null,o));return a},i.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(r,"a",r),r},i.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},i.p="",i(i.s=20)}([function(n,s){var i={};n.exports=i,function(){i._baseDelta=1e3/60,i._nextId=0,i._seed=0,i._nowStartTime=+new Date,i._warnedOnce={},i._decomp=null,i.extend=function(r,a){var o,u;typeof a=="boolean"?(o=2,u=a):(o=1,u=!0);for(var c=o;c<arguments.length;c++){var f=arguments[c];if(f)for(var h in f)u&&f[h]&&f[h].constructor===Object&&(!r[h]||r[h].constructor===Object)?(r[h]=r[h]||{},i.extend(r[h],u,f[h])):r[h]=f[h]}return r},i.clone=function(r,a){return i.extend({},a,r)},i.keys=function(r){if(Object.keys)return Object.keys(r);var a=[];for(var o in r)a.push(o);return a},i.values=function(r){var a=[];if(Object.keys){for(var o=Object.keys(r),u=0;u<o.length;u++)a.push(r[o[u]]);return a}for(var c in r)a.push(r[c]);return a},i.get=function(r,a,o,u){a=a.split(".").slice(o,u);for(var c=0;c<a.length;c+=1)r=r[a[c]];return r},i.set=function(r,a,o,u,c){var f=a.split(".").slice(u,c);return i.get(r,a,0,-1)[f[f.length-1]]=o,o},i.shuffle=function(r){for(var a=r.length-1;a>0;a--){var o=Math.floor(i.random()*(a+1)),u=r[a];r[a]=r[o],r[o]=u}return r},i.choose=function(r){return r[Math.floor(i.random()*r.length)]},i.isElement=function(r){return typeof HTMLElement<"u"?r instanceof HTMLElement:!!(r&&r.nodeType&&r.nodeName)},i.isArray=function(r){return Object.prototype.toString.call(r)==="[object Array]"},i.isFunction=function(r){return typeof r=="function"},i.isPlainObject=function(r){return typeof r=="object"&&r.constructor===Object},i.isString=function(r){return toString.call(r)==="[object String]"},i.clamp=function(r,a,o){return r<a?a:r>o?o:r},i.sign=function(r){return r<0?-1:1},i.now=function(){if(typeof window<"u"&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-i._nowStartTime},i.random=function(r,a){return r=typeof r<"u"?r:0,a=typeof a<"u"?a:1,r+t()*(a-r)};var t=function(){return i._seed=(i._seed*9301+49297)%233280,i._seed/233280};i.colorToNumber=function(r){return r=r.replace("#",""),r.length==3&&(r=r.charAt(0)+r.charAt(0)+r.charAt(1)+r.charAt(1)+r.charAt(2)+r.charAt(2)),parseInt(r,16)},i.logLevel=1,i.log=function(){console&&i.logLevel>0&&i.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},i.info=function(){console&&i.logLevel>0&&i.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},i.warn=function(){console&&i.logLevel>0&&i.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},i.warnOnce=function(){var r=Array.prototype.slice.call(arguments).join(" ");i._warnedOnce[r]||(i.warn(r),i._warnedOnce[r]=!0)},i.deprecated=function(r,a,o){r[a]=i.chain(function(){i.warnOnce(" deprecated ",o)},r[a])},i.nextId=function(){return i._nextId++},i.indexOf=function(r,a){if(r.indexOf)return r.indexOf(a);for(var o=0;o<r.length;o++)if(r[o]===a)return o;return-1},i.map=function(r,a){if(r.map)return r.map(a);for(var o=[],u=0;u<r.length;u+=1)o.push(a(r[u]));return o},i.topologicalSort=function(r){var a=[],o=[],u=[];for(var c in r)!o[c]&&!u[c]&&i._topologicalSort(c,o,u,r,a);return a},i._topologicalSort=function(r,a,o,u,c){var f=u[r]||[];o[r]=!0;for(var h=0;h<f.length;h+=1){var l=f[h];o[l]||a[l]||i._topologicalSort(l,a,o,u,c)}o[r]=!1,a[r]=!0,c.push(r)},i.chain=function(){for(var r=[],a=0;a<arguments.length;a+=1){var o=arguments[a];o._chained?r.push.apply(r,o._chained):r.push(o)}var u=function(){for(var c,f=new Array(arguments.length),h=0,l=arguments.length;h<l;h++)f[h]=arguments[h];for(h=0;h<r.length;h+=1){var d=r[h].apply(c,f);typeof d<"u"&&(c=d)}return c};return u._chained=r,u},i.chainPathBefore=function(r,a,o){return i.set(r,a,i.chain(o,i.get(r,a)))},i.chainPathAfter=function(r,a,o){return i.set(r,a,i.chain(i.get(r,a),o))},i.setDecomp=function(r){i._decomp=r},i.getDecomp=function(){var r=i._decomp;try{!r&&typeof window<"u"&&(r=window.decomp),!r&&typeof pt<"u"&&(r=pt.decomp)}catch{r=null}return r}}()},function(n,s){var i={};n.exports=i,function(){i.create=function(t){var r={min:{x:0,y:0},max:{x:0,y:0}};return t&&i.update(r,t),r},i.update=function(t,r,a){t.min.x=1/0,t.max.x=-1/0,t.min.y=1/0,t.max.y=-1/0;for(var o=0;o<r.length;o++){var u=r[o];u.x>t.max.x&&(t.max.x=u.x),u.x<t.min.x&&(t.min.x=u.x),u.y>t.max.y&&(t.max.y=u.y),u.y<t.min.y&&(t.min.y=u.y)}a&&(a.x>0?t.max.x+=a.x:t.min.x+=a.x,a.y>0?t.max.y+=a.y:t.min.y+=a.y)},i.contains=function(t,r){return r.x>=t.min.x&&r.x<=t.max.x&&r.y>=t.min.y&&r.y<=t.max.y},i.overlaps=function(t,r){return t.min.x<=r.max.x&&t.max.x>=r.min.x&&t.max.y>=r.min.y&&t.min.y<=r.max.y},i.translate=function(t,r){t.min.x+=r.x,t.max.x+=r.x,t.min.y+=r.y,t.max.y+=r.y},i.shift=function(t,r){var a=t.max.x-t.min.x,o=t.max.y-t.min.y;t.min.x=r.x,t.max.x=r.x+a,t.min.y=r.y,t.max.y=r.y+o}}()},function(n,s){var i={};n.exports=i,function(){i.create=function(t,r){return{x:t||0,y:r||0}},i.clone=function(t){return{x:t.x,y:t.y}},i.magnitude=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},i.magnitudeSquared=function(t){return t.x*t.x+t.y*t.y},i.rotate=function(t,r,a){var o=Math.cos(r),u=Math.sin(r);a||(a={});var c=t.x*o-t.y*u;return a.y=t.x*u+t.y*o,a.x=c,a},i.rotateAbout=function(t,r,a,o){var u=Math.cos(r),c=Math.sin(r);o||(o={});var f=a.x+((t.x-a.x)*u-(t.y-a.y)*c);return o.y=a.y+((t.x-a.x)*c+(t.y-a.y)*u),o.x=f,o},i.normalise=function(t){var r=i.magnitude(t);return r===0?{x:0,y:0}:{x:t.x/r,y:t.y/r}},i.dot=function(t,r){return t.x*r.x+t.y*r.y},i.cross=function(t,r){return t.x*r.y-t.y*r.x},i.cross3=function(t,r,a){return(r.x-t.x)*(a.y-t.y)-(r.y-t.y)*(a.x-t.x)},i.add=function(t,r,a){return a||(a={}),a.x=t.x+r.x,a.y=t.y+r.y,a},i.sub=function(t,r,a){return a||(a={}),a.x=t.x-r.x,a.y=t.y-r.y,a},i.mult=function(t,r){return{x:t.x*r,y:t.y*r}},i.div=function(t,r){return{x:t.x/r,y:t.y/r}},i.perp=function(t,r){return r=r===!0?-1:1,{x:r*-t.y,y:r*t.x}},i.neg=function(t){return{x:-t.x,y:-t.y}},i.angle=function(t,r){return Math.atan2(r.y-t.y,r.x-t.x)},i._temp=[i.create(),i.create(),i.create(),i.create(),i.create(),i.create()]}()},function(n,s,i){var t={};n.exports=t;var r=i(2),a=i(0);(function(){t.create=function(o,u){for(var c=[],f=0;f<o.length;f++){var h=o[f],l={x:h.x,y:h.y,index:f,body:u,isInternal:!1};c.push(l)}return c},t.fromPath=function(o,u){var c=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/ig,f=[];return o.replace(c,function(h,l,d){f.push({x:parseFloat(l),y:parseFloat(d)})}),t.create(f,u)},t.centre=function(o){for(var u=t.area(o,!0),c={x:0,y:0},f,h,l,d=0;d<o.length;d++)l=(d+1)%o.length,f=r.cross(o[d],o[l]),h=r.mult(r.add(o[d],o[l]),f),c=r.add(c,h);return r.div(c,6*u)},t.mean=function(o){for(var u={x:0,y:0},c=0;c<o.length;c++)u.x+=o[c].x,u.y+=o[c].y;return r.div(u,o.length)},t.area=function(o,u){for(var c=0,f=o.length-1,h=0;h<o.length;h++)c+=(o[f].x-o[h].x)*(o[f].y+o[h].y),f=h;return u?c/2:Math.abs(c)/2},t.inertia=function(o,u){for(var c=0,f=0,h=o,l,d,p=0;p<h.length;p++)d=(p+1)%h.length,l=Math.abs(r.cross(h[d],h[p])),c+=l*(r.dot(h[d],h[d])+r.dot(h[d],h[p])+r.dot(h[p],h[p])),f+=l;return u/6*(c/f)},t.translate=function(o,u,c){c=typeof c<"u"?c:1;var f=o.length,h=u.x*c,l=u.y*c,d;for(d=0;d<f;d++)o[d].x+=h,o[d].y+=l;return o},t.rotate=function(o,u,c){if(u!==0){var f=Math.cos(u),h=Math.sin(u),l=c.x,d=c.y,p=o.length,m,x,T,v;for(v=0;v<p;v++)m=o[v],x=m.x-l,T=m.y-d,m.x=l+(x*f-T*h),m.y=d+(x*h+T*f);return o}},t.contains=function(o,u){for(var c=u.x,f=u.y,h=o.length,l=o[h-1],d,p=0;p<h;p++){if(d=o[p],(c-l.x)*(d.y-l.y)+(f-l.y)*(l.x-d.x)>0)return!1;l=d}return!0},t.scale=function(o,u,c,f){if(u===1&&c===1)return o;f=f||t.centre(o);for(var h,l,d=0;d<o.length;d++)h=o[d],l=r.sub(h,f),o[d].x=f.x+l.x*u,o[d].y=f.y+l.y*c;return o},t.chamfer=function(o,u,c,f,h){typeof u=="number"?u=[u]:u=u||[8],c=typeof c<"u"?c:-1,f=f||2,h=h||14;for(var l=[],d=0;d<o.length;d++){var p=o[d-1>=0?d-1:o.length-1],m=o[d],x=o[(d+1)%o.length],T=u[d<u.length?d:u.length-1];if(T===0){l.push(m);continue}var v=r.normalise({x:m.y-p.y,y:p.x-m.x}),b=r.normalise({x:x.y-m.y,y:m.x-x.x}),g=Math.sqrt(2*Math.pow(T,2)),w=r.mult(a.clone(v),T),S=r.normalise(r.mult(r.add(v,b),.5)),A=r.sub(m,r.mult(S,g)),P=c;c===-1&&(P=Math.pow(T,.32)*1.75),P=a.clamp(P,f,h),P%2===1&&(P+=1);for(var M=Math.acos(r.dot(v,b)),L=M/P,E=0;E<P;E++)l.push(r.add(r.rotate(w,L*E),A))}return l},t.clockwiseSort=function(o){var u=t.mean(o);return o.sort(function(c,f){return r.angle(u,c)-r.angle(u,f)}),o},t.isConvex=function(o){var u=0,c=o.length,f,h,l,d;if(c<3)return null;for(f=0;f<c;f++)if(h=(f+1)%c,l=(f+2)%c,d=(o[h].x-o[f].x)*(o[l].y-o[h].y),d-=(o[h].y-o[f].y)*(o[l].x-o[h].x),d<0?u|=1:d>0&&(u|=2),u===3)return!1;return u!==0?!0:null},t.hull=function(o){var u=[],c=[],f,h;for(o=o.slice(0),o.sort(function(l,d){var p=l.x-d.x;return p!==0?p:l.y-d.y}),h=0;h<o.length;h+=1){for(f=o[h];c.length>=2&&r.cross3(c[c.length-2],c[c.length-1],f)<=0;)c.pop();c.push(f)}for(h=o.length-1;h>=0;h-=1){for(f=o[h];u.length>=2&&r.cross3(u[u.length-2],u[u.length-1],f)<=0;)u.pop();u.push(f)}return u.pop(),c.pop(),u.concat(c)}})()},function(n,s,i){var t={};n.exports=t;var r=i(3),a=i(2),o=i(7),u=i(0),c=i(1),f=i(11);(function(){t._timeCorrection=!0,t._inertiaScale=4,t._nextCollidingGroupId=1,t._nextNonCollidingGroupId=-1,t._nextCategory=1,t._baseDelta=1e3/60,t.create=function(l){var d={id:u.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:r.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,deltaTime:16.666666666666668,_original:null},p=u.extend(d,l);return h(p,l),p},t.nextGroup=function(l){return l?t._nextNonCollidingGroupId--:t._nextCollidingGroupId++},t.nextCategory=function(){return t._nextCategory=t._nextCategory<<1,t._nextCategory};var h=function(l,d){d=d||{},t.set(l,{bounds:l.bounds||c.create(l.vertices),positionPrev:l.positionPrev||a.clone(l.position),anglePrev:l.anglePrev||l.angle,vertices:l.vertices,parts:l.parts||[l],isStatic:l.isStatic,isSleeping:l.isSleeping,parent:l.parent||l}),r.rotate(l.vertices,l.angle,l.position),f.rotate(l.axes,l.angle),c.update(l.bounds,l.vertices,l.velocity),t.set(l,{axes:d.axes||l.axes,area:d.area||l.area,mass:d.mass||l.mass,inertia:d.inertia||l.inertia});var p=l.isStatic?"#14151f":u.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),m=l.isStatic?"#555":"#ccc",x=l.isStatic&&l.render.fillStyle===null?1:0;l.render.fillStyle=l.render.fillStyle||p,l.render.strokeStyle=l.render.strokeStyle||m,l.render.lineWidth=l.render.lineWidth||x,l.render.sprite.xOffset+=-(l.bounds.min.x-l.position.x)/(l.bounds.max.x-l.bounds.min.x),l.render.sprite.yOffset+=-(l.bounds.min.y-l.position.y)/(l.bounds.max.y-l.bounds.min.y)};t.set=function(l,d,p){var m;typeof d=="string"&&(m=d,d={},d[m]=p);for(m in d)if(Object.prototype.hasOwnProperty.call(d,m))switch(p=d[m],m){case"isStatic":t.setStatic(l,p);break;case"isSleeping":o.set(l,p);break;case"mass":t.setMass(l,p);break;case"density":t.setDensity(l,p);break;case"inertia":t.setInertia(l,p);break;case"vertices":t.setVertices(l,p);break;case"position":t.setPosition(l,p);break;case"angle":t.setAngle(l,p);break;case"velocity":t.setVelocity(l,p);break;case"angularVelocity":t.setAngularVelocity(l,p);break;case"speed":t.setSpeed(l,p);break;case"angularSpeed":t.setAngularSpeed(l,p);break;case"parts":t.setParts(l,p);break;case"centre":t.setCentre(l,p);break;default:l[m]=p}},t.setStatic=function(l,d){for(var p=0;p<l.parts.length;p++){var m=l.parts[p];d?(m.isStatic||(m._original={restitution:m.restitution,friction:m.friction,mass:m.mass,inertia:m.inertia,density:m.density,inverseMass:m.inverseMass,inverseInertia:m.inverseInertia}),m.restitution=0,m.friction=1,m.mass=m.inertia=m.density=1/0,m.inverseMass=m.inverseInertia=0,m.positionPrev.x=m.position.x,m.positionPrev.y=m.position.y,m.anglePrev=m.angle,m.angularVelocity=0,m.speed=0,m.angularSpeed=0,m.motion=0):m._original&&(m.restitution=m._original.restitution,m.friction=m._original.friction,m.mass=m._original.mass,m.inertia=m._original.inertia,m.density=m._original.density,m.inverseMass=m._original.inverseMass,m.inverseInertia=m._original.inverseInertia,m._original=null),m.isStatic=d}},t.setMass=function(l,d){var p=l.inertia/(l.mass/6);l.inertia=p*(d/6),l.inverseInertia=1/l.inertia,l.mass=d,l.inverseMass=1/l.mass,l.density=l.mass/l.area},t.setDensity=function(l,d){t.setMass(l,d*l.area),l.density=d},t.setInertia=function(l,d){l.inertia=d,l.inverseInertia=1/l.inertia},t.setVertices=function(l,d){d[0].body===l?l.vertices=d:l.vertices=r.create(d,l),l.axes=f.fromVertices(l.vertices),l.area=r.area(l.vertices),t.setMass(l,l.density*l.area);var p=r.centre(l.vertices);r.translate(l.vertices,p,-1),t.setInertia(l,t._inertiaScale*r.inertia(l.vertices,l.mass)),r.translate(l.vertices,l.position),c.update(l.bounds,l.vertices,l.velocity)},t.setParts=function(l,d,p){var m;for(d=d.slice(0),l.parts.length=0,l.parts.push(l),l.parent=l,m=0;m<d.length;m++){var x=d[m];x!==l&&(x.parent=l,l.parts.push(x))}if(l.parts.length!==1){if(p=typeof p<"u"?p:!0,p){var T=[];for(m=0;m<d.length;m++)T=T.concat(d[m].vertices);r.clockwiseSort(T);var v=r.hull(T),b=r.centre(v);t.setVertices(l,v),r.translate(l.vertices,b)}var g=t._totalProperties(l);l.area=g.area,l.parent=l,l.position.x=g.centre.x,l.position.y=g.centre.y,l.positionPrev.x=g.centre.x,l.positionPrev.y=g.centre.y,t.setMass(l,g.mass),t.setInertia(l,g.inertia),t.setPosition(l,g.centre)}},t.setCentre=function(l,d,p){p?(l.positionPrev.x+=d.x,l.positionPrev.y+=d.y,l.position.x+=d.x,l.position.y+=d.y):(l.positionPrev.x=d.x-(l.position.x-l.positionPrev.x),l.positionPrev.y=d.y-(l.position.y-l.positionPrev.y),l.position.x=d.x,l.position.y=d.y)},t.setPosition=function(l,d,p){var m=a.sub(d,l.position);p?(l.positionPrev.x=l.position.x,l.positionPrev.y=l.position.y,l.velocity.x=m.x,l.velocity.y=m.y,l.speed=a.magnitude(m)):(l.positionPrev.x+=m.x,l.positionPrev.y+=m.y);for(var x=0;x<l.parts.length;x++){var T=l.parts[x];T.position.x+=m.x,T.position.y+=m.y,r.translate(T.vertices,m),c.update(T.bounds,T.vertices,l.velocity)}},t.setAngle=function(l,d,p){var m=d-l.angle;p?(l.anglePrev=l.angle,l.angularVelocity=m,l.angularSpeed=Math.abs(m)):l.anglePrev+=m;for(var x=0;x<l.parts.length;x++){var T=l.parts[x];T.angle+=m,r.rotate(T.vertices,m,l.position),f.rotate(T.axes,m),c.update(T.bounds,T.vertices,l.velocity),x>0&&a.rotateAbout(T.position,m,l.position,T.position)}},t.setVelocity=function(l,d){var p=l.deltaTime/t._baseDelta;l.positionPrev.x=l.position.x-d.x*p,l.positionPrev.y=l.position.y-d.y*p,l.velocity.x=(l.position.x-l.positionPrev.x)/p,l.velocity.y=(l.position.y-l.positionPrev.y)/p,l.speed=a.magnitude(l.velocity)},t.getVelocity=function(l){var d=t._baseDelta/l.deltaTime;return{x:(l.position.x-l.positionPrev.x)*d,y:(l.position.y-l.positionPrev.y)*d}},t.getSpeed=function(l){return a.magnitude(t.getVelocity(l))},t.setSpeed=function(l,d){t.setVelocity(l,a.mult(a.normalise(t.getVelocity(l)),d))},t.setAngularVelocity=function(l,d){var p=l.deltaTime/t._baseDelta;l.anglePrev=l.angle-d*p,l.angularVelocity=(l.angle-l.anglePrev)/p,l.angularSpeed=Math.abs(l.angularVelocity)},t.getAngularVelocity=function(l){return(l.angle-l.anglePrev)*t._baseDelta/l.deltaTime},t.getAngularSpeed=function(l){return Math.abs(t.getAngularVelocity(l))},t.setAngularSpeed=function(l,d){t.setAngularVelocity(l,u.sign(t.getAngularVelocity(l))*d)},t.translate=function(l,d,p){t.setPosition(l,a.add(l.position,d),p)},t.rotate=function(l,d,p,m){if(!p)t.setAngle(l,l.angle+d,m);else{var x=Math.cos(d),T=Math.sin(d),v=l.position.x-p.x,b=l.position.y-p.y;t.setPosition(l,{x:p.x+(v*x-b*T),y:p.y+(v*T+b*x)},m),t.setAngle(l,l.angle+d,m)}},t.scale=function(l,d,p,m){var x=0,T=0;m=m||l.position;for(var v=0;v<l.parts.length;v++){var b=l.parts[v];r.scale(b.vertices,d,p,m),b.axes=f.fromVertices(b.vertices),b.area=r.area(b.vertices),t.setMass(b,l.density*b.area),r.translate(b.vertices,{x:-b.position.x,y:-b.position.y}),t.setInertia(b,t._inertiaScale*r.inertia(b.vertices,b.mass)),r.translate(b.vertices,{x:b.position.x,y:b.position.y}),v>0&&(x+=b.area,T+=b.inertia),b.position.x=m.x+(b.position.x-m.x)*d,b.position.y=m.y+(b.position.y-m.y)*p,c.update(b.bounds,b.vertices,l.velocity)}l.parts.length>1&&(l.area=x,l.isStatic||(t.setMass(l,l.density*x),t.setInertia(l,T))),l.circleRadius&&(d===p?l.circleRadius*=d:l.circleRadius=null)},t.update=function(l,d){d=(typeof d<"u"?d:1e3/60)*l.timeScale;var p=d*d,m=t._timeCorrection?d/(l.deltaTime||d):1,x=1-l.frictionAir*(d/u._baseDelta),T=(l.position.x-l.positionPrev.x)*m,v=(l.position.y-l.positionPrev.y)*m;l.velocity.x=T*x+l.force.x/l.mass*p,l.velocity.y=v*x+l.force.y/l.mass*p,l.positionPrev.x=l.position.x,l.positionPrev.y=l.position.y,l.position.x+=l.velocity.x,l.position.y+=l.velocity.y,l.deltaTime=d,l.angularVelocity=(l.angle-l.anglePrev)*x*m+l.torque/l.inertia*p,l.anglePrev=l.angle,l.angle+=l.angularVelocity;for(var b=0;b<l.parts.length;b++){var g=l.parts[b];r.translate(g.vertices,l.velocity),b>0&&(g.position.x+=l.velocity.x,g.position.y+=l.velocity.y),l.angularVelocity!==0&&(r.rotate(g.vertices,l.angularVelocity,l.position),f.rotate(g.axes,l.angularVelocity),b>0&&a.rotateAbout(g.position,l.angularVelocity,l.position,g.position)),c.update(g.bounds,g.vertices,l.velocity)}},t.updateVelocities=function(l){var d=t._baseDelta/l.deltaTime,p=l.velocity;p.x=(l.position.x-l.positionPrev.x)*d,p.y=(l.position.y-l.positionPrev.y)*d,l.speed=Math.sqrt(p.x*p.x+p.y*p.y),l.angularVelocity=(l.angle-l.anglePrev)*d,l.angularSpeed=Math.abs(l.angularVelocity)},t.applyForce=function(l,d,p){var m={x:d.x-l.position.x,y:d.y-l.position.y};l.force.x+=p.x,l.force.y+=p.y,l.torque+=m.x*p.y-m.y*p.x},t._totalProperties=function(l){for(var d={mass:0,area:0,inertia:0,centre:{x:0,y:0}},p=l.parts.length===1?0:1;p<l.parts.length;p++){var m=l.parts[p],x=m.mass!==1/0?m.mass:1;d.mass+=x,d.area+=m.area,d.inertia+=m.inertia,d.centre=a.add(d.centre,a.mult(m.position,x))}return d.centre=a.div(d.centre,d.mass),d}})()},function(n,s,i){var t={};n.exports=t;var r=i(0);(function(){t.on=function(a,o,u){for(var c=o.split(" "),f,h=0;h<c.length;h++)f=c[h],a.events=a.events||{},a.events[f]=a.events[f]||[],a.events[f].push(u);return u},t.off=function(a,o,u){if(!o){a.events={};return}typeof o=="function"&&(u=o,o=r.keys(a.events).join(" "));for(var c=o.split(" "),f=0;f<c.length;f++){var h=a.events[c[f]],l=[];if(u&&h)for(var d=0;d<h.length;d++)h[d]!==u&&l.push(h[d]);a.events[c[f]]=l}},t.trigger=function(a,o,u){var c,f,h,l,d=a.events;if(d&&r.keys(d).length>0){u||(u={}),c=o.split(" ");for(var p=0;p<c.length;p++)if(f=c[p],h=d[f],h){l=r.clone(u,!1),l.name=f,l.source=a;for(var m=0;m<h.length;m++)h[m].apply(a,[l])}}}})()},function(n,s,i){var t={};n.exports=t;var r=i(5),a=i(0),o=i(1),u=i(4);(function(){t.create=function(c){return a.extend({id:a.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},c)},t.setModified=function(c,f,h,l){if(c.isModified=f,f&&c.cache&&(c.cache.allBodies=null,c.cache.allConstraints=null,c.cache.allComposites=null),h&&c.parent&&t.setModified(c.parent,f,h,l),l)for(var d=0;d<c.composites.length;d++){var p=c.composites[d];t.setModified(p,f,h,l)}},t.add=function(c,f){var h=[].concat(f);r.trigger(c,"beforeAdd",{object:f});for(var l=0;l<h.length;l++){var d=h[l];switch(d.type){case"body":if(d.parent!==d){a.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}t.addBody(c,d);break;case"constraint":t.addConstraint(c,d);break;case"composite":t.addComposite(c,d);break;case"mouseConstraint":t.addConstraint(c,d.constraint);break}}return r.trigger(c,"afterAdd",{object:f}),c},t.remove=function(c,f,h){var l=[].concat(f);r.trigger(c,"beforeRemove",{object:f});for(var d=0;d<l.length;d++){var p=l[d];switch(p.type){case"body":t.removeBody(c,p,h);break;case"constraint":t.removeConstraint(c,p,h);break;case"composite":t.removeComposite(c,p,h);break;case"mouseConstraint":t.removeConstraint(c,p.constraint);break}}return r.trigger(c,"afterRemove",{object:f}),c},t.addComposite=function(c,f){return c.composites.push(f),f.parent=c,t.setModified(c,!0,!0,!1),c},t.removeComposite=function(c,f,h){var l=a.indexOf(c.composites,f);if(l!==-1){var d=t.allBodies(f);t.removeCompositeAt(c,l);for(var p=0;p<d.length;p++)d[p].sleepCounter=0}if(h)for(var p=0;p<c.composites.length;p++)t.removeComposite(c.composites[p],f,!0);return c},t.removeCompositeAt=function(c,f){return c.composites.splice(f,1),t.setModified(c,!0,!0,!1),c},t.addBody=function(c,f){return c.bodies.push(f),t.setModified(c,!0,!0,!1),c},t.removeBody=function(c,f,h){var l=a.indexOf(c.bodies,f);if(l!==-1&&(t.removeBodyAt(c,l),f.sleepCounter=0),h)for(var d=0;d<c.composites.length;d++)t.removeBody(c.composites[d],f,!0);return c},t.removeBodyAt=function(c,f){return c.bodies.splice(f,1),t.setModified(c,!0,!0,!1),c},t.addConstraint=function(c,f){return c.constraints.push(f),t.setModified(c,!0,!0,!1),c},t.removeConstraint=function(c,f,h){var l=a.indexOf(c.constraints,f);if(l!==-1&&t.removeConstraintAt(c,l),h)for(var d=0;d<c.composites.length;d++)t.removeConstraint(c.composites[d],f,!0);return c},t.removeConstraintAt=function(c,f){return c.constraints.splice(f,1),t.setModified(c,!0,!0,!1),c},t.clear=function(c,f,h){if(h)for(var l=0;l<c.composites.length;l++)t.clear(c.composites[l],f,!0);return f?c.bodies=c.bodies.filter(function(d){return d.isStatic}):c.bodies.length=0,c.constraints.length=0,c.composites.length=0,t.setModified(c,!0,!0,!1),c},t.allBodies=function(c){if(c.cache&&c.cache.allBodies)return c.cache.allBodies;for(var f=[].concat(c.bodies),h=0;h<c.composites.length;h++)f=f.concat(t.allBodies(c.composites[h]));return c.cache&&(c.cache.allBodies=f),f},t.allConstraints=function(c){if(c.cache&&c.cache.allConstraints)return c.cache.allConstraints;for(var f=[].concat(c.constraints),h=0;h<c.composites.length;h++)f=f.concat(t.allConstraints(c.composites[h]));return c.cache&&(c.cache.allConstraints=f),f},t.allComposites=function(c){if(c.cache&&c.cache.allComposites)return c.cache.allComposites;for(var f=[].concat(c.composites),h=0;h<c.composites.length;h++)f=f.concat(t.allComposites(c.composites[h]));return c.cache&&(c.cache.allComposites=f),f},t.get=function(c,f,h){var l,d;switch(h){case"body":l=t.allBodies(c);break;case"constraint":l=t.allConstraints(c);break;case"composite":l=t.allComposites(c).concat(c);break}return l?(d=l.filter(function(p){return p.id.toString()===f.toString()}),d.length===0?null:d[0]):null},t.move=function(c,f,h){return t.remove(c,f),t.add(h,f),c},t.rebase=function(c){for(var f=t.allBodies(c).concat(t.allConstraints(c)).concat(t.allComposites(c)),h=0;h<f.length;h++)f[h].id=a.nextId();return c},t.translate=function(c,f,h){for(var l=h?t.allBodies(c):c.bodies,d=0;d<l.length;d++)u.translate(l[d],f);return c},t.rotate=function(c,f,h,l){for(var d=Math.cos(f),p=Math.sin(f),m=l?t.allBodies(c):c.bodies,x=0;x<m.length;x++){var T=m[x],v=T.position.x-h.x,b=T.position.y-h.y;u.setPosition(T,{x:h.x+(v*d-b*p),y:h.y+(v*p+b*d)}),u.rotate(T,f)}return c},t.scale=function(c,f,h,l,d){for(var p=d?t.allBodies(c):c.bodies,m=0;m<p.length;m++){var x=p[m],T=x.position.x-l.x,v=x.position.y-l.y;u.setPosition(x,{x:l.x+T*f,y:l.y+v*h}),u.scale(x,f,h)}return c},t.bounds=function(c){for(var f=t.allBodies(c),h=[],l=0;l<f.length;l+=1){var d=f[l];h.push(d.bounds.min,d.bounds.max)}return o.create(h)}})()},function(n,s,i){var t={};n.exports=t;var r=i(4),a=i(5),o=i(0);(function(){t._motionWakeThreshold=.18,t._motionSleepThreshold=.08,t._minBias=.9,t.update=function(u,c){for(var f=c/o._baseDelta,h=t._motionSleepThreshold,l=0;l<u.length;l++){var d=u[l],p=r.getSpeed(d),m=r.getAngularSpeed(d),x=p*p+m*m;if(d.force.x!==0||d.force.y!==0){t.set(d,!1);continue}var T=Math.min(d.motion,x),v=Math.max(d.motion,x);d.motion=t._minBias*T+(1-t._minBias)*v,d.sleepThreshold>0&&d.motion<h?(d.sleepCounter+=1,d.sleepCounter>=d.sleepThreshold/f&&t.set(d,!0)):d.sleepCounter>0&&(d.sleepCounter-=1)}},t.afterCollisions=function(u){for(var c=t._motionSleepThreshold,f=0;f<u.length;f++){var h=u[f];if(h.isActive){var l=h.collision,d=l.bodyA.parent,p=l.bodyB.parent;if(!(d.isSleeping&&p.isSleeping||d.isStatic||p.isStatic)&&(d.isSleeping||p.isSleeping)){var m=d.isSleeping&&!d.isStatic?d:p,x=m===d?p:d;!m.isStatic&&x.motion>c&&t.set(m,!1)}}}},t.set=function(u,c){var f=u.isSleeping;c?(u.isSleeping=!0,u.sleepCounter=u.sleepThreshold,u.positionImpulse.x=0,u.positionImpulse.y=0,u.positionPrev.x=u.position.x,u.positionPrev.y=u.position.y,u.anglePrev=u.angle,u.speed=0,u.angularSpeed=0,u.motion=0,f||a.trigger(u,"sleepStart")):(u.isSleeping=!1,u.sleepCounter=0,f&&a.trigger(u,"sleepEnd"))}})()},function(n,s,i){var t={};n.exports=t;var r=i(3),a=i(9);(function(){var o=[],u={overlap:0,axis:null},c={overlap:0,axis:null};t.create=function(f,h){return{pair:null,collided:!1,bodyA:f,bodyB:h,parentA:f.parent,parentB:h.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[null,null],supportCount:0}},t.collides=function(f,h,l){if(t._overlapAxes(u,f.vertices,h.vertices,f.axes),u.overlap<=0||(t._overlapAxes(c,h.vertices,f.vertices,h.axes),c.overlap<=0))return null;var d=l&&l.table[a.id(f,h)],p;d?p=d.collision:(p=t.create(f,h),p.collided=!0,p.bodyA=f.id<h.id?f:h,p.bodyB=f.id<h.id?h:f,p.parentA=p.bodyA.parent,p.parentB=p.bodyB.parent),f=p.bodyA,h=p.bodyB;var m;u.overlap<c.overlap?m=u:m=c;var x=p.normal,T=p.tangent,v=p.penetration,b=p.supports,g=m.overlap,w=m.axis,S=w.x,A=w.y,P=h.position.x-f.position.x,M=h.position.y-f.position.y;S*P+A*M>=0&&(S=-S,A=-A),x.x=S,x.y=A,T.x=-A,T.y=S,v.x=S*g,v.y=A*g,p.depth=g;var L=t._findSupports(f,h,x,1),E=0;if(r.contains(f.vertices,L[0])&&(b[E++]=L[0]),r.contains(f.vertices,L[1])&&(b[E++]=L[1]),E<2){var D=t._findSupports(h,f,x,-1);r.contains(h.vertices,D[0])&&(b[E++]=D[0]),E<2&&r.contains(h.vertices,D[1])&&(b[E++]=D[1])}return E===0&&(b[E++]=L[0]),p.supportCount=E,p},t._overlapAxes=function(f,h,l,d){var p=h.length,m=l.length,x=h[0].x,T=h[0].y,v=l[0].x,b=l[0].y,g=d.length,w=Number.MAX_VALUE,S=0,A,P,M,L,E,D;for(E=0;E<g;E++){var V=d[E],z=V.x,W=V.y,_=x*z+T*W,U=v*z+b*W,J=_,te=U;for(D=1;D<p;D+=1)L=h[D].x*z+h[D].y*W,L>J?J=L:L<_&&(_=L);for(D=1;D<m;D+=1)L=l[D].x*z+l[D].y*W,L>te?te=L:L<U&&(U=L);if(P=J-U,M=te-_,A=P<M?P:M,A<w&&(w=A,S=E,A<=0))break}f.axis=d[S],f.overlap=w},t._findSupports=function(f,h,l,d){var p=h.vertices,m=p.length,x=f.position.x,T=f.position.y,v=l.x*d,b=l.y*d,g=p[0],w=g,S=v*(x-w.x)+b*(T-w.y),A,P,M;for(M=1;M<m;M+=1)w=p[M],P=v*(x-w.x)+b*(T-w.y),P<S&&(S=P,g=w);return A=p[(m+g.index-1)%m],S=v*(x-A.x)+b*(T-A.y),w=p[(g.index+1)%m],v*(x-w.x)+b*(T-w.y)<S?(o[0]=g,o[1]=w,o):(o[0]=g,o[1]=A,o)}})()},function(n,s,i){var t={};n.exports=t;var r=i(16);(function(){t.create=function(a,o){var u=a.bodyA,c=a.bodyB,f={id:t.id(u,c),bodyA:u,bodyB:c,collision:a,contacts:[r.create(),r.create()],contactCount:0,separation:0,isActive:!0,isSensor:u.isSensor||c.isSensor,timeCreated:o,timeUpdated:o,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return t.update(f,a,o),f},t.update=function(a,o,u){var c=o.supports,f=o.supportCount,h=a.contacts,l=o.parentA,d=o.parentB;a.isActive=!0,a.timeUpdated=u,a.collision=o,a.separation=o.depth,a.inverseMass=l.inverseMass+d.inverseMass,a.friction=l.friction<d.friction?l.friction:d.friction,a.frictionStatic=l.frictionStatic>d.frictionStatic?l.frictionStatic:d.frictionStatic,a.restitution=l.restitution>d.restitution?l.restitution:d.restitution,a.slop=l.slop>d.slop?l.slop:d.slop,a.contactCount=f,o.pair=a;var p=c[0],m=h[0],x=c[1],T=h[1];(T.vertex===p||m.vertex===x)&&(h[1]=m,h[0]=m=T,T=h[1]),m.vertex=p,T.vertex=x},t.setActive=function(a,o,u){o?(a.isActive=!0,a.timeUpdated=u):(a.isActive=!1,a.contactCount=0)},t.id=function(a,o){return a.id<o.id?a.id.toString(36)+":"+o.id.toString(36):o.id.toString(36)+":"+a.id.toString(36)}})()},function(n,s,i){var t={};n.exports=t;var r=i(3),a=i(2),o=i(7),u=i(1),c=i(11),f=i(0);(function(){t._warming=.4,t._torqueDampen=1,t._minLength=1e-6,t.create=function(h){var l=h;l.bodyA&&!l.pointA&&(l.pointA={x:0,y:0}),l.bodyB&&!l.pointB&&(l.pointB={x:0,y:0});var d=l.bodyA?a.add(l.bodyA.position,l.pointA):l.pointA,p=l.bodyB?a.add(l.bodyB.position,l.pointB):l.pointB,m=a.magnitude(a.sub(d,p));l.length=typeof l.length<"u"?l.length:m,l.id=l.id||f.nextId(),l.label=l.label||"Constraint",l.type="constraint",l.stiffness=l.stiffness||(l.length>0?1:.7),l.damping=l.damping||0,l.angularStiffness=l.angularStiffness||0,l.angleA=l.bodyA?l.bodyA.angle:l.angleA,l.angleB=l.bodyB?l.bodyB.angle:l.angleB,l.plugin={};var x={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return l.length===0&&l.stiffness>.1?(x.type="pin",x.anchors=!1):l.stiffness<.9&&(x.type="spring"),l.render=f.extend(x,l.render),l},t.preSolveAll=function(h){for(var l=0;l<h.length;l+=1){var d=h[l],p=d.constraintImpulse;d.isStatic||p.x===0&&p.y===0&&p.angle===0||(d.position.x+=p.x,d.position.y+=p.y,d.angle+=p.angle)}},t.solveAll=function(h,l){for(var d=f.clamp(l/f._baseDelta,0,1),p=0;p<h.length;p+=1){var m=h[p],x=!m.bodyA||m.bodyA&&m.bodyA.isStatic,T=!m.bodyB||m.bodyB&&m.bodyB.isStatic;(x||T)&&t.solve(h[p],d)}for(p=0;p<h.length;p+=1)m=h[p],x=!m.bodyA||m.bodyA&&m.bodyA.isStatic,T=!m.bodyB||m.bodyB&&m.bodyB.isStatic,!x&&!T&&t.solve(h[p],d)},t.solve=function(h,l){var d=h.bodyA,p=h.bodyB,m=h.pointA,x=h.pointB;if(!(!d&&!p)){d&&!d.isStatic&&(a.rotate(m,d.angle-h.angleA,m),h.angleA=d.angle),p&&!p.isStatic&&(a.rotate(x,p.angle-h.angleB,x),h.angleB=p.angle);var T=m,v=x;if(d&&(T=a.add(d.position,m)),p&&(v=a.add(p.position,x)),!(!T||!v)){var b=a.sub(T,v),g=a.magnitude(b);g<t._minLength&&(g=t._minLength);var w=(g-h.length)/g,S=h.stiffness>=1||h.length===0,A=S?h.stiffness*l:h.stiffness*l*l,P=h.damping*l,M=a.mult(b,w*A),L=(d?d.inverseMass:0)+(p?p.inverseMass:0),E=(d?d.inverseInertia:0)+(p?p.inverseInertia:0),D=L+E,V,z,W,_,U;if(P>0){var J=a.create();W=a.div(b,g),U=a.sub(p&&a.sub(p.position,p.positionPrev)||J,d&&a.sub(d.position,d.positionPrev)||J),_=a.dot(W,U)}d&&!d.isStatic&&(z=d.inverseMass/L,d.constraintImpulse.x-=M.x*z,d.constraintImpulse.y-=M.y*z,d.position.x-=M.x*z,d.position.y-=M.y*z,P>0&&(d.positionPrev.x-=P*W.x*_*z,d.positionPrev.y-=P*W.y*_*z),V=a.cross(m,M)/D*t._torqueDampen*d.inverseInertia*(1-h.angularStiffness),d.constraintImpulse.angle-=V,d.angle-=V),p&&!p.isStatic&&(z=p.inverseMass/L,p.constraintImpulse.x+=M.x*z,p.constraintImpulse.y+=M.y*z,p.position.x+=M.x*z,p.position.y+=M.y*z,P>0&&(p.positionPrev.x+=P*W.x*_*z,p.positionPrev.y+=P*W.y*_*z),V=a.cross(x,M)/D*t._torqueDampen*p.inverseInertia*(1-h.angularStiffness),p.constraintImpulse.angle+=V,p.angle+=V)}}},t.postSolveAll=function(h){for(var l=0;l<h.length;l++){var d=h[l],p=d.constraintImpulse;if(!(d.isStatic||p.x===0&&p.y===0&&p.angle===0)){o.set(d,!1);for(var m=0;m<d.parts.length;m++){var x=d.parts[m];r.translate(x.vertices,p),m>0&&(x.position.x+=p.x,x.position.y+=p.y),p.angle!==0&&(r.rotate(x.vertices,p.angle,d.position),c.rotate(x.axes,p.angle),m>0&&a.rotateAbout(x.position,p.angle,d.position,x.position)),u.update(x.bounds,x.vertices,d.velocity)}p.angle*=t._warming,p.x*=t._warming,p.y*=t._warming}}},t.pointAWorld=function(h){return{x:(h.bodyA?h.bodyA.position.x:0)+(h.pointA?h.pointA.x:0),y:(h.bodyA?h.bodyA.position.y:0)+(h.pointA?h.pointA.y:0)}},t.pointBWorld=function(h){return{x:(h.bodyB?h.bodyB.position.x:0)+(h.pointB?h.pointB.x:0),y:(h.bodyB?h.bodyB.position.y:0)+(h.pointB?h.pointB.y:0)}},t.currentLength=function(h){var l=(h.bodyA?h.bodyA.position.x:0)+(h.pointA?h.pointA.x:0),d=(h.bodyA?h.bodyA.position.y:0)+(h.pointA?h.pointA.y:0),p=(h.bodyB?h.bodyB.position.x:0)+(h.pointB?h.pointB.x:0),m=(h.bodyB?h.bodyB.position.y:0)+(h.pointB?h.pointB.y:0),x=l-p,T=d-m;return Math.sqrt(x*x+T*T)}})()},function(n,s,i){var t={};n.exports=t;var r=i(2),a=i(0);(function(){t.fromVertices=function(o){for(var u={},c=0;c<o.length;c++){var f=(c+1)%o.length,h=r.normalise({x:o[f].y-o[c].y,y:o[c].x-o[f].x}),l=h.y===0?1/0:h.x/h.y;l=l.toFixed(3).toString(),u[l]=h}return a.values(u)},t.rotate=function(o,u){if(u!==0)for(var c=Math.cos(u),f=Math.sin(u),h=0;h<o.length;h++){var l=o[h],d;d=l.x*c-l.y*f,l.y=l.x*f+l.y*c,l.x=d}}})()},function(n,s,i){var t={};n.exports=t;var r=i(3),a=i(0),o=i(4),u=i(1),c=i(2);(function(){t.rectangle=function(f,h,l,d,p){p=p||{};var m={label:"Rectangle Body",position:{x:f,y:h},vertices:r.fromPath("L 0 0 L "+l+" 0 L "+l+" "+d+" L 0 "+d)};if(p.chamfer){var x=p.chamfer;m.vertices=r.chamfer(m.vertices,x.radius,x.quality,x.qualityMin,x.qualityMax),delete p.chamfer}return o.create(a.extend({},m,p))},t.trapezoid=function(f,h,l,d,p,m){m=m||{},p>=1&&a.warn("Bodies.trapezoid: slope parameter must be < 1."),p*=.5;var x=(1-p*2)*l,T=l*p,v=T+x,b=v+T,g;p<.5?g="L 0 0 L "+T+" "+-d+" L "+v+" "+-d+" L "+b+" 0":g="L 0 0 L "+v+" "+-d+" L "+b+" 0";var w={label:"Trapezoid Body",position:{x:f,y:h},vertices:r.fromPath(g)};if(m.chamfer){var S=m.chamfer;w.vertices=r.chamfer(w.vertices,S.radius,S.quality,S.qualityMin,S.qualityMax),delete m.chamfer}return o.create(a.extend({},w,m))},t.circle=function(f,h,l,d,p){d=d||{};var m={label:"Circle Body",circleRadius:l};p=p||25;var x=Math.ceil(Math.max(10,Math.min(p,l)));return x%2===1&&(x+=1),t.polygon(f,h,x,l,a.extend({},m,d))},t.polygon=function(f,h,l,d,p){if(p=p||{},l<3)return t.circle(f,h,d,p);for(var m=2*Math.PI/l,x="",T=m*.5,v=0;v<l;v+=1){var b=T+v*m,g=Math.cos(b)*d,w=Math.sin(b)*d;x+="L "+g.toFixed(3)+" "+w.toFixed(3)+" "}var S={label:"Polygon Body",position:{x:f,y:h},vertices:r.fromPath(x)};if(p.chamfer){var A=p.chamfer;S.vertices=r.chamfer(S.vertices,A.radius,A.quality,A.qualityMin,A.qualityMax),delete p.chamfer}return o.create(a.extend({},S,p))},t.fromVertices=function(f,h,l,d,p,m,x,T){var v=a.getDecomp(),b,g,w,S,A,P,M,L,E,D,V;for(b=!!(v&&v.quickDecomp),d=d||{},w=[],p=typeof p<"u"?p:!1,m=typeof m<"u"?m:.01,x=typeof x<"u"?x:10,T=typeof T<"u"?T:.01,a.isArray(l[0])||(l=[l]),D=0;D<l.length;D+=1)if(P=l[D],S=r.isConvex(P),A=!S,A&&!b&&a.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),S||!b)S?P=r.clockwiseSort(P):P=r.hull(P),w.push({position:{x:f,y:h},vertices:P});else{var z=P.map(function(C){return[C.x,C.y]});v.makeCCW(z),m!==!1&&v.removeCollinearPoints(z,m),T!==!1&&v.removeDuplicatePoints&&v.removeDuplicatePoints(z,T);var W=v.quickDecomp(z);for(M=0;M<W.length;M++){var _=W[M],U=_.map(function(C){return{x:C[0],y:C[1]}});x>0&&r.area(U)<x||w.push({position:r.centre(U),vertices:U})}}for(M=0;M<w.length;M++)w[M]=o.create(a.extend(w[M],d));if(p){var J=5;for(M=0;M<w.length;M++){var te=w[M];for(L=M+1;L<w.length;L++){var re=w[L];if(u.overlaps(te.bounds,re.bounds)){var oe=te.vertices,ue=re.vertices;for(E=0;E<te.vertices.length;E++)for(V=0;V<re.vertices.length;V++){var B=c.magnitudeSquared(c.sub(oe[(E+1)%oe.length],ue[V])),O=c.magnitudeSquared(c.sub(oe[E],ue[(V+1)%ue.length]));B<J&&O<J&&(oe[E].isInternal=!0,ue[V].isInternal=!0)}}}}}return w.length>1?(g=o.create(a.extend({parts:w.slice(0)},d)),o.setPosition(g,{x:f,y:h}),g):w[0]}})()},function(n,s,i){var t={};n.exports=t;var r=i(0),a=i(8);(function(){t.create=function(o){var u={bodies:[],collisions:[],pairs:null};return r.extend(u,o)},t.setBodies=function(o,u){o.bodies=u.slice(0)},t.clear=function(o){o.bodies=[],o.collisions=[]},t.collisions=function(o){var u=o.pairs,c=o.bodies,f=c.length,h=t.canCollide,l=a.collides,d=o.collisions,p=0,m,x;for(c.sort(t._compareBoundsX),m=0;m<f;m++){var T=c[m],v=T.bounds,b=T.bounds.max.x,g=T.bounds.max.y,w=T.bounds.min.y,S=T.isStatic||T.isSleeping,A=T.parts.length,P=A===1;for(x=m+1;x<f;x++){var M=c[x],L=M.bounds;if(L.min.x>b)break;if(!(g<L.min.y||w>L.max.y)&&!(S&&(M.isStatic||M.isSleeping))&&h(T.collisionFilter,M.collisionFilter)){var E=M.parts.length;if(P&&E===1){var D=l(T,M,u);D&&(d[p++]=D)}else for(var V=A>1?1:0,z=E>1?1:0,W=V;W<A;W++)for(var _=T.parts[W],v=_.bounds,U=z;U<E;U++){var J=M.parts[U],L=J.bounds;if(!(v.min.x>L.max.x||v.max.x<L.min.x||v.max.y<L.min.y||v.min.y>L.max.y)){var D=l(_,J,u);D&&(d[p++]=D)}}}}}return d.length!==p&&(d.length=p),d},t.canCollide=function(o,u){return o.group===u.group&&o.group!==0?o.group>0:(o.mask&u.category)!==0&&(u.mask&o.category)!==0},t._compareBoundsX=function(o,u){return o.bounds.min.x-u.bounds.min.x}})()},function(n,s,i){var t={};n.exports=t;var r=i(0);(function(){t.create=function(a){var o={};return a||r.log("Mouse.create: element was undefined, defaulting to document.body","warn"),o.element=a||document.body,o.absolute={x:0,y:0},o.position={x:0,y:0},o.mousedownPosition={x:0,y:0},o.mouseupPosition={x:0,y:0},o.offset={x:0,y:0},o.scale={x:1,y:1},o.wheelDelta=0,o.button=-1,o.pixelRatio=parseInt(o.element.getAttribute("data-pixel-ratio"),10)||1,o.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},o.mousemove=function(u){var c=t._getRelativeMousePosition(u,o.element,o.pixelRatio),f=u.changedTouches;f&&(o.button=0,u.preventDefault()),o.absolute.x=c.x,o.absolute.y=c.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y,o.sourceEvents.mousemove=u},o.mousedown=function(u){var c=t._getRelativeMousePosition(u,o.element,o.pixelRatio),f=u.changedTouches;f?(o.button=0,u.preventDefault()):o.button=u.button,o.absolute.x=c.x,o.absolute.y=c.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y,o.mousedownPosition.x=o.position.x,o.mousedownPosition.y=o.position.y,o.sourceEvents.mousedown=u},o.mouseup=function(u){var c=t._getRelativeMousePosition(u,o.element,o.pixelRatio),f=u.changedTouches;f&&u.preventDefault(),o.button=-1,o.absolute.x=c.x,o.absolute.y=c.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y,o.mouseupPosition.x=o.position.x,o.mouseupPosition.y=o.position.y,o.sourceEvents.mouseup=u},o.mousewheel=function(u){o.wheelDelta=Math.max(-1,Math.min(1,u.wheelDelta||-u.detail)),u.preventDefault(),o.sourceEvents.mousewheel=u},t.setElement(o,o.element),o},t.setElement=function(a,o){a.element=o,o.addEventListener("mousemove",a.mousemove,{passive:!0}),o.addEventListener("mousedown",a.mousedown,{passive:!0}),o.addEventListener("mouseup",a.mouseup,{passive:!0}),o.addEventListener("wheel",a.mousewheel,{passive:!1}),o.addEventListener("touchmove",a.mousemove,{passive:!1}),o.addEventListener("touchstart",a.mousedown,{passive:!1}),o.addEventListener("touchend",a.mouseup,{passive:!1})},t.clearSourceEvents=function(a){a.sourceEvents.mousemove=null,a.sourceEvents.mousedown=null,a.sourceEvents.mouseup=null,a.sourceEvents.mousewheel=null,a.wheelDelta=0},t.setOffset=function(a,o){a.offset.x=o.x,a.offset.y=o.y,a.position.x=a.absolute.x*a.scale.x+a.offset.x,a.position.y=a.absolute.y*a.scale.y+a.offset.y},t.setScale=function(a,o){a.scale.x=o.x,a.scale.y=o.y,a.position.x=a.absolute.x*a.scale.x+a.offset.x,a.position.y=a.absolute.y*a.scale.y+a.offset.y},t._getRelativeMousePosition=function(a,o,u){var c=o.getBoundingClientRect(),f=document.documentElement||document.body.parentNode||document.body,h=window.pageXOffset!==void 0?window.pageXOffset:f.scrollLeft,l=window.pageYOffset!==void 0?window.pageYOffset:f.scrollTop,d=a.changedTouches,p,m;return d?(p=d[0].pageX-c.left-h,m=d[0].pageY-c.top-l):(p=a.pageX-c.left-h,m=a.pageY-c.top-l),{x:p/(o.clientWidth/(o.width||o.clientWidth)*u),y:m/(o.clientHeight/(o.height||o.clientHeight)*u)}}})()},function(n,s,i){var t={};n.exports=t;var r=i(0);(function(){t._registry={},t.register=function(a){if(t.isPlugin(a)||r.warn("Plugin.register:",t.toString(a),"does not implement all required fields."),a.name in t._registry){var o=t._registry[a.name],u=t.versionParse(a.version).number,c=t.versionParse(o.version).number;u>c?(r.warn("Plugin.register:",t.toString(o),"was upgraded to",t.toString(a)),t._registry[a.name]=a):u<c?r.warn("Plugin.register:",t.toString(o),"can not be downgraded to",t.toString(a)):a!==o&&r.warn("Plugin.register:",t.toString(a),"is already registered to different plugin object")}else t._registry[a.name]=a;return a},t.resolve=function(a){return t._registry[t.dependencyParse(a).name]},t.toString=function(a){return typeof a=="string"?a:(a.name||"anonymous")+"@"+(a.version||a.range||"0.0.0")},t.isPlugin=function(a){return a&&a.name&&a.version&&a.install},t.isUsed=function(a,o){return a.used.indexOf(o)>-1},t.isFor=function(a,o){var u=a.for&&t.dependencyParse(a.for);return!a.for||o.name===u.name&&t.versionSatisfies(o.version,u.range)},t.use=function(a,o){if(a.uses=(a.uses||[]).concat(o||[]),a.uses.length===0){r.warn("Plugin.use:",t.toString(a),"does not specify any dependencies to install.");return}for(var u=t.dependencies(a),c=r.topologicalSort(u),f=[],h=0;h<c.length;h+=1)if(c[h]!==a.name){var l=t.resolve(c[h]);if(!l){f.push(" "+c[h]);continue}t.isUsed(a,l.name)||(t.isFor(l,a)||(r.warn("Plugin.use:",t.toString(l),"is for",l.for,"but installed on",t.toString(a)+"."),l._warned=!0),l.install?l.install(a):(r.warn("Plugin.use:",t.toString(l),"does not specify an install function."),l._warned=!0),l._warned?(f.push(" "+t.toString(l)),delete l._warned):f.push(" "+t.toString(l)),a.used.push(l.name))}f.length>0&&r.info(f.join("  "))},t.dependencies=function(a,o){var u=t.dependencyParse(a),c=u.name;if(o=o||{},!(c in o)){a=t.resolve(a)||a,o[c]=r.map(a.uses||[],function(h){t.isPlugin(h)&&t.register(h);var l=t.dependencyParse(h),d=t.resolve(h);return d&&!t.versionSatisfies(d.version,l.range)?(r.warn("Plugin.dependencies:",t.toString(d),"does not satisfy",t.toString(l),"used by",t.toString(u)+"."),d._warned=!0,a._warned=!0):d||(r.warn("Plugin.dependencies:",t.toString(h),"used by",t.toString(u),"could not be resolved."),a._warned=!0),l.name});for(var f=0;f<o[c].length;f+=1)t.dependencies(o[c][f],o);return o}},t.dependencyParse=function(a){if(r.isString(a)){var o=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/;return o.test(a)||r.warn("Plugin.dependencyParse:",a,"is not a valid dependency string."),{name:a.split("@")[0],range:a.split("@")[1]||"*"}}return{name:a.name,range:a.range||a.version}},t.versionParse=function(a){var o=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;o.test(a)||r.warn("Plugin.versionParse:",a,"is not a valid version or range.");var u=o.exec(a),c=Number(u[4]),f=Number(u[5]),h=Number(u[6]);return{isRange:!!(u[1]||u[2]),version:u[3],range:a,operator:u[1]||u[2]||"",major:c,minor:f,patch:h,parts:[c,f,h],prerelease:u[7],number:c*1e8+f*1e4+h}},t.versionSatisfies=function(a,o){o=o||"*";var u=t.versionParse(o),c=t.versionParse(a);if(u.isRange){if(u.operator==="*"||a==="*")return!0;if(u.operator===">")return c.number>u.number;if(u.operator===">=")return c.number>=u.number;if(u.operator==="~")return c.major===u.major&&c.minor===u.minor&&c.patch>=u.patch;if(u.operator==="^")return u.major>0?c.major===u.major&&c.number>=u.number:u.minor>0?c.minor===u.minor&&c.patch>=u.patch:c.patch===u.patch}return a===o||a==="*"}})()},function(n,s){var i={};n.exports=i,function(){i.create=function(t){return{vertex:t,normalImpulse:0,tangentImpulse:0}}}()},function(n,s,i){var t={};n.exports=t;var r=i(7),a=i(18),o=i(13),u=i(19),c=i(5),f=i(6),h=i(10),l=i(0),d=i(4);(function(){t._deltaMax=1e3/60,t.create=function(p){p=p||{};var m={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0,lastUpdatesPerFrame:0}},x=l.extend(m,p);return x.world=p.world||f.create({label:"World"}),x.pairs=p.pairs||u.create(),x.detector=p.detector||o.create(),x.detector.pairs=x.pairs,x.grid={buckets:[]},x.world.gravity=x.gravity,x.broadphase=x.grid,x.metrics={},x},t.update=function(p,m){var x=l.now(),T=p.world,v=p.detector,b=p.pairs,g=p.timing,w=g.timestamp,S;m>t._deltaMax&&l.warnOnce("Matter.Engine.update: delta argument is recommended to be less than or equal to",t._deltaMax.toFixed(3),"ms."),m=typeof m<"u"?m:l._baseDelta,m*=g.timeScale,g.timestamp+=m,g.lastDelta=m;var A={timestamp:g.timestamp,delta:m};c.trigger(p,"beforeUpdate",A);var P=f.allBodies(T),M=f.allConstraints(T);for(T.isModified&&(o.setBodies(v,P),f.setModified(T,!1,!1,!0)),p.enableSleeping&&r.update(P,m),t._bodiesApplyGravity(P,p.gravity),m>0&&t._bodiesUpdate(P,m),c.trigger(p,"beforeSolve",A),h.preSolveAll(P),S=0;S<p.constraintIterations;S++)h.solveAll(M,m);h.postSolveAll(P);var L=o.collisions(v);u.update(b,L,w),p.enableSleeping&&r.afterCollisions(b.list),b.collisionStart.length>0&&c.trigger(p,"collisionStart",{pairs:b.collisionStart,timestamp:g.timestamp,delta:m});var E=l.clamp(20/p.positionIterations,0,1);for(a.preSolvePosition(b.list),S=0;S<p.positionIterations;S++)a.solvePosition(b.list,m,E);for(a.postSolvePosition(P),h.preSolveAll(P),S=0;S<p.constraintIterations;S++)h.solveAll(M,m);for(h.postSolveAll(P),a.preSolveVelocity(b.list),S=0;S<p.velocityIterations;S++)a.solveVelocity(b.list,m);return t._bodiesUpdateVelocities(P),b.collisionActive.length>0&&c.trigger(p,"collisionActive",{pairs:b.collisionActive,timestamp:g.timestamp,delta:m}),b.collisionEnd.length>0&&c.trigger(p,"collisionEnd",{pairs:b.collisionEnd,timestamp:g.timestamp,delta:m}),t._bodiesClearForces(P),c.trigger(p,"afterUpdate",A),p.timing.lastElapsed=l.now()-x,p},t.merge=function(p,m){if(l.extend(p,m),m.world){p.world=m.world,t.clear(p);for(var x=f.allBodies(p.world),T=0;T<x.length;T++){var v=x[T];r.set(v,!1),v.id=l.nextId()}}},t.clear=function(p){u.clear(p.pairs),o.clear(p.detector)},t._bodiesClearForces=function(p){for(var m=p.length,x=0;x<m;x++){var T=p[x];T.force.x=0,T.force.y=0,T.torque=0}},t._bodiesApplyGravity=function(p,m){var x=typeof m.scale<"u"?m.scale:.001,T=p.length;if(!(m.x===0&&m.y===0||x===0))for(var v=0;v<T;v++){var b=p[v];b.isStatic||b.isSleeping||(b.force.y+=b.mass*m.y*x,b.force.x+=b.mass*m.x*x)}},t._bodiesUpdate=function(p,m){for(var x=p.length,T=0;T<x;T++){var v=p[T];v.isStatic||v.isSleeping||d.update(v,m)}},t._bodiesUpdateVelocities=function(p){for(var m=p.length,x=0;x<m;x++)d.updateVelocities(p[x])}})()},function(n,s,i){var t={};n.exports=t;var r=i(3),a=i(0),o=i(1);(function(){t._restingThresh=2,t._restingThreshTangent=Math.sqrt(6),t._positionDampen=.9,t._positionWarming=.8,t._frictionNormalMultiplier=5,t._frictionMaxStatic=Number.MAX_VALUE,t.preSolvePosition=function(u){var c,f,h,l=u.length;for(c=0;c<l;c++)f=u[c],f.isActive&&(h=f.contactCount,f.collision.parentA.totalContacts+=h,f.collision.parentB.totalContacts+=h)},t.solvePosition=function(u,c,f){var h,l,d,p,m,x,T,v,b=t._positionDampen*(f||1),g=a.clamp(c/a._baseDelta,0,1),w=u.length;for(h=0;h<w;h++)l=u[h],!(!l.isActive||l.isSensor)&&(d=l.collision,p=d.parentA,m=d.parentB,x=d.normal,l.separation=d.depth+x.x*(m.positionImpulse.x-p.positionImpulse.x)+x.y*(m.positionImpulse.y-p.positionImpulse.y));for(h=0;h<w;h++)l=u[h],!(!l.isActive||l.isSensor)&&(d=l.collision,p=d.parentA,m=d.parentB,x=d.normal,v=l.separation-l.slop*g,(p.isStatic||m.isStatic)&&(v*=2),p.isStatic||p.isSleeping||(T=b/p.totalContacts,p.positionImpulse.x+=x.x*v*T,p.positionImpulse.y+=x.y*v*T),m.isStatic||m.isSleeping||(T=b/m.totalContacts,m.positionImpulse.x-=x.x*v*T,m.positionImpulse.y-=x.y*v*T))},t.postSolvePosition=function(u){for(var c=t._positionWarming,f=u.length,h=r.translate,l=o.update,d=0;d<f;d++){var p=u[d],m=p.positionImpulse,x=m.x,T=m.y,v=p.velocity;if(p.totalContacts=0,x!==0||T!==0){for(var b=0;b<p.parts.length;b++){var g=p.parts[b];h(g.vertices,m),l(g.bounds,g.vertices,v),g.position.x+=x,g.position.y+=T}p.positionPrev.x+=x,p.positionPrev.y+=T,x*v.x+T*v.y<0?(m.x=0,m.y=0):(m.x*=c,m.y*=c)}}},t.preSolveVelocity=function(u){var c=u.length,f,h;for(f=0;f<c;f++){var l=u[f];if(!(!l.isActive||l.isSensor)){var d=l.contacts,p=l.contactCount,m=l.collision,x=m.parentA,T=m.parentB,v=m.normal,b=m.tangent;for(h=0;h<p;h++){var g=d[h],w=g.vertex,S=g.normalImpulse,A=g.tangentImpulse;if(S!==0||A!==0){var P=v.x*S+b.x*A,M=v.y*S+b.y*A;x.isStatic||x.isSleeping||(x.positionPrev.x+=P*x.inverseMass,x.positionPrev.y+=M*x.inverseMass,x.anglePrev+=x.inverseInertia*((w.x-x.position.x)*M-(w.y-x.position.y)*P)),T.isStatic||T.isSleeping||(T.positionPrev.x-=P*T.inverseMass,T.positionPrev.y-=M*T.inverseMass,T.anglePrev-=T.inverseInertia*((w.x-T.position.x)*M-(w.y-T.position.y)*P))}}}}},t.solveVelocity=function(u,c){var f=c/a._baseDelta,h=f*f,l=h*f,d=-t._restingThresh*f,p=t._restingThreshTangent,m=t._frictionNormalMultiplier*f,x=t._frictionMaxStatic,T=u.length,v,b,g,w;for(g=0;g<T;g++){var S=u[g];if(!(!S.isActive||S.isSensor)){var A=S.collision,P=A.parentA,M=A.parentB,L=A.normal.x,E=A.normal.y,D=A.tangent.x,V=A.tangent.y,z=S.inverseMass,W=S.friction*S.frictionStatic*m,_=S.contacts,U=S.contactCount,J=1/U,te=P.position.x-P.positionPrev.x,re=P.position.y-P.positionPrev.y,oe=P.angle-P.anglePrev,ue=M.position.x-M.positionPrev.x,B=M.position.y-M.positionPrev.y,O=M.angle-M.anglePrev;for(w=0;w<U;w++){var C=_[w],R=C.vertex,H=R.x-P.position.x,X=R.y-P.position.y,N=R.x-M.position.x,K=R.y-M.position.y,Q=te-X*oe,q=re+H*oe,G=ue-K*O,Y=B+N*O,Z=Q-G,ee=q-Y,F=L*Z+E*ee,I=D*Z+V*ee,$=S.separation+F,ae=Math.min($,1);ae=$<0?0:ae;var ve=ae*W;I<-ve||I>ve?(b=I>0?I:-I,v=S.friction*(I>0?1:-1)*l,v<-b?v=-b:v>b&&(v=b)):(v=I,b=x);var we=H*E-X*L,me=N*E-K*L,Ce=J/(z+P.inverseInertia*we*we+M.inverseInertia*me*me),Re=(1+S.restitution)*F*Ce;if(v*=Ce,F<d)C.normalImpulse=0;else{var Ye=C.normalImpulse;C.normalImpulse+=Re,C.normalImpulse>0&&(C.normalImpulse=0),Re=C.normalImpulse-Ye}if(I<-p||I>p)C.tangentImpulse=0;else{var k=C.tangentImpulse;C.tangentImpulse+=v,C.tangentImpulse<-b&&(C.tangentImpulse=-b),C.tangentImpulse>b&&(C.tangentImpulse=b),v=C.tangentImpulse-k}var ne=L*Re+D*v,fe=E*Re+V*v;P.isStatic||P.isSleeping||(P.positionPrev.x+=ne*P.inverseMass,P.positionPrev.y+=fe*P.inverseMass,P.anglePrev+=(H*fe-X*ne)*P.inverseInertia),M.isStatic||M.isSleeping||(M.positionPrev.x-=ne*M.inverseMass,M.positionPrev.y-=fe*M.inverseMass,M.anglePrev-=(N*fe-K*ne)*M.inverseInertia)}}}}})()},function(n,s,i){var t={};n.exports=t;var r=i(9),a=i(0);(function(){t.create=function(o){return a.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},o)},t.update=function(o,u,c){var f=r.update,h=r.create,l=r.setActive,d=o.table,p=o.list,m=p.length,x=m,T=o.collisionStart,v=o.collisionEnd,b=o.collisionActive,g=u.length,w=0,S=0,A=0,P,M,L;for(L=0;L<g;L++)P=u[L],M=P.pair,M?(M.isActive&&(b[A++]=M),f(M,P,c)):(M=h(P,c),d[M.id]=M,T[w++]=M,p[x++]=M);for(x=0,m=p.length,L=0;L<m;L++)M=p[L],M.timeUpdated>=c?p[x++]=M:(l(M,!1,c),M.collision.bodyA.sleepCounter>0&&M.collision.bodyB.sleepCounter>0?p[x++]=M:(v[S++]=M,delete d[M.id]));p.length!==x&&(p.length=x),T.length!==w&&(T.length=w),v.length!==S&&(v.length=S),b.length!==A&&(b.length=A)},t.clear=function(o){return o.table={},o.list.length=0,o.collisionStart.length=0,o.collisionActive.length=0,o.collisionEnd.length=0,o}})()},function(n,s,i){var t=n.exports=i(21);t.Axes=i(11),t.Bodies=i(12),t.Body=i(4),t.Bounds=i(1),t.Collision=i(8),t.Common=i(0),t.Composite=i(6),t.Composites=i(22),t.Constraint=i(10),t.Contact=i(16),t.Detector=i(13),t.Engine=i(17),t.Events=i(5),t.Grid=i(23),t.Mouse=i(14),t.MouseConstraint=i(24),t.Pair=i(9),t.Pairs=i(19),t.Plugin=i(15),t.Query=i(25),t.Render=i(26),t.Resolver=i(18),t.Runner=i(27),t.SAT=i(28),t.Sleeping=i(7),t.Svg=i(29),t.Vector=i(2),t.Vertices=i(3),t.World=i(30),t.Engine.run=t.Runner.run,t.Common.deprecated(t.Engine,"run","Engine.run  use Matter.Runner.run(engine) instead")},function(n,s,i){var t={};n.exports=t;var r=i(15),a=i(0);(function(){t.name="matter-js",t.version="0.20.0",t.uses=[],t.used=[],t.use=function(){r.use(t,Array.prototype.slice.call(arguments))},t.before=function(o,u){return o=o.replace(/^Matter./,""),a.chainPathBefore(t,o,u)},t.after=function(o,u){return o=o.replace(/^Matter./,""),a.chainPathAfter(t,o,u)}})()},function(n,s,i){var t={};n.exports=t;var r=i(6),a=i(10),o=i(0),u=i(4),c=i(12),f=o.deprecated;(function(){t.stack=function(h,l,d,p,m,x,T){for(var v=r.create({label:"Stack"}),b=h,g=l,w,S=0,A=0;A<p;A++){for(var P=0,M=0;M<d;M++){var L=T(b,g,M,A,w,S);if(L){var E=L.bounds.max.y-L.bounds.min.y,D=L.bounds.max.x-L.bounds.min.x;E>P&&(P=E),u.translate(L,{x:D*.5,y:E*.5}),b=L.bounds.max.x+m,r.addBody(v,L),w=L,S+=1}else b+=m}g+=P+x,b=h}return v},t.chain=function(h,l,d,p,m,x){for(var T=h.bodies,v=1;v<T.length;v++){var b=T[v-1],g=T[v],w=b.bounds.max.y-b.bounds.min.y,S=b.bounds.max.x-b.bounds.min.x,A=g.bounds.max.y-g.bounds.min.y,P=g.bounds.max.x-g.bounds.min.x,M={bodyA:b,pointA:{x:S*l,y:w*d},bodyB:g,pointB:{x:P*p,y:A*m}},L=o.extend(M,x);r.addConstraint(h,a.create(L))}return h.label+=" Chain",h},t.mesh=function(h,l,d,p,m){var x=h.bodies,T,v,b,g,w;for(T=0;T<d;T++){for(v=1;v<l;v++)b=x[v-1+T*l],g=x[v+T*l],r.addConstraint(h,a.create(o.extend({bodyA:b,bodyB:g},m)));if(T>0)for(v=0;v<l;v++)b=x[v+(T-1)*l],g=x[v+T*l],r.addConstraint(h,a.create(o.extend({bodyA:b,bodyB:g},m))),p&&v>0&&(w=x[v-1+(T-1)*l],r.addConstraint(h,a.create(o.extend({bodyA:w,bodyB:g},m)))),p&&v<l-1&&(w=x[v+1+(T-1)*l],r.addConstraint(h,a.create(o.extend({bodyA:w,bodyB:g},m))))}return h.label+=" Mesh",h},t.pyramid=function(h,l,d,p,m,x,T){return t.stack(h,l,d,p,m,x,function(v,b,g,w,S,A){var P=Math.min(p,Math.ceil(d/2)),M=S?S.bounds.max.x-S.bounds.min.x:0;if(!(w>P)){w=P-w;var L=w,E=d-1-w;if(!(g<L||g>E)){A===1&&u.translate(S,{x:(g+(d%2===1?1:-1))*M,y:0});var D=S?g*M:0;return T(h+D+g*m,b,g,w,S,A)}}})},t.newtonsCradle=function(h,l,d,p,m){for(var x=r.create({label:"Newtons Cradle"}),T=0;T<d;T++){var v=1.9,b=c.circle(h+T*(p*v),l+m,p,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),g=a.create({pointA:{x:h+T*(p*v),y:l},bodyB:b});r.addBody(x,b),r.addConstraint(x,g)}return x},f(t,"newtonsCradle","Composites.newtonsCradle  moved to newtonsCradle example"),t.car=function(h,l,d,p,m){var x=u.nextGroup(!0),T=20,v=-d*.5+T,b=d*.5-T,g=0,w=r.create({label:"Car"}),S=c.rectangle(h,l,d,p,{collisionFilter:{group:x},chamfer:{radius:p*.5},density:2e-4}),A=c.circle(h+v,l+g,m,{collisionFilter:{group:x},friction:.8}),P=c.circle(h+b,l+g,m,{collisionFilter:{group:x},friction:.8}),M=a.create({bodyB:S,pointB:{x:v,y:g},bodyA:A,stiffness:1,length:0}),L=a.create({bodyB:S,pointB:{x:b,y:g},bodyA:P,stiffness:1,length:0});return r.addBody(w,S),r.addBody(w,A),r.addBody(w,P),r.addConstraint(w,M),r.addConstraint(w,L),w},f(t,"car","Composites.car  moved to car example"),t.softBody=function(h,l,d,p,m,x,T,v,b,g){b=o.extend({inertia:1/0},b),g=o.extend({stiffness:.2,render:{type:"line",anchors:!1}},g);var w=t.stack(h,l,d,p,m,x,function(S,A){return c.circle(S,A,v,b)});return t.mesh(w,d,p,T,g),w.label="Soft Body",w},f(t,"softBody","Composites.softBody  moved to softBody and cloth examples")})()},function(n,s,i){var t={};n.exports=t;var r=i(9),a=i(0),o=a.deprecated;(function(){t.create=function(u){var c={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return a.extend(c,u)},t.update=function(u,c,f,h){var l,d,p,m=f.world,x=u.buckets,T,v,b=!1;for(l=0;l<c.length;l++){var g=c[l];if(!(g.isSleeping&&!h)&&!(m.bounds&&(g.bounds.max.x<m.bounds.min.x||g.bounds.min.x>m.bounds.max.x||g.bounds.max.y<m.bounds.min.y||g.bounds.min.y>m.bounds.max.y))){var w=t._getRegion(u,g);if(!g.region||w.id!==g.region.id||h){(!g.region||h)&&(g.region=w);var S=t._regionUnion(w,g.region);for(d=S.startCol;d<=S.endCol;d++)for(p=S.startRow;p<=S.endRow;p++){v=t._getBucketId(d,p),T=x[v];var A=d>=w.startCol&&d<=w.endCol&&p>=w.startRow&&p<=w.endRow,P=d>=g.region.startCol&&d<=g.region.endCol&&p>=g.region.startRow&&p<=g.region.endRow;!A&&P&&P&&T&&t._bucketRemoveBody(u,T,g),(g.region===w||A&&!P||h)&&(T||(T=t._createBucket(x,v)),t._bucketAddBody(u,T,g))}g.region=w,b=!0}}}b&&(u.pairsList=t._createActivePairsList(u))},o(t,"update","Grid.update  replaced by Matter.Detector"),t.clear=function(u){u.buckets={},u.pairs={},u.pairsList=[]},o(t,"clear","Grid.clear  replaced by Matter.Detector"),t._regionUnion=function(u,c){var f=Math.min(u.startCol,c.startCol),h=Math.max(u.endCol,c.endCol),l=Math.min(u.startRow,c.startRow),d=Math.max(u.endRow,c.endRow);return t._createRegion(f,h,l,d)},t._getRegion=function(u,c){var f=c.bounds,h=Math.floor(f.min.x/u.bucketWidth),l=Math.floor(f.max.x/u.bucketWidth),d=Math.floor(f.min.y/u.bucketHeight),p=Math.floor(f.max.y/u.bucketHeight);return t._createRegion(h,l,d,p)},t._createRegion=function(u,c,f,h){return{id:u+","+c+","+f+","+h,startCol:u,endCol:c,startRow:f,endRow:h}},t._getBucketId=function(u,c){return"C"+u+"R"+c},t._createBucket=function(u,c){var f=u[c]=[];return f},t._bucketAddBody=function(u,c,f){var h=u.pairs,l=r.id,d=c.length,p;for(p=0;p<d;p++){var m=c[p];if(!(f.id===m.id||f.isStatic&&m.isStatic)){var x=l(f,m),T=h[x];T?T[2]+=1:h[x]=[f,m,1]}}c.push(f)},t._bucketRemoveBody=function(u,c,f){var h=u.pairs,l=r.id,d;c.splice(a.indexOf(c,f),1);var p=c.length;for(d=0;d<p;d++){var m=h[l(f,c[d])];m&&(m[2]-=1)}},t._createActivePairsList=function(u){var c,f=u.pairs,h=a.keys(f),l=h.length,d=[],p;for(p=0;p<l;p++)c=f[h[p]],c[2]>0?d.push(c):delete f[h[p]];return d}})()},function(n,s,i){var t={};n.exports=t;var r=i(3),a=i(7),o=i(14),u=i(5),c=i(13),f=i(10),h=i(6),l=i(0),d=i(1);(function(){t.create=function(p,m){var x=(p?p.mouse:null)||(m?m.mouse:null);x||(p&&p.render&&p.render.canvas?x=o.create(p.render.canvas):m&&m.element?x=o.create(m.element):(x=o.create(),l.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var T=f.create({label:"Mouse Constraint",pointA:x.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),v={type:"mouseConstraint",mouse:x,element:null,body:null,constraint:T,collisionFilter:{category:1,mask:4294967295,group:0}},b=l.extend(v,m);return u.on(p,"beforeUpdate",function(){var g=h.allBodies(p.world);t.update(b,g),t._triggerEvents(b)}),b},t.update=function(p,m){var x=p.mouse,T=p.constraint,v=p.body;if(x.button===0){if(T.bodyB)a.set(T.bodyB,!1),T.pointA=x.position;else for(var b=0;b<m.length;b++)if(v=m[b],d.contains(v.bounds,x.position)&&c.canCollide(v.collisionFilter,p.collisionFilter))for(var g=v.parts.length>1?1:0;g<v.parts.length;g++){var w=v.parts[g];if(r.contains(w.vertices,x.position)){T.pointA=x.position,T.bodyB=p.body=v,T.pointB={x:x.position.x-v.position.x,y:x.position.y-v.position.y},T.angleB=v.angle,a.set(v,!1),u.trigger(p,"startdrag",{mouse:x,body:v});break}}}else T.bodyB=p.body=null,T.pointB=null,v&&u.trigger(p,"enddrag",{mouse:x,body:v})},t._triggerEvents=function(p){var m=p.mouse,x=m.sourceEvents;x.mousemove&&u.trigger(p,"mousemove",{mouse:m}),x.mousedown&&u.trigger(p,"mousedown",{mouse:m}),x.mouseup&&u.trigger(p,"mouseup",{mouse:m}),o.clearSourceEvents(m)}})()},function(n,s,i){var t={};n.exports=t;var r=i(2),a=i(8),o=i(1),u=i(12),c=i(3);(function(){t.collides=function(f,h){for(var l=[],d=h.length,p=f.bounds,m=a.collides,x=o.overlaps,T=0;T<d;T++){var v=h[T],b=v.parts.length,g=b===1?0:1;if(x(v.bounds,p))for(var w=g;w<b;w++){var S=v.parts[w];if(x(S.bounds,p)){var A=m(S,f);if(A){l.push(A);break}}}}return l},t.ray=function(f,h,l,d){d=d||1e-100;for(var p=r.angle(h,l),m=r.magnitude(r.sub(h,l)),x=(l.x+h.x)*.5,T=(l.y+h.y)*.5,v=u.rectangle(x,T,m,d,{angle:p}),b=t.collides(v,f),g=0;g<b.length;g+=1){var w=b[g];w.body=w.bodyB=w.bodyA}return b},t.region=function(f,h,l){for(var d=[],p=0;p<f.length;p++){var m=f[p],x=o.overlaps(m.bounds,h);(x&&!l||!x&&l)&&d.push(m)}return d},t.point=function(f,h){for(var l=[],d=0;d<f.length;d++){var p=f[d];if(o.contains(p.bounds,h))for(var m=p.parts.length===1?0:1;m<p.parts.length;m++){var x=p.parts[m];if(o.contains(x.bounds,h)&&c.contains(x.vertices,h)){l.push(p);break}}}return l}})()},function(n,s,i){var t={};n.exports=t;var r=i(4),a=i(0),o=i(6),u=i(1),c=i(5),f=i(2),h=i(14);(function(){var l,d;typeof window<"u"&&(l=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(g){window.setTimeout(function(){g(a.now())},1e3/60)},d=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),t._goodFps=30,t._goodDelta=1e3/60,t.create=function(g){var w={engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],engineUpdatesHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",wireframeStrokeStyle:"#bbb",hasBounds:!!g.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},S=a.extend(w,g);return S.canvas&&(S.canvas.width=S.options.width||S.canvas.width,S.canvas.height=S.options.height||S.canvas.height),S.mouse=g.mouse,S.engine=g.engine,S.canvas=S.canvas||x(S.options.width,S.options.height),S.context=S.canvas.getContext("2d"),S.textures={},S.bounds=S.bounds||{min:{x:0,y:0},max:{x:S.canvas.width,y:S.canvas.height}},S.controller=t,S.options.showBroadphase=!1,S.options.pixelRatio!==1&&t.setPixelRatio(S,S.options.pixelRatio),a.isElement(S.element)&&S.element.appendChild(S.canvas),S},t.run=function(g){(function w(S){g.frameRequestId=l(w),p(g,S),t.world(g,S),g.context.setTransform(g.options.pixelRatio,0,0,g.options.pixelRatio,0,0),(g.options.showStats||g.options.showDebug)&&t.stats(g,g.context,S),(g.options.showPerformance||g.options.showDebug)&&t.performance(g,g.context,S),g.context.setTransform(1,0,0,1,0,0)})()},t.stop=function(g){d(g.frameRequestId)},t.setPixelRatio=function(g,w){var S=g.options,A=g.canvas;w==="auto"&&(w=T(A)),S.pixelRatio=w,A.setAttribute("data-pixel-ratio",w),A.width=S.width*w,A.height=S.height*w,A.style.width=S.width+"px",A.style.height=S.height+"px"},t.setSize=function(g,w,S){g.options.width=w,g.options.height=S,g.bounds.max.x=g.bounds.min.x+w,g.bounds.max.y=g.bounds.min.y+S,g.options.pixelRatio!==1?t.setPixelRatio(g,g.options.pixelRatio):(g.canvas.width=w,g.canvas.height=S)},t.lookAt=function(g,w,S,A){A=typeof A<"u"?A:!0,w=a.isArray(w)?w:[w],S=S||{x:0,y:0};for(var P={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},M=0;M<w.length;M+=1){var L=w[M],E=L.bounds?L.bounds.min:L.min||L.position||L,D=L.bounds?L.bounds.max:L.max||L.position||L;E&&D&&(E.x<P.min.x&&(P.min.x=E.x),D.x>P.max.x&&(P.max.x=D.x),E.y<P.min.y&&(P.min.y=E.y),D.y>P.max.y&&(P.max.y=D.y))}var V=P.max.x-P.min.x+2*S.x,z=P.max.y-P.min.y+2*S.y,W=g.canvas.height,_=g.canvas.width,U=_/W,J=V/z,te=1,re=1;J>U?re=J/U:te=U/J,g.options.hasBounds=!0,g.bounds.min.x=P.min.x,g.bounds.max.x=P.min.x+V*te,g.bounds.min.y=P.min.y,g.bounds.max.y=P.min.y+z*re,A&&(g.bounds.min.x+=V*.5-V*te*.5,g.bounds.max.x+=V*.5-V*te*.5,g.bounds.min.y+=z*.5-z*re*.5,g.bounds.max.y+=z*.5-z*re*.5),g.bounds.min.x-=S.x,g.bounds.max.x-=S.x,g.bounds.min.y-=S.y,g.bounds.max.y-=S.y,g.mouse&&(h.setScale(g.mouse,{x:(g.bounds.max.x-g.bounds.min.x)/g.canvas.width,y:(g.bounds.max.y-g.bounds.min.y)/g.canvas.height}),h.setOffset(g.mouse,g.bounds.min))},t.startViewTransform=function(g){var w=g.bounds.max.x-g.bounds.min.x,S=g.bounds.max.y-g.bounds.min.y,A=w/g.options.width,P=S/g.options.height;g.context.setTransform(g.options.pixelRatio/A,0,0,g.options.pixelRatio/P,0,0),g.context.translate(-g.bounds.min.x,-g.bounds.min.y)},t.endViewTransform=function(g){g.context.setTransform(g.options.pixelRatio,0,0,g.options.pixelRatio,0,0)},t.world=function(g,w){var S=a.now(),A=g.engine,P=A.world,M=g.canvas,L=g.context,E=g.options,D=g.timing,V=o.allBodies(P),z=o.allConstraints(P),W=E.wireframes?E.wireframeBackground:E.background,_=[],U=[],J,te={timestamp:A.timing.timestamp};if(c.trigger(g,"beforeRender",te),g.currentBackground!==W&&b(g,W),L.globalCompositeOperation="source-in",L.fillStyle="transparent",L.fillRect(0,0,M.width,M.height),L.globalCompositeOperation="source-over",E.hasBounds){for(J=0;J<V.length;J++){var re=V[J];u.overlaps(re.bounds,g.bounds)&&_.push(re)}for(J=0;J<z.length;J++){var oe=z[J],ue=oe.bodyA,B=oe.bodyB,O=oe.pointA,C=oe.pointB;ue&&(O=f.add(ue.position,oe.pointA)),B&&(C=f.add(B.position,oe.pointB)),!(!O||!C)&&(u.contains(g.bounds,O)||u.contains(g.bounds,C))&&U.push(oe)}t.startViewTransform(g),g.mouse&&(h.setScale(g.mouse,{x:(g.bounds.max.x-g.bounds.min.x)/g.options.width,y:(g.bounds.max.y-g.bounds.min.y)/g.options.height}),h.setOffset(g.mouse,g.bounds.min))}else U=z,_=V,g.options.pixelRatio!==1&&g.context.setTransform(g.options.pixelRatio,0,0,g.options.pixelRatio,0,0);!E.wireframes||A.enableSleeping&&E.showSleeping?t.bodies(g,_,L):(E.showConvexHulls&&t.bodyConvexHulls(g,_,L),t.bodyWireframes(g,_,L)),E.showBounds&&t.bodyBounds(g,_,L),(E.showAxes||E.showAngleIndicator)&&t.bodyAxes(g,_,L),E.showPositions&&t.bodyPositions(g,_,L),E.showVelocity&&t.bodyVelocity(g,_,L),E.showIds&&t.bodyIds(g,_,L),E.showSeparations&&t.separations(g,A.pairs.list,L),E.showCollisions&&t.collisions(g,A.pairs.list,L),E.showVertexNumbers&&t.vertexNumbers(g,_,L),E.showMousePosition&&t.mousePosition(g,g.mouse,L),t.constraints(U,L),E.hasBounds&&t.endViewTransform(g),c.trigger(g,"afterRender",te),D.lastElapsed=a.now()-S},t.stats=function(g,w,S){for(var A=g.engine,P=A.world,M=o.allBodies(P),L=0,E=55,D=44,V=0,z=0,W=0;W<M.length;W+=1)L+=M[W].parts.length;var _={Part:L,Body:M.length,Cons:o.allConstraints(P).length,Comp:o.allComposites(P).length,Pair:A.pairs.list.length};w.fillStyle="#0e0f19",w.fillRect(V,z,E*5.5,D),w.font="12px Arial",w.textBaseline="top",w.textAlign="right";for(var U in _){var J=_[U];w.fillStyle="#aaa",w.fillText(U,V+E,z+8),w.fillStyle="#eee",w.fillText(J,V+E,z+26),V+=E}},t.performance=function(g,w){var S=g.engine,A=g.timing,P=A.deltaHistory,M=A.elapsedHistory,L=A.timestampElapsedHistory,E=A.engineDeltaHistory,D=A.engineUpdatesHistory,V=A.engineElapsedHistory,z=S.timing.lastUpdatesPerFrame,W=S.timing.lastDelta,_=m(P),U=m(M),J=m(E),te=m(D),re=m(V),oe=m(L),ue=oe/_||0,B=Math.round(_/W),O=1e3/_||0,C=4,R=12,H=60,X=34,N=10,K=69;w.fillStyle="#0e0f19",w.fillRect(0,50,R*5+H*6+22,X),t.status(w,N,K,H,C,P.length,Math.round(O)+" fps",O/t._goodFps,function(Q){return P[Q]/_-1}),t.status(w,N+R+H,K,H,C,E.length,W.toFixed(2)+" dt",t._goodDelta/W,function(Q){return E[Q]/J-1}),t.status(w,N+(R+H)*2,K,H,C,D.length,z+" upf",Math.pow(a.clamp(te/B||1,0,1),4),function(Q){return D[Q]/te-1}),t.status(w,N+(R+H)*3,K,H,C,V.length,re.toFixed(2)+" ut",1-z*re/t._goodFps,function(Q){return V[Q]/re-1}),t.status(w,N+(R+H)*4,K,H,C,M.length,U.toFixed(2)+" rt",1-U/t._goodFps,function(Q){return M[Q]/U-1}),t.status(w,N+(R+H)*5,K,H,C,L.length,ue.toFixed(2)+" x",ue*ue*ue,function(Q){return(L[Q]/P[Q]/ue||0)-1})},t.status=function(g,w,S,A,P,M,L,E,D){g.strokeStyle="#888",g.fillStyle="#444",g.lineWidth=1,g.fillRect(w,S+7,A,1),g.beginPath(),g.moveTo(w,S+7-P*a.clamp(.4*D(0),-2,2));for(var V=0;V<A;V+=1)g.lineTo(w+V,S+7-(V<M?P*a.clamp(.4*D(V),-2,2):0));g.stroke(),g.fillStyle="hsl("+a.clamp(25+95*E,0,120)+",100%,60%)",g.fillRect(w,S-7,4,4),g.font="12px Arial",g.textBaseline="middle",g.textAlign="right",g.fillStyle="#eee",g.fillText(L,w+A,S-5)},t.constraints=function(g,w){for(var S=w,A=0;A<g.length;A++){var P=g[A];if(!(!P.render.visible||!P.pointA||!P.pointB)){var M=P.bodyA,L=P.bodyB,E,D;if(M?E=f.add(M.position,P.pointA):E=P.pointA,P.render.type==="pin")S.beginPath(),S.arc(E.x,E.y,3,0,2*Math.PI),S.closePath();else{if(L?D=f.add(L.position,P.pointB):D=P.pointB,S.beginPath(),S.moveTo(E.x,E.y),P.render.type==="spring")for(var V=f.sub(D,E),z=f.perp(f.normalise(V)),W=Math.ceil(a.clamp(P.length/5,12,20)),_,U=1;U<W;U+=1)_=U%2===0?1:-1,S.lineTo(E.x+V.x*(U/W)+z.x*_*4,E.y+V.y*(U/W)+z.y*_*4);S.lineTo(D.x,D.y)}P.render.lineWidth&&(S.lineWidth=P.render.lineWidth,S.strokeStyle=P.render.strokeStyle,S.stroke()),P.render.anchors&&(S.fillStyle=P.render.strokeStyle,S.beginPath(),S.arc(E.x,E.y,3,0,2*Math.PI),S.arc(D.x,D.y,3,0,2*Math.PI),S.closePath(),S.fill())}}},t.bodies=function(g,w,S){var A=S;g.engine;var P=g.options,M=P.showInternalEdges||!P.wireframes,L,E,D,V;for(D=0;D<w.length;D++)if(L=w[D],!!L.render.visible){for(V=L.parts.length>1?1:0;V<L.parts.length;V++)if(E=L.parts[V],!!E.render.visible){if(P.showSleeping&&L.isSleeping?A.globalAlpha=.5*E.render.opacity:E.render.opacity!==1&&(A.globalAlpha=E.render.opacity),E.render.sprite&&E.render.sprite.texture&&!P.wireframes){var z=E.render.sprite,W=v(g,z.texture);A.translate(E.position.x,E.position.y),A.rotate(E.angle),A.drawImage(W,W.width*-z.xOffset*z.xScale,W.height*-z.yOffset*z.yScale,W.width*z.xScale,W.height*z.yScale),A.rotate(-E.angle),A.translate(-E.position.x,-E.position.y)}else{if(E.circleRadius)A.beginPath(),A.arc(E.position.x,E.position.y,E.circleRadius,0,2*Math.PI);else{A.beginPath(),A.moveTo(E.vertices[0].x,E.vertices[0].y);for(var _=1;_<E.vertices.length;_++)!E.vertices[_-1].isInternal||M?A.lineTo(E.vertices[_].x,E.vertices[_].y):A.moveTo(E.vertices[_].x,E.vertices[_].y),E.vertices[_].isInternal&&!M&&A.moveTo(E.vertices[(_+1)%E.vertices.length].x,E.vertices[(_+1)%E.vertices.length].y);A.lineTo(E.vertices[0].x,E.vertices[0].y),A.closePath()}P.wireframes?(A.lineWidth=1,A.strokeStyle=g.options.wireframeStrokeStyle,A.stroke()):(A.fillStyle=E.render.fillStyle,E.render.lineWidth&&(A.lineWidth=E.render.lineWidth,A.strokeStyle=E.render.strokeStyle,A.stroke()),A.fill())}A.globalAlpha=1}}},t.bodyWireframes=function(g,w,S){var A=S,P=g.options.showInternalEdges,M,L,E,D,V;for(A.beginPath(),E=0;E<w.length;E++)if(M=w[E],!!M.render.visible)for(V=M.parts.length>1?1:0;V<M.parts.length;V++){for(L=M.parts[V],A.moveTo(L.vertices[0].x,L.vertices[0].y),D=1;D<L.vertices.length;D++)!L.vertices[D-1].isInternal||P?A.lineTo(L.vertices[D].x,L.vertices[D].y):A.moveTo(L.vertices[D].x,L.vertices[D].y),L.vertices[D].isInternal&&!P&&A.moveTo(L.vertices[(D+1)%L.vertices.length].x,L.vertices[(D+1)%L.vertices.length].y);A.lineTo(L.vertices[0].x,L.vertices[0].y)}A.lineWidth=1,A.strokeStyle=g.options.wireframeStrokeStyle,A.stroke()},t.bodyConvexHulls=function(g,w,S){var A=S,P,M,L;for(A.beginPath(),M=0;M<w.length;M++)if(P=w[M],!(!P.render.visible||P.parts.length===1)){for(A.moveTo(P.vertices[0].x,P.vertices[0].y),L=1;L<P.vertices.length;L++)A.lineTo(P.vertices[L].x,P.vertices[L].y);A.lineTo(P.vertices[0].x,P.vertices[0].y)}A.lineWidth=1,A.strokeStyle="rgba(255,255,255,0.2)",A.stroke()},t.vertexNumbers=function(g,w,S){var A=S,P,M,L;for(P=0;P<w.length;P++){var E=w[P].parts;for(L=E.length>1?1:0;L<E.length;L++){var D=E[L];for(M=0;M<D.vertices.length;M++)A.fillStyle="rgba(255,255,255,0.2)",A.fillText(P+"_"+M,D.position.x+(D.vertices[M].x-D.position.x)*.8,D.position.y+(D.vertices[M].y-D.position.y)*.8)}}},t.mousePosition=function(g,w,S){var A=S;A.fillStyle="rgba(255,255,255,0.8)",A.fillText(w.position.x+"  "+w.position.y,w.position.x+5,w.position.y-5)},t.bodyBounds=function(g,w,S){var A=S;g.engine;var P=g.options;A.beginPath();for(var M=0;M<w.length;M++){var L=w[M];if(L.render.visible)for(var E=w[M].parts,D=E.length>1?1:0;D<E.length;D++){var V=E[D];A.rect(V.bounds.min.x,V.bounds.min.y,V.bounds.max.x-V.bounds.min.x,V.bounds.max.y-V.bounds.min.y)}}P.wireframes?A.strokeStyle="rgba(255,255,255,0.08)":A.strokeStyle="rgba(0,0,0,0.1)",A.lineWidth=1,A.stroke()},t.bodyAxes=function(g,w,S){var A=S;g.engine;var P=g.options,M,L,E,D;for(A.beginPath(),L=0;L<w.length;L++){var V=w[L],z=V.parts;if(V.render.visible)if(P.showAxes)for(E=z.length>1?1:0;E<z.length;E++)for(M=z[E],D=0;D<M.axes.length;D++){var W=M.axes[D];A.moveTo(M.position.x,M.position.y),A.lineTo(M.position.x+W.x*20,M.position.y+W.y*20)}else for(E=z.length>1?1:0;E<z.length;E++)for(M=z[E],D=0;D<M.axes.length;D++)A.moveTo(M.position.x,M.position.y),A.lineTo((M.vertices[0].x+M.vertices[M.vertices.length-1].x)/2,(M.vertices[0].y+M.vertices[M.vertices.length-1].y)/2)}P.wireframes?(A.strokeStyle="indianred",A.lineWidth=1):(A.strokeStyle="rgba(255, 255, 255, 0.4)",A.globalCompositeOperation="overlay",A.lineWidth=2),A.stroke(),A.globalCompositeOperation="source-over"},t.bodyPositions=function(g,w,S){var A=S;g.engine;var P=g.options,M,L,E,D;for(A.beginPath(),E=0;E<w.length;E++)if(M=w[E],!!M.render.visible)for(D=0;D<M.parts.length;D++)L=M.parts[D],A.arc(L.position.x,L.position.y,3,0,2*Math.PI,!1),A.closePath();for(P.wireframes?A.fillStyle="indianred":A.fillStyle="rgba(0,0,0,0.5)",A.fill(),A.beginPath(),E=0;E<w.length;E++)M=w[E],M.render.visible&&(A.arc(M.positionPrev.x,M.positionPrev.y,2,0,2*Math.PI,!1),A.closePath());A.fillStyle="rgba(255,165,0,0.8)",A.fill()},t.bodyVelocity=function(g,w,S){var A=S;A.beginPath();for(var P=0;P<w.length;P++){var M=w[P];if(M.render.visible){var L=r.getVelocity(M);A.moveTo(M.position.x,M.position.y),A.lineTo(M.position.x+L.x,M.position.y+L.y)}}A.lineWidth=3,A.strokeStyle="cornflowerblue",A.stroke()},t.bodyIds=function(g,w,S){var A=S,P,M;for(P=0;P<w.length;P++)if(w[P].render.visible){var L=w[P].parts;for(M=L.length>1?1:0;M<L.length;M++){var E=L[M];A.font="12px Arial",A.fillStyle="rgba(255,255,255,0.5)",A.fillText(E.id,E.position.x+10,E.position.y-10)}}},t.collisions=function(g,w,S){var A=S,P=g.options,M,L,E,D;for(A.beginPath(),E=0;E<w.length;E++)if(M=w[E],!!M.isActive)for(L=M.collision,D=0;D<M.contactCount;D++){var V=M.contacts[D],z=V.vertex;A.rect(z.x-1.5,z.y-1.5,3.5,3.5)}for(P.wireframes?A.fillStyle="rgba(255,255,255,0.7)":A.fillStyle="orange",A.fill(),A.beginPath(),E=0;E<w.length;E++)if(M=w[E],!!M.isActive&&(L=M.collision,M.contactCount>0)){var W=M.contacts[0].vertex.x,_=M.contacts[0].vertex.y;M.contactCount===2&&(W=(M.contacts[0].vertex.x+M.contacts[1].vertex.x)/2,_=(M.contacts[0].vertex.y+M.contacts[1].vertex.y)/2),L.bodyB===L.supports[0].body||L.bodyA.isStatic===!0?A.moveTo(W-L.normal.x*8,_-L.normal.y*8):A.moveTo(W+L.normal.x*8,_+L.normal.y*8),A.lineTo(W,_)}P.wireframes?A.strokeStyle="rgba(255,165,0,0.7)":A.strokeStyle="orange",A.lineWidth=1,A.stroke()},t.separations=function(g,w,S){var A=S,P=g.options,M,L,E,D,V;for(A.beginPath(),V=0;V<w.length;V++)if(M=w[V],!!M.isActive){L=M.collision,E=L.bodyA,D=L.bodyB;var z=1;!D.isStatic&&!E.isStatic&&(z=.5),D.isStatic&&(z=0),A.moveTo(D.position.x,D.position.y),A.lineTo(D.position.x-L.penetration.x*z,D.position.y-L.penetration.y*z),z=1,!D.isStatic&&!E.isStatic&&(z=.5),E.isStatic&&(z=0),A.moveTo(E.position.x,E.position.y),A.lineTo(E.position.x+L.penetration.x*z,E.position.y+L.penetration.y*z)}P.wireframes?A.strokeStyle="rgba(255,165,0,0.5)":A.strokeStyle="orange",A.stroke()},t.inspector=function(g,w){g.engine;var S=g.selected,A=g.render,P=A.options,M;if(P.hasBounds){var L=A.bounds.max.x-A.bounds.min.x,E=A.bounds.max.y-A.bounds.min.y,D=L/A.options.width,V=E/A.options.height;w.scale(1/D,1/V),w.translate(-A.bounds.min.x,-A.bounds.min.y)}for(var z=0;z<S.length;z++){var W=S[z].data;switch(w.translate(.5,.5),w.lineWidth=1,w.strokeStyle="rgba(255,165,0,0.9)",w.setLineDash([1,2]),W.type){case"body":M=W.bounds,w.beginPath(),w.rect(Math.floor(M.min.x-3),Math.floor(M.min.y-3),Math.floor(M.max.x-M.min.x+6),Math.floor(M.max.y-M.min.y+6)),w.closePath(),w.stroke();break;case"constraint":var _=W.pointA;W.bodyA&&(_=W.pointB),w.beginPath(),w.arc(_.x,_.y,10,0,2*Math.PI),w.closePath(),w.stroke();break}w.setLineDash([]),w.translate(-.5,-.5)}g.selectStart!==null&&(w.translate(.5,.5),w.lineWidth=1,w.strokeStyle="rgba(255,165,0,0.6)",w.fillStyle="rgba(255,165,0,0.1)",M=g.selectBounds,w.beginPath(),w.rect(Math.floor(M.min.x),Math.floor(M.min.y),Math.floor(M.max.x-M.min.x),Math.floor(M.max.y-M.min.y)),w.closePath(),w.stroke(),w.fill(),w.translate(-.5,-.5)),P.hasBounds&&w.setTransform(1,0,0,1,0,0)};var p=function(g,w){var S=g.engine,A=g.timing,P=A.historySize,M=S.timing.timestamp;A.delta=w-A.lastTime||t._goodDelta,A.lastTime=w,A.timestampElapsed=M-A.lastTimestamp||0,A.lastTimestamp=M,A.deltaHistory.unshift(A.delta),A.deltaHistory.length=Math.min(A.deltaHistory.length,P),A.engineDeltaHistory.unshift(S.timing.lastDelta),A.engineDeltaHistory.length=Math.min(A.engineDeltaHistory.length,P),A.timestampElapsedHistory.unshift(A.timestampElapsed),A.timestampElapsedHistory.length=Math.min(A.timestampElapsedHistory.length,P),A.engineUpdatesHistory.unshift(S.timing.lastUpdatesPerFrame),A.engineUpdatesHistory.length=Math.min(A.engineUpdatesHistory.length,P),A.engineElapsedHistory.unshift(S.timing.lastElapsed),A.engineElapsedHistory.length=Math.min(A.engineElapsedHistory.length,P),A.elapsedHistory.unshift(A.lastElapsed),A.elapsedHistory.length=Math.min(A.elapsedHistory.length,P)},m=function(g){for(var w=0,S=0;S<g.length;S+=1)w+=g[S];return w/g.length||0},x=function(g,w){var S=document.createElement("canvas");return S.width=g,S.height=w,S.oncontextmenu=function(){return!1},S.onselectstart=function(){return!1},S},T=function(g){var w=g.getContext("2d"),S=window.devicePixelRatio||1,A=w.webkitBackingStorePixelRatio||w.mozBackingStorePixelRatio||w.msBackingStorePixelRatio||w.oBackingStorePixelRatio||w.backingStorePixelRatio||1;return S/A},v=function(g,w){var S=g.textures[w];return S||(S=g.textures[w]=new Image,S.src=w,S)},b=function(g,w){var S=w;/(jpg|gif|png)$/.test(w)&&(S="url("+w+")"),g.canvas.style.background=S,g.canvas.style.backgroundSize="contain",g.currentBackground=w}})()},function(n,s,i){var t={};n.exports=t;var r=i(5),a=i(17),o=i(0);(function(){t._maxFrameDelta=1e3/15,t._frameDeltaFallback=1e3/60,t._timeBufferMargin=1.5,t._elapsedNextEstimate=1,t._smoothingLowerBound=.1,t._smoothingUpperBound=.9,t.create=function(c){var f={delta:16.666666666666668,frameDelta:null,frameDeltaSmoothing:!0,frameDeltaSnapping:!0,frameDeltaHistory:[],frameDeltaHistorySize:100,frameRequestId:null,timeBuffer:0,timeLastTick:null,maxUpdates:null,maxFrameTime:33.333333333333336,lastUpdatesDeferred:0,enabled:!0},h=o.extend(f,c);return h.fps=0,h},t.run=function(c,f){return c.timeBuffer=t._frameDeltaFallback,function h(l){c.frameRequestId=t._onNextFrame(c,h),l&&c.enabled&&t.tick(c,f,l)}(),c},t.tick=function(c,f,h){var l=o.now(),d=c.delta,p=0,m=h-c.timeLastTick;if((!m||!c.timeLastTick||m>Math.max(t._maxFrameDelta,c.maxFrameTime))&&(m=c.frameDelta||t._frameDeltaFallback),c.frameDeltaSmoothing){c.frameDeltaHistory.push(m),c.frameDeltaHistory=c.frameDeltaHistory.slice(-c.frameDeltaHistorySize);var x=c.frameDeltaHistory.slice(0).sort(),T=c.frameDeltaHistory.slice(x.length*t._smoothingLowerBound,x.length*t._smoothingUpperBound),v=u(T);m=v||m}c.frameDeltaSnapping&&(m=1e3/Math.round(1e3/m)),c.frameDelta=m,c.timeLastTick=h,c.timeBuffer+=c.frameDelta,c.timeBuffer=o.clamp(c.timeBuffer,0,c.frameDelta+d*t._timeBufferMargin),c.lastUpdatesDeferred=0;var b=c.maxUpdates||Math.ceil(c.maxFrameTime/d),g={timestamp:f.timing.timestamp};r.trigger(c,"beforeTick",g),r.trigger(c,"tick",g);for(var w=o.now();d>0&&c.timeBuffer>=d*t._timeBufferMargin;){r.trigger(c,"beforeUpdate",g),a.update(f,d),r.trigger(c,"afterUpdate",g),c.timeBuffer-=d,p+=1;var S=o.now()-l,A=o.now()-w,P=S+t._elapsedNextEstimate*A/p;if(p>=b||P>c.maxFrameTime){c.lastUpdatesDeferred=Math.round(Math.max(0,c.timeBuffer/d-t._timeBufferMargin));break}}f.timing.lastUpdatesPerFrame=p,r.trigger(c,"afterTick",g),c.frameDeltaHistory.length>=100&&(c.lastUpdatesDeferred&&Math.round(c.frameDelta/d)>b?o.warnOnce("Matter.Runner: runner reached runner.maxUpdates, see docs."):c.lastUpdatesDeferred&&o.warnOnce("Matter.Runner: runner reached runner.maxFrameTime, see docs."),typeof c.isFixed<"u"&&o.warnOnce("Matter.Runner: runner.isFixed is now redundant, see docs."),(c.deltaMin||c.deltaMax)&&o.warnOnce("Matter.Runner: runner.deltaMin and runner.deltaMax were removed, see docs."),c.fps!==0&&o.warnOnce("Matter.Runner: runner.fps was replaced by runner.delta, see docs."))},t.stop=function(c){t._cancelNextFrame(c)},t._onNextFrame=function(c,f){if(typeof window<"u"&&window.requestAnimationFrame)c.frameRequestId=window.requestAnimationFrame(f);else throw new Error("Matter.Runner: missing required global window.requestAnimationFrame.");return c.frameRequestId},t._cancelNextFrame=function(c){if(typeof window<"u"&&window.cancelAnimationFrame)window.cancelAnimationFrame(c.frameRequestId);else throw new Error("Matter.Runner: missing required global window.cancelAnimationFrame.")};var u=function(c){for(var f=0,h=c.length,l=0;l<h;l+=1)f+=c[l];return f/h||0}})()},function(n,s,i){var t={};n.exports=t;var r=i(8),a=i(0),o=a.deprecated;(function(){t.collides=function(u,c){return r.collides(u,c)},o(t,"collides","SAT.collides  replaced by Collision.collides")})()},function(n,s,i){var t={};n.exports=t,i(1);var r=i(0);(function(){t.pathToVertices=function(a,o){typeof window<"u"&&!("SVGPathSeg"in window)&&r.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var u,c,f,h,l,d,p,m,x,T,v=[],b,g,w=0,S=0,A=0;o=o||15;var P=function(L,E,D){var V=D%2===1&&D>1;if(!x||L!=x.x||E!=x.y){x&&V?(b=x.x,g=x.y):(b=0,g=0);var z={x:b+L,y:g+E};(V||!x)&&(x=z),v.push(z),S=b+L,A=g+E}},M=function(L){var E=L.pathSegTypeAsLetter.toUpperCase();if(E!=="Z"){switch(E){case"M":case"L":case"T":case"C":case"S":case"Q":S=L.x,A=L.y;break;case"H":S=L.x;break;case"V":A=L.y;break}P(S,A,L.pathSegType)}};for(t._svgPathToAbsolute(a),f=a.getTotalLength(),d=[],u=0;u<a.pathSegList.numberOfItems;u+=1)d.push(a.pathSegList.getItem(u));for(p=d.concat();w<f;){if(T=a.getPathSegAtLength(w),l=d[T],l!=m){for(;p.length&&p[0]!=l;)M(p.shift());m=l}switch(l.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":h=a.getPointAtLength(w),P(h.x,h.y,0);break}w+=o}for(u=0,c=p.length;u<c;++u)M(p[u]);return v},t._svgPathToAbsolute=function(a){for(var o,u,c,f,h,l,d=a.pathSegList,p=0,m=0,x=d.numberOfItems,T=0;T<x;++T){var v=d.getItem(T),b=v.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(b))"x"in v&&(p=v.x),"y"in v&&(m=v.y);else switch("x1"in v&&(c=p+v.x1),"x2"in v&&(h=p+v.x2),"y1"in v&&(f=m+v.y1),"y2"in v&&(l=m+v.y2),"x"in v&&(p+=v.x),"y"in v&&(m+=v.y),b){case"m":d.replaceItem(a.createSVGPathSegMovetoAbs(p,m),T);break;case"l":d.replaceItem(a.createSVGPathSegLinetoAbs(p,m),T);break;case"h":d.replaceItem(a.createSVGPathSegLinetoHorizontalAbs(p),T);break;case"v":d.replaceItem(a.createSVGPathSegLinetoVerticalAbs(m),T);break;case"c":d.replaceItem(a.createSVGPathSegCurvetoCubicAbs(p,m,c,f,h,l),T);break;case"s":d.replaceItem(a.createSVGPathSegCurvetoCubicSmoothAbs(p,m,h,l),T);break;case"q":d.replaceItem(a.createSVGPathSegCurvetoQuadraticAbs(p,m,c,f),T);break;case"t":d.replaceItem(a.createSVGPathSegCurvetoQuadraticSmoothAbs(p,m),T);break;case"a":d.replaceItem(a.createSVGPathSegArcAbs(p,m,v.r1,v.r2,v.angle,v.largeArcFlag,v.sweepFlag),T);break;case"z":case"Z":p=o,m=u;break}(b=="M"||b=="m")&&(o=p,u=m)}}})()},function(n,s,i){var t={};n.exports=t;var r=i(6);i(0),function(){t.create=r.create,t.add=r.add,t.remove=r.remove,t.clear=r.clear,t.addComposite=r.addComposite,t.addBody=r.addBody,t.addConstraint=r.addConstraint}()}])})})(ta);class na extends Zo{constructor(){super({key:"MainScene"})}init(){this.accessThirdDimension()}create(){const e=new he(8421504);this.third.physics.add.box({x:0,y:-2,z:0,width:10,height:1,depth:10},{lambert:{color:e}}),this.third.physics.add.box({x:0,y:5,z:0},{lambert:{color:"blue"}}),this.add.text(10,10,"Phaser + Three.js + Ammo.js",{color:"#ffffff"})}}const sa={type:Ft.WEBGL,transparent:!0,scale:{mode:Ft.Scale.FIT,autoCenter:Ft.Scale.CENTER_BOTH,width:1280,height:720},scene:[na],...ea()};window.addEventListener("load",()=>{$o(()=>new Ft.Game(sa)).withPhysics("/lib")});
